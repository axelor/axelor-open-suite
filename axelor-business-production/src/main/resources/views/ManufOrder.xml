<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_7.4.xsd">

  <form id="business-production-manuf-order-form" name="manuf-order-form"
    title="Manufacturing order" model="com.axelor.apps.production.db.ManufOrder" extension="true">

    <extend target="//field[@name='isConsProOnOperation']">
      <insert position="after">
        <field name="isToInvoice" onChange="save,action-manuf-order-method-is-to-invoice"
          if-module="axelor-business-production"
          if="__config__.app.getApp('production')?.getManageBusinessProduction()"/>
        <field name="invoiced" showIf="isToInvoice" if-module="axelor-business-production"
          if="__config__.app.getApp('production')?.getManageBusinessProduction()"/>
      </insert>
    </extend>
  </form>

  <action-method name="action-manuf-order-method-is-to-invoice">
    <call class="com.axelor.apps.businessproduction.web.ManufOrderBusinessController"
      method="propagateIsToInvoice"/>
  </action-method>

  <action-method name="action-businessproduction-manuf-order-method-check-timesheet">
    <call class="com.axelor.apps.businessproduction.web.ManufOrderBusinessController"
      method="alertNonValidatedTimesheet"/>
  </action-method>

  <search-filters id="business-production-manuf-order-filters"
    name="manuf-order-filters" model="com.axelor.apps.production.db.ManufOrder"
    title="Manufacturing order filters">
    <field name="company" hidden="true"
      if="!__config__.app.getApp('base')?.getEnableMultiCompany()"/>
    <field name="workshopStockLocation" hidden="true"
      if="!__config__.app.getApp('production')?.getManageWorkshop()"/>
    <field name="isToInvoice" hidden="true"
      if="!__config__.app.getApp('production')?.getManageBusinessProduction()"/>
    <field name="invoiced" hidden="true"
      if="!__config__.app.getApp('production')?.getManageBusinessProduction()"/>
    <filter name="manuf-order-filters-draft-mos" title="Draft MOs">
      <domain>self.statusSelect = 1</domain>
    </filter>
    <filter name="manuf-order-filters-planned-mos" title="Planned MOs">
      <domain>self.statusSelect = 3</domain>
    </filter>
    <filter name="manuf-order-filters-mos-in-progress" title="MOs In Progress">
      <domain>self.statusSelect = 4</domain>
    </filter>
    <filter name="manuf-order-filters-mos-in-standby" title="MOs In Standby">
      <domain>self.statusSelect = 5</domain>
    </filter>
    <filter name="manuf-order-filters-finished-mos" title="Finished MOs">
      <domain>self.statusSelect = 6</domain>
    </filter>
    <filter name="manuf-order-filters-mos-to-invoice" title="MOs to invoice">
      <domain>self.isToInvoice = true</domain>
    </filter>
    <filter name="manuf-order-filters-cancelled-mos" title="Cancelled MOs">
      <domain>self.statusSelect = 2</domain>
    </filter>
    <filter name="manuf-order-filters-late-planned-mos" title="Late Planned MOs">
      <domain>self.statusSelect = 3 AND self.plannedStartDateT &lt; :_todayDateTime</domain>
    </filter>
    <filter name="manuf-order-filters-mos-finished-late" title="MOs Finished late">
      <domain>self.statusSelect = 6 AND self.plannedEndDateT &lt; self.realEndDateT</domain>
    </filter>
  </search-filters>

  <action-group id="business-production-action-manuf-order-group-finish"
    name="action-manuf-order-group-finish">
    <action name="action-businessproduction-manuf-order-method-check-timesheet"
      if="__config__.app.getApp('production')?.getEnableTimesheetOnManufOrder()"/>
    <action name="action-manuf-order-method-finish"/>
  </action-group>

</object-views>