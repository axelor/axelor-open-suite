/*
 * Axelor Business Solutions
 *
 * Copyright (C) 2022 Axelor (<http://axelor.com>).
 *
 * This program is free software: you can redistribute it and/or  modify
 * it under the terms of the GNU Affero General Public License, version 3,
 * as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
(this["webpackJsonpaxelor-dms"]=this["webpackJsonpaxelor-dms"]||[]).push([[0],{119:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=119},220:function(e,t,a){e.exports=a(292)},252:function(e,t){},254:function(e,t){},255:function(e,t){},256:function(e,t){},257:function(e,t){},290:function(e,t,a){},291:function(e,t,a){},292:function(e,t,a){"use strict";a.r(t);var n,r=a(0),i=a.n(r),o=a(17),l=a.n(o),c=a(6),s=a(7),u=a(347),d=a(390),m=a(348),f=a(198),p=a(169),v=a.n(p),h=a(170),b=a.n(h),g=a(349),C=Object(u.a)({dangerouslyUseGlobalCSS:!1,productionPrefix:"c"});function E(e){var t=e.direction,a=e.palette,o=e.children;Object(r.useEffect)((function(){t?document.body.dir=t:document.body.removeAttribute("dir")}));var l=function(e){var t=e.direction,a=void 0===t?"ltr":t,r=e.palette;return void 0===n&&(n=document.body.dir||document.dir),a=a||n,Object(f.a)({direction:a,layout:{cols:12},header:{height:64},palette:Object(c.a)({primary:v.a,secondary:b.a},r),typography:{useNextVariants:!0}})}({direction:t,palette:a});return(i.a.createElement(d.b,{generateClassName:C},i.a.createElement(m.a,{theme:l},i.a.createElement(g.a,null),o)))}var O=a(16),y=a.n(O),j=a(24),k=a(8),w=a(387),x=a(134),N="PENDING",S="COMPLETED",F="CANCEL";function I(e){return 0===e.indexOf("-")?"desc":"asc"}function T(e){return 0===e.indexOf("-")?e.substring(1):e}function P(e){return window._t&&"string"===typeof e?window._t(e):e}var D=[{name:"fileName",title:"File Name",type:"STRING"},{name:"content",title:"Content",type:"STRING"},{name:"contentType",title:"Content type",type:"STRING"},{name:"createdOn",title:"Created on",type:"DATETIME"},{name:"createdBy",title:"Created by",type:"MANY_TO_ONE",target:"com.axelor.auth.db.User",targetName:"fullName"},{name:"importId",title:"Import ID",type:"STRING"},{name:"isDirectory",title:"Is directory",type:"BOOLEAN"},{name:"updatedOn",title:"Updated on",type:"DATETIME"},{name:"updatedBy",title:"Updated by",type:"MANY_TO_ONE",target:"com.axelor.auth.db.User",targetName:"fullName"},{name:"tag",title:"Tag",type:"MANY_TO_MANY",target:"com.axelor.dms.db.DMSFileTag",targetName:"name"},{name:"importOrigin",title:"Imported from",type:"STRING"}],L=[{title:P("Can read"),id:"READ"},{title:P("Can write"),id:"WRITE"},{title:P("Can share"),id:"FULL"}],V=a(14),B=a(150),M=a(391),R=a(131),U=a.n(R),z=a(130),A=a.n(z),W=a(175),_=a.n(W),H=a(11),q=a.n(H),G=a(172),K=a(351);var Y=function(e){var t=e.item,a=e.menuOptions,n=i.a.useState(),r=Object(s.a)(n,2),o=r[0],l=r[1],c=i.a.useCallback((function(e){0!==a.length&&(e.preventDefault(),l({mouseX:e.clientX-2,mouseY:e.clientY-4}))}),[a]),u=i.a.useCallback((function(){l()}),[]),d=i.a.useCallback((function(e,a){e.stopPropagation(),u(),a.method(t)}),[u,t]);return i.a.createElement("div",{onContextMenu:function(e){e.stopPropagation(),e.preventDefault(),c(e)}},e.children,i.a.createElement(G.a,{keepMounted:!0,open:Boolean(o),onClose:u,anchorReference:"anchorPosition",anchorPosition:o?{top:o.mouseY,left:o.mouseX}:void 0},a.map((function(e,t){return i.a.createElement(K.a,{key:t,onClick:function(t){return d(t,e)}},e.title)}))))},X=a(352),J=a(353),Q=a(354),$=a(356),Z=a(299),ee=a(355),te=Object(M.a)((function(e){return{form:{display:"flex",flexDirection:"column"},input:{marginBottom:25}}}));var ae=function(e){var t=e.onClose,a=e.open,n=e.onSave,r=i.a.useState(""),o=Object(s.a)(r,2),l=o[0],c=o[1],u=te(),d=i.a.useCallback((function(e){c(e.target.value)}),[]),m=i.a.useCallback((function(e){c(""),t()}),[t]),f=i.a.useCallback((function(e){""!==l?(n(l),c("")):alert(P("Folder name is required"))}),[l,n]);return i.a.createElement(X.a,{onClose:m,"aria-labelledby":"simple-dialog-title",open:a,maxWidth:"xs",fullWidth:!0},i.a.createElement(J.a,null,P("New Folder")),i.a.createElement(Q.a,{className:u.form},i.a.createElement(ee.a,{className:u.input,name:"name",value:l,onChange:d,placeholder:P("Folder name")})),i.a.createElement($.a,null,i.a.createElement(Z.a,{onClick:f,variant:"contained",color:"primary"},P("Save")),i.a.createElement(Z.a,{onClick:m,variant:"outlined"},P("Cancel"))))},ne=Object(M.a)((function(e){return{dmsTreeContainer:{width:300,paddingRight:10,maxHeight:"60%",marginBottom:15,overflow:"auto"},treeElement:{padding:5,display:"flex"},treeElementContainer:{cursor:"pointer","&:hover":{backgroundColor:"rgba(0, 0, 0, .05)"}},selected:{backgroundColor:"rgba(0, 0, 0, .03)"},expandIcon:{marginTop:-3,cursor:"pointer"},folderIcon:{fontSize:"1.3rem",marginRight:5},noChildren:{paddingLeft:24}}}));function re(e){var t=ne(),a=!1===e.isCollapse?A.a:U.a;return i.a.createElement(a,{className:t.expandIcon,onClick:e.onClick})}var ie=function(e){var t=e.data,a=e.currentFolder,n=e.handleFolder,o=e.onFolderCreate,l=ne(),c=Object(r.useState)([]),u=Object(s.a)(c,2),d=u[0],m=u[1],f=i.a.useState(),p=Object(s.a)(f,2),v=p[0],h=p[1],b=i.a.useCallback((function(e,t){var a=t.id;e&&e.stopPropagation();var n=!0;a&&m((function(e){var t=e.indexOf(a);return n&&(n=!1,t>-1?e.splice(t,1):e.push(a)),Object(k.a)(e)}))}),[]),g=i.a.useCallback((function(e,t){n(t)}),[n]),C=i.a.useCallback((function(e){var t={fileName:e,isDirectory:!0,relatedId:v.relatedId,relatedModel:v.relatedModel,parent:{id:v.id},favouriteUserSet:[]};o(t),h()}),[o,v]),E=i.a.useCallback((function(e){h(e)}),[]),O=i.a.useCallback((function(){h()}),[]),y=[{title:"New Folder",method:E}];Object(r.useEffect)((function(){b(null,{id:a})}),[a,b]);var j=t&&t[0];return(i.a.createElement("div",{className:l.dmsTreeContainer},j&&function e(n,r){return n.map((function(n,o){var c=function(e,t,a){return e.filter((function(e){return e[a]===t}))}(t,n.id,"parent.id"),s=!d.includes(n.id);return i.a.createElement(i.a.Fragment,{key:o},i.a.createElement(Y,{menuOptions:y,item:n},i.a.createElement("div",{className:q()(l.treeElementContainer,n.id===a&&l.selected),onClick:function(e){return g(e,n)}},i.a.createElement("div",{className:q()(l.treeElement,Object(V.a)({},l.noChildren,0===c.length)),style:{marginLeft:15*r}},c.length>0&&i.a.createElement(re,{onClick:function(e){return b(e,n)},isCollapse:s}),i.a.createElement(_.a,{className:l.folderIcon}),i.a.createElement("span",null,n.fileName))),!s&&e(c,r+1)))}))}([j],1),i.a.createElement(ae,{onClose:O,open:Boolean(v),onSave:C})))},oe=a(99),le=a(393),ce=a(358),se=a(389),ue=a(181),de=a.n(ue),me=a(176),fe=a.n(me),pe=a(177),ve=a.n(pe),he=a(62),be=a.n(he),ge=Object(M.a)((function(e){return{noDocumentsFound:{display:"flex",justifyContent:"center",width:"100%"},listContainer:{width:"100%",height:"100%"},listHeaderContainer:{padding:10,display:"flex"},listContentContainer:{overflow:"auto",height:"calc(100% - 120px)"},listHeaderCell:{padding:5,display:"flex"},sortIcon:{width:"0.90em",height:"0.90em",marginTop:2,marginLeft:5},recordLine:{display:"flex",padding:10,borderBottom:"1px solid rgb(224,224,224)","&:hover":{backgroundColor:"rgba(0, 0, 0, .05)"}},selectedRecordLine:{backgroundColor:"rgba(0, 0, 0, 0.2) !important"},ellipseTypo:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},ellipse:{whiteSpace:"nowrap"},columnTitle:{textTransform:"capitalize"},starIconView:{paddingTop:"2px",display:"flex",justifyContent:"center"},starIcon:{alignSelf:"center",color:"#ffc107",fontSize:20,cursor:"pointer"}}})),Ce=[{name:"typeIcon",title:"",width:"34px"},{name:"fileName",title:"File Name",width:"50%",canSort:!0},{name:"starIcon",title:"",width:"34px"},{name:"updatedOn",title:"Updated On",width:"15%",canSort:!0},{name:"updatedBy",title:"Updated By",width:"15%",canSort:!0},{name:"metaFile.sizeText",title:"File Size",width:"15%",canSort:!0}],Ee=function(e,t){if(!t.canWrite){var a=e.findIndex((function(e){return e.title===P("Delete")}));e.splice(a,1)}return e},Oe=function(e){var t=e.selectedFiles,a=e.onSorting,n=e.sortingField,o=void 0===n?"":n,l=e.menuOptions,c=e.fields,s=e.data,u=e.onClick,d=e.userId,m=e.handleFavourite,f=ge(),p=function(e){return-1!==t.findIndex((function(t){return t.id===e.id}))},v=[].concat(Ce,Object(k.a)(c)),h=Object(r.useCallback)((function(e){var t=o.indexOf(e.name);a(0===t?"-".concat(e.name):e.name)}),[o,a]);return i.a.createElement("div",{className:f.listContainer},s&&0!==s.length?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:f.listHeaderContainer},v.map((function(e,t){return i.a.createElement("div",{key:t,className:f.listHeaderCell,style:{width:e.width},onClick:function(){return e.canSort&&h(e)}},i.a.createElement(oe.a,{noWrap:!0,className:f.columnTitle},P(e.title)),T(o)===e.name&&i.a.createElement(i.a.Fragment,null,"desc"===I(o)?i.a.createElement(fe.a,{className:f.sortIcon}):i.a.createElement(ve.a,{className:f.sortIcon})))}))),i.a.createElement("div",{className:f.listContentContainer},s.map((function(e){return i.a.createElement(Y,{key:e.id,menuOptions:Ee(l,e),item:e},i.a.createElement("div",{className:q()(f.recordLine,p(e)&&f.selectedRecordLine),onClick:function(t){return u(t,e)}},v.map((function(t,a){return i.a.createElement("div",{key:a,className:q()(f.listHeaderCell,f.ellipse,Object(V.a)({},f.starIconView,"starIcon"===t.name)),style:{width:t.width}},"typeIcon"===t.name?i.a.createElement("i",{className:e[t.name],style:{alignSelf:"center"}}):"starIcon"===t.name&&function(e,t){return-1!==(e.favouriteUserSet||[]).findIndex((function(e){return e.id===t}))}(e,d)?i.a.createElement("i",{className:q()("fa fa-star",f.starIcon),onClick:function(t){return function(e,t){e.stopPropagation(),m(t)}(t,e)}}):i.a.createElement(oe.a,{noWrap:!0,className:f.ellipseTypo},"updatedOn"===t.name?be()(e.updatedOn).format("L LT"):(n=e[t.name])&&"object"===typeof n?n.fullName:n));var n}))))})))):i.a.createElement("div",{className:f.noDocumentsFound},P("No documents found.")))},ye=a(179),je=a.n(ye),ke=a(178),we=a.n(ke),xe=a(357),Ne=Object(B.a)((function(e){return{noDocumentsFound:{display:"flex",justifyContent:"center",width:"100%"},listContainer:{width:"100%",height:"100%"},listHeaderContainer:{padding:10,display:"flex"},listContentContainer:Object(V.a)({display:"flex",flexWrap:"wrap",height:"calc(100% - 75px)",overflow:"auto",alignContent:"baseline"},e.breakpoints.only("xs"),{justifyContent:"center"}),listHeaderCell:{padding:5},recordLine:{display:"flex",padding:10,border:"1px solid rgb(224,224,224)",margin:"10px 0 0 10px",borderRadius:2,width:350,height:75,"&:hover":{backgroundColor:"rgba(0, 0, 0, .05)"}},selectedRecordLine:{backgroundColor:"rgba(0, 0, 0, 0.2) !important"},ellipseTypo:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},ellipse:{whiteSpace:"nowrap"},imageIconView:{display:"flex",alignItems:"center",justifyContent:"center",width:50,height:"100%",alignSelf:"center"},fileName:{fontSize:"12px !important",fontWeight:"bold !important"},updatedText:{fontSize:"12px !important"},infoContainer:{display:"flex",maxWidth:"calc(100% - 50px - 8px)",marginLeft:8,flexDirection:"column",justifyContent:"space-between",flex:1},infoRow:{display:"flex",justifyContent:"space-between"},actionView:{height:20},actionIcon:{width:20,height:20,cursor:"pointer"},selectedStar:{color:xe.a[500]},thumbnailImage:{maxWidth:"100%",maxHeight:"100%"},thumbnailTypeIcon:{fontSize:50,display:"flex",justifyContent:"center"}}})),Se=function(e){var t=e.item,a=Ne();return t.id?t.fileType&&-1!==t.fileType.indexOf("image")?i.a.createElement("img",{src:hr(t.id),alt:P("Thumbnail"),className:a.thumbnailImage}):i.a.createElement("i",{className:q()(t.typeIcon,a.thumbnailTypeIcon)}):null},Fe=function(e){var t=e.menuOptions,a=e.userId,n=e.selectedFiles,r=e.onClick,o=e.data,l=e.handleFavourite,c=Ne(),s=function(e){return-1!==n.findIndex((function(t){return t.id===e.id}))};return i.a.createElement("div",{className:c.listContainer},o&&0!==o.length?i.a.createElement("div",{className:c.listContentContainer},o.map((function(e){return i.a.createElement(Y,{key:e.id,menuOptions:t,item:e},i.a.createElement("div",{className:q()(c.recordLine,s(e)&&c.selectedRecordLine),onClick:function(t){return r(t,e)}},i.a.createElement("div",{className:c.imageIconView},i.a.createElement(Se,{item:e})),i.a.createElement("div",{className:c.infoContainer},i.a.createElement("div",{className:q()(c.ellipse)},i.a.createElement(oe.a,{className:q()(c.ellipseTypo,c.fileName)},e.fileName)),i.a.createElement("div",{className:q()(c.ellipse,c.infoRow)},i.a.createElement(oe.a,{className:q()(c.ellipseTypo,c.updatedText)},be()(e.updatedOn).format("L LT")),i.a.createElement("div",{className:q()(c.actionView),onClick:function(t){return function(e,t){e.stopPropagation(),l(t)}(t,e)}},function(e,t){return-1!==(e.favouriteUserSet||[]).findIndex((function(e){return e.id===t}))}(e,a)?i.a.createElement(we.a,{className:q()(c.actionIcon,c.selectedStar)}):i.a.createElement(je.a,{className:c.actionIcon}))))))}))):i.a.createElement("div",{className:c.noDocumentsFound},P("No documents found.")))},Ie=Object(M.a)((function(e){return{form:{display:"flex",flexDirection:"column"},input:{marginBottom:25}}}));var Te=function(e){var t=e.onClose,a=e.open,n=e.onConfirm,r=e.name,o=Ie(),l=i.a.useCallback((function(e){t()}),[t]);return i.a.createElement(X.a,{onClose:l,"aria-labelledby":"simple-dialog-title",open:a,maxWidth:"xs",fullWidth:!0},i.a.createElement(J.a,null,P("Question")),i.a.createElement(Q.a,{className:o.form},i.a.createElement(oe.a,null,P("Are you sure you want to delete")," ",i.a.createElement("b",null,r),"?"),i.a.createElement(oe.a,null,P("All old versions will also removed."))),i.a.createElement($.a,null,i.a.createElement(Z.a,{onClick:n,variant:"contained",color:"primary"},P("Delete")),i.a.createElement(Z.a,{onClick:l,variant:"outlined"},P("Cancel"))))},Pe=Object(M.a)((function(e){return{gridViewWrapper:{width:"100%",position:"relative",height:"100%"},dropOverlayContainer:{position:"absolute",backgroundColor:"rgba(0,0,0,0.2)",width:"100%",top:0,left:0,height:"100%"},homeCrumb:{display:"flex",alignItems:"center"},homeIcon:{marginRight:5,color:"#0088cc"},crumbTypo:{lineHeight:2,color:"#0088cc",cursor:"pointer",borderBottom:"1px solid transparent","&:hover":{borderBottom:"1px solid #0088cc"}},lastCrumbTypo:{cursor:"auto",borderBottom:"none","&:hover":{borderBottom:"none"}},breadcrumb:{padding:20,"& > ol":{flexWrap:"noWrap",whiteSpace:"noWrap",overflow:"auto"}}}}));function De(){var e=Pe();return(i.a.createElement("div",{className:e.dropOverlayContainer}))}var Le=function(e){var t=Pe(),a=i.a.useRef(null),n=e.viewMode,r=e.onSelect,o=e.onFolderDoubleClick,l=e.selectedFiles,u=e.sortingField,d=e.onDelete,m=e.breadcrumb,f=e.userId,p=e.onFavouriteDocument,v=e.customFields,h=i.a.useState(0),b=Object(s.a)(h,2),g=b[0],C=b[1],E=i.a.useState(),O=Object(s.a)(E,2),y=O[0],j=O[1],k=i.a.useState(),w=Object(s.a)(k,2),N=w[0],S=w[1],F=i.a.useCallback((function(){var e=y.record;e.isDirectory&&o(e)}),[o,y]),I=i.a.useCallback((function(){var e=y.e,t=y.record;r(t,e.ctrlKey)}),[r,y]),T=i.a.useCallback((function(e,t){C((function(e){return e+1})),j({e:Object(c.a)({},e),record:t})}),[]);i.a.useEffect((function(){var e;return 1===g?e=setTimeout((function(){I(),C(0)}),250):2===g&&(F(),C(0)),function(){return clearTimeout(e)}}),[g,F,I]);var D=i.a.useCallback((function(e){S(e)}),[]),L=i.a.useCallback((function(){d(N),S()}),[N,d]),B=i.a.useCallback((function(){S()}),[]),M=i.a.useCallback((function(e){o(e)}),[o]),R=i.a.useCallback((function(e,a){return i.a.createElement(oe.a,{key:e.id,className:q()(t.crumbTypo,Object(V.a)({},t.lastCrumbTypo,a)),onClick:function(t){return!a&&M(e)}},e.fileName)}),[M,t]),U=i.a.useCallback((function(e){p(e)}),[p]),z=i.a.useCallback((function(){return v.map((function(e){return{name:"".concat(e.modelField,".").concat(e.name),minWidth:"15%",title:e.name,canSort:!0}}))}),[v]),A=Object(se.a)({accept:[x.a.FILE],drop:function(t,a){e.handleFileUpload(a.getItem().files)},collect:function(e){return{isOver:e.isOver(),canDrop:e.canDrop()}}}),W=Object(s.a)(A,2),_=W[0];(0,W[1])(a);var H=[{title:P("Delete"),method:D},{title:P("Favourite"),method:U}];return(i.a.createElement("div",{ref:a,className:t.gridViewWrapper},_.isOver&&_.canDrop&&i.a.createElement(De,null),i.a.createElement(le.a,{classes:{root:t.breadcrumb},"aria-label":"breadcrumb"},m.map((function(e,a){return 0===a?i.a.createElement(ce.a,{key:e.id,className:t.homeCrumb},i.a.createElement(de.a,{className:t.homeIcon}),R(e,m.length-1===a)):R(e,m.length-1===a)}))),"list"===n?i.a.createElement(Oe,{menuOptions:H,data:e.data,onClick:T,selectedFiles:l,onSorting:e.onSorting,sortingField:u,userId:f,fields:z(),handleFavourite:U}):i.a.createElement(Fe,{menuOptions:H,data:e.data,onClick:T,selectedFiles:l,onSorting:e.onSorting,sortingField:u,userId:f,handleFavourite:U}),i.a.createElement(Te,{open:Boolean(N),name:null===N||void 0===N?void 0:N.fileName,onConfirm:L,onClose:B})))},Ve=a(199),Be=a(360),Me=a(394);function Re(e){var t=e.DesktopView,a=e.MobileView,n=e.viewProps,r=e.desktopViewProps,o=e.mobileViewProps;return(i.a.createElement(i.a.Fragment,null,i.a.createElement(Me.a,{only:"xs"},i.a.createElement(t,Object.assign({},n,r))),i.a.createElement(Me.a,{smUp:!0},i.a.createElement(a,Object.assign({},n,o)))))}Re.defaultProps={DesktopView:function(){},MobileView:function(){},desktopViewProps:{},mobileViewProps:{},viewProps:{}};var Ue=Re,ze=a(300),Ae=i.a.forwardRef((function(e,t){return i.a.createElement(ze.a,Object.assign({direction:"left",ref:t},e))})),We=Object(M.a)((function(e){return{uploadViewContainer:{position:"absolute",bottom:20,right:20,width:600,minHeight:150,maxHeight:500,zIndex:9999},uploadViewCard:{width:"100%",height:"100%"},uploadList:{overflow:"auto",padding:5,maxHeight:450},fileInfoView:{display:"flex",justifyContent:"flex-end",padding:"5px 0px"},progressView:{width:150,height:20,margin:5},fileNameText:{lineHeight:2},titleView:{padding:10,borderBottom:"2px solid #ddd"},actionText:{textTransform:"capitalize !important"},actionButton:{padding:"0px !important"}}}));function _e(e){var t=e.droppedFiles,a=e.cancelUpload,n=e.retryUpload,r=We(),o=i.a.useState(!1),l=Object(s.a)(o,2),c=l[0],u=l[1];i.a.useEffect((function(){t.length>0?u(!0):u(!1)}),[t]);var d=i.a.useCallback((function(){u(!1)}),[]);return(i.a.createElement(X.a,{onClose:d,"aria-labelledby":"simple-dialog-title",open:c,fullScreen:!0,TransitionComponent:Ae},i.a.createElement(J.a,null,P("Upload completed")),i.a.createElement(Q.a,null,t.map((function(e,t){return i.a.createElement("div",{key:t,className:r.fileInfoView},i.a.createElement(oe.a,{className:r.fileNameText,noWrap:!0},e.file.name),i.a.createElement(Be.a,{className:r.progressView,variant:"determinate",value:e.progress}),i.a.createElement("div",{className:r.actionView},e.status===N&&i.a.createElement(Z.a,{className:r.actionButton,variant:"outlined",onClick:function(){return a(e.id)}},i.a.createElement(oe.a,{className:r.actionText},P("Cancel"))),e.status===F&&i.a.createElement(Z.a,{className:r.actionButton,variant:"outlined",onClick:function(){return n(e.id)}},i.a.createElement(oe.a,{className:r.actionText},P("Retry")))))})))))}function He(e){var t=e.droppedFiles,a=e.cancelUpload,n=e.retryUpload,r=We();return t.length?i.a.createElement("div",{className:r.uploadViewContainer},i.a.createElement(Ve.a,{className:r.uploadViewCard},i.a.createElement("div",{className:r.titleView},i.a.createElement(oe.a,null,P("Upload completed"))),i.a.createElement("div",{className:r.uploadList},t.map((function(e,t){return i.a.createElement("div",{key:t,className:r.fileInfoView},i.a.createElement("span",{className:r.fileNameText},e.file.name),i.a.createElement(Be.a,{className:r.progressView,variant:"determinate",value:e.progress}),i.a.createElement("div",{className:r.actionView},e.status===N&&i.a.createElement(Z.a,{className:r.actionButton,variant:"outlined",onClick:function(){return a(e.id)}},i.a.createElement(oe.a,{className:r.actionText},P("Cancel"))),e.status===F&&i.a.createElement(Z.a,{className:r.actionButton,variant:"outlined",onClick:function(){return n(e.id)}},i.a.createElement(oe.a,{className:r.actionText},P("Retry")))))}))))):null}var qe=function(e){return i.a.createElement(Ue,{DesktopView:He,MobileView:_e,viewProps:Object(c.a)({},e)})},Ge=a(305),Ke=a(372),Ye=a(296),Xe=a(301),Je=a(374),Qe=a(297),$e=a(298),Ze=a(3),et=a(361),tt=a(375),at=a(376),nt=a(377),rt=a(378),it=a(379),ot=a(380),lt=a(381),ct=a(382),st=a(367),ut=a(370),dt=a(373),mt=a(362),ft=a(369),pt=a(23),vt=a(397),ht=Object(B.a)((function(e){return{root:{display:"flex",borderBottom:"solid 1px rgba(0, 0, 0, 0.54)",marginBottom:"7px"},chip:{margin:"4px",height:30},list:{display:"flex",padding:"0 !important"},listItem:{padding:"0 !important"},divider:{width:1,height:28,margin:4},buttonContainer:{display:"flex",width:"100%",justifyContent:"flex-end",alignItems:"center",position:"relative",bottom:-3},inputIconBtn:{margin:0,padding:0,color:"#bbb"}}}));function bt(e){var t=e.value,a=e.onDelete,n=e.filters,r=e.handleClick,o=(Object(pt.a)(e,["value","onDelete","filters","handleClick"]),ht()),l="";if(t.length>1)l="Filters ".concat(t.length);else if(t.length){var c=n.find((function(e){return e.id===t[0]}));l=c?c.title:P("Custom")}return(i.a.createElement("div",{className:o.root},i.a.createElement(Qe.a,{className:o.list},i.a.createElement(vt.a,{label:l,onDelete:function(){return a(t)},className:o.chip})),i.a.createElement("div",{className:o.buttonContainer},i.a.createElement(Xe.a,{"aria-label":"open",onClick:r,className:o.inputIconBtn},i.a.createElement(et.a,null)),i.a.createElement(Xe.a,{"aria-label":"refresh",className:o.inputIconBtn},i.a.createElement(mt.a,null)))))}var gt=a(182),Ct=a(108),Et=a(183),Ot=a(184),yt=a(185);Ct.b.add(Et.a,Ot.a,yt.a);var jt=gt.a,kt=a(303),wt=a(359),xt=a(363),Nt=a(68),St=Object(B.a)((function(e){return{container:{display:"flex",justifyContent:"center",flexDirection:"column"},subtitle1:{fontSize:12},chip:{margin:e.spacing(.5,.25)},link:{cursor:"pointer"},mobleString:{alignItems:"flex-start !important",padding:5}}}));function Ft(e){var t=e.title,a=e.value,n=St(),r=Object(Nt.a)(),o=Object(wt.a)(r.breakpoints.up("sm"));return i.a.createElement("div",{className:q()(n.container,Object(V.a)({},n.mobleString,!o))},i.a.createElement(oe.a,{variant:"subtitle1",className:n.subtitle1},t),i.a.createElement(oe.a,null,a))}function It(e){var t=e.title,a=e.value,n=e.optionLabelKey,r=e.viewRecord,o=St();function l(e){var t=e&&e[n];return t&&i.a.createElement(xt.a,{className:o.link,onClick:function(){return r&&r(e)}},t)}return Array.isArray(a)?i.a.createElement("div",null,i.a.createElement(oe.a,{variant:"subtitle1",className:o.subtitle1},t),a.map((function(e,t){return i.a.createElement(vt.a,{key:t,label:l(e),className:o.chip})}))):i.a.createElement("div",null,i.a.createElement(oe.a,{variant:"subtitle1",className:o.subtitle1},t),a&&l(a))}function Tt(e){var t=e.title,a=e.value,n=e.customRender;return"object"!==typeof a||n?i.a.createElement(Ft,{title:t,value:a}):i.a.createElement(It,e)}function Pt(e){var t=e.name,a=e.title,n=e.autoTitle,r=e.value,o=void 0===r?"":r,l=e.onChange,u=e.onBlur,d=e.readOnly,m=e.inline,f=e.InputProps,p=e.style,v=e.isControlled,h=void 0===v||v,b=Object(pt.a)(e,["name","title","autoTitle","value","onChange","onBlur","readOnly","inline","InputProps","style","isControlled"]),g=i.a.useState(o),C=Object(s.a)(g,2),E=C[0],O=C[1];function y(e){l(E),u&&u(e)}function j(e){var t=e.target.value;h?O(t):l(t)}return i.a.useEffect((function(){O(o)}),[o]),m?d?i.a.createElement(Tt,{value:E}):i.a.createElement(ee.a,Object.assign({style:Object(c.a)({width:"100%"},p),placeholder:a,inputProps:{"aria-label":a},name:t,onChange:j,onBlur:y,autoComplete:"off",readOnly:d,disabled:d,value:E||""},b)):d?i.a.createElement(Tt,{title:a,value:E}):i.a.createElement(kt.a,Object.assign({id:"filled-".concat(t),label:a||n,name:t,style:Object(c.a)({width:"100%"},p),onChange:j,onBlur:y,autoComplete:"off",fullWidth:!0,InputProps:Object(c.a)({readOnly:d},f),value:E||"",className:b.className},b))}Pt.defaultProps={rows:3,readOnly:!1};var Dt=Pt,Lt=a(371),Vt=a(135),Bt=a(399),Mt=a(365),Rt=a(395),Ut=a(396);function zt(e){var t=e.title,a=e.className,n=e.onClick,r=Object(pt.a)(e,["title","className","onClick"]);return t&&i.a.createElement(xt.a,Object.assign({component:"button",variant:"body2",onClick:n,className:a},r),t)}function At(e){var t=e.name,a=e.className,n=e.onChange,r=e.value,o=e.classes,l=e.data;return(i.a.createElement(Bt.a,{"aria-label":t,name:t,className:a,value:r,onChange:function(e){return n(e)}},l.map((function(e,t){var a=e.value,n=e.label;return(i.a.createElement(Mt.a,{key:t,value:a,control:i.a.createElement(Rt.a,null),label:n,classes:{label:o&&o.label}}))}))))}function Wt(e){var t=e.name,a=e.value,n=e.onChange,r=e.title,o=e.inline,l=void 0!==o&&o,c=e.isDisabled,s=e.classes,u=Object(pt.a)(e,["name","value","onChange","title","inline","isDisabled","classes"]);return l?i.a.createElement(Ut.a,Object.assign({checked:Boolean(a),onChange:function(e){var t=e.target.checked;return n(t)},value:t,name:t,disabled:c},u)):i.a.createElement(Mt.a,{control:i.a.createElement(Ut.a,{checked:Boolean(a),onChange:function(e){var a=e.target.checked;return n({name:t,checked:a})},value:t}),label:r,classes:{label:s&&s.label}})}function _t(e){var t=e.classes,a=e.onClick,n=e.title,r=e.hide,o=e.className,l=Object(pt.a)(e,["classes","onClick","title","hide","className"]);return(i.a.createElement(Z.a,Object.assign({variant:"contained",color:"primary",className:q()(t.button,o),onClick:a},l,{style:r?{display:"none"}:{}}),n))}var Ht=a(392),qt=Object(B.a)((function(e){return{root:{display:"flex",flexWrap:"wrap"},select:{width:"150px"}}}));function Gt(e){var t=e.name,a=e.value,n=void 0===a?"":a,r=e.onChange,o=e.options,l=Object(pt.a)(e,["name","value","onChange","options"]),c=qt();return i.a.createElement(Ht.a,Object.assign({value:n,onChange:function(e){return r(e.target.value)},name:t,style:{marginRight:8},classes:{select:c.select}},l),o&&o.map((function(e,t){var a=e.name,n=e.title;return(i.a.createElement(K.a,{value:a,key:t},n))})))}var Kt=a(364),Yt=a(186),Xt=a(187),Jt=a.n(Xt),Qt=a(189),$t=a.n(Qt),Zt=a(197);var ea=Object(M.a)((function(e){return{formControl:{width:"100%",position:"relative","&.inline":{marginTop:3},".inline &":{paddingBottom:3}},inputRoot:{"& > div":{marginTop:"12px"}},root:{flexGrow:1},inputWrapper:{".inline & > *":{paddingBottom:3}},input:{display:"flex",padding:0,textOverflow:"ellipsis",position:"relative",whiteSpace:"nowrap",height:36,".single":{height:36},".inline &":{height:26}},valueContainer:{position:"relative",display:"flex",flexWrap:"wrap",flex:1,alignItems:"center",overflow:"hidden",".single > &":{flexWrap:"nowrap"},".inline &":{flexWrap:"nowrap"}},chip:{margin:e.spacing(.5,.25)},chipFocused:{backgroundColor:Object(Yt.emphasize)("light"===e.palette.type?e.palette.grey[300]:e.palette.grey[700],.08)},noOptionsMessage:{padding:e.spacing(1,2)},singleValue:{fontSize:16,textOverflow:"ellipsis",overflow:"hidden"},placeholder:{position:"absolute",left:2,bottom:6,fontSize:16,".inline &":{bottom:1}},divider:{height:e.spacing(2)},viewIcon:{display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",right:70,bottom:8,zIndex:1,cursor:"pointer","& svg":{fontSize:20,color:"#ddd","&:hover":{color:"#555"}}}}}));function ta(e){var t=e.inputRef,a=Object(pt.a)(e,["inputRef"]);return(i.a.createElement("div",Object.assign({ref:t},a)))}var aa={Control:function(e){var t=e.children,a=e.innerProps,n=e.innerRef,r=e.selectProps,o=r.classes,l=r.isMulti,s=r.TextFieldProps,u=r.InputProps;return(i.a.createElement(kt.a,Object.assign({className:o.inputWrapper,fullWidth:!0,classes:Object(c.a)({},s&&s.label&&{root:o.inputRoot}),InputProps:Object(c.a)({},u,{inputComponent:ta,inputProps:Object(c.a)({className:q()(o.input,{single:!l}),ref:n,children:t},a)})},s)))},MultiValue:function(e){var t={};return e.isDisabled||(t.onDelete=e.removeProps.onClick),i.a.createElement(vt.a,Object.assign({tabIndex:-1,label:e.children,className:Object(Ze.a)(e.selectProps.classes.chip,Object(V.a)({},e.selectProps.classes.chipFocused,e.isFocused)),deleteIcon:i.a.createElement(Jt.a,e.removeProps)},t))},NoOptionsMessage:function(e){return i.a.createElement(oe.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.noOptionsMessage},e.innerProps),e.children)},Option:function(e){return i.a.createElement(K.a,Object.assign({ref:e.innerRef,selected:e.isFocused,component:"div",style:{fontWeight:e.isSelected?500:400}},e.innerProps,{className:"menu-item"}),e.children)},Placeholder:function(e){return i.a.createElement(oe.a,Object.assign({color:"textSecondary",className:e.selectProps.classes.placeholder},e.innerProps),e.children)},SingleValue:function(e){return i.a.createElement(oe.a,Object.assign({className:e.selectProps.classes.singleValue},e.innerProps),e.children)},ValueContainer:function(e){return i.a.createElement("div",{className:q()(e.selectProps.classes.valueContainer,e.selectProps.valueContainerClassName)},e.children)}};function na(e){var t=ea(),a=Object(r.useState)(e.options||[]),n=Object(s.a)(a,2),o=n[0],l=n[1],u=Object(r.useState)(!1),d=Object(s.a)(u,2),m=d[0],f=d[1],p=i.a.useState(null),v=Object(s.a)(p,2),h=v[0],b=v[1],g=e.name,C=e.title,E=void 0===C?"":C,O=e.onChange,k=e.value,w=e.error,x=e.readOnly,N=void 0!==x&&x,S=e.isMulti,F=void 0!==S&&S,I=e.isSearchable,T=void 0!==I&&I,P=e.optionValueKey,D=void 0===P?"id":P,L=e.optionLabelKey,V=void 0===L?"title":L,B=e.fetchAPI,M=e.beforeFetchAPI,R=e.isPortal,U=e.inline,z=e.autoFocus,A=e.onFocus,W=e.InputProps,_=e.formControlStyle,H=e.clearIndicatorStyle,G=e.onView,K=Object(pt.a)(e,["name","title","onChange","value","error","readOnly","isMulti","isSearchable","optionValueKey","optionLabelKey","fetchAPI","beforeFetchAPI","isPortal","inline","autoFocus","onFocus","InputProps","formControlStyle","clearIndicatorStyle","onView"]),Y=i.a.useCallback((function(t){return e.options.find((function(e){return e[D]===t}))}),[e.options,D]);function X(){return J.apply(this,arguments)}function J(){return(J=Object(j.a)(y.a.mark((function t(){var a,n,r=arguments;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=r.length>0&&void 0!==r[0]?r[0]:"",f(!0),!M){t.next=5;break}return t.next=5,M();case 5:if(!B){t.next=12;break}return t.next=8,B({search:a});case 8:n=t.sent,l(n),t.next=13;break;case 12:l(e.options);case 13:f(!1);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}i.a.useEffect((function(){if("object"!==typeof k){var e=k.split(",");b(1===e.length?Y(e[0].trim()):e.map((function(e){return Y(e.trim())})))}else b(k)}),[k,Y]);var Q=function(e,t){var a=i.a.useRef(null),n=function(){return a.current&&clearTimeout(a.current)},r=function(e){return a.current=setTimeout(e,t)};return i.a.useEffect((function(){return function(){return n()}}),[]),function(){for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];n(),r((function(){return e.apply(void 0,a)}))}}(X,400);return N?i.a.createElement(Tt,{title:E,value:function(e){var t=o.find((function(t){return"object"===typeof e?"".concat(t[D])==="".concat(e[D]):"".concat(t[D||"value"])==="".concat(e)}));return t&&t[V]||("object"===typeof e&&e?e[V]:e)}(k)}):i.a.createElement(Kt.a,{className:q()(t.formControl,{inline:U}),style:_},i.a.createElement(Zt.a,Object.assign({autoFocus:z,name:g,InputProps:W,TextFieldProps:Object(c.a)({},U?{}:{label:E,InputLabelProps:{shrink:!0}},{error:w}),isLoading:m,onFocus:function(){A&&A(),X()},isClearable:!0,options:m?[]:o,onInputChange:function(e,t){"input-change"===t.action&&(f(!0),Q(e))},onChange:function(e){O("object"!==typeof k?F?e.map((function(e){return e[D]})).join(","):e&&e[D]:e)},value:h,placeholder:T?"Search ".concat(E):"Select ".concat(E),classes:t,components:aa,isDisabled:N,isMulti:F,isSearchable:T,getOptionLabel:function(e){return e[V]},getOptionValue:function(e){return e[D]},blurInputOnSelect:!0,menuPlacement:"auto",styles:{menuPortal:function(e){return Object(c.a)({},e,{zIndex:1500})},container:function(e){return{width:"100%"}},clearIndicator:function(e){return Object(c.a)({},e,{},H)},menu:function(e){return Object(c.a)({},e,{marginTop:0,borderRadius:0})}}},K.options?{}:{filterOption:function(){return!0}},R?{menuPortalTarget:document.body}:{},K)),k&&G&&i.a.createElement("div",{onClick:function(e){e.stopPropagation(),G(k)},className:t.viewIcon},i.a.createElement($t.a,null)))}na.defaultProps={isPortal:!0};var ra=na,ia=a(190),oa=a(401),la=a(368),ca=a(388),sa=a(192),ua={date:oa.a,time:la.a,datetime:ca.a},da={date:"DD/MM/YYYY",time:"LT",datetime:"DD/MM/YYYY h:mm a"};var ma=function(e){var t=e.inline,a=e.type,n=void 0===a?"date":a,o=Object(pt.a)(e,["inline","type"]),l=Object(r.useState)(!1),u=Object(s.a)(l,2),d=u[0],m=u[1],f=i.a.useRef(),p=(o.name,o.title),v=o.format,h=o.readOnly,b=void 0!==h&&h,g=(o.error,o.onChange),C=Object(pt.a)(o,["name","title","format","readOnly","error","onChange"]);if(b){var E=o.value?be()(o.value).format(v||da[n]):"";return(i.a.createElement(Tt,{title:p,value:E}))}var O=ua[n];return i.a.createElement(sa.b,{utils:ia.a,moment:be.a},i.a.createElement(O,Object.assign({autoOk:!0,open:d,onChange:function(e){f.current=e},PopoverProps:{anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},disableToolbar:!0,variant:"inline"},t?{invalidDateMessage:""}:{},{style:Object(c.a)({width:"100%"},t?{margin:0}:{}),label:t?"":p,format:v||da[n]},"time"!==n?{animateYearScrolling:!1}:{},C,{onKeyDown:function(e){40===e.keyCode&&m(!0)},onClose:function(){g(f.current),m(!1)},onOpen:function(){return m(!0)}})))},fa=a(193);function pa(e){var t=e.inputRef,a=(e.onChange,e.thousandSeparator),n=void 0===a||a,r=Object(pt.a)(e,["inputRef","onChange","thousandSeparator"]);return(i.a.createElement(fa.a,Object.assign({getInputRef:t,thousandSeparator:n},r)))}function va(e){var t=e.type,a=void 0===t?"integer":t,n=e.title,o=e.onChange,l=e.value,c=void 0===l?0:l,u=e.readOnly,d=e.scale,m=void 0===d?2:d,f=e.customeFormat,p=e.onBlur,v=Object(pt.a)(e,["type","title","onChange","value","readOnly","scale","customeFormat","onBlur"]),h=Object(r.useState)(c),b=Object(s.a)(h,2),g=b[0],C=b[1],E=Object(r.useCallback)((function(e){return Number(Number(e).toFixed("integer"===a?0:m))}),[a,m]);return i.a.useEffect((function(){C(E(c))}),[c,C,E]),u?i.a.createElement(Tt,{title:n,value:i.a.createElement(pa,Object.assign({},f,{value:c,displayType:"text"})),customRender:!0}):i.a.createElement(Dt,Object.assign({onChange:C,title:n,type:"number",value:"".concat(g),onBlur:function(e){o(E(g)),C(E(g)),p&&p(e)}},v))}va.defaultProps={readOnly:!1};var ha,ba=va,ga={enum:["=","!=","isNull","notNull"],text:["like","notLike","isNull","notNull"],string:["=","!=","like","notLike","isNull","notNull"],integer:["=","!=",">=","<=",">","<","between","notBetween","isNull","notNull"],boolean:["isTrue","isFalse"]},Ca=[{name:"=",title:P("equals")},{name:"!=",title:P("not equal")},{name:">",title:P("greater than")},{name:">=",title:P("greater or equal")},{name:"<",title:P("less than")},{name:"<=",title:P("less or equal")},{name:"in",title:P("in")},{name:"between",title:P("between")},{name:"notBetween",title:P("not Between")},{name:"notIn",title:P("not in")},{name:"isNull",title:P("is null")},{name:"notNull",title:P("is not null")},{name:"like",title:P("contains")},{name:"notLike",title:P("doesn't contain")},{name:"isTrue",title:P("true")},{name:"isFalse",title:P("false")}],Ea=a(71),Oa=a(137),ya=a(97),ja=a(98),ka=a(149),wa=a(148),xa=a(194),Na=a.n(xa),Sa={};function Fa(e){var t=document.cookie||"";return t!==ha&&(ha=t,Sa=t.split("; ").reduce((function(e,t){var a=t.split("=");return e[a[0]]=a[1],e}),{})),Sa[e]}var Ia=function(){function e(t,a){Object(ya.a)(this,e),this.http=t,this.entity=a}return Object(ja.a)(e,[{key:"insert",value:function(e){return this.http.put("/ws/rest/"+this.entity,e)}},{key:"update",value:function(e){return this.http.post("/ws/rest/"+this.entity,e)}},{key:"delete",value:function(e){return this.http.delete("/ws/rest/"+this.entity+"/"+e)}},{key:"deleteAll",value:function(e){return this.http.post("/ws/rest/".concat(this.entity,"/removeAll"),{records:e.map((function(e){return{id:e.id,version:e.version}}))})}},{key:"fetch",value:function(e,t){return this.http.post("/ws/rest/"+this.entity+"/"+e+"/fetch",t)}},{key:"copy",value:function(e,t){return this.http.get("/ws/rest/"+this.entity+"/"+e+"/copy",t)}},{key:"details",value:function(e,t){return this.http.get("/ws/rest/"+this.entity+"/"+e+"/details?name="+t)}},{key:"search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.http.post("/ws"+(this.entity?"/rest/".concat(this.entity):"")+"/search",e)}}]),e}(),Ta=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.baseURL,n=void 0===a?"/":a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Object(ya.a)(this,e),this.instance=Na.a.create({baseURL:n}),this.interceptor=r}return Object(ja.a)(e,[{key:"catchError",value:function(e){console.log("catch error",e),this.callback?this.callback(e):"".concat(e).includes("401")}},{key:"request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,r=a.headers,i=void 0===r?{}:r,o=a.token,l=void 0===o||o,s=a.withCredentials,u=void 0===s||s,d=Object(c.a)({},l?{"X-CSRF-Token":Fa("CSRF-TOKEN")}:{},{},n||Object.assign({},{accept:"application/json","x-requested-with":"XMLHttpRequest"},i,Object.keys(t).length?{"content-type":"application/json"}:{})),m=Object.assign({url:e,method:"POST",headers:d,data:"application/json"===d["content-type"]?JSON.stringify(t):t},a,{withCredentials:u});return"GET"!==m.method&&"HEAD"!==m.method||!m.data||delete m.data,this.instance(m)}},{key:"intercept",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,i={method:a,withCredentials:!0},o=function(){return t.request(e,n,i,r)},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e5;return new Promise((function(t,a){setTimeout((function(){a(new Error("Request failed Timeout"))}),e)}))};return Promise.race([l(),o().then((function(e){return 401===e.status?t.catchError({logout:!0}):e.data}))]).catch(this.catchError.bind(this))}},{key:"get",value:function(e,t){return this.intercept(e,"GET",{},t)}},{key:"post",value:function(e,t,a){return this.intercept(e,"POST",t,a)}},{key:"put",value:function(e,t,a){return this.intercept(e,"PUT",t,a)}},{key:"delete",value:function(e,t){return this.intercept(e,"DELETE",{},t)}},{key:"head",value:function(e,t){return this.intercept(e,"HEAD",{},t)}},{key:"action",value:function(e,t){return this.intercept("/ws/action"+e,"POST",t)}},{key:"rest",value:function(e){return new Ia(this,e)}},{key:"login",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Object.assign({},this.config||{},t);return this.request("/callback",{username:a.username,password:a.password},{token:!1}).then((function(t){var n=null;if(void 0===t)throw new Error("Failed To Connect !!");return t&&401===t.status?n=!1:t&&200===t.status&&(n=!0,e.config=a),n})).catch(this.catchError.bind(this))}},{key:"logout",value:function(){return this.get("/logout")}},{key:"info",value:function(){return this.get("/ws/app/info")}},{key:"checkInfo",value:function(){return this.request("/ws/app/info",{},{method:"GET"}).then((function(e){return e.data})).then((function(e){return{appUser:e,app:{name:e["application.name"],version:e["application.version"],description:e["application.description"]},user:{id:e["user.id"],code:e["user.login"],name:e["user.name"],language:e["user.lang"]||"en",email:e["user.login"],theme:e["user.theme"]||""}}}))}},{key:"upload",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise((function(i,o){var l=new XMLHttpRequest,c="".concat("../","ws/files/upload"),s=function(){return a["X-File-Id"]?e.intercept((function(){return e.delete("".concat(c,"/").concat(a["X-File-Id"]))})):Promise.resolve(!0)};l.open("POST",c,!0),Object.keys(a).forEach((function(e){l.setRequestHeader(e,a[e])})),l.withCredentials=!0,l.overrideMimeType("application/octet-stream"),l.setRequestHeader("Content-Type","application/octet-stream"),l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.setRequestHeader("X-CSRF-Token",Fa("CSRF-TOKEN")),l.onload=function(){n(100)},r.abort=function(){return l.abort(),s()},l.onreadystatechange=function(){if(4===l.readyState)switch(l.status){case 401:throw this.callbackInterceptor(),new Error("Unauthorized !!");case 200:try{var e=JSON.parse(l.responseText);i(e)}catch(t){i(l.responseText)}break;default:s(),o({status:l.status})}},l.upload.onprogress=function(e){var t=a["X-File-Size"],i=parseFloat(a["X-File-Offset"])+e.loaded,o=Math.round(i/t*100);r.progress=o>95?"95%":o+"%",r.transfer=function(e,t){var a=function(e){return e>1e9?parseFloat(e/1e9).toFixed(2)+" GB":e>1e6?parseFloat(e/1e6).toFixed(2)+" MB":e>=1e3?parseFloat(e/1e3).toFixed(2)+" KB":e+" B"};return a(e||0)+"/"+a(t)}(i,t),r.loaded=i===t,e.lengthComputable&&n(e.loaded/e.total*100,r)},l.send(t)}))}}]),e}(),Pa=(new Ta({baseURL:"/"}),new(function(e){Object(ka.a)(a,e);var t=Object(wa.a)(a);function a(){return Object(ya.a)(this,a),t.apply(this,arguments)}return Object(ja.a)(a,[{key:"download",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a="".concat(this.instance.defaults.baseURL,"ws/dms/download/").concat(e.id);return new Promise((function(n){var r=new XMLHttpRequest;r.open("GET",a,!0),r.responseType="blob",r.onload=function(){var a=r.response;if(t)n(a);else{var i=document.createElement("a");i.href=window.URL.createObjectURL(a),i.download=e.isDirectory?"".concat(e.fileName,".zip"):e.fileName,i.click(),n()}},r.send()}))}},{key:"metaFileDownload",value:function(e){var t="".concat(this.instance.defaults.baseURL,"ws/rest/com.axelor.meta.db.MetaFile/").concat(e.id,"/content/download"),a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="blob",a.onload=function(){var t=a.response,n=document.createElement("a");n.href=window.URL.createObjectURL(t),n.download=e.isDirectory?"".concat(e.fileName,".zip"):e.fileName,n.click()},a.send()}}]),a}(Ta))({baseURL:"../"})),Da=function(e){Object(ka.a)(a,e);var t=Object(wa.a)(a);function a(){return Object(ya.a)(this,a),t.apply(this,arguments)}return Object(ja.a)(a,[{key:"save",value:function(e){return console.log(e),e.id?Object(Oa.a)(Object(Ea.a)(a.prototype),"update",this).call(this,{data:Object(c.a)({},e)}):Object(Oa.a)(Object(Ea.a)(a.prototype),"insert",this).call(this,Object(c.a)({},e.records?e:{data:Object(c.a)({},e)}))}},{key:"removeAll",value:function(e){return Object(Oa.a)(Object(Ea.a)(a.prototype),"deleteAll",this).call(this,e)}},{key:"action",value:function(e,t){return Pa.action("/".concat(e),Object(c.a)({},t,{model:this.entity}))}},{key:"info",value:function(){return Pa.info()}}]),a}(Ia);function La(e){return new Da(Pa,e)}var Va=La("com.axelor.apps.base.db.App"),Ba=La("com.axelor.apps.base.db.AppProject"),Ma=La("com.axelor.apps.project.db.Project"),Ra=La("com.axelor.dms.db.DMSFile"),Ua=La("com.axelor.meta.db.MetaFilter"),za=La("com.axelor.dms.db.DMSPermission"),Aa=La("com.axelor.meta.db.MetaJsonField"),Wa=La("com.axelor.apps.projectdms.db.DMSVersion"),_a=La("com.axelor.dms.db.DMSFileTag");function Ha(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=[{name:e.targetName}];e.targetSearch&&(n=e.targetSearch.map((function(e){return{name:e}})));var r=La(e.target);return r.search(Object(c.a)({},a,{limit:10,offset:0,fields:n.map((function(e){return e.name})),data:t?n.reduce((function(e,a){return Object(c.a)({},e,Object(V.a)({},a.name,t))}),{criteria:void 0,operator:void 0}):{}}))}var qa=Object(B.a)((function(e){return{group:{margin:"0px 8px",flexDirection:"row"},button:{margin:e.spacing(1)},label:{fontSize:"0.875rem"},list:{width:"100%",padding:0},listItem:{paddingLeft:0,paddingTop:0,paddingBottom:0},link:{margin:e.spacing(1)},textField:{margin:e.spacing(1),flexBasis:200},divider:{width:1,height:28,margin:4},criteriaValue:{width:"250px !important",alignItems:"normal"},mobileViewCriteria:{flexWrap:"wrap"},mobileViewButtonLink:{display:"flex",justifyContent:"center"}}})),Ga={title:"",operator:"and",isArchived:!1,isShare:!1,criteria:[{}],selected:!1},Ka=function(e,t){e.map((function(e){return ga[e]=t}))};function Ya(e,t,a){var n=a.onChange,r=a.value,o=a.value2,l=a.classes,s=a.style,u=Object(pt.a)(a,["onChange","value","value2","classes","style"]);return["=","!=",">",">=","<","<=","like","notLike"].includes(t)?i.a.createElement(e,Object.assign({name:"value",className:l.criteriaValue,onChange:function(e){return n({name:"value",value:e})},value:r},u)):["between","notBetween"].includes(t)?i.a.createElement(i.a.Fragment,null,i.a.createElement(e,Object.assign({name:"value",style:Object(c.a)({marginRight:8},s),className:l.criteriaValue,onChange:function(e){return n({name:"value",value:"".concat(e)})},value:r},u)),i.a.createElement(e,Object.assign({name:"value2",className:l.criteriaValue,onChange:function(e){return n({name:"value2",value:"".concat(e)})},value:o},u))):void 0}function Xa(e){var t=e.type,a=e.operator,n=e.onChange,r=e.value,o=e.classes,l=Object(pt.a)(e,["type","operator","onChange","value","classes"]),s=Object(c.a)({value:r.value,value2:r.value2,onChange:n},l);switch(t){case"one_to_one":case"many_to_one":case"many_to_many":case"one_to_many":return function(e,t){var a=t.onChange,n=Object(pt.a)(t,["onChange"]);if(["like","notLike","notIn"].includes(e))return i.a.createElement(Dt,Object.assign({name:"value",onChange:function(e){return a({name:"value",value:e})},margin:"none",style:{width:250}},n));if(["in"].includes(e)){var r=n.field,o=n.value,l=r.targetName,c=function(){var e=Object(j.a)(y.a.mark((function e(t){var a,n,i;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.search,e.next=3,Ha(r,a);case 3:return n=e.sent,i=n.data,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return i.a.createElement(ra,{placeholder:"",fetchAPI:c,isSearchable:!0,optionLabelKey:l,optionValueKey:"id",name:"value",value:o,isMulti:!0,formControlStyle:{marginBottom:"5px",width:250},clearIndicatorStyle:{paddingLeft:"0 !important"},closeMenuOnScroll:!1,onChange:function(e){return a({name:"value",value:Array.isArray(e)?e.map((function(e){return Object(V.a)({id:e.id},l,e[l])})):e&&Object(V.a)({id:e.id},l,e[l])})}})}}(a,Object(c.a)({},s));case"date":case"time":case"dateTime":return Ya(ma,a,Object(c.a)({type:t},s,{format:"DD/MM/YYYY",margin:"none",classes:o}));case"integer":case"long":case"decimal":return Ya(ba,a,Object(c.a)({type:t},s,{margin:"none",classes:o}));case"enum":var u=l.field.selectionList.map((function(e){var t=e.title,a=e.value,n=e.data;return{name:n&&n.value||a,title:t}}));return Ya(Gt,a,Object(c.a)({options:u,classes:o},s));default:return Ya(Dt,a,Object(c.a)({classes:o},s,{margin:"none"}))}}function Ja(e){var t=e.className,a=e.onRemove,n=e.onChange,r=e.value,o=e.fields,l=e.classes,s=e.mobileView,u=o.find((function(e){return e.name===r.fieldName})),d=(u&&u.type||"").toLowerCase();u&&u.selectionList&&(d="enum");var m=Ca.filter((function(e){return(ga[d]||[]).includes(e.name)}));function f(e){var t=e.name,a=e.options,o=Object(pt.a)(e,["name","options"]);return(i.a.createElement(Gt,Object.assign({name:t,onChange:function(e){return n({name:t,value:e})},value:r[t],options:a},o)))}return(i.a.createElement("div",null,i.a.createElement(Xe.a,{"aria-label":"close",className:t,onClick:a},i.a.createElement(ft.a,null)),i.a.createElement("div",{className:q()(Object(V.a)({},l.mobileViewCriteria,s))},i.a.createElement(f,{name:"fieldName",options:o,className:"fieldName"}),i.a.createElement(f,{name:"operator",options:m,className:"operator"}),r.operator&&Xa(Object(c.a)({type:d,operator:r.operator,value:r,onChange:n,classes:l},{field:u})))))}function Qa(e){var t=e.customCriteria,a=e.setCustomCriteria,n=e.fields,r=e.clearFilters,o=e.applyFiltersClick,l=e.filterView,u=e.onSave,d=e.onDelete,m=e.mobileView,f=e.onExport,p=e.onExportAll,v=qa(),h=i.a.useState(!1),b=Object(s.a)(h,2),g=b[0],C=b[1],E=t.id,O=t.operator,y=t.isArchived,j=t.criteria,k=t.title,w=t.isShare;function x(e){var n=e.target,r=n.name,i=n.value;a(Object(c.a)({},t,Object(V.a)({},r,i)))}function N(e,t,r){t instanceof be.a&&(t=be()(t).format("YYYY-MM-DD")),a(Object(Vt.a)((function(a){a.criteria[r][e]=t,"fieldName"===e&&(a.criteria[r].operator="",a.criteria[r].value=function(e){var t=n.find((function(t){return t.name===e})).type.toLowerCase();return["one_to_one","many_to_one","many_to_many","one_to_many"].includes(t)?null:["integer","long","decimal"].includes(t)?0:["date","time","dateTime"].includes(t)?null:""}(t))})))}function S(){var e=t.id,a=t.version,n=t.title,r=t.isShare,i=t.operator,o=t.criteria,c={shared:r||!1,title:n,filterCustom:JSON.stringify({operator:i,criteria:o}),filterView:l};e?(c.id=e,c.version=a):c.name=n.replace(" ","_").toLowerCase(),u(c)}return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,i.a.createElement(At,{name:"operator",onChange:function(e){return x(e)},value:O,classes:v,className:v.group,data:[{label:P("and"),value:"and"},{label:P("or"),value:"or"}]}),i.a.createElement(Wt,{name:"isArchived",title:P("Show archived"),value:y,onChange:function(e){var t=e.name;return x({target:{value:e.checked,name:t}})},classes:v,className:"archived"})),i.a.createElement("div",null,i.a.createElement(Qe.a,{className:v.list},j.map((function(e,t){return i.a.createElement($e.a,{className:v.listItem,key:t},i.a.createElement(Ja,{className:v.buttonLink,id:t,value:e,fields:n,onRemove:function(){return function(e){a(Object(Vt.a)((function(t){1===t.criteria.length?t.criteria=[{}]:t.criteria.splice(e,1)})))}(t)},onChange:function(e){return N(e.name,e.value,t)},classes:v,mobileView:m}))})))),i.a.createElement("div",{className:q()(v.buttonLink,Object(V.a)({},v.mobileViewButtonLink,m))},i.a.createElement(zt,{title:P("Add filter"),className:q()(v.link,"add-filter"),onClick:function(){a(Object(Vt.a)((function(e){e.criteria[e.criteria.length-1].operator&&e.criteria.push({})})))}}),i.a.createElement(ut.a,{className:v.divider}),i.a.createElement(zt,{title:P("Clear"),className:q()(v.link,"clear"),onClick:function(){r(),a(Ga)}}),i.a.createElement(ut.a,{className:v.divider}),i.a.createElement(zt,{title:P("Export"),className:v.link,onClick:f}),i.a.createElement(ut.a,{className:v.divider}),i.a.createElement(zt,{title:P("Export full"),className:v.link,onClick:p}),i.a.createElement(ut.a,{className:v.divider}),i.a.createElement(zt,{title:P("Apply"),className:q()(v.link,"apply-filter"),onClick:function(){return o(t)}})),i.a.createElement(ut.a,{style:{marginTop:8}}),i.a.createElement("div",null,i.a.createElement(Dt,{name:"title",value:k,onChange:function(e){return x({target:{value:e,name:"title"}})},className:q()(v.textField,"title")}),i.a.createElement(Wt,{title:P("share"),name:"isShare",value:w,onChange:function(e){var t=e.name;return x({target:{value:e.checked,name:t}})},className:"share"})),i.a.createElement("div",null,i.a.createElement(_t,{classes:v,onClick:S,title:P("Save"),hide:""===k||null===k||void 0!==E,className:"save"}),i.a.createElement(_t,{classes:v,onClick:S,title:P("Update"),hide:""===E||void 0===E||null===E}),i.a.createElement(_t,{classes:v,onClick:function(){return C(!0)},title:P("Delete"),hide:""===E||void 0===E||null===E,className:"delete"}),i.a.createElement(X.a,{open:g,onClose:function(){return C(!1)},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},i.a.createElement(J.a,{id:"alert-dialog-title"},"Question"),i.a.createElement(Q.a,null,i.a.createElement(Lt.a,{id:"alert-dialog-description"},P("Would you like to remove the filter?"))),i.a.createElement($.a,null,i.a.createElement(Z.a,{onClick:function(){return C(!1)},className:"cancel"},P("Cancel")),i.a.createElement(Z.a,{onClick:function(){d(t),C(!1)},color:"primary",autoFocus:!0,className:"confirm-delete"},P("Ok"))))))}Ka(["long","decimal","date","time","datetime"],ga.integer),Ka(["one_to_many"],ga.text),Ka(["one_to_one","many_to_one","many_to_many"],["like","notLike","in","notIn","isNull"]);var $a=Object(B.a)((function(e){return{container:{border:"1px solid",borderRadius:20,backgroundColor:e.palette.grey[200],borderColor:e.palette.grey[300],padding:"0 ".concat(e.spacing(),"px"),width:"100%",maxWidth:300,"& > div:last-child":{zIndex:1}},textField:{margin:e.spacing(1),flexBasis:200},divider:{width:1,height:28,margin:4},typography:{padding:e.spacing(1),fontWeight:600,flex:1},searchContainer:{display:"flex",flexDirection:"column","& div":{display:"flex",alignItems:"center"}},formControl:{margin:e.spacing(1)},group:{margin:"0px 8px",flexDirection:"row"},paper:{minWidth:480,boxShadow:"0 4px 12px rgb(0,0,0,0.4)"},link:{margin:e.spacing(1)},button:{margin:e.spacing(1)},list:{width:"100%",padding:0},listItem:{paddingLeft:0,paddingTop:0,paddingBottom:0},searchFilterContainer:{display:"flex",alignItems:"flex-start !important"},searchFilter:{flexDirection:"column",alignItems:"baseline !important",width:"100%"},filter:{flexDirection:"column",marginLeft:8,alignItems:"baseline !important"},inputIconBtn:{margin:0,padding:0,color:"#bbb"},label:{fontSize:"0.875rem"},filterLabel:{display:"flex",alignItems:"center",margin:"0 8px"}}}));function Za(e){try{return JSON.parse(e)}catch(t){return e}}function en(e){var t=e.icon,a=e.title,n=e.classes;return(i.a.createElement("div",{className:n.filterLabel},i.a.createElement(jt,{icon:t}),i.a.createElement(oe.a,{className:n.typography},a)))}function tn(e){var t=e.filter,a=e.disabled,n=e.isChecked,r=e.onClick,o=e.onChange,l=e.classes,c=t.title;return i.a.createElement($e.a,{className:l.listItem},i.a.createElement(Wt,{name:c.replace(" ","_").toLowerCase(),value:n,onChange:function(e){o(e,t)},inline:!0,isDisabled:a}),i.a.createElement(zt,{title:c,onClick:function(){return(!a||n)&&r(t,!n)},style:a&&!n?{color:"rgba(0, 0, 0, 0.54)"}:{}}))}function an(e){var t=e.active,a=void 0===t?[]:t,n=e.data,r=void 0===n?[]:n,o=e.disabled,l=e.onClick,c=e.onChange,s=e.classes;return(i.a.createElement("div",{className:s.filter},i.a.createElement(Qe.a,{className:s.list},r.map((function(e){return i.a.createElement(tn,{key:e.id,filter:e,isChecked:a.includes(e.id),disabled:o,onClick:l,onChange:c,classes:s})})))))}function nn(e){var t=e.filters,a=e.value,n=void 0===a?[]:a,o=e.onOpen,l=e.onDelete,c=e.classes,u=e.onContentSearch,d=Object(r.useState)(""),m=Object(s.a)(d,2),f=m[0],p=m[1],v=i.a.useCallback((function(e){var t=e.target.value;u(t||f)}),[u,f]);return n.length>0?i.a.createElement(bt,{handleClick:o,value:n,onDelete:l,filters:t}):i.a.createElement(Dt,{name:"search",margin:"none",onChange:p,onKeyPress:function(e){return"Enter"===e.key&&v(e)},value:f,InputProps:{disableUnderline:!0,endAdornment:i.a.createElement(st.a,{position:"end"},i.a.createElement(Xe.a,{"aria-label":"open",onClick:o,className:c.inputIconBtn},i.a.createElement(et.a,null)),i.a.createElement(Xe.a,{"aria-label":"refresh",className:c.inputIconBtn,onClick:v},i.a.createElement(mt.a,null)))}})}function rn(e){var t=e.name,a=e.value,n=e.fields,o=e.filters,l=void 0===o?[]:o,u=e.domain,d=void 0===u?[]:u,m=e.onSave,f=e.onDelete,p=e.handleChange,v=e.onContentSearch,h=e.onExport,b=e.onExportAll,g=$a(),C=Object(r.useRef)(),E=i.a.useState(!1),O=Object(s.a)(E,2),w=O[0],x=O[1],N=i.a.useState([]),S=Object(s.a)(N,2),F=S[0],I=S[1],T=i.a.useState(!1),D=Object(s.a)(T,2),L=D[0],V=D[1],B=Object(r.useState)(Ga),M=Object(s.a)(B,2),R=M[0],U=M[1],z=L?l.find((function(e){return e.id===F[0]})):null;function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,n=l.filter((function(t){return e.includes(t.id)})),r=d.filter((function(t){return e.includes(t.id)})),i={criteria:[],operator:t.operator||"and"};if(a&&L)i.criteria=t.criteria;else{var o,c;if(n.length)(c=i.criteria).push.apply(c,Object(k.a)(n.map((function(e){var t=Za(e.filterCustom),a=t.criteria,n=void 0===a?[]:a;return{operator:t.operator,criteria:n}}))));(o=i.criteria).push.apply(o,Object(k.a)(t.criteria||[]))}return r.length&&(i._domains=r.map((function(e){return{title:e.title,domain:e.domain}}))),i}function W(e,t){var a=[];e.length>0&&(a=A(e,t)),p({selected:Object(k.a)(e),query:a})}function _(e,t){var a=!!e.domain,n=t&&e?[e.id]:[];V(!a&&t),I(n),W(n)}function H(e,t){var a=t.id,n=F.findIndex((function(e){return e===a}));n>-1?!e&&F.splice(n,1):e&&F.push(a),I(Object(k.a)(F))}function q(){p({}),I([]),V(!1),U(Ga)}function G(e){F.length>0?W(F.length?Object(k.a)(F):[null]):e&&e.criteria.length&&function(e){p({selected:[null],query:A(F,e,!0)})}(Object(c.a)({},e,{criteria:(e.criteria||[]).filter((function(e){return e.fieldName&&e.operator}))})),x(!1)}var K=function(e){f(e),q()},Y=function(){var e=Object(j.a)(y.a.mark((function e(t){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(t);case 2:_(e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X=function(){return x(!1)},J=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(i.a.createElement("div",{className:g.searchContainer},i.a.createElement("div",null,i.a.createElement(oe.a,{className:g.typography},P("Advanced Search")),i.a.createElement(Xe.a,{"aria-label":"close",onClick:X},i.a.createElement(ft.a,null))),i.a.createElement(ut.a,null),i.a.createElement("div",{className:g.searchFilterContainer},d.length>0&&i.a.createElement("div",{className:g.searchFilter},i.a.createElement(en,{icon:"filter",title:"Filters",classes:g}),i.a.createElement(an,{data:d,disabled:L,active:F,onClick:_,onChange:H,classes:g})),l.length>0&&i.a.createElement("div",{className:g.searchFilter},i.a.createElement(en,{icon:"filter",title:"My Filter",classes:g}),i.a.createElement(an,{data:l,disabled:L,active:F,onClick:_,onChange:H,classes:g}))),l.length>=1||d.length?i.a.createElement(ut.a,{style:{marginTop:8}}):"",i.a.createElement(Qa,{fields:n,clearFilters:q,applyFiltersClick:G,filterView:t,onSave:Y,onDelete:K,customCriteria:R,setCustomCriteria:U,mobileView:e,onExport:h,onExportAll:b})))};return Object(r.useEffect)((function(){if(z){var e=Za(z.filterCustom),t=e.criteria,a=e.operator;U(Object(c.a)({},z,{operator:a,criteria:t.map((function(e){return Object(c.a)({},e,{operator:e.operator})}))}))}else U(Ga)}),[U,z]),i.a.createElement("div",{className:g.container,ref:C},i.a.createElement(nn,{value:a&&a.selected,filters:l,onOpen:function(){return x((function(e){return!e}))},onDelete:q,classes:g,onContentSearch:v}),i.a.createElement(Ue,{DesktopView:function(){return i.a.createElement(Ke.a,{onClickAway:X},i.a.createElement(dt.a,{open:w,anchorEl:C.current,placement:"bottom-end",disablePortal:!0},i.a.createElement(Ve.a,{className:g.paper},J())))},MobileView:function(){return i.a.createElement(Je.a,{open:w,fullScreen:!0},J(!0))}}))}var on=Object(B.a)((function(e){return{toolbarWrapper:{flexGrow:1,position:"relative",backgroundColor:"white",padding:"5px 10px",display:"flex"},iconButton:{marginLeft:e.spacing(),padding:e.spacing(.5)},icon:{backgroundColor:"transparent",color:e.palette.grey[600],transition:e.transitions.create(["color"],{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.standard})},selectedViewMode:{color:e.palette.grey[900],borderRadius:"50%"},popper:{zIndex:9999},customButton:{width:"100%",borderRadius:4,cursor:"pointer",display:"flex",border:"1px solid",justifyContent:"space-between",alignItems:"center",padding:e.spacing(.5),borderColor:e.palette.grey[300],transition:e.transitions.create(["background-color"],{easing:e.transitions.easing.easeInOut}),"&:hover":{backgroundColor:e.palette.grey[200]}},projectSelectorPaper:Object(V.a)({width:280},e.breakpoints.only("xs"),{width:"100%"}),favourite:{marginLeft:e.spacing()},favouriteButtonText:{marginLeft:e.spacing(),textTransform:"capitalize"},favouriteButton:{justifyContent:"center"},favouriteIcon:{color:xe.a[500]},mobileDrawer:{padding:e.spacing()},desktopToolbarWrapper:{display:"flex",width:"100%",alignItems:"center",justifyContent:"space-between"},projectSelector:{flex:1,minWidth:290,maxWidth:290,display:"flex"},advanceSearch:{flex:1,display:"flex",justifyContent:"flex-end",marginLeft:e.spacing()},actionIcon:{fontSize:20,marginRight:10},uploadText:{textTransform:"capitalize"},uploadIconButton:{marginLeft:e.spacing(),padding:e.spacing()}}}));function ln(e){var t=e.total;return e.offset+e.limit>=t}function cn(e){return 0===e.offset}function sn(e){var t=e.selectedProject,a=e.projectList,n=e.handleSelectedProject,r=on(),o=i.a.useState(null),l=Object(s.a)(o,2),c=l[0],u=l[1],d=function(){u(null)};var m=Boolean(c),f=t?t.fullName:P("Select Project");return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{onClick:function(e){u(e.currentTarget)},className:r.customButton},i.a.createElement(oe.a,{noWrap:!0,variant:"body1",title:f},f),i.a.createElement(et.a,null)),i.a.createElement(Ge.a,{open:m,anchorEl:c,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"center"},classes:{paper:r.projectSelectorPaper}},i.a.createElement(Ve.a,null,i.a.createElement(Ke.a,{onClickAway:d},i.a.createElement(Ye.a,{autoFocus:m,id:"menu-list-grow",onKeyDown:function(e){"Tab"===e.key&&(e.preventDefault(),d())}},a.map((function(e){return i.a.createElement(K.a,{onClick:function(t){return function(e,t){e.preventDefault(),n(t),d()}(t,e)},key:e.id},i.a.createElement(oe.a,{noWrap:!0,variant:"body1"},e.fullName))})))))))}var un=function(e){var t=e.onListViewClick,a=e.onGridViewClick,n=e.viewMode,r=e.fields,o=e.onSave,l=e.onRemove,c=e.filters,s=e.onFilter,u=e.searchFilter,d=e.handleSelectedProject,m=e.selectedProject,f=e.projectList,p=e.pagination,v=e.onPrev,h=e.onNext,b=e.onFavouriteSearch,g=e.onContentSearch,C=e.FavouriteIcon,E=e.onExport,O=e.onExportAll,y=e.onOpenUpload,j=on();return i.a.createElement("div",{className:j.desktopToolbarWrapper},i.a.createElement("div",{className:j.projectSelector},i.a.createElement(sn,{selectedProject:m,projectList:f,handleSelectedProject:d})),i.a.createElement("div",{className:j.favourite},i.a.createElement("div",{className:Object(Ze.a)(j.customButton,j.favouriteButton),onClick:b},i.a.createElement(C,{className:j.favouriteIcon}),i.a.createElement(oe.a,{className:j.favouriteButtonText,noWrap:!0},P("Favourites")))),i.a.createElement("div",{className:j.uploadButton},i.a.createElement(Xe.a,{size:"medium",onClick:y,className:j.uploadIconButton},i.a.createElement(tt.a,null))),i.a.createElement("div",{className:j.advanceSearch},i.a.createElement(rn,{fields:r,handleChange:s,onSave:o,onDelete:l,filters:c,value:u,onContentSearch:g,onExport:E,onExportAll:O})),i.a.createElement("div",null,i.a.createElement(Xe.a,{size:"small",onClick:v,className:j.iconButton,disabled:cn(p)},i.a.createElement(at.a,{className:j.icon})),i.a.createElement(Xe.a,{size:"small",onClick:h,className:j.iconButton,disabled:ln(p)},i.a.createElement(nt.a,{className:j.icon})),i.a.createElement(Xe.a,{size:"small",onClick:t,className:j.iconButton},i.a.createElement(rt.a,{className:Object(Ze.a)(j.icon,Object(V.a)({},j.selectedViewMode,"list"===n))})),i.a.createElement(Xe.a,{size:"small",onClick:a,className:j.iconButton},i.a.createElement(it.a,{className:Object(Ze.a)(j.icon,Object(V.a)({},j.selectedViewMode,"card"===n))}))))},dn=function(e){var t=e.onListViewClick,a=e.onGridViewClick,n=e.viewMode,o=e.fields,l=e.onSave,c=e.onRemove,u=e.filters,d=e.onFilter,m=e.searchFilter,f=e.handleSelectedProject,p=e.selectedProject,v=e.projectList,h=e.pagination,b=e.onPrev,g=e.onNext,C=e.onFavouriteSearch,E=e.onContentSearch,O=e.FavouriteIcon,y=e.onOpenUpload,j=e.onExport,k=e.onExportAll,w=on(),x=Object(r.useState)(!1),N=Object(s.a)(x,2),S=N[0],F=N[1],I=function(){return F(!1)};return i.a.createElement(i.a.Fragment,null,i.a.createElement(Xe.a,{size:"small",onClick:function(){return F(!0)},className:w.iconButton,style:{margin:0}},i.a.createElement(ot.a,{className:w.icon})),i.a.createElement(Xe.a,{size:"small",onClick:C,className:w.iconButton},i.a.createElement(O,{className:Object(Ze.a)(w.icon,w.favouriteIcon)})),i.a.createElement("div",{className:w.advanceSearch},i.a.createElement(rn,{fields:o,handleChange:d,onSave:l,onDelete:c,filters:u,value:m,onContentSearch:E,onExport:j,onExportAll:k})),i.a.createElement(Xe.a,{size:"small",onClick:b,className:w.iconButton,disabled:cn(h)},i.a.createElement(at.a,{className:w.icon})),i.a.createElement(Xe.a,{size:"small",onClick:g,className:w.iconButton,disabled:ln(h)},i.a.createElement(nt.a,{className:w.icon})),i.a.createElement(Xe.a,{size:"small",onClick:t,className:w.iconButton},i.a.createElement(rt.a,{className:Object(Ze.a)(w.icon,Object(V.a)({},w.selectedViewMode,"list"===n))})),i.a.createElement(Xe.a,{size:"small",onClick:a,className:w.iconButton},i.a.createElement(it.a,{className:Object(Ze.a)(w.icon,Object(V.a)({},w.selectedViewMode,"card"===n))})),i.a.createElement(Je.a,{anchor:"top",open:S,onClose:I},i.a.createElement(Qe.a,null,i.a.createElement($e.a,{button:!0},i.a.createElement(sn,{selectedProject:p,projectList:v,handleSelectedProject:function(e){I(),f(e)}})),p&&i.a.createElement($e.a,{button:!0},i.a.createElement(Z.a,{fullWidth:!0,variant:"outlined",onClick:function(){I(),y()}},i.a.createElement("i",{className:q()("fa fa-upload",w.actionIcon)}),i.a.createElement(oe.a,{className:w.uploadText},P("Upload Files")))))))},mn=function(e){var t=e.onViewModeChange,a=e.viewMode,n=e.fields,o=e.onSave,l=e.onRemove,c=e.filters,s=e.onFilter,u=e.searchFilter,d=e.handleSelectedProject,m=e.selectedProject,f=e.projectList,p=e.pagination,v=e.onPrev,h=e.onNext,b=e.favouriteSearch,g=e.onFavouriteSearch,C=e.onContentSearch,E=e.onOpenUpload,O=e.onExport,y=e.onExportAll,j=on(),k={onListViewClick:Object(r.useCallback)((function(){t("list")}),[t]),onGridViewClick:Object(r.useCallback)((function(){t("card")}),[t]),viewMode:a,fields:n,onSave:o,onRemove:l,filters:c,onFilter:s,searchFilter:u,handleSelectedProject:d,selectedProject:m,projectList:f,pagination:p,onPrev:v,onNext:h,onFavouriteSearch:g,onContentSearch:C,FavouriteIcon:b?lt.a:ct.a,onOpenUpload:E,onExport:O,onExportAll:y};return Object(r.useEffect)((function(){f&&f.length>0&&d(f[0])}),[f,d]),i.a.createElement(Ve.a,{elevation:4,square:!0,className:j.toolbarWrapper},i.a.createElement(Ue,{DesktopView:un,MobileView:dn,viewProps:k}))},fn=a(398),pn=a(147),vn=a.n(pn),hn=a(196),bn=a.n(hn),gn=a(293),Cn=a(136),En=a.n(Cn),On=a(111);On.pdfjs.GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(On.pdfjs.version,"/pdf.worker.js");var yn=Object(M.a)((function(e){return{form:{display:"flex",flexDirection:"column"},pdfPage:{display:"flex",justifyContent:"center"},mobilePdfPage:{"&>div":{width:"100% !important"},"& > canvas":{width:"100% !important"}},pdfNavigation:{display:"flex"},mobileImage:{width:"fit-content"},mobielForm:{overflowX:"hidden"},imageView:{overflowX:"auto"}}}));function jn(e){var t=yn(),a=Object(gn.a)(),n=e.document,r=e.onClose,o=e.open,l=e.pdfBlob,c=i.a.useState(),u=Object(s.a)(c,2),d=u[0],m=u[1],f=i.a.useState(1),p=Object(s.a)(f,2),v=p[0],h=p[1],b=Object(wt.a)(a.breakpoints.up("sm")),g=i.a.useCallback((function(e){var t=e.numPages;m(t)}),[]),C=i.a.useCallback((function(){h((function(e){return e+1}))}),[]),E=i.a.useCallback((function(){h((function(e){return e-1}))}),[]);return i.a.createElement(X.a,{onClose:r,"aria-labelledby":"simple-dialog-title",open:o,maxWidth:"lg",fullWidth:!0,fullScreen:!b,TransitionComponent:Ae,transitionDuration:200},i.a.createElement(J.a,null,P("File preview")),i.a.createElement(Q.a,{className:q()(t.form,Object(V.a)({},t.mobielForm,!b))},-1!==n.fileType.indexOf("sheet")?i.a.createElement(En.a,{fileType:"xlsx",filePath:br(n.id)}):-1!==n.fileType.indexOf("csv")?i.a.createElement(En.a,{fileType:"csv",filePath:br(n.id)}):-1!==n.fileType.indexOf("document")?i.a.createElement(En.a,{fileType:"docx",filePath:br(n.id)}):-1!==n.fileType.indexOf("pdf")&&l?i.a.createElement("div",null,i.a.createElement(On.Document,{file:l,onLoadSuccess:g},i.a.createElement(On.Page,{className:q()(t.pdfPage,Object(V.a)({},t.mobilePdfPage,!b)),pageNumber:v}))):-1!==n.fileType.indexOf("image")?i.a.createElement("div",{className:t.imageView},i.a.createElement("img",{src:hr(n.id),alt:n.fileName,className:q()(Object(V.a)({},t.mobileImage,!b))})):i.a.createElement(oe.a,null,P("File format not supported yet"))),i.a.createElement($.a,null,-1!==n.fileType.indexOf("pdf")&&l&&i.a.createElement("div",{className:t.pdfNavigation},i.a.createElement(Xe.a,{disabled:v<=1,onClick:E},i.a.createElement(at.a,null)),i.a.createElement("p",null,P("Page")," ",v," of ",d),i.a.createElement(Xe.a,{disabled:v>=d,onClick:C},i.a.createElement(nt.a,null))),i.a.createElement(Z.a,{onClick:r,variant:"outlined"},P("Close"))))}var kn=function(e){var t=e.document,a=e.onClose,n=e.open,r=i.a.useState(),o=Object(s.a)(r,2),l=o[0],c=o[1];return i.a.useEffect((function(){t.fileType&&-1!==t.fileType.indexOf("pdf")&&Pa.download(t,!0).then((function(e){c(e)}))}),[t]),i.a.createElement(jn,{pdfBlob:l,open:n,onClose:a,document:t})},wn=Object(B.a)((function(e){return{paper:{width:"inherit",overflow:"hidden"},drawer:{width:350},fullDrawer:{width:"100%"},header:{padding:10,boxShadow:e.shadows[4]},actionIcon:{border:"1px solid rgba(0,0,0,0.5)",fontSize:25,padding:10,margin:5,width:50,textAlign:"center",cursor:"pointer","&:hover":{backgroundColor:"rgba(0, 0, 0, .05)"}},content:{padding:10},thumbnail:{display:"flex",justifyContent:"center",alignItems:"center",border:"1px solid #0003",borderRadius:4,width:"97%",alignSelf:"center",marginBottom:10,cursor:"pointer",position:"relative",height:200},thumbnailImage:{maxHeight:"100%",maxWidth:"100%"},thumbnailTypeIcon:{fontSize:150},documentLockIcon:{position:"absolute",fontSize:25,right:10,top:5},versionListItem:{borderBottom:"1px solid rgba(0,0,0,0.2)",padding:"5px 0px",display:"flex",flexWrap:"wrap"},versionFileName:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},restoreButton:{padding:"0px !important",marginLeft:3,textTransform:"capitalize !important"},versionDownloadIcon:{marginTop:7,paddingLeft:5,cursor:"pointer"},formControl:{margin:e.spacing(1),width:"90%"},chips:{display:"flex",flexWrap:"wrap"},chip:{marginRight:5,marginTop:5},chipContent:{display:"flex",flexDirection:"row"},chipClose:{width:"0.9em",paddingLeft:5,cursor:"pointer"},tagSaveIcon:{marginTop:30,cursor:"pointer",color:"rgb(47, 160, 66)"},restoreText:{fontSize:"0.8rem !important"},getVersionButton:{textTransform:"capitalize !important",margin:"10px 0px 10px 5px"},"@keyframes rotateKF":{from:{transform:"rotate(0deg)"},to:{transform:"rotate(359deg)"}},syncIcon:{animation:"$rotateKF 1s infinite linear reverse"}}}));function xn(e){var t=e.item,a=e.onClick,n=wn(),r=t.fileName,o=t.fileType;return t.id?i.a.createElement("div",{className:n.thumbnail,onClick:a},o&&-1!==o.indexOf("image")?i.a.createElement("img",{src:"".concat(hr(t.id),"?v=").concat(t.version),alt:r,className:n.thumbnailImage}):i.a.createElement("i",{className:q()(t.typeIcon,n.thumbnailTypeIcon,n.thumbnailImage)}),t.isLock&&i.a.createElement("i",{title:"Lock",className:q()("fa fa-lock",n.documentLockIcon)})):null}var Nn={PaperProps:{style:{maxHeight:224,width:250}}};function Sn(e){var t=e.onClose,a=e.userId,n=e.desktopView,r=e.onPreview,o=e.onDownload,l=e.onNewVersion,s=e.onUnlock,u=e.onLock,d=e.onSendMail,m=e.onPermission,f=e.onVersionDownload,p=e.tags,v=e.onRestore,h=e.handleChange,b=e.tagList,g=e.handleDeleteChip,C=e.updateVersions,E=e.versionsLoading,O=e.versions,y=e.preview,j=e.handlePreviewClose,w=e.document,x=wn();return i.a.createElement(Je.a,{className:q()(Object(V.a)({},x.drawer,n),Object(V.a)({},x.fullDrawer,!n)),open:Boolean(w),onClose:t,anchor:"right",variant:"persistent",classes:{paper:x.paper}},w&&i.a.createElement(i.a.Fragment,null,i.a.createElement(ce.a,{container:!0,justify:"space-between",className:x.header},i.a.createElement(ce.a,{item:!0,xs:10},i.a.createElement(oe.a,{noWrap:!0,variant:"body1"},w.fileName)),i.a.createElement(ce.a,{item:!0,xs:2,align:"right"},i.a.createElement(Xe.a,{size:"small",onClick:t},i.a.createElement(vn.a,{fontSize:"small"})))),i.a.createElement(ce.a,{container:!0,direction:"column",className:x.content},i.a.createElement(xn,{item:w,onClick:r}),i.a.createElement(ce.a,{item:!0,container:!0,justify:"space-between",direction:"row"},i.a.createElement(ce.a,{item:!0},i.a.createElement("i",{title:P("Download"),className:q()("fa fa-download",x.actionIcon),onClick:o}),w.canWrite&&function(e,t){return!t.isLock||!t.lockedBy||e===t.lockedBy.id}(a,w)&&i.a.createElement("i",{title:P("New version"),className:q()("fa fa-upload",x.actionIcon),onClick:l}),w.canWrite&&function(e,t){return!t.isLock||!t.lockedBy||e===t.lockedBy.id}(a,w)&&i.a.createElement(i.a.Fragment,null,w.isLock?i.a.createElement("i",{title:P("Unlock"),className:q()("fa fa-unlock",x.actionIcon),onClick:s}):i.a.createElement("i",{title:P("Lock"),className:q()("fa fa-lock",x.actionIcon),onClick:u}))),i.a.createElement(ce.a,{item:!0},w.isLock&&w.lockedBy&&a!==w.lockedBy.id&&i.a.createElement("i",{className:q()("fa fa-envelope",x.actionIcon),onClick:d}))),i.a.createElement(ce.a,null,i.a.createElement(Z.a,{onClick:m,className:x.getVersionButton,variant:"outlined"},P("Permissions"))),i.a.createElement(ce.a,{container:!0,wrap:"nowrap"},i.a.createElement(Kt.a,{className:x.formControl},i.a.createElement(fn.a,{id:"tags-mutiple-chip-label",shrink:!0},P("Tags")),i.a.createElement(Ht.a,{id:"tags-mutiple-chip",value:p,onChange:h,input:i.a.createElement(ee.a,{id:"select-multiple-chip"}),renderValue:function(e){return i.a.createElement("div",{className:x.chips},e.map((function(e){return i.a.createElement(vt.a,{size:"small",key:e.id,label:i.a.createElement("div",{className:x.chipContent},i.a.createElement(oe.a,{noWrap:!0,variant:"body1"},e.name),i.a.createElement(vn.a,{className:x.chipClose,onClick:function(t){return g(t,e)}})),className:x.chip})})))},MenuProps:Nn},b.map((function(e){var t=e.tagList,a=Object(pt.a)(e,["tagList"]);return([Object(c.a)({},a)].concat(Object(k.a)(t))||[]).map((function(e){return i.a.createElement(K.a,{key:e.id,value:e},a.id===e.id?e.name:"".concat(a.name," > ").concat(e.name))}))}))))),i.a.createElement(ce.a,null,i.a.createElement(Z.a,{variant:"outlined",className:x.getVersionButton,onClick:C},P("Get Versions")),E?i.a.createElement(ce.a,{item:!0,container:!0,justify:"center"},i.a.createElement(bn.a,{className:x.syncIcon})):O.map((function(e,t){return i.a.createElement(ce.a,{key:t,item:!0,className:x.versionListItem},i.a.createElement(ce.a,{item:!0,xs:2},Number(e.documentVersion)),i.a.createElement(ce.a,{item:!0,xs:6},i.a.createElement(oe.a,{title:e.metaFile&&e.metaFile.fileName,className:x.versionFileName},e.metaFile&&e.metaFile.fileName)),i.a.createElement(ce.a,{item:!0,xs:4},w["metaFile.id"]===(e.metaFile||{}).id?i.a.createElement(oe.a,{align:"center"},P("Current")):i.a.createElement(ce.a,{item:!0,container:!0,justify:"space-around"},i.a.createElement("i",{title:P("Download"),className:q()("fa fa-download",x.versionDownloadIcon),onClick:function(){return f(e)}}),w.canWrite&&i.a.createElement(Z.a,{className:x.restoreButton,variant:"outlined",onClick:function(){return v(e)}},i.a.createElement(oe.a,{className:x.restoreText},P("Restore"))))))})))),w.fileType&&i.a.createElement(kn,{document:w,open:y,onClose:j})))}var Fn=function(e){var t=e.document,a=e.onClose,n=e.onDownload,o=e.onNewVersion,l=e.onLock,c=e.onSendMail,u=e.onUnlock,d=e.userId,m=e.onRestore,f=e.onVersionDownload,p=e.tagList,v=e.onTagSave,h=e.onPermission,b=(wn(),Object(Nt.a)()),g=Object(r.useState)([]),C=Object(s.a)(g,2),E=C[0],O=C[1],y=Object(r.useState)([]),j=Object(s.a)(y,2),w=j[0],x=j[1],N=Object(r.useState)(!1),S=Object(s.a)(N,2),F=S[0],I=S[1],T=Object(r.useState)(!1),P=Object(s.a)(T,2),D=P[0],L=P[1],V=Object(wt.a)(b.breakpoints.up("sm")),B=i.a.useCallback((function(){t.fileType&&I(!0)}),[t]),M=Object(r.useCallback)((function(){if(t){L(!0);var e={_domain:"self.documentId.id = ".concat(t.id)};Wa.search({fields:["metaFile","documentVersion"],data:e}).then((function(e){var t=e.data,a=void 0===t?[]:t;O(Object(k.a)(a)),setTimeout((function(){return L(!1)}),1e3)})).catch((function(){return setTimeout((function(){return L(!1)}),1e3)}))}}),[t]),R=Object(r.useCallback)((function(e){var a=e.target.value;x((function(e){if(!e.find((function(e){return e.id===a.id}))){var n=[].concat(Object(k.a)(e),[a]);return t&&v(n),n}return e}))}),[t,v]),U=Object(r.useCallback)((function(e,t){e.stopPropagation(),x((function(e){var a=e.filter((function(e){return e.id!==t.id}));return v(a),a}))}),[v]),z=Object(r.useCallback)((function(){return I(!1)}),[]);return Object(r.useEffect)((function(){if(O([]),M(),t){var e=t.tags;e&&x(Object(k.a)(e))}}),[t,M]),i.a.createElement(Sn,{document:t,userId:d,onClose:a,desktopView:V,onPreview:B,onDownload:n,onNewVersion:o,onUnlock:u,onLock:l,onSendMail:c,onPermission:h,tags:w,onVersionDownload:f,onRestore:m,handleChange:R,tagList:p,handleDeleteChip:U,updateVersions:M,versionsLoading:D,versions:E,preview:F,handlePreviewClose:z})},In=Object(M.a)((function(e){return{form:{display:"flex",flexDirection:"column"},input:{marginBottom:25}}}));function Tn(e){var t=e.open,a=e.onClose,n=e.onSave,r=e.record,o=e.onFileChange,l=e.onVersionChange,c=r.version,s=In();return i.a.createElement(X.a,{onClose:a,"aria-labelledby":"simple-dialog-title",open:t},i.a.createElement(J.a,null,P("New version")),i.a.createElement(Q.a,{className:s.form},i.a.createElement(ee.a,{placeholder:P("New file"),className:s.input,type:"File",onChange:o}),i.a.createElement(ee.a,{className:s.input,type:"number",name:"version",value:c,onChange:l,placeholder:P("Version")})),i.a.createElement($.a,null,i.a.createElement(Z.a,{onClick:n,variant:"contained",color:"primary"},P("Save")),i.a.createElement(Z.a,{onClick:a,variant:"outlined"},P("Cancel"))))}var Pn=function(e){var t=e.open,a=e.onClose,n=e.onSave,o=e.versionRecord,l=Object(r.useState)({}),u=Object(s.a)(l,2),d=u[0],m=u[1],f=i.a.useCallback((function(){d.file&&d.version?(n(d),m({}),a()):alert(P("Version number field should be required"))}),[d,n,a]),p=i.a.useCallback((function(e){var t=e.target,a=t.name,n=t.value;m((function(e){return Object(c.a)({},e,Object(V.a)({},a,n))}))}),[]),v=i.a.useCallback((function(e){var t=e.target.files;t.length&&m((function(e){return Object(c.a)({},e,{file:t})}))}),[]),h=i.a.useCallback((function(){m({}),a()}),[a]);return Object(r.useEffect)((function(){o&&m(Object(c.a)({},o))}),[o]),i.a.createElement(Tn,{record:d,open:t,onSave:f,onClose:h,onFileChange:v,onVersionChange:p})},Dn=Object(M.a)((function(e){return{dmsTreeContainer:{width:300,paddingRight:10,maxHeight:"35%",overflow:"auto"},treeElement:{padding:"0px 5px",display:"flex"},treeElementContainer:{cursor:"pointer","&:hover":{backgroundColor:"rgba(0, 0, 0, .05)"}},selected:{backgroundColor:"rgba(0, 0, 0, .03)"},expandIcon:{marginTop:3,cursor:"pointer"},folderIcon:{fontSize:"1.3rem",marginRight:5},root:{padding:"2px !important"},tagName:{paddingTop:5,paddingLeft:3},noChildElement:{paddingLeft:20},tagTitle:{paddingLeft:20,fontWeight:"bold"}}}));function Ln(e){var t=Dn(),a=!1===e.isCollapse?A.a:U.a;return i.a.createElement(a,{className:t.expandIcon,onClick:e.onClick})}var Vn=function(e){var t=e.data,a=e.selectedTags,n=e.onChecked,o=Dn(),l=Object(r.useState)([]),c=Object(s.a)(l,2),u=c[0],d=c[1],m=i.a.useCallback((function(e,t){var a=t.id;e&&e.stopPropagation();var n=!0;d((function(e){var t=e.indexOf(a);return n&&(n=!1,t>-1?e.splice(t,1):e.push(a)),Object(k.a)(e)}))}),[]),f=i.a.useCallback((function(e,t){e.stopPropagation();var a=[t.id];t.tagList&&a.push.apply(a,Object(k.a)(t.tagList.map((function(e){return e.id})))),n(a)}),[n]);return i.a.createElement("div",{className:o.dmsTreeContainer},t.length>0&&i.a.createElement(oe.a,{className:o.tagTitle,variant:"subtitle1"},P("Tags")),function e(t,n){return t.map((function(t,r){var l=t.tagList||[],c=u.includes(t.id),s=Boolean(l.length);return i.a.createElement(i.a.Fragment,{key:r},i.a.createElement("div",{className:q()(o.treeElementContainer)},i.a.createElement("div",{className:q()(o.treeElement,Object(V.a)({},o.noChildElement,!s)),style:{marginLeft:15*n},onClick:function(e){return f(e,t)}},s&&i.a.createElement(Ln,{onClick:function(e){return m(e,t)},isCollapse:c}),i.a.createElement(Ut.a,{checked:a.includes(t.id),classes:{root:o.root}}),i.a.createElement(oe.a,{className:o.tagName},t.name))),!c&&e(l,n+1))}))}(t,1))},Bn=a(385),Mn=a(383),Rn=a(384),Un=Object(B.a)((function(e){return{collapseHandle:{padding:e.spacing(.5),display:"flex",alignItems:"center",justifyContent:"space-between"},collapseContainer:{maxHeight:200,overflow:"auto"}}}));var zn=function(e){var t=e.children,a=e.hasData,n=Un(),r=i.a.useState(!1),o=Object(s.a)(r,2),l=o[0],c=o[1];return i.a.createElement(i.a.Fragment,null,i.a.createElement(Me.a,{only:"xs"},t),i.a.createElement(Me.a,{smUp:!0},a&&i.a.createElement("div",{className:n.collapseHandle,onClick:function(){return c((function(e){return!e}))}},i.a.createElement(oe.a,null,P("Directory and Tags")),i.a.createElement(Xe.a,{size:"small"},l?i.a.createElement(Mn.a,null):i.a.createElement(Rn.a,null))),i.a.createElement(Bn.a,{classes:{container:n.collapseContainer},in:l},t)))},An=a(386);function Wn(){return _n.apply(this,arguments)}function _n(){return(_n=Object(j.a)(y.a.mark((function e(){var t;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={_domain:"self.code = 'project'"},e.abrupt("return",Va.search({data:t}).then((function(e){return Object(s.a)(e.data,1)[0]})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hn(e,t){return qn.apply(this,arguments)}function qn(){return(qn=Object(j.a)(y.a.mark((function e(t,a){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ba.fetch(t,{fields:a}).then((function(e){return Object(s.a)(e.data,1)[0]})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gn(){return(Gn=Object(j.a)(y.a.mark((function e(){return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Wn().then((function(e){if(e&&e.id)return Hn(e.id,["defaultIncrement"]).then((function(e){return e&&e.defaultIncrement}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kn(){return(Kn=Object(j.a)(y.a.mark((function e(t){var a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return a={criteria:[{fieldName:"membersUserSet.id",operator:"in",value:[t]}]},e.abrupt("return",Ma.search({fields:["fullName"],data:a}).then((function(e){var t=e.data;return void 0===t?[]:t})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yn(){return(Yn=Object(j.a)(y.a.mark((function e(){var t,a,n,r=arguments;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:[],a=r.length>1?r[1]:void 0,t.length&&a){e.next=4;break}return e.abrupt("return");case 4:return n={criteria:[{fieldName:"id",operator:"in",value:Object(k.a)(t)},{fieldName:"membersUserSet.id",operator:"in",value:[a]}],operator:"and"},e.abrupt("return",Ma.search({fields:["fullName"],data:n}).then((function(e){var t=e.data;return void 0===t?[]:t})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xn(){return(Xn=Object(j.a)(y.a.mark((function e(t,a){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return n={id:t.id,version:t.version,isLock:!0,lockedBy:{id:a}},e.abrupt("return",Ra.save(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jn(){return(Jn=Object(j.a)(y.a.mark((function e(t){var a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={id:t.id,version:t.version,isLock:!1,lockedBy:null},e.abrupt("return",Ra.save(a));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qn(){return(Qn=Object(j.a)(y.a.mark((function e(t){var a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return"com.axelor.apps.projectdms.web.DMSController:sendEmail",a={data:{model:Ra.model,domain:null,context:Object(c.a)({},t)}},e.abrupt("return",Ra.action("com.axelor.apps.projectdms.web.DMSController:sendEmail",a).then((function(e){return e.status})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $n(){return($n=Object(j.a)(y.a.mark((function e(){var t;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"com.axelor.meta.web.MetaFilterController:findFilters",t={data:{model:Ua.model,domain:null,context:{filterView:"dms-file-filters",_model:Ua.model}}},e.abrupt("return",Ua.action("com.axelor.meta.web.MetaFilterController:findFilters",t).then((function(e){var t=e.data;return void 0===t?[]:t})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zn(){return(Zn=Object(j.a)(y.a.mark((function e(t){var a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return"com.axelor.meta.web.MetaFilterController:removeFilter",a={data:{model:Ua.model,domain:null,context:Object(c.a)({},t)}},e.abrupt("return",Ua.action("com.axelor.meta.web.MetaFilterController:removeFilter",a).then((function(e){var t=e.data;return void 0===t?{}:t})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function er(){return(er=Object(j.a)(y.a.mark((function e(t){var a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return"com.axelor.meta.web.MetaFilterController:saveFilter",a={data:{model:Ua.model,domain:null,context:Object(c.a)({},t,{},t.name&&{name:t.name},{filterView:"dms-file-filters",filters:""})}},e.abrupt("return",Ua.action("com.axelor.meta.web.MetaFilterController:saveFilter",a).then((function(e){return e.data})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tr(){return(tr=Object(j.a)(y.a.mark((function e(t,a,n){var r,i,o,l;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(e){return!(!e.user||!e.group)},i=a.map((function(e){if(!e.id&&r(e))return Object(c.a)({},e,{file:{id:t},value:e.value?e.value.id:null})})).filter((function(e){return e})),o={records:i},l=[],i.length>0&&l.push(za.save(o,!0)),n.length>0&&l.push(za.removeAll(n)),e.abrupt("return",Promise.all(l).then((function(e){if(i.length>0){var t=e[0].data,n=void 0===t?[]:t;return[].concat(Object(k.a)(a.filter((function(e){return e.id}))),Object(k.a)(n))}return Object(k.a)(a)})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ar(){return(ar=Object(j.a)(y.a.mark((function e(t){var a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={_domain:"self.file.id = ".concat(t)},e.abrupt("return",za.search({data:a}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nr(){return(nr=Object(j.a)(y.a.mark((function e(){var t,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={_domain:"self.jsonModel is null and self.model = '".concat(Ra.model,"'")},a=["type","name","model","modelField","visibleInGrid"],e.abrupt("return",Aa.search({fields:a,data:t}).then((function(e){var t=e.data;return void 0===t?[]:t})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var rr=Object(M.a)((function(e){return{form:{display:"flex",flexDirection:"column","& svg.addIcon":{cursor:"pointer",marginTop:10},"& svg.closeIcon":{marginTop:5,cursor:"pointer"}},input:{marginBottom:25},permissionView:{display:"flex",flexDirection:"row",justifyContent:"space-between"},actionButton:{textTransform:"capitalize"}}})),ir="com.axelor.auth.db.User",or="com.axelor.auth.db.Group",lr={user:null,group:null,value:null};function cr(e){var t=e.open,a=e.onClose,n=e.onSave,r=e.onNew,o=e.onRemove,l=e.onChange,c=e.onFetch,s=e.permissionList,u=void 0===s?[]:s,d=rr();return i.a.createElement(X.a,{open:t,onClose:a,maxWidth:"sm",fullWidth:!0},i.a.createElement(J.a,null,P("Permissions")),i.a.createElement(Q.a,{className:d.form},u.map((function(e,t){return i.a.createElement("div",{key:t,className:q()(d.permissionRow,d.permissionView)},i.a.createElement(ra,{readOnly:Boolean(e.id),fetchAPI:function(e){return c(e,ir,"fullName")},isSearchable:!0,optionLabelKey:"fullName",optionValueKey:"id",name:"user",value:e.user,formControlStyle:{marginBottom:"5px",width:"30%"},clearIndicatorStyle:{paddingLeft:"0 !important"},closeMenuOnScroll:!1,onChange:function(e){return l("user",e,t)}}),i.a.createElement(ra,{readOnly:Boolean(e.id),fetchAPI:function(e){return c(e,or,"name")},isSearchable:!0,optionLabelKey:"name",optionValueKey:"id",name:"group",value:e.group,formControlStyle:{marginBottom:"5px",width:"30%"},clearIndicatorStyle:{paddingLeft:"0 !important"},closeMenuOnScroll:!1,onChange:function(e){return l("group",e,t)}}),i.a.createElement(ra,{readOnly:Boolean(e.id),name:"value",value:e.value,onChange:function(e){return l("value",e,t)},options:L,formControlStyle:{marginBottom:"5px",width:"30%"},clearIndicatorStyle:{paddingLeft:"0 !important"},closeMenuOnScroll:!1}),i.a.createElement(ft.a,{className:"closeIcon",onClick:function(){return o(t)}}))})),i.a.createElement(An.a,{className:"addIcon",onClick:r})),i.a.createElement($.a,null,i.a.createElement(Z.a,{onClick:a,variant:"outlined",className:d.actionButton},P("Close")),i.a.createElement(Z.a,{onClick:n,variant:"contained",color:"primary",className:d.actionButton},P("OK"))))}function sr(e){var t=e.open,a=e.onClose,n=e.onFetch,r=e.onChange,o=e.onNew,l=e.onRemove,c=e.onSave,s=e.permissionList,u=void 0===s?[]:s,d=rr();return i.a.createElement(X.a,{open:t,onClose:a,maxWidth:"sm",fullWidth:!0,fullScreen:!0,TransitionComponent:Ae,transitionDuration:200},i.a.createElement(J.a,null,P("Permissions")),i.a.createElement(Q.a,{className:d.form},u.map((function(e,t){return i.a.createElement("div",{key:t,className:d.permissionView},i.a.createElement(ce.a,{container:!0,direction:"column",className:d.permissionRow},i.a.createElement(ra,{readOnly:Boolean(e.id),fetchAPI:function(e){return n(e,ir,"fullName")},isSearchable:!0,optionLabelKey:"fullName",optionValueKey:"id",name:"user",value:e.user,formControlStyle:{marginBottom:"5px",width:"80%"},clearIndicatorStyle:{paddingLeft:"0 !important"},closeMenuOnScroll:!1,onChange:function(e){return r("user",e,t)}}),i.a.createElement(ra,{readOnly:Boolean(e.id),fetchAPI:function(e){return n(e,or,"name")},isSearchable:!0,optionLabelKey:"name",optionValueKey:"id",name:"group",value:e.group,formControlStyle:{marginBottom:"5px",width:"80%"},clearIndicatorStyle:{paddingLeft:"0 !important"},closeMenuOnScroll:!1,onChange:function(e){return r("group",e,t)}}),i.a.createElement(ra,{readOnly:Boolean(e.id),name:"value",value:e.value,onChange:function(e){return r("value",e,t)},options:L,formControlStyle:{marginBottom:"5px",width:"80%"},clearIndicatorStyle:{paddingLeft:"0 !important"},closeMenuOnScroll:!1})),i.a.createElement(ft.a,{className:d.closeIcon,onClick:function(){return l(t)}}))})),i.a.createElement(An.a,{className:d.addIcon,onClick:o})),i.a.createElement($.a,null,i.a.createElement(Z.a,{onClick:a,variant:"outlined"},P("Close")),i.a.createElement(Z.a,{onClick:c,variant:"contained",color:"primary"},P("OK"))))}var ur=function(e){var t=e.onSave,a=e.open,n=e.onClose,r=e.fileId,o=i.a.useState([Object(c.a)({},lr)]),l=Object(s.a)(o,2),u=l[0],d=l[1],m=i.a.useState([]),f=Object(s.a)(m,2),p=f[0],v=f[1];i.a.useEffect((function(){(function(e){return ar.apply(this,arguments)})(r).then((function(e){var t=e.data,a=void 0===t?[]:t;a.length>0?d(Object(k.a)(a)):d([Object(c.a)({},lr)])}))}),[r]);var h=i.a.useCallback((function(){(function(e,t,a){return tr.apply(this,arguments)})(r,u,p).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];d(Object(k.a)(e)),t(e),n()}))}),[t,p,u,r,n]),b=i.a.useCallback((function(e,t,a){d((function(n){return n[a]=Object(c.a)({},n[a],Object(V.a)({},e,t)),Object(k.a)(n)}))}),[]),g=i.a.useCallback((function(e){var t=u[e];t&&(t.id&&v((function(e){return[].concat(Object(k.a)(e),[Object(c.a)({},t)])})),d((function(t){return t.splice(e,1),0===t.length&&t.push(Object(c.a)({},lr)),Object(k.a)(t)})))}),[u]),C=i.a.useCallback((function(){var e=u[u.length-1];e.user&&e.group&&d((function(e){return[].concat(Object(k.a)(e),[Object(c.a)({},lr)])}))}),[u]),E=i.a.useCallback((function(e,t,a){var n=La(t),r=Object(c.a)({},""!==e.search&&{criteria:[{fieldName:a,operator:"like",value:e.search}]});return n.search({fields:[a],data:r}).then((function(e){var t=e.data;return void 0===t?[]:t}))}),[]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(Me.a,{only:"xs"},i.a.createElement(cr,{open:a,onSave:h,onNew:C,onRemove:g,onChange:b,onFetch:E,onClose:n,permissionList:u})),i.a.createElement(Me.a,{smUp:!0},i.a.createElement(sr,{open:a,onSave:h,onNew:C,onRemove:g,onChange:b,onFetch:E,onClose:n,permissionList:u})))},dr=a(366),mr=Object(B.a)({root:{height:"inherit",width:"inherit",position:"relative",display:"flex",justifyContent:"center",alignItems:"center"},top:{color:"#eef3fd"},bottom:{color:"#3ecf8e",animationDuration:"250ms",position:"absolute"}});var fr=function(e){var t=mr();return(i.a.createElement("div",{className:t.root},i.a.createElement(dr.a,Object.assign({variant:"determinate",value:100,className:t.top,size:24,thickness:4},e)),i.a.createElement(dr.a,Object.assign({variant:"indeterminate",disableShrink:!0,className:t.bottom,size:24,thickness:4},e))))},pr=Object(B.a)((function(e){var t;return{sideColumn:{border:"1px solid",width:250},contentColumn:{flexGrow:1},dmsContentContainer:Object(V.a)({display:"flex",width:"100%",position:"relative",height:"calc(100% - 50px)",marginTop:e.spacing(.5),".popup &":{height:"60vh"}},e.breakpoints.only("xs"),{flexDirection:"column"}),dmsGridContainer:(t={width:"calc(100% - 250px)"},Object(V.a)(t,e.breakpoints.only("xs"),{width:"100%"}),Object(V.a)(t,"position","relative"),Object(V.a)(t,"display","flex"),Object(V.a)(t,"overflow","hidden"),Object(V.a)(t,"flexGrow",1),Object(V.a)(t,"height","100%"),t),dmsSideTreeView:Object(V.a)({height:"100%",backgroundColor:e.palette.grey[100]},e.breakpoints.only("xs"),{height:"auto"}),fileInput:{display:"none"},noSelectedProjectView:{textAlign:"center",padding:25}}}));var vr=function(e){var t=e.data,a=e.treeData,n=e.viewMode,o=e.fields,l=e.filters,c=e.searchFilter,s=e.projectList,u=e.selectedProject,d=e.pagination,m=e.currentFolder,f=e.favouriteSearch,p=e.tagList,v=e.selectedTags,h=e.selectedFiles,b=e.breadcrumb,g=e.uploadFiles,C=e.sortingField,E=e.customFields,O=e.userId,y=e.versionDialog,j=e.fileInput,k=e.document,w=e.handleViewModeChange,x=e.handleFilterChange,N=e.handleFilterSave,S=e.handleFilterRemove,F=e.handleSelectedProject,I=e.handleNext,T=e.handlePrev,D=e.handleFavouriteSearch,L=e.handleContentSearch,V=e.handleOpenUpload,B=e.handleExport,M=e.handleExportAll,R=e.handleFolderDoubleClick,U=e.handleFolderCreate,z=e.handleFilterTagCheck,A=e.handleFileUpload,W=e.handleSelect,_=e.handleSortingField,H=e.handleDocumentDelete,q=e.handleDocumentClose,G=e.handleDownload,K=e.handleDocumentLock,Y=e.handleDocumentUnlock,X=e.cancelUpload,J=e.showPermission,Q=e.handlePermissionClose,$=e.handlePermissionOpen,Z=e.handleSavePermission,ee=e.handleMetaFileDownload,te=e.handleFavouriteDocument,ae=e.retryUpload,ne=e.handleVersionDialog,re=e.handleSendMail,le=e.handleTagSave,ce=e.handleVersionRestore,se=e.handleVersionUpdate,ue=e.handleFileSelect,de=e.versionRecord,me=e.loading,fe=pr(),pe=Object(r.useCallback)((function(){return ne(!0)}),[ne]),ve=Object(r.useCallback)((function(){return ne(!1)}),[ne]),he=Object(r.useCallback)((function(e){e&&(j.current=e)}),[j]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(mn,{viewMode:n,onViewModeChange:w,fields:o,onFilter:x,onSave:N,onRemove:S,filters:l,searchFilter:c,projectList:s,selectedProject:u,handleSelectedProject:F,onNext:I,onPrev:T,pagination:d,favouriteSearch:f,onFavouriteSearch:D,onContentSearch:L,onOpenUpload:V,onExport:B,onExportAll:M}),me?i.a.createElement(fr,null):u?i.a.createElement("div",{className:fe.dmsContentContainer},i.a.createElement("div",{className:fe.dmsSideTreeView},i.a.createElement(zn,{hasData:Boolean(m)},i.a.createElement(ie,{currentFolder:m,data:a,handleFolder:R,onFolderCreate:U}),i.a.createElement(Vn,{currentFolder:m,data:p,onChecked:z,selectedTags:v}))),i.a.createElement("div",{className:fe.dmsGridContainer},i.a.createElement(Le,{data:t,handleFileUpload:A,viewMode:n,onSelect:W,onFolderDoubleClick:R,selectedFiles:h,sortingField:C,onSorting:_,onDelete:H,breadcrumb:b,onFavouriteDocument:te,userId:O,customFields:E}),i.a.createElement(qe,{droppedFiles:g,cancelUpload:X,retryUpload:ae}))):i.a.createElement("div",{className:fe.noSelectedProjectView},i.a.createElement(oe.a,{variant:"h6"},P("No project selected"))),i.a.createElement(Fn,{document:k,onClose:q,onDownload:G,onLock:K,onUnlock:Y,onSendMail:re,userId:O,onNewVersion:pe,onVersionDownload:ee,onRestore:ce,tagList:p,onTagSave:le,onPermission:$}),i.a.createElement(Pn,{open:y,onClose:ve,onSave:se,versionRecord:de}),i.a.createElement("input",{className:fe.fileInput,type:"file",multiple:!0,ref:he,onChange:ue}),k&&i.a.createElement(ur,{open:J,onClose:Q,fileId:k.id,onSave:Z}))};function hr(e){return"".concat(Pa.instance.defaults.baseURL,"ws/dms/inline/").concat(e)}function br(e){return"".concat(Pa.instance.defaults.baseURL,"ws/dms/download/").concat(e)}function gr(e){var t=e.userInfo,a=void 0===t?{}:t,n=i.a.useState(),o=Object(s.a)(n,2),l=o[0],u=o[1],d=i.a.useState({offset:0,limit:40,total:0}),m=Object(s.a)(d,2),f=m[0],p=m[1],v=i.a.useState(null),h=Object(s.a)(v,2),b=h[0],g=h[1],C=i.a.useState([]),E=Object(s.a)(C,2),O=E[0],w=E[1],x=i.a.useState([]),P=Object(s.a)(x,2),L=P[0],V=P[1],B=i.a.useState([]),M=Object(s.a)(B,2),R=M[0],U=M[1],z=i.a.useState([]),A=Object(s.a)(z,2),W=A[0],_=A[1],H=i.a.useState(!1),q=Object(s.a)(H,2),G=q[0],K=q[1],Y=i.a.useState("list"),X=Object(s.a)(Y,2),J=X[0],Q=X[1],$=i.a.useState([]),Z=Object(s.a)($,2),ee=Z[0],te=Z[1],ae=i.a.useState(),ne=Object(s.a)(ae,2),re=ne[0],ie=ne[1],oe=i.a.useState(),le=Object(s.a)(oe,2),ce=le[0],se=le[1],ue=i.a.useState(!1),de=Object(s.a)(ue,2),me=de[0],fe=de[1],pe=i.a.useState("1.0"),ve=Object(s.a)(pe,2),he=ve[0],be=ve[1],ge=i.a.useState([]),Ce=Object(s.a)(ge,2),Ee=Ce[0],Oe=Ce[1],ye=i.a.useState(),je=Object(s.a)(ye,2),ke=je[0],we=je[1],xe=i.a.useState(),Ne=Object(s.a)(xe,2),Se=Ne[0],Fe=Ne[1],Ie=i.a.useState([]),Te=Object(s.a)(Ie,2),Pe=Te[0],De=Te[1],Le=i.a.useState(!1),Ve=Object(s.a)(Le,2),Be=Ve[0],Me=Ve[1],Re=i.a.useState(),Ue=Object(s.a)(Re,2),ze=Ue[0],Ae=Ue[1],We=i.a.useState(!0),_e=Object(s.a)(We,2),He=_e[0],qe=_e[1],Ge=i.a.useState([]),Ke=Object(s.a)(Ge,2),Ye=Ke[0],Xe=Ke[1],Je=i.a.useState(),Qe=Object(s.a)(Je,2),$e=Qe[0],Ze=Qe[1],et=i.a.useState(),tt=Object(s.a)(et,2),at=tt[0],nt=tt[1],rt=i.a.useState(),it=Object(s.a)(rt,2),ot=it[0],lt=it[1],ct=i.a.useState([]),st=Object(s.a)(ct,2),ut=st[0],dt=st[1],mt=i.a.useState([]),ft=Object(s.a)(mt,2),pt=ft[0],vt=ft[1],ht=i.a.useState([]),bt=Object(s.a)(ht,2),gt=bt[0],Ct=bt[1],Et=i.a.useRef(R),Ot=i.a.useRef(),yt=i.a.useCallback((function(){return a&&a["user.id"]}),[a]),jt=i.a.useCallback((function(){p({offset:0,limit:40,total:0})}),[]),kt=i.a.useCallback((function(){return ut.map((function(e){return e.visibleInGrid?"".concat(e.modelField,".").concat(e.name):null})).filter((function(e){return e}))}),[ut]),wt=i.a.useCallback((function(e){w((function(t){var a=e.filter((function(e){return-1===t.findIndex((function(t){return t.id===e.id}))&&e.isDirectory}));return[].concat(Object(k.a)(t),Object(k.a)(a))}))}),[]),xt=i.a.useCallback((function(e){var t=L.find((function(t){return t.id===e}))||{};return{relatedId:t.relatedId,relatedModel:t.relatedModel}}),[L]);i.a.useEffect((function(){if(ke){var e={criteria:[{fieldName:"projectSet.id",operator:"in",value:[ke.id]}]};_a.search({data:e,fields:["projectSet","name","color","tagList"]}).then((function(e){var t=e.data,a=void 0===t?[]:t;a&&Array.isArray(a)&&vt(Object(k.a)(a))}))}}),[ke]),i.a.useEffect((function(){if(l){var e={_domain:"self.parent.id = ".concat(l," and self.isDirectory = true")},t=["fileName","parent.id","isDirectory","metaFile.sizeText","typeIcon","relatedModel","relatedId","isLock","lockedBy","metaFile.id"].concat(Object(k.a)(kt()));Ra.search({data:e,fields:t}).then((function(e){var t=e.data;wt(void 0===t?[]:t)}))}}),[l,wt,kt]);var Nt=f.limit,St=f.offset;i.a.useEffect((function(){if(l){var e=[];$e&&$e.query&&e.push(Object(c.a)({},$e.query)),gt.length&&e.push({fieldName:"tags.id",operator:"in",value:gt}),at&&e.push({fieldName:"favouriteUserSet.id",operator:"in",value:[a["user.id"]]}),ot&&e.push({fieldName:"fileName",operator:"like",value:ot});var t={_domain:"self.parent.id = ".concat(l),criteria:e,operator:"and"},n=["fileName","parent.id","isDirectory","metaFile.sizeText","typeIcon","relatedModel","relatedId","isLock","lockedBy","metaFile.id","tags","favouriteUserSet"].concat(Object(k.a)(kt()));Ra.search({data:t,fields:n,limit:Nt,offset:St,sortBy:["-isDirectory","fileName"]}).then((function(e){var t=e.data,a=void 0===t?[]:t;qe(!1),V(a),p((function(t){return Object(c.a)({},t,{total:e.total})}))}))}}),[$e,l,gt,St,Nt,at,a,ot,kt]);var Ft=i.a.useCallback((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(l){var t=[];$e&&$e.query&&t.push(Object(c.a)({},$e.query)),gt.length&&t.push({fieldName:"tags.id",operator:"in",value:gt}),at&&t.push({fieldName:"favouriteUserSet.id",operator:"in",value:[a["user.id"]]}),ot&&t.push({fieldName:"fileName",operator:"like",value:ot});var n={_domain:"self.parent.id = ".concat(l),criteria:t,operator:"and"},r=!0===e?[]:["fileName","metaFile.sizeText","typeIcon","isLock","lockedBy","metaFile.id","tags"].concat(Object(k.a)(kt())),i=["isDirectory"];Ra.export({data:n,fields:r,sortBy:i})}}),[$e,l,gt,at,a,ot,kt]),It=i.a.useCallback((function(){var e=yt();e&&(b&&b.projectIds?function(){return Yn.apply(this,arguments)}(b.projectIds.split(","),e).then((function(e){Oe(e),qe(!1)})):function(e){return Kn.apply(this,arguments)}(e).then((function(e){Oe(e),qe(!1)})))}),[yt,b]),Tt=i.a.useCallback((function(){(function(){return nr.apply(this,arguments)})().then(dt)}),[]),Pt=i.a.useCallback((function(){Ra.search({data:{_domain:"self.relatedModel = 'com.axelor.apps.project.db.Project' and self.relatedId = 0 and self.isDirectory = true and self.parent = null"}}).then((function(e){var t=e.data,a=void 0===t?[]:t;if(a[0])Fe(a[0]);else{Ra.save({relatedModel:"com.axelor.apps.project.db.Project",relatedId:0,isDirectory:!0,parent:null,fileName:"Projects"}).then((function(e){var t=e.data,a=void 0===t?[]:t;a[0]&&Fe(a[0])}))}}))}),[]),Dt=i.a.useCallback((function(e,t){var a="self.relatedModel = 'com.axelor.apps.project.db.Project' and self.isDirectory = true and self.relatedId = ".concat(e.id);t&&(a="".concat(a," and self.parent.id = ").concat(t.id));var n={_domain:a},r=["fileName","parent.id","isDirectory","metaFile.sizeText","typeIcon","relatedModel","relatedId","isLock","lockedBy","metaFile.id","tags","favouriteUserSet"].concat(Object(k.a)(kt()));Ra.search({fields:r,data:n}).then((function(t){var a=t.data,n=void 0===a?[]:a;if(n[0])jt(),u(n[0].id),w((function(e){return[].concat(Object(k.a)(e),[Object(c.a)({},n[0])])})),De([Object(c.a)({},n[0])]);else{var r={relatedModel:"com.axelor.apps.project.db.Project",relatedId:e.id,isDirectory:!0,parent:null,fileName:e.fullName};Ra.save(r).then((function(e){var t=e.data,a=void 0===t?[]:t;a[0]&&(jt(),u(a[0].id),w((function(e){return[].concat(Object(k.a)(e),[Object(c.a)({},a[0],{"parent.id":a[0].parent.id})])})),De([Object(c.a)({},a[0],{"parent.id":a[0].parent.id})]))}))}}))}),[jt,kt]),Lt=i.a.useCallback((function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:he,n={metaFile:e,documentId:{id:t},documentVersion:a};return Wa.save(n).then((function(e){var t=e.data;return t[0]?t[0]:null}))}),[he]),Vt=i.a.useCallback((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Ra.save(e).then((function(e){var a=(e||{}).data,n=(void 0===a?[]:a)[0];if(n.id)if(Lt(n.metaFile,n.id,t),t)V((function(e){var t=e.find((function(e){return e.id===n.id}));return-1!==t&&(e[t]=Object(c.a)({},n,{"metaFile.id":n.metaFile.id})),Object(k.a)(e)})),ie(Object(c.a)({},n,{"metaFile.id":n.metaFile.id}));else{var r=n.parent?n.parent.id:null;n.isDirectory&&w((function(e){return[].concat(Object(k.a)(e),[Object(c.a)({},n,{"parent.id":r})])})),V((function(e){return[].concat(Object(k.a)(e),[Object(c.a)({},n)])})),u(r)}}))}),[Lt]),Bt=i.a.useCallback((function(e,t){_((function(a){var n=a.findIndex((function(e){return e.id===t}));if(-1!==n){var r=a[n].file,i=100*e/r.size;a[n]=Object(c.a)({},a[n],{progress:i})}return Object(k.a)(a)}))}),[]),Mt=i.a.useCallback((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=e.id,r=e.file,i=(Et.current||[]).find((function(e){return e.id===n}));if(!i||i.status!==F){var o=t+1e6<r.size?t+1e6:r.size,l=r.slice(t,o),c={"X-File-Name":r.name,"X-File-Offset":Math.min(t,r.size),"X-File-Size":r.size,"X-File-Type":r.type};return a&&(c["X-File-Id"]=a),Pa.upload(l,c,(function(e){Bt(o,n)})).then((function(n){if(n.id)return Promise.resolve(n);var r=a;return n.fileId&&(r=n.fileId),Mt(e,t+1e6,r)}))}}),[Bt]),Rt=i.a.useCallback(function(){var e=Object(j.a)(y.a.mark((function e(t){var a,n,r,i=arguments;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=i.length>1&&void 0!==i[1]?i[1]:null,_(t),K(!0),n=y.a.mark((function e(n){var r,i,o,s,u,d,m;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t[n],e.next=3,Mt(r);case 3:(i=e.sent)&&i.id&&(a?(o={metaFile:{id:i.id},id:re.id,version:re.version},Vt(o,a)):(s=xt(l),u=s.relatedId,d=s.relatedModel,m=Object(c.a)({metaFile:{id:i.id},fileName:i.fileName,tags:[]},l&&Number(l)>0?{parent:{id:l}}:{},{},u&&d?{relatedId:u,relatedModel:d}:{}),Vt(m)),_((function(e){var t=e.findIndex((function(e){return e.id===r.id}));return-1!==t&&(e[t].status=S),Object(k.a)(e)})));case 5:case"end":return e.stop()}}),e)})),r=0;case 5:if(!(r<t.length)){e.next=10;break}return e.delegateYield(n(r),"t0",7);case 7:r++,e.next=5;break;case 10:_((function(e){return e.filter((function(e){return e.status!==S}))})),U([]),K(!1);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[xt,Mt,l,Vt,re]),Ut=i.a.useCallback((function(e){_((function(t){var a=t.findIndex((function(t){return t.id===e}));return-1!==a&&t[a].status!==S&&(t[a]=Object(c.a)({},t[a],{status:F})),Object(k.a)(t)}))}),[]),zt=i.a.useCallback((function(e){var t=Object(k.a)(W),a=t.findIndex((function(t){return t.id===e}));-1!==a&&t[a].status!==S&&(t[a]=Object(c.a)({},t[a],{status:N})),Et.current=t}),[W]),At=i.a.useCallback((function(e){var t=Array.prototype.slice.call(e).slice(0).map((function(e,t){return{file:e,id:t,progress:0,status:N}}));U(t)}),[]),Wt=i.a.useCallback((function(e){Q(e)}),[]),_t=i.a.useCallback((function(e,t){t?(te((function(t){var a=t.findIndex((function(t){return t.id===e.id}));return-1===a?t.push(Object(c.a)({},e)):t.splice(a,1),Object(k.a)(t)})),ie()):(ie(e),te([e]))}),[]),Ht=Object(r.useCallback)((function(){te((function(e){return e.filter((function(e){return e.id!==re.id}))})),ie(void 0)}),[re]),qt=i.a.useCallback((function(){Pa.download(re)}),[re]),Gt=i.a.useCallback((function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=e.data,n=void 0===a?[]:a;n[0]&&(t&&ie(Object(c.a)({},n[0])),V((function(e){var t=e.findIndex((function(e){return e.id===n[0].id}));return-1!==t&&(e[t]=Object(c.a)({},n[0],{"parent.id":n[0].parent.id})),Object(k.a)(e)})))}),[]),Kt=i.a.useCallback((function(){(function(e,t){return Xn.apply(this,arguments)})(re,yt()).then(Gt)}),[re,yt,Gt]),Yt=i.a.useCallback((function(){(function(e){return Jn.apply(this,arguments)})(re).then(Gt)}),[re,Gt]),Xt=i.a.useCallback((function(){return function(e){return Qn.apply(this,arguments)}(re).then((function(e){return 0===e&&alert("Mail sent to the user")}))}),[re]),Jt=i.a.useCallback((function(e){jt(),De(function(e,t){var a=[],n=e;do{a.push(Object(c.a)({},n)),n=t.find((function(e){return e.id===n["parent.id"]}))}while(n);return a.reverse()}(e,O)),u(e.id)}),[jt,O]),Qt=i.a.useCallback((function(e){return function(e){return er.apply(this,arguments)}(e).then((function(e){if(e.id)return Xe((function(t){var a=t.findIndex((function(t){return t.id===e.id}));return-1===a?t.push(Object(c.a)({},e)):t[a]=Object(c.a)({},e),Object(k.a)(t)})),e}))}),[]),$t=i.a.useCallback((function(){(function(){return $n.apply(this,arguments)})().then(Xe)}),[]),Zt=i.a.useCallback((function(e){return function(e){return Zn.apply(this,arguments)}(e).then((function(e){if(e.name)return Xe((function(t){var a=t.findIndex((function(t){return t.name===e.name}));return-1!==a&&t.splice(a,1),Object(k.a)(t)})),e}))}),[]),ea=i.a.useCallback((function(e){se(e),V((function(t){return t.sort(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";return function(a,n){if(!a.hasOwnProperty(e)||!n.hasOwnProperty(e))return 0;var r="string"===typeof a[e]?a[e].toUpperCase():a[e]||"",i="string"===typeof n[e]?n[e].toUpperCase():n[e]||"",o=0;return r>i?o=1:r<i&&(o=-1),"desc"===t?-1*o:o}}(T(e),I(e))),Object(k.a)(t)}))}),[]),ta=i.a.useCallback((function(e){fe(e)}),[]),aa=i.a.useCallback((function(e){var t=Array.prototype.slice.call(e.file).slice(0).map((function(e,t){return{file:e,id:t,progress:0,status:N}}));Rt(Object(k.a)(t),e.version)}),[Rt]),na=i.a.useCallback((function(e){var t={version:re.version,id:re.id,metaFile:{id:e.metaFile.id}};Ra.save(t).then((function(e){var t=e.data,a=void 0===t?[]:t;if(a[0]){var n=a[0].metaFile,r=void 0===n?{}:n;V((function(e){var t=e.findIndex((function(t){return t.id===e[0].id}));return-1!==t&&(e[t]=Object(c.a)({},e[0],{"metaFile.id":r.id})),Object(k.a)(e)})),ie(Object(c.a)({},a[0],{"metaFile.id":r.id}))}}))}),[re]),ra=i.a.useCallback((function(e){var t=e.metaFile,a=void 0===t?{}:t;a.id&&Pa.metaFileDownload(a)}),[]),ia=i.a.useCallback((function(e){Array.isArray(e.query)||(jt(),Ze(e))}),[jt]),oa=i.a.useCallback((function(e){jt(),Ct((function(t){if(e.length>1){if(t.includes(e[0])){var a=t.filter((function(t){return!e.includes(t)}));return Object(k.a)(a)}var n=e.filter((function(e){return!t.includes(e)}));return[].concat(Object(k.a)(t),Object(k.a)(n))}var r=t.findIndex((function(t){return t===e[0]}));return-1!==r?t.splice(r,1):t.push(e[0]),Object(k.a)(t)}))}),[jt]),la=i.a.useCallback((function(e){we(e)}),[]);i.a.useEffect((function(){ke&&Se&&(Dt(ke,Se),qe(!0),w([]))}),[ke,Se,Dt]);var ca=Object(r.useCallback)((function(e){var t={id:re.id,version:re.version,tags:e};Ra.save(t).then((function(e){var t=e.data,a=void 0===t?[]:t;a[0]&&(ie(Object(c.a)({},a[0])),V((function(e){var t=e.findIndex((function(e){return e.id===a[0].id}));return-1!==t&&(e[t]=Object(c.a)({},a[0])),Object(k.a)(e)})))}),[])}),[re]),sa=i.a.useCallback((function(e){Vt(e)}),[Vt]),ua=i.a.useCallback((function(e){var t=ee.findIndex((function(t){return t.id===e.id})),a=[],n=-1===t?[e.id]:ee.map((function(e){return e.id}));-1===t?(a.push({id:e.id}),te([])):(a=ee,te([]));var r={criteria:[{fieldName:"documentId.id",operator:"in",value:n}]};Wa.search({fields:["id"],data:r}).then((function(e){var t=e.data,n=void 0===t?[]:t;Wa.removeAll(n).then((function(e){Ra.removeAll(a).then((function(e){var t=e.data,a=void 0===t?[]:t;if(a.length){var n=a.map((function(e){return e.id}));V((function(e){var t=e.filter((function(e){return!n.includes(e.id)}));return Object(k.a)(t)})),w((function(e){var t=e.filter((function(e){return!n.includes(e.id)}));return Object(k.a)(t)})),ie()}}))}))}))}),[ee]),da=i.a.useCallback((function(){p((function(e){var t=e.offset+e.limit;return Object(c.a)({},e,{offset:t<e.total?t:e.total})}))}),[]),ma=i.a.useCallback((function(){p((function(e){var t=e.offset-e.limit;return Object(c.a)({},e,{offset:t>0?t:0})}))}),[]),fa=i.a.useCallback((function(){nt((function(e){return!e}))}),[]),pa=i.a.useCallback((function(e){var t=Object(k.a)(e.favouriteUserSet||[]),n=t.findIndex((function(e){return e.id===a["user.id"]}));-1===n?t.push({id:a["user.id"]}):t.splice(n,1);var r={id:e.id,version:e.version,favouriteUserSet:t};Ra.save(r).then((function(e){Gt(e,!1)}))}),[Gt,a]),va=i.a.useCallback((function(e){lt(e)}),[]),ha=i.a.useCallback((function(){Ot.current.click()}),[]),ba=i.a.useCallback((function(){At(Ot.current.files)}),[At]),ga=i.a.useCallback((function(){Ft(!0)}),[Ft]),Ca=i.a.useCallback((function(){Me(!1)}),[]),Ea=i.a.useCallback((function(){Me(!0)}),[]),Oa=i.a.useCallback((function(e){ie((function(t){return Object(c.a)({},t,{permissions:e})})),V((function(t){var a=t.findIndex((function(e){return e.id===re.id}));return-1!==a&&(t[a]=Object(c.a)({},t[a],{permissions:e})),Object(k.a)(t)})),w((function(t){var a=t.findIndex((function(e){return e.id===re.id}));return-1!==a&&(t[a]=Object(c.a)({},t[a],{permissions:e})),Object(k.a)(t)}))}),[re]),ya=i.a.useCallback((function(){return ut.map((function(e){return{title:"".concat(e.name," (").concat(e.modelField,")"),name:"".concat(e.modelField,".").concat(e.name,"::text"),type:"string"}}))}),[ut]);return i.a.useEffect((function(){ke&&Se&&Dt(ke,Se)}),[ke,Se,Dt]),i.a.useEffect((function(){Et.current=W}),[W]),i.a.useEffect((function(){R.length&&!G&&Rt(R)}),[R,G,Rt]),i.a.useEffect((function(){if(re&&re["metaFile.id"]){var e={_domain:"self.metaFile.id = ".concat(re["metaFile.id"])};Wa.search({fields:["documentVersion"],data:e}).then((function(e){var t=e.data,a=void 0===t?[]:t;Ae((function(e){return Object(c.a)({},e,{version:Number(he)+(a[0]?Number(a[0].documentVersion):0)})}))}))}}),[he,re]),i.a.useEffect((function(){yt()&&(qe(!0),function(){return Gn.apply(this,arguments)}().then((function(e){return e&&be(e)})),$t(),Pt(),It(),Tt())}),[$t,Pt,It,yt,Tt]),i.a.useEffect((function(){for(var e={},t=/[?&]([^=#]+)=([^&#]*)/g,a=window.location.href,n=t.exec(a);n;)e[n[1]]=n[2],n=t.exec(a);g(e)}),[]),i.a.createElement(vr,{data:L,treeData:O,viewMode:J,fields:[].concat(Object(k.a)(D),Object(k.a)(ya())),filters:Ye,searchFilter:$e,projectList:Ee,selectedProject:ke,pagination:f,currentFolder:l,favouriteSearch:at,tagList:pt,selectedTags:gt,selectedFiles:ee,breadcrumb:Pe,uploadFiles:W,sortingField:ce,customFields:ut,userId:a["user.id"],userInfo:a,versionDialog:me,fileInput:Ot,document:re,handleViewModeChange:Wt,handleFilterChange:ia,handleFilterSave:Qt,handleFilterRemove:Zt,handleSelectedProject:la,handleNext:da,handlePrev:ma,handleFavouriteSearch:fa,handleContentSearch:va,handleOpenUpload:ha,handleExport:Ft,handleExportAll:ga,handleFolderDoubleClick:Jt,handleFolderCreate:sa,handleFilterTagCheck:oa,handleFileUpload:At,handleSelect:_t,handleSortingField:ea,handleDocumentDelete:ua,handleDocumentClose:Ht,handleDownload:qt,handleDocumentLock:Kt,handleDocumentUnlock:Yt,cancelUpload:Ut,showPermission:Be,handlePermissionClose:Ca,handlePermissionOpen:Ea,handleSavePermission:Oa,handleMetaFileDownload:ra,handleFavouriteDocument:pa,retryUpload:zt,handleVersionDialog:ta,handleSendMail:Xt,handleTagSave:ca,handleVersionRestore:na,handleVersionUpdate:aa,handleFileSelect:ba,versionRecord:ze,loading:He})}var Cr=function(e){return i.a.createElement(w.a,{backend:x.b},i.a.createElement(gr,e))};var Er=function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.language,a=e.theme,n={};return"ar"!==t&&"he"!==t||(n.direction="rtl"),"dark"===a&&(n.palette={type:"dark"}),n}({}),t=e.direction,a=e.palette,n=i.a.useState({}),r=Object(s.a)(n,2),o=r[0],l=r[1];return i.a.useEffect((function(){La().info().then((function(e){l(Object(c.a)({},e))}))}),[]),i.a.createElement(E,{direction:t,palette:a},i.a.createElement(Cr,{userInfo:o}))};a(290);var Or=function(){return i.a.createElement(Er,null)};a(291);l.a.render(i.a.createElement(Or,null),document.getElementById("root"))}},[[220,1,2]]]);