<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_7.2.xsd">

  <grid name="api-configuration-grid" title="API Configuration"
    model="com.axelor.apps.base.db.PartnerApiConfiguration">
    <field name="apiName"/>
    <field name="apiUrl" widget="url"/>
  </grid>

  <form name="api-configuration-form" title="API Configuration"
    model="com.axelor.apps.base.db.PartnerApiConfiguration" canDelete="false" canNew="false"
    width="large">
    <panel name="apiPanel" title="API Service" colSpan="12" showTitle="false">
      <field name="apiName" required="true"/>
      <field name="apiUrl" widget="url"/>
      <field name="apiKey" widget="password"/>
    </panel>
  </form>

  <form name="partner-api-configuration-wizard-form" title="Partner API configuration"
    model="com.axelor.utils.db.Wizard" onNew="action-api-configuration-group-on-new">
    <panel name="mainPanel">
      <field name="partnerApiConfiguration" title="API config"
        target="com.axelor.apps.base.db.PartnerApiConfiguration" type="many-to-one" required="true"
        canNew="false" colSpan="5"/>
      <field name="siretNumber" title="Siret number" type="string" required="true" colSpan="5"
        readonlyIf="$parentSiret"/>
      <button name="executeApiBtn" title="Fetch data"
        onClick="action-api-configuration-method-fetch-data" colSpan="2"
        readonlyIf="partnerApiConfiguration == null || siretNumber == null"/>
      <field name="$parentSiret" type="string" hidden="true"/>
    </panel>
  </form>

  <action-method name="action-api-configuration-method-fetch-data">
    <call class="com.axelor.apps.base.web.PartnerApiConfigurationController" method="fetchData"/>
  </action-method>

  <action-group name="action-api-configuration-group-on-new">
    <action name="action-api-configuration-record-set-parent-siret"/>
    <action name="action-api-configuration-record-set-siret-number" if="parentSiret"/>
  </action-group>

  <action-record name="action-api-configuration-record-set-parent-siret"
    model="com.axelor.utils.db.Wizard">
    <field name="$parentSiret" expr="eval: _parentSiret"/>
  </action-record>

  <action-record name="action-api-configuration-record-set-siret-number"
    model="com.axelor.utils.db.Wizard">
    <field name="siretNumber" expr="eval: parentSiret"/>
  </action-record>

</object-views>