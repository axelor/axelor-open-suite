<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_7.4.xsd">

  <grid name="map-group-grid" title="Map groups" model="com.axelor.apps.base.db.MapGroup">
    <field name="name"/>
    <field name="metaModel"/>
    <field name="addressField"/>
    <field name="markerColor" widget="ColorPicker"/>
  </grid>

  <form name="map-group-form" title="Map group" model="com.axelor.apps.base.db.MapGroup">
    <panel name="mainPanel">
      <field name="name"/>
      <field name="metaModel" grid-view="meta-model-grid" form-view="meta-model-form"/>
      <field name="addressField" grid-view="meta-field-grid" form-view="meta-field-form"
        domain="self.metaModel = :metaModel AND self.typeName = 'Address' AND self.relationship = 'ManyToOne'"
        colSpan="4"/>
      <field name="formViewToUse" onSelect="action-map-group-attrs-set-form-view-domain"
        colSpan="4" target-name="name"/>
      <field name="markerColor" widget="ColorPicker" colSpan="4"/>
      <field name="filter" colSpan="8"/>
      <button name="previewFilteredRecordsBtn" title="Preview filtered records"
        readonlyIf="!metaModel" onClick="action-map-group-method-preview-records" colSpan="4"/>
      <field name="cardContent" colSpan="12"/>
    </panel>
  </form>

  <action-attrs name="action-map-group-attrs-set-form-view-domain">
    <attribute name="domain" for="formViewToUse"
      expr="eval: &quot;self.type = 'form' AND self.model = '${metaModel?.fullName}' AND self.priority IN (SELECT MAX(priority) FROM MetaView WHERE name = self.name GROUP BY name) &quot;"/>
  </action-attrs>

  <action-method name="action-map-group-method-preview-records">
    <call class="com.axelor.apps.base.web.MapGroupController" method="previewRecords"/>
  </action-method>

</object-views>
