<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views
                                  http://axelor.com/xml/ns/object-views/object-views_7.4.xsd">

  <!-- preview form -->
  <form name="task-report-preview-form" title="MGM Task Report"
    model="com.axelor.apps.businessproject.db.TaskReport" width="large">

    <panel colSpan="12" name="mainPanel">
       <panel colSpan="12" showTitle="false" style="text-align:center;" showFrame="false">
       <label value="MGM TASK REPORT" stsyle="font-size:18px; font-weight:bold;"/>
       </panel>
      <panel-include view="incl-header-form"/>
      <panel-include view="incl-general-info"/>
      <panel-include view="incl-team-member-report"/>
      <panel-include view="incl-additional-services"/>
      <panel-include view="incl-sign-off-form"/>
    </panel>
  </form>
  <form title="Company Header" name="incl-header-form" model="com.axelor.apps.base.db.Company">
    <panel name="companyHeaderPanel" colSpan="12" showFrame="false" style="text-align:center;">
      <panel showFrame="false" colSpan="6">
        <field name="picture" showTitle="false" widget="Image" colSpan="12">
          <viewer>
            <![CDATA[
        <>
          {/* Use record's picture if exists */}
          {id && <Image src={$image('id', 'content')} style={{ width: "80%" }}></Image>}

          {/* If no picture, use company logo if exists */}
          {!id && _parent.company && _parent.company.logo &&
            <Image src={$image(_parent.company.logo.id, 'content')} style={{ width: "80%" }}></Image>
          }

          {/* Fallbacks if company logo is missing */}
          {!id && (!_parent.company || !_parent.company.logo) && _parent.partnerTypeSelect != 2 &&
            <Image src="img/company-default.jpg" style={{ width: "80%" }}></Image>
          }

          {!id && (!_parent.company || !_parent.company.logo) && _parent.partnerTypeSelect == 2 && _parent.titleSelect == 1 &&
            <Image src="img/partner-m-default.png" style={{ width: "80%" }}></Image>
          }

          {!id && (!_parent.company || !_parent.company.logo) && _parent.partnerTypeSelect == 2 && _parent.titleSelect == 2 &&
            <Image src="img/partner-w-default.png" style={{ width: "80%" }}></Image>
          }

          {!id && (!_parent.company || !_parent.company.logo) && _parent.partnerTypeSelect == 2 &&
            (_parent.titleSelect > 2 || !_parent.titleSelect) &&
            <Image src="img/partner-default.png" style={{ width: "80%" }}></Image>
          }
        </>
      ]]>
          </viewer>
        </field>
        <field name="company.name" readonly="true" colSpan="12"/>
      </panel>
      <panel name="titlePanel" colSpan="6" style="text-align:left;">
        <label name="customTitle" title="MGM REPORT" colSpan="12"
          style="font-size:16px; font-weight:bold; color:#333;"/>
      </panel>
    </panel>
  </form>
  <form title="General Info" name="incl-general-info" readonlyIf="_previewReadonly"
    model="com.axelor.apps.businessproject.db.TaskReport">
    <panel title="General Information" showFrame="false" readonly="true">
      <field name="project"/>
      <field name="customer" hidden="true"/>
      <field name="customer"/>
      <field name="location"/>
    </panel>
  </form>
  <form title="Team Member Reports" name="incl-team-member-report"
    readonlyIf="_previewReadonly" model="com.axelor.apps.businessproject.db.TaskMemberReport">
    <panel title="Team Members Reports" canCollapse="true" colSpan="12" readonly="true">
      <field name="taskMemberReports" x-show-bars="false" title="Team Members Report"
        widget="list" colSpan="12" showTitle="false" readonly="true"/>
      <panel showFrame="false">
        <field name="totalWorkHours" colSpan="12" readonly="true"/>
      </panel>
    </panel>
  </form>
  <form title="Additional services" name="incl-additional-services"
    readonlyIf="_previewReadonly" model="com.axelor.apps.businessproject.db.TaskReport">
    <panel colSpan="12" showFrame="false">
      <panel title="Extra charges" colSpan="6" showFrame="false">
        <field name="travelExpenses" colSpan="6" widget="checkbox" readonly="true"/>
        <field name="toolsUsage" colSpan="6" widget="checkbox" readonly="true"/>
      </panel>
      <panel title="Additional Services" colSpan="6" showFrame="false">
        <field name="additionalServices" colSpan="12" widget="MultiSelect" readonly="true"/>
      </panel>
      <panel title="Activity Details" colSpan="12" showTitle="false" showFrame="false"
        readonly="true">
        <field name="material" colSpan="12" widget="textarea"/>
        <field name="otherServices" colSpan="12" widget="textarea"/>
        <field name="comments" title="Comments" colSpan="12" widget="textarea"/>
      </panel>
    </panel>
  </form>
  <form title="Sign Off" name="incl-sign-off-form" readonlyIf="_previewReadonly"
    model="com.axelor.apps.businessproject.db.TaskReport">
    <panel title="Sign-Off" readonly="true" colSpan="12">
      <panel colSpan="12">
        <field name="taskDate" colSpan="4"/>
      </panel>
      <panel colSpan="12">
        <field name="employee" title="Employee Name"/>
        <field name="customerName" title="Customer Name"/>
        <field name="employeeSignature" title="Employee Signature" widget="drawing"
          x-drawing-height="200" x-drawing-width="800"/>
        <field name="customerSignature" title="Customer Signature" widget="drawing"
          x-drawing-height="200" x-drawing-width="800" readonlyIf="eval: !_customerCanSign"/>
      </panel>
    </panel>
  </form>

  <action-method name="action-task-report-method-preview-for-customer">
    <call class="com.axelor.apps.businessproject.web.TaskReportController"
      method="previewTaskReport"/>
  </action-method>

  <action-view name="action-task-report-open-preview" title="Task Report Preview"
    model="com.axelor.apps.businessproject.db.TaskReport">
    <view type="form" name="task-report-preview-form"/>
    <view-param name="popup" value="true"/>
    <view-param name="forceEdit" value="false"/>
    <view-param name="forceTitle" value="true"/>
    <context name="_taskReport" expr="eval: __self__"/>
    <context name="company" expr="eval: __self__.project?.company ?: __user__.company"/>
     <context name="_id" expr="eval: __self__ "/>
  </action-view>
</object-views>