<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">
    <form name="configurator-bom-form" title="Configurator BOM"
          model="com.axelor.apps.production.db.ConfiguratorBOM">
        <panel-include view="configurator-bom-line-form"/>
        <panel-dashlet action="action-configurator-bom-view-tree"/>
    </form>

    <form name="configurator-bom-line-form" title="Configurator BOM"
          model="com.axelor.apps.production.db.ConfiguratorBOM">
        <panel>
            <panel title="Label">
                <field name="defNameAsFormula" colSpan="6"/>
                <field name="name" colSpan="12" showIf="defNameAsFormula"/>
                <field name="nameFormula" colSpan="12" height="120"
                       widget="CodeEditor" x-code-syntax="groovy"
                       showTitle="false" showIf="!defNameAsFormula"/>
            </panel>
            <field name="useCondition" widget="CodeEditor" height="120" colSpan="12"
                   x-code-syntax="groovy"/>
            <panel title="Product">
                <field name="defProductAsFormula" colSpan="6"/>
                <field name="product" colSpan="12" showIf="!defProductAsFormula"/>
                <field name="productFormula" colSpan="12" height="120" widget="CodeEditor"
                       x-code-syntax="groovy" showTitle="false" showIf="defProductAsFormula"/>
            </panel>
            <panel title="Qty">
                <field name="defQtyAsFormula" colSpan="6"/>
                <field name="qty" colSpan="12" showIf="!defQtyAsFormula"/>
                <field name="qtyFormula" colSpan="12" height="120" widget="CodeEditor"
                       showTitle="false" x-code-syntax="groovy" showIf="defQtyAsFormula"/>
            </panel>
            <panel title="Unit">
                <field name="defUnitAsFormula" colSpan="6"/>
                <field name="unit" colSpan="12" showIf="!defUnitAsFormula"/>
                <field name="unitFormula" colSpan="12" height="120" widget="CodeEditor"
                       showTitle="false" x-code-syntax="groovy" showIf="defUnitAsFormula"/>
            </panel>
            <panel title="Production process">
                <field name="defProdProcessAsFormula" readonlyIf="defProdProcessAsConfigurator" colSpan="6"/>
                <field name="defProdProcessAsConfigurator" readonlyIf="defProdProcessAsFormula" colSpan="6"/>
                <field name="prodProcess" colSpan="12" showIf="!defProdProcessAsFormula &amp;&amp; !defProdProcessAsConfigurator"/>
                <field name="prodProcessFormula" colSpan="12" height="120" widget="CodeEditor"
                       showTitle="false" x-code-syntax="groovy" showIf="defProdProcessAsFormula &amp;&amp; !defProdProcessAsConfigurator"/>
                <field name="configuratorProdProcess" colSpan="12" showIf="defProdProcessAsConfigurator"/>
            </panel>
            <field name="configuratorBomList" colSpan="12"/>
            <panel>
                <button name="generateBom" title="Generate Bill of Material"
                        onClick="action-configurator-bom-method-generate-bom"/>
            </panel>
            <button name="generateBom" title="Generate bom"
                    onClick="action-configurator-method-generate-bom"/>
        </panel>

    </form>

    <grid name="configurator-bom-grid" title="Configurator BOM" model="com.axelor.apps.production.db.ConfiguratorBOM">
        <field name="name"/>
    </grid>

     <action-view name="action-configurator-bom-view" title="Configurator BOM"
                  model="com.axelor.apps.production.db.ConfiguratorBOM">
         <view type="form" name="configurator-bom-line-form"/>
         <view-param name="popup" value="true"/>
        <view-param name="show-toolbar" value="false"/>
  		<view-param name="show-confirm" value="false" />
	  	<view-param name="popup-save" value="false"/>
    	<context name="_showRecord" expr="eval: id"/>
     </action-view>

     <action-view name="action-configurator-bom-view-tree" title="Configurators BOMs tree" model="com.axelor.apps.production.db.ConfiguratorBOM">
    	<view type="tree" name="configurator-bom-tree"/>
    	<view type="form" name="configurator-bom-form"/>
     	<context name="confBomId" expr="eval: id"/>
    </action-view>

    <tree name="configurator-bom-tree" title="Configurators BOMs tree">

    	<column name="name" type="string"/>
        <column name="product" type="reference"/>
    	<column name="qty" type="decimal"/>
    	<column name="unit" type="reference"/>
    	<column name="prodProcess" type="reference"/>

		<node model="com.axelor.apps.production.db.ConfiguratorBOM"
              domain="self.id = :confBomId"
              onClick="action-configurator-bom-view">
            <field name="name" as="name"/>
			<field name="product" as="product"/>
			<field name="qty" as="qty"/>
			<field name="unit" as="unit"/>
			<field name="prodProcess" as="prodProcess"/>
		</node>

		<node model="com.axelor.apps.production.db.ConfiguratorBOM"
              parent="parentConfiguratorBOM" draggable="true"
              onClick="action-configurator-bom-view">
            <field name="name" as="name"/>
			<field name="product" as="product"/>
			<field name="qty" as="qty"/>
			<field name="unit" as="unit"/>
			<field name="prodProcess" as="prodProcess"/>
		</node>

	</tree>

    <action-method name="action-configurator-bom-method-generate-bom">
        <call class="com.axelor.apps.production.web.ConfiguratorController"
              method="generateBillOfMaterial"/>
    </action-method>

</object-views>
