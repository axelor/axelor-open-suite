<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_7.2.xsd">

  <grid name="sale-order-line-details-grid" title="Sale order lines details"
    model="com.axelor.apps.production.db.SaleOrderLineDetails">
    <field name="typeSelect" onChange="action-sale-order-line-details-group-type-onchange"
      widget="ImageSelect" title=""/>
    <field name="product" form-view="product-form" grid-view="product-grid"
      onChange="action-sale-order-line-details-method-product-onchange" showIf="!$readonly()"
      readonlyIf="typeSelect != 1"/>
    <field name="workCenter"
      onChange="action-sale-order-line-details-attrs-work-center-onchange" showIf="!$readonly()"
      readonlyIf="typeSelect != 2"/>
    <field name="title"/>
    <field name="qty" min="0" onChange="action-sale-order-line-details-method-compute-price"
      x-scale="$nbDecimalDigitForQty" showIf="typeSelect &amp;&amp; typeSelect == 1"/>
    <field name="price" onChange="action-sale-order-line-details-method-compute-price"
      x-scale="$nbDecimalDigitForUnitPrice"/>
    <field name="unit" showIf="typeSelect == 1"/>
    <field name="totalPrice" x-scale="$nbDecimalDigitForUnitPrice"/>
    <field name="description"/>
  </grid>

  <grid name="sale-order-line-details-readonly-grid" title="Sale order lines details"
    model="com.axelor.apps.production.db.SaleOrderLineDetails">
    <field name="typeSelect" onChange="action-sale-order-line-details-group-type-onchange"
      widget="ImageSelect"/>
    <field name="title"/>
    <field name="qty" min="0" onChange="action-sale-order-line-details-method-compute-price"
      x-scale="$nbDecimalDigitForQty" showIf="typeSelect &amp;&amp; typeSelect == 1"/>
    <field name="price" onChange="action-sale-order-line-details-method-compute-price"
      x-scale="$nbDecimalDigitForUnitPrice"/>
    <field name="unit" showIf="typeSelect == 1"/>
    <field name="totalPrice" x-scale="$nbDecimalDigitForUnitPrice"/>
    <field name="description"/>
  </grid>

  <form name="sale-order-line-details-form" title="Sale order line details"
    model="com.axelor.apps.production.db.SaleOrderLineDetails"
    onNew="action-sale-order-line-details-group-onnew"
    onLoad="action-sale-order-line-details-group-onload">
    <panel-tabs name="mainPanelTabs" colSpan="12">
      <panel name="mainPanel" title="Information">
        <field name="typeSelect" colSpan="6"
          onChange="action-sale-order-line-details-group-type-onchange"/>
        <field name="title" colSpan="6"/>
        <field name="product" form-view="product-form" grid-view="product-grid"
          onChange="action-sale-order-line-details-method-product-onchange" colSpan="6"
          showIf="typeSelect == 1"/>
        <field name="unit" colSpan="6" showIf="typeSelect == 1"/>
        <field name="workCenter" colSpan="6"
          onChange="action-sale-order-line-details-attrs-work-center-onchange"
          showIf="typeSelect == 2"/>
        <spacer colSpan="6"/>
        <field name="qty" min="0"
          onChange="action-sale-order-line-details-method-compute-price" colSpan="4"
          showIf="typeSelect &amp;&amp; typeSelect == 1"/>
        <spacer colSpan="8"/>
        <field name="price" colSpan="6"
          onChange="action-sale-order-line-details-method-compute-price"/>
        <field name="totalPrice" colSpan="6"/>
        <field name="description" colSpan="12"/>
      </panel>
      <panel name="marginPanel" title="Margin">
        <field name="subTotalCostPrice" x-scale="$nbDecimalDigitForUnitPrice"
          onChange="action-sale-order-line-details-method-compute-margin"/>
        <field name="subTotalGrossMargin" readonly="true"
          x-scale="$nbDecimalDigitForUnitPrice"/>
        <field name="subMarginRate" readonly="true"/>
        <field name="subTotalMarkup" readonly="true"/>
      </panel>
    </panel-tabs>
  </form>

  <action-group name="action-sale-order-line-details-group-onnew">
    <action name="action-sale-order-line-details-attrs-scale-and-precision"/>
  </action-group>

  <action-group name="action-sale-order-line-details-group-onload">
    <action name="action-sale-order-line-details-attrs-scale-and-precision"/>
  </action-group>

  <action-attrs name="action-sale-order-line-details-attrs-scale-and-precision">
    <attribute name="scale" for="price"
      expr="eval: __config__.app.getNbDecimalDigitForUnitPrice()"/>
    <attribute name="scale" for="totalPrice"
      expr="eval: __config__.app.getNbDecimalDigitForUnitPrice()"/>
    <attribute name="scale" for="qty"
      expr="eval: __config__.app.getNbDecimalDigitForQty()"/>
  </action-attrs>

  <action-group name="action-sale-order-line-details-group-type-onchange">
    <action name="action-sale-order-line-details-attrs-reset"/>
    <action name="action-sale-order-line-details-attrs-focus"/>
  </action-group>

  <action-attrs name="action-sale-order-line-details-attrs-reset">
    <attribute for="title" name="value" expr="eval: null"/>
    <attribute for="product" name="value" expr="eval: null"/>
    <attribute for="workCenter" name="value" expr="eval: null"/>
    <attribute for="unit" name="value" expr="eval: null"/>
    <attribute for="qty" name="value" expr="eval: 1"/>
    <attribute for="price" name="value" expr="eval: 0"/>
    <attribute for="totalPrice" name="value" expr="eval: 0"/>
    <attribute for="subTotalCostPrice" name="value" expr="eval: 0"/>
    <attribute for="subTotalGrossMargin" name="value" expr="eval: 0"/>
    <attribute for="subMarginRate" name="value" expr="eval: 0"/>
    <attribute for="subTotalMarkup" name="value" expr="eval: 0"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-details-attrs-focus">
    <attribute for="product" name="focus" expr="true" if="typeSelect == 1"/>
    <attribute for="workCenter" name="focus" expr="true" if="typeSelect == 2"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-details-attrs-work-center-onchange">
    <attribute for="title" name="value" expr="eval: workCenter?.name"/>
  </action-attrs>

  <action-method name="action-sale-order-line-details-method-product-onchange">
    <call class="com.axelor.apps.production.web.SaleOrderLineDetailsController"
      method="productOnChange"/>
  </action-method>

  <action-method name="action-sale-order-line-details-method-compute-price">
    <call class="com.axelor.apps.production.web.SaleOrderLineDetailsController"
      method="computePrices"/>
  </action-method>

  <action-method name="action-sale-order-line-details-method-compute-margin">
    <call class="com.axelor.apps.production.web.SaleOrderLineDetailsController"
      method="computeMargin"/>
  </action-method>

</object-views>