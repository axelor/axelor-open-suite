<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">

  <grid name="move-line-mass-entry-move-grid"
    model="com.axelor.apps.account.db.MoveLineMassEntry" title="Move lines" canArchive="false"
    onNew="action-account-move-line-onnew-mass-entry-group">
    <field name="temporaryMoveNumber" width="50" readonly="true"/>
    <field name="inputAction" selection="iaccount.move.input.action.select"
      onChange="action-move-line-group-input-action-onchange" readonly="true" required="true"
      width="50"/>
    <field name="date" onChange="account-move-line-group-date-onchange-mass-entry"/>
    <field name="originDate" onChange=""/>
    <field name="origin" onChange=""/>
    <field name="moveDescription" onChange="" readonly="false"/>
    <field name="movePaymentCondition" readonly="false" form-view="payment-condition-form"
      grid-view="payment-condition-grid" onChange=""/>
    <field name="movePaymentMode" readonly="false" form-view="payment-mode-form"
      grid-view="payment-mode-grid" onChange="action-move-line-group-payment-mode-onchange"/>
    <field name="account" form-view="account-form" grid-view="account-grid"
      onSelect="action-move-line-attrs-domain-account" width="200" canEdit="false"
      readonlyIf="amountPaid &gt; 0"
      onChange="action-account-move-line-account-group-on-change-mass-entry"/>
    <field name="taxLine" readonlyIf="!account.isTaxAuthorizedOnMoveLine"
      requiredIf="account.isTaxRequiredOnMoveLine"
      domain="self.endDate > :date OR self.endDate IS NULL"
      onChange="account-move-line-update-tax-equiv"/>
    <field name="partner" form-view="partner-form" grid-view="partner-grid"
      onSelect="action-account-move-line-partner-group"
      onChange="action-move-line-record-reset-partner-details-mass-entry" width="120"
      canEdit="false" readonly="false"/>
    <field name="description"
      requiredIf="$isDescriptionRequired || move.company.accountConfig.isDescriptionRequired"/>
    <field name="debit"
      onChange="action-record-account-moveline-debit-onchange,action-group-account-moveline-debitcredit-onchange,action-move-line-method-generate-invoice-terms"
      width="90" readonlyIf="amountPaid &gt; 0"/>
    <field name="credit"
      onChange="action-record-account-moveline-credit-onchange,action-group-account-moveline-debitcredit-onchange,action-move-line-method-generate-invoice-terms"
      width="90" readonlyIf="amountPaid &gt; 0"/>
    <field name="currencyRate" onChange="action-move-line-group-currency-amount-rate-onchange"
      readonlyIf="!isOtherCurrency"/>
    <field name="currencyAmount"
      onChange="action-move-line-group-currency-amount-rate-onchange" readonlyIf="!isOtherCurrency"/>
    <field name="cutOffStartDate" requiredIf="account.manageCutOffPeriod"
      validIf="!cutOffEndDate || cutOffStartDate &lt;= cutOffEndDate"
      onChange="action-move-line-record-set-cut-off-generated-false"
      if="__config__.app.getApp('account').manageCutOffPeriod"/>
    <field name="cutOffEndDate" requiredIf="account.manageCutOffPeriod"
      validIf="!cutOffStartDate || cutOffEndDate &gt;= cutOffStartDate"
      onChange="action-move-line-record-set-cut-off-generated-false"
      if="__config__.app.getApp('account').manageCutOffPeriod"/>
    <field name="pfpValidatorUser"
      if="__config__.app.getApp('account')?.getActivatePassedForPayment()"
      readonlyIf="pfpValidateStatusSelect != 1"
      onSelect="action-move-line-method-domain-pfp-validator-user-on-select" onChange=""
      canEdit="false"/>
    <field name="partner.bankDetails"/>
    <field name="vatSystemSelect" readonlyIf="move.statusSelect != 1"/>
    <field name="move.statusSelect"/>
    <field name="move.technicalOriginSelect" hidden="true"/>
    <field name="isOtherCurrency" hidden="true"/>
    <field name="$isDescriptionRequired" type="boolean" hidden="true"/>
    <field name="move.company.accountConfig.isDescriptionRequired" hidden="true"/>
  </grid>

  <action-group name="action-account-move-line-onnew-mass-entry-group">
    <action name="action-move-line-record-get-move-informations-mass-entry"/>
    <action name="action-move-line-method-get-account-informations"/>
    <action name="action-move-line-record-compute-temporaryMoveNumber"/>
    <action name="action-move-line-attrs-set-readonly-first-move-line"
      if="eval: __parent__?.moveLineMassEntryList != null &amp;&amp; __parent__?.moveLineMassEntryList.size() != 0"/>
    <action name="action-move-line-attrs-set-hidden-cut-off"/>
    <action name="action-move-line-method-compute-analytic-distribution"/>
    <action name="action-move-line-method-hide-axis-analytic-account"/>
    <action name="action-move-line-group-analytic-distribution-template-onchange"/>
    <action name="action-move-line-record-get-first-move-line-informations"/>
    <action name="action-move-line-method-get-creditdebit-balance"/>
    <action name="action-move-line-attrs-hidden-reconcileLists"/>
    <action name="action-move-line-record-set-partner"/>
    <action name="action-move-line-method-set-is-other-currency"/>
    <action name="action-move-line-method-set-currencyRate"/>
    <action name="action-move-line-record-set-currencyAmount"/>
    <action name="action-move-line-method-description-required"/>
    <action name="action-move-line-record-financial-discount"
      if="__config__.app.getApp('account').getManageFinancialDiscount()"/>
    <action name="action-move-line-method-compute-financial-discount"
      if="__config__.app.getApp('account').getManageFinancialDiscount()"/>
  </action-group>

  <action-group name="action-account-move-line-account-group-on-change-mass-entry">
    <action name="action-move-line-attrs-set-hidden-cut-off"/>
    <action name="action-move-line-record-set-cut-off-dates"
      if="__config__.app.getApp('account').manageCutOffPeriod"/>
    <action name="action-move-line-record-set-cut-off-generated-false"/>
    <action name="action-move-line-method-compute-analytic-distribution"/>
    <action name="action-account-move-line-method-set-partner-readonly"/>
    <action name="action-move-line-method-refresh-account-informations"/>
    <action name="action-move-line-method-hide-axis-analytic-account"/>
    <action name="action-move-line-method-change-account-set-default-distribution-template"/>
    <action name="action-move-line-group-analytic-distribution-template-onchange"/>
    <action name="action-move-line-record-set-partner"/>
    <action name="action-move-line-method-generate-invoice-terms"/>
  </action-group>

  <action-group name="action-move-line-group-input-action-onchange">
    <action name="action-move-line-record-increment-temporaryMoveNumber"/>
    <action name="action-move-line-attrs-set-not-required-account" if="inputAction == 2"/>
    <action name="action-move-line-attrs-set-all-fields-required"/>
  </action-group>

  <action-attrs name="action-move-line-attrs-set-all-fields-required">
    <attribute for="date" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="originDate" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="origin" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="moveDescription" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="movePaymentCondition" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="movePaymentMode" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="account" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="taxLine" name="readonly"
      expr="eval: inputAction == 2 &amp;&amp; !account?.isTaxAuthorizedOnMoveLine"/>
    <attribute for="partner" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="description" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="debit" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="credit" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="currencyRate" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="currencyAmount" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="cutOffStartDate" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="cutOffEndDate" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="pfpValidatorUser" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="partner.bankDetails" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="vatSystemSelect" name="readonly" expr="eval: inputAction == 2"/>
    <attribute for="move.statusSelect" name="readonly" expr="eval: inputAction == 2"/>
  </action-attrs>

  <action-attrs name="action-move-line-attrs-set-not-required-account">
    <attribute for="account" name="required" expr="false"/>
  </action-attrs>

  <action-record name="action-move-line-record-reset-partner-details-mass-entry"
    model="com.axelor.apps.account.db.MoveLine">
    <field name="partnerFullName,partnerSeq,partnerId" expr="eval: null" if="!partner"/>
    <field name="bankDetails"
      expr="eval: partner?.bankDetailsList.find{ it -&gt; it.isDefault &amp;&amp; it.active} ? partner?.bankDetailsList.find{ it -&gt; it.isDefault &amp;&amp; it.active} : null"/>
  </action-record>

  <action-record name="action-move-line-record-get-move-informations-mass-entry"
    model="com.axelor.apps.account.db.MoveLineMassEntry">
    <field name="partner" expr="eval: __parent__?.partner"/>
    <field name="date" expr="eval: __parent__?.date"/>
    <field name="dueDate" expr="eval: __parent__?.date"/>
    <field name="originDate" expr="eval: __parent__?.originDate"/>
    <field name="origin" expr="eval: __parent__?.origin"/>
  </action-record>

  <action-record name="action-move-line-record-compute-temporaryMoveNumber"
    model="com.axelor.apps.account.db.MoveLine">
    <field name="temporaryMoveNumber"
      expr="eval: __parent__?.moveLineMassEntryList?.max { it.temporaryMoveNumber }?.temporaryMoveNumber"/>
    <field name="temporaryMoveNumber" expr="1"
      if="eval: __parent__?.moveLineMassEntryList.size() == 0"/>
    <field name="inputAction" expr="1"/>
  </action-record>

  <action-record name="action-move-line-record-increment-temporaryMoveNumber"
    model="com.axelor.apps.account.db.MoveLine">
    <field name="temporaryMoveNumber"
      expr="eval: __parent__?.moveLineMassEntryList?.max { it.temporaryMoveNumber }?.temporaryMoveNumber + 1"
      if="inputAction == 3"/>
    <field name="inputAction" expr="1" if="inputAction == 3"/>
  </action-record>

  <action-method name="action-move-line-method-generate-taxline-and-counterpart">
    <call class="com.axelor.apps.account.web.MoveLineMassEntryController"
      method="generateTaxLineAndCounterpart"/>
  </action-method>

  <action-attrs name="action-move-line-attrs-set-readonly-first-move-line">
    <attribute for="inputAction" name="readonly" expr="false"/>
    <attribute for="inputAction" name="focus" expr="true"/>
  </action-attrs>

  <action-group name="account-move-line-group-date-onchange-mass-entry">
    <action name="account-move-line-record-date-onchange"/>
    <action name="action-move-line-method-compute-analytic-distribution"/>
    <action name="action-move-line-validate-check-date-in-period"/>
  </action-group>

  <action-method name="action-move-line-method-domain-pfp-validator-user-on-select">
    <call class="com.axelor.apps.account.web.MoveLineMassEntryController"
      method="setPfpValidatorUserDomain"/>
  </action-method>

  <action-attrs name="action-move-line-attrs-set-hidden-cut-off">
    <attribute for="cutOffStartDate" name="readonly"
      expr="eval: !account?.manageCutOffPeriod"/>
    <attribute for="cutOffEndDate" name="readonly"
      expr="eval: !account?.manageCutOffPeriod"/>
  </action-attrs>

  <action-group name="action-move-line-group-payment-mode-onchange">
    <action name="action-move-method-fill-company-bank-detail"/>
  </action-group>

</object-views>
