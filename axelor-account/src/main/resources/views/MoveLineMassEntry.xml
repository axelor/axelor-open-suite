<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">

  <grid name="move-line-mass-entry-move-grid"
    model="com.axelor.apps.account.db.MoveLineMassEntry" title="Move lines" canArchive="false"
    onNew="action-account-move-line-onnew-group">
    <field name="temporaryMoveNumber" width="50"
      onChange="action-move-line-mass-entry-method-get-first-move-line-informations"/>
    <field name="inputAction" selection="iaccount.move.line.mass.entry.input.action.select"
      onChange="action-move-line-mass-entry-method-input-action-onchange" readonly="true"
      required="true" width="50" selection-in="[1,2,3]"/>
    <field name="date" onChange="account-move-line-group-date-onchange">
      <hilite if="$contains(fieldsErrorList,'date:'+date.toString())" background="danger"/>
    </field>
    <field name="originDate"
      onChange="action-move-line-mass-entry-method-set-currencyRate,action-move-line-mass-entry-attrs-set-cut-off-dates">
      <hilite if="$contains(fieldsErrorList,'originDate:'+originDate.toString())"
        background="danger"/>
    </field>
    <field name="origin" onChange="action-move-line-mass-entry-record-set-is-edited">
      <hilite if="$contains(fieldsErrorList,'origin:'+origin)" background="danger"/>
    </field>
    <field name="moveDescription"
      onChange="action-account-move-line-mass-entry-attrs-set-description,action-move-line-mass-entry-record-set-is-edited"
      readonly="false" required="true"/>
    <field name="partner" form-view="partner-form" grid-view="partner-grid"
      onSelect="action-account-move-line-partner-group"
      onChange="action-move-line-mass-entry-method-on-change-partner" width="120" canEdit="false"
      readonly="false">
      <hilite if="$contains(fieldsErrorList,'partner:'+partner.name)" background="danger"/>
    </field>
    <field name="movePaymentCondition" form-view="payment-condition-form"
      grid-view="payment-condition-grid" onChange="action-move-line-mass-entry-record-set-is-edited"/>
    <field name="movePaymentMode" readonly="false" form-view="payment-mode-form"
      grid-view="payment-mode-grid" onChange="action-move-line-mass-entry-record-set-is-edited">
      <hilite if="$contains(fieldsErrorList,'paymentMode:')" background="danger"/>
    </field>
    <field name="account" form-view="account-form" grid-view="account-grid"
      onSelect="action-move-line-attrs-domain-account" width="200" canEdit="false"
      onChange="action-account-move-line-account-group-on-change"/>
    <field name="taxLine" readonlyIf="!account.isTaxAuthorizedOnMoveLine"
      requiredIf="account.isTaxRequiredOnMoveLine"
      domain="self.endDate > :date OR self.endDate IS NULL"
      onChange="account-move-line-update-tax-equiv"/>
    <field name="currencyRate"
      onChange="action-move-line-group-currency-amount-rate-onchange,action-move-line-mass-entry-record-set-is-edited"
      readonlyIf="!isOtherCurrency">
      <hilite if="$contains(fieldsErrorList,'currencyRate:'+currencyRate.toString())"
        background="danger"/>
    </field>
    <field name="currencyAmount"
      onChange="action-move-line-group-currency-amount-rate-onchange" readonlyIf="!isOtherCurrency">
      <hilite if="$contains(fieldsErrorList,'balance:')" background="danger"/>
    </field>
    <field name="debit"
      onChange="action-record-account-moveline-debit-onchange,action-group-account-moveline-debitcredit-onchange,action-move-line-method-generate-invoice-terms"
      width="90" readonlyIf="isOtherCurrency">
      <hilite if="$contains(fieldsErrorList,'balance:')" background="danger"/>
    </field>
    <field name="credit"
      onChange="action-record-account-moveline-credit-onchange,action-group-account-moveline-debitcredit-onchange,action-move-line-method-generate-invoice-terms"
      width="90" readonlyIf="isOtherCurrency">
      <hilite if="$contains(fieldsErrorList,'balance:')" background="danger"/>
    </field>
    <field name="description"
      requiredIf="$isDescriptionRequired || move.company.accountConfig.isDescriptionRequired"/>
    <field name="cutOffStartDate" requiredIf="account.manageCutOffPeriod"
      validIf="!cutOffEndDate || cutOffStartDate &lt;= cutOffEndDate"
      onChange="action-move-line-record-set-cut-off-generated-false"
      if="__config__.app.getApp('account').manageCutOffPeriod"/>
    <field name="cutOffEndDate" requiredIf="account.manageCutOffPeriod"
      validIf="!cutOffStartDate || cutOffEndDate &gt;= cutOffStartDate"
      onChange="action-move-line-record-set-cut-off-generated-false"
      if="__config__.app.getApp('account').manageCutOffPeriod"/>
    <field name="movePartnerBankDetails"
      onSelect="action-move-line-mass-entry-attrs-bank-details-from-partner-domain"
      form-view="bank-details-form" grid-view="bank-details-grid" hidden="true"/>
    <field name="pfpValidatorUser" title="PFP Validator"
      if="__config__.app.getApp('account')?.getActivatePassedForPayment()"/>
    <field name="deliveryDate" title="Delivery date"/>
    <field name="analyticDistributionTemplate"
      if="__config__.app.getApp('account')?.getManageAnalyticAccounting()"
      grid-view="analytic-distribution-template-grid"
      form-view="analytic-distribution-template-form"
      onChange="action-move-line-group-analytic-distribution-template-onchange"
      onSelect="action-move-line-group-set-analytic-distribution-template-onselect"
      readonlyIf="!account || !account.analyticDistributionAuthorized"
      requiredIf="(!analyticMoveLineList || !analyticMoveLineList.length) &amp;&amp; account.analyticDistributionAuthorized &amp;&amp; account.analyticDistributionRequiredOnMoveLines &amp;&amp; (axis1AnalyticAccount == null &amp;&amp; axis2AnalyticAccount == null &amp;&amp; axis3AnalyticAccount == null &amp;&amp; axis4AnalyticAccount == null &amp;&amp; axis5AnalyticAccount == null)">
      <hilite if="$contains(fieldsErrorList,'analytic:')" background="danger"/>
    </field>
    <field name="axis1AnalyticAccount" grid-view="analytic-account-grid"
      form-view="analytic-account-form"
      if="__config__.app.getApp('account')?.getManageAnalyticAccounting()"
      readonlyIf="account.analyticDistributionAuthorized == false || !account"
      onSelect="action-move-line-attrs-set-domain-axis"
      onChange="action-move-line-group-analytic-axis-onchange">
      <hilite if="$contains(fieldsErrorList,'analytic:')" background="danger"/>
    </field>
    <field name="axis2AnalyticAccount" grid-view="analytic-account-grid"
      form-view="analytic-account-form"
      if="__config__.app.getApp('account')?.getManageAnalyticAccounting()"
      readonlyIf="account.analyticDistributionAuthorized == false || !account"
      onSelect="action-move-line-attrs-set-domain-axis"
      onChange="action-move-line-group-analytic-axis-onchange">
      <hilite if="$contains(fieldsErrorList,'analytic:')" background="danger"/>
    </field>
    <field name="axis3AnalyticAccount" grid-view="analytic-account-grid"
      form-view="analytic-account-form"
      if="__config__.app.getApp('account')?.getManageAnalyticAccounting()"
      readonlyIf="account.analyticDistributionAuthorized == false || !account"
      onSelect="action-move-line-attrs-set-domain-axis"
      onChange="action-move-line-group-analytic-axis-onchange">
      <hilite if="$contains(fieldsErrorList,'analytic:')" background="danger"/>
    </field>
    <field name="axis4AnalyticAccount" grid-view="analytic-account-grid"
      form-view="analytic-account-form"
      if="__config__.app.getApp('account')?.getManageAnalyticAccounting()"
      readonlyIf="account.analyticDistributionAuthorized == false || !account"
      onSelect="action-move-line-attrs-set-domain-axis"
      onChange="action-move-line-group-analytic-axis-onchange">
      <hilite if="$contains(fieldsErrorList,'analytic:')" background="danger"/>
    </field>
    <field name="axis5AnalyticAccount" grid-view="analytic-account-grid"
      form-view="analytic-account-form"
      if="__config__.app.getApp('account')?.getManageAnalyticAccounting()"
      readonlyIf="account.analyticDistributionAuthorized == false || !account"
      onSelect="action-move-line-attrs-set-domain-axis"
      onChange="action-move-line-group-analytic-axis-onchange">
      <hilite if="$contains(fieldsErrorList,'analytic:')" background="danger"/>
    </field>
    <field name="analyticMoveLineList" grid-view="analytic-move-line-move-line-grid"
      form-view="analytic-move-line-move-line-form"
      if="__config__.app.getApp('account')?.getManageAnalyticAccounting()"
      onChange="action-move-line-method-check-analytic-account-on-move-line,action-move-line-method-set-required-analytic-accounts">
      <hilite if="$contains(fieldsErrorList,'analytic:')" background="danger"/>
    </field>
    <field name="vatSystemSelect"
      onChange="action-move-line-mass-entry-record-set-is-edited-vat-system"/>
    <field name="moveStatusSelect"/>
    <field name="isOtherCurrency" hidden="true"/>
    <field name="fieldsErrorList" hidden="true"/>
  </grid>

  <!-- Action group -->

  <!-- Action record -->
  <action-record name="action-move-line-mass-entry-record-set-is-edited"
    model="com.axelor.apps.account.db.MoveLineMassEntry">
    <field name="isEdited" expr="1" if="isEdited == 0"/>
  </action-record>

  <action-record name="action-move-line-mass-entry-record-set-is-edited-vat-system"
    model="com.axelor.apps.account.db.MoveLineMassEntry">
    <field name="isEdited" expr="2"/>
  </action-record>

  <!-- Action attrs -->
  <action-attrs name="action-move-line-mass-entry-attrs-set-hidden-and-readonly">
    <attribute for="cutOffStartDate" name="readonly"
      expr="eval: !account.manageCutOffPeriod" if="account != null"/>
    <attribute for="cutOffEndDate" name="readonly"
      expr="eval: !account.manageCutOffPeriod" if="account != null"/>
    <attribute for="movePaymentMode" name="readonly"
      expr="eval: !__config__.app.getApp('account').allowMultiInvoiceTerms"/>
  </action-attrs>

  <action-attrs name="action-move-line-attrs-set-debit-credit-focus">
    <attribute for="debit" name="focus" expr="true"
      if="eval: (account?.commonPosition == 2 || account?.commonPosition == 0) &amp;&amp; !isOtherCurrency"/>
    <attribute for="credit" name="focus" expr="true"
      if="eval: account?.commonPosition == 1 &amp;&amp; !isOtherCurrency"/>
    <attribute for="currencyAmount" name="focus" expr="true" if="eval: isOtherCurrency"/>
  </action-attrs>

  <action-attrs
    name="action-move-line-mass-entry-attrs-bank-details-from-partner-domain">
    <attribute name="domain" for="movePartnerBankDetails"
      expr="eval: &quot; self = null &quot;"/>
    <attribute name="domain" for="movePartnerBankDetails"
      expr="eval: &quot; self.id IN (${partner.bankDetailsList.collect{it.id}.join(',')}) AND self.active IS TRUE &quot;"
      if="partner?.bankDetailsList &amp;&amp; !partner.bankDetailsList.isEmpty()"/>
  </action-attrs>

  <action-attrs name="action-account-move-line-mass-entry-attrs-set-description"
    model="com.axelor.apps.account.db.MoveLineMassEntry">
    <attribute for="description" name="value" expr="eval: moveDescription"/>
  </action-attrs>

  <action-attrs name="action-move-line-mass-entry-attrs-set-cut-off-dates">
    <attribute for="cutOffStartDate" name="value" expr="eval: originDate"
      if="__config__.app.getApp('account').manageCutOffPeriod"/>
    <attribute for="cutOffEndDate" name="value" expr="eval: originDate"
      if="__config__.app.getApp('account').manageCutOffPeriod"/>
  </action-attrs>

  <action-attrs name="action-move-line-mass-entry-attrs-set-input-action-selection">
    <attribute name="selection-in" for="inputAction"
      expr="eval: __parent__?.functionalOriginSelect == 3 || __parent__?.functionalOriginSelect == 4 || __parent__?.functionalOriginSelect == 7 ? [1,2,3] : [1,3]"/>
  </action-attrs>

  <!-- Action method -->
  <action-method
    name="action-move-line-mass-entry-method-get-first-move-line-informations">
    <call class="com.axelor.apps.account.web.MoveLineMassEntryController"
      method="getFirstMoveLineMassEntryInformations"/>
  </action-method>

  <action-method
    name="action-move-line-mass-entry-method-verify-fields-and-generate-taxline-and-counterpart">
    <call class="com.axelor.apps.account.web.MassEntryMoveController"
      method="verifyFieldsAndGenerateTaxLineAndCounterpart"/>
  </action-method>

  <action-method name="action-move-line-mass-entry-method-on-change-partner">
    <call class="com.axelor.apps.account.web.MoveLineMassEntryController"
      method="changePartnerOnMoveLineMassEntry"/>
  </action-method>

  <action-method name="action-move-line-mass-entry-method-set-currencyRate"
    model="com.axelor.apps.account.db.MoveLine">
    <call class="com.axelor.apps.account.web.MoveLineMassEntryController"
      method="computeCurrentRate"/>
  </action-method>

  <action-method name="action-move-line-mass-entry-method-input-action-onchange">
    <call class="com.axelor.apps.account.web.MoveLineMassEntryController"
      method="setAttrsAndFieldsOnInputActionChanges"/>
  </action-method>

  <!-- Need to be dev and used -->
  <action-method
    name="action-move-line-mass-entry-method-verify-mass-entry-move-balance">
    <call class="com.axelor.apps.account.web.MoveLineMassEntryController"
      method="verifyMassEntryMoveBalance"/>
  </action-method>

</object-views>
