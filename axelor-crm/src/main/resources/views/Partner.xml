<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_6.1.xsd">

  <form name="incl-activities-partner-form" title="Partner"
    model="com.axelor.apps.base.db.Partner">
    <panel-dashlet name="partnerEventsPanel" colSpan="12"
      action="action-partner-view-all-events" height="550"/>
  </form>

  <form name="incl-activities-contact-form" title="Contact"
    model="com.axelor.apps.base.db.Partner">
    <panel-dashlet name="contactEventsPanel" colSpan="12"
      action="action-contact-view-all-events" height="550"/>
  </form>

  <form name="incl-events-partner-form" title="Partner" model="com.axelor.apps.base.db.Partner">
    <panel-dashlet name="customerCrmActivitiesPanel" colSpan="12" title="Events"
      showIf="id != null" action="dashlet.customer.crm.activities" height="350"/>
  </form>

  <form name="incl-opportunities-partner-form" title="Partner"
    model="com.axelor.apps.base.db.Partner">
    <panel-dashlet name="partnerOpportunityPanel" colSpan="12"
      action="action-partner-view-opportunities" height="550"/>
  </form>

  <form name="incl-event-actions-partner-form" title="Partner"
    model="com.axelor.apps.base.db.Partner" id="incl-event-actions-crm-partner-form">
    <menubar>
      <menu name="partnerToolsMenu" title="Tools" icon="fa-wrench" showTitle="true">
        <item name="generateProjectItem" title="Generate Project"
          action="action-partner-method-generate-project" readonlyIf="id == null || id &lt; 1"
          if-module="axelor-project" if="__config__.app.isApp('project')" hideIf="isContact"/>
        <item title="Customer recovery" name="customerRecoveryItem"
          action="action-partner-view-show-customer-debt-recovery"
          if="__config__.app.isApp('account')"/>
        <item title="Create sale quotation" name="createSaleQuotationItem"
          action="save,action-partner-view-create-order" if="__config__.app.isApp('sale')"/>
        <item title="Create purchase quotation" name="createPurchaseQuotationItem"
          action="save,action-partner-view-create-purchase-quotation"
          if="__config__.app.isApp('purchase')" showIf="isSupplier"/>
      </menu>
    </menubar>
  </form>

  <form id="crm-partner-form" name="partner-form" title="Partner"
    model="com.axelor.apps.base.db.Partner" extension="true">
    <extend target="/">
      <attribute name="onLoad" value="crm-action-group-partner-onload"/>
      <attribute name="onNew" value="crm-action-group-partner-onnew"/>
    </extend>
    <extend target="//label[@name='facebookLabel']">
      <replace/>
    </extend>
    <extend target="//label[@name='twitterLabel']">
      <replace/>
    </extend>
    <extend target="//label[@name='youtubeLabel']">
      <replace/>
    </extend>
    <extend target="//field[@name='simpleFullName']">
      <replace>
        <field name="simpleFullName" showTitle="false" colSpan="7" css="label-bold bold large">
          <hilite color="primary" strong="true" if="true"/>
          <editor x-show-titles="false">
            <field name="partnerTypeSelect" showTitle="false" colSpan="12"
              placeholder="Partner Type" onChange="action-partner-group-type-select-onchange"/>
            <panel name="companyPartnerNamePanel" showIf="partnerTypeSelect == 1" colSpan="12">
              <field name="name" showTitle="false" colSpan="12" css="highlight"
                placeholder="Name" onChange="action-group-base-partner-contact-name-onchange"/>
            </panel>
            <panel name="individualPartnerNamePanel" showIf="partnerTypeSelect == 2"
              colSpan="12">
              <field name="titleSelect" showTitle="false" colSpan="2" placeholder="Civility"/>
              <field name="firstName" showTitle="false" colSpan="5" css="highlight"
                placeholder="First name" onChange="action-group-base-partner-contact-name-onchange"/>
              <field name="name" showTitle="false" colSpan="5" css="highlight"
                placeholder="Name" onChange="action-group-base-partner-contact-name-onchange"/>
            </panel>
          </editor>
        </field>
      </replace>
    </extend>
    <extend target="//field[@name='isSupplier']">
      <attribute name="hideIf" value="_isCustomer || _isProspect || $readonly()"/>
    </extend>
    <extend target="//field[@name='isInternal']">
      <attribute name="hideIf" value="_isCustomer || _isProspect || $readonly()"/>
    </extend>
    <extend target="//field[@name='isSubcontractor']">
      <attribute name="hideIf" value="_isCustomer || _isProspect || $readonly()"/>
    </extend>
    <extend target="//field[@name='isCarrier']">
      <attribute name="hideIf" value="_isCustomer || _isProspect || $readonly()"/>
    </extend>
    <extend target="//field[@name='isFactor']">
      <attribute name="hideIf" value="_isCustomer || _isProspect || $readonly()"/>
    </extend>
    <extend target="//button[@name='$positiveBalanceBtn']">
      <attribute name="showIf" value="id &amp;&amp; !isProspect"/>
    </extend>
    <extend target="//field[@name='isFactor']">
      <insert position="after">
        <spacer colSpan="6"/>
        <field name="leadScoringSelect" showIf="isProspect" widget="ImageSelect"
          x-labels="false" colSpan="2"/>
      </insert>
    </extend>
    <extend target="//field[@name='department']">
      <insert position="after">
        <field name="isKeyAccount" colSpan="3"/>
        <field name="isNurturing" colSpan="3"/>
        <field name="sizeSelect" colSpan="6"/>
      </insert>
    </extend>
    <extend target="//field[@name='source']">
      <attribute name="canNew" value="true"/>
    </extend>
    <extend target="//field[@name='taxNbr']">
      <attribute name="showIf" value="isCustomer"/>
    </extend>
    <extend target="//field[@name='paymentDelay']">
      <attribute name="showIf" value="isCustomer"/>
    </extend>
    <extend target="//panel-dashlet[@name='subsidiaryPartners']">
      <attribute name="showIf"
        value="partnerTypeSelect == 1 &amp;&amp; $subsidiaryCount != 0"/>
      <attribute name="height" value="150"/>
    </extend>
    <extend target="//field[@name='webSite']">
      <insert position="after">
        <panel colSpan="12">
          <field name="language" colSpan="6" canEdit="false"/>
          <field if="__config__.app.getApp('base').getIsRegroupProductsOnPrintings()"
            name="groupProductsOnPrintings" showIf="(isCustomer || isSupplier)" colSpan="12"
            widget="boolean-switch"/>
          <panel name="assignedToPanel" title="Assigned to" colSpan="12">
            <field name="user" hideIf="isEmployee" colSpan="6" canNew="false" canView="false"
              canEdit="false" onSelect="action-partner-attrs-user-group" form-view="user-form"
              grid-view="user-grid"/>
            <field if="__config__.app.getApp('base').getTeamManagement()" name="team"
              hideIf="isEmployee" colSpan="6" canEdit="false" form-view="team-form"
              grid-view="team-grid"/>
            <field name="companySet" colSpan="12" widget="TagSelect" canNew="false"
              form-view="company-form" grid-view="company-grid"/>
            <field if="__config__.app.getApp('crm')?.getAgenciesManagement()" name="agency"/>
          </panel>
        </panel>
      </insert>
    </extend>
    <extend target="//panel[@name='settingsPanel']">
      <replace/>
    </extend>
    <extend target="//panel[@name='paymentPanel']">
      <attribute name="hideIf" value="isProspect"/>
    </extend>
    <extend target="//panel-related[@name='accountingSituationListPanel']">
      <attribute name="hideIf" value="isProspect"/>
    </extend>
    <extend target="//button[@name='showAllEventsBtn']">
      <insert position="after">
        <field name="lastEventDateT" readonly="true" colSpan="3"/>
        <field name="scheduledEventDateT" colSpan="3" readonly="true"/>
      </insert>
    </extend>
  </form>

  <form name="partner-crm-customer-form" title="Customer"
    model="com.axelor.apps.base.db.Partner" onNew="crm-action-group-partner-onnew"
    onLoad="crm-action-group-partner-onload, action-partner-attrs-hide-customer-recovery"
    onSave="action-partner-validate-partner-stock-settings-list" width="large">
    <toolbar>
      <button name="showMapBtn" title="Map" icon="fa-map-marker"
        onClick="action-partner-method-show-on-map" readonlyIf="!id"/>
    </toolbar>
    <menubar>
      <menu name="partnerReportsMenu" title="Reports" icon="fa-files-o" showTitle="true">
        <item name="envelopeItem" title="Envelope"
          action="save,action-partner-method-show-envelope" readonlyIf="!id"/>
        <item name="customerSituationItem" title="Customer Situation"
          action="save,action-partner-method-show-client-situation" readonlyIf="!id"
          showIf="isCustomer" if-module="axelor-account"/>
      </menu>
    </menubar>
    <panel-include view="incl-event-actions-partner-form"/>
    <panel name="mainPanel">
      <field name="partnerStatus" showTitle="false" colSpan="12" widget="NavSelect"
        x-order="sequence" onChange="action-partner-group-partner-status-onchange"
        if="__config__.app.getApp('crm')?.getCrmProcessOnPartner()"/>
      <panel name="imagePanel" colSpan="2">
        <field name="picture" showTitle="false" widget="Image" colSpan="12">
          <viewer>
						<![CDATA[
					    <div>
			    			<img width="80%" ng-show="record.picture" ng-src="{{$image('picture', 'content')}}" />
          					<img width="80%" ng-show="!record.picture && record.partnerTypeSelect != 2" src="img/company-default.jpg" />
          					<img width="80%" ng-show="!record.picture && record.partnerTypeSelect == 2 && record.titleSelect == 1" src="img/partner-m-default.png" />
          					<img width="80%" ng-show="!record.picture && record.partnerTypeSelect == 2 && record.titleSelect == 2" src="img/partner-w-default.png" />
        					<img width="80%" ng-show="!record.picture && record.partnerTypeSelect == 2 && (record.titleSelect > 2 || !record.titleSelect)" src="img/partner-default.png" />
     					</div>
					]]>
          </viewer>
        </field>
        <panel name="socialNetworkPanel" colSpan="12" showIf="fullName != null">
          <label name="googleLabel"
            title="&lt;a class='fa fa-google' href='http://www.google.com' target='_blank' /&gt;"
            colSpan="2"/>
          <label name="facebookLabel"
            title="&lt;a class='fa fa-facebook' href='http://www.facebook.com' target='_blank' /&gt;"
            colSpan="2"/>
          <label name="twitterLabel"
            title="&lt;a class='fa fa-twitter' href='http://www.twitter.com' target='_blank' /&gt;"
            colSpan="2"/>
          <label name="linkedinLabel"
            title="&lt;a class='fa fa-linkedin' href='http://www.linkedin.com' target='_blank' /&gt;"
            colSpan="2"/>
          <label name="youtubeLabel"
            title="&lt;a class='fa fa-youtube' href='http://www.youtube.com' target='_blank' /&gt;"
            colSpan="2"/>
        </panel>
      </panel>
      <panel name="generalInfoPanel" colSpan="10">
        <panel name="partnerInfoPanel" colSpan="12">
          <field name="simpleFullName" colSpan="7" showTitle="false"
            css="label-bold bold large">
            <hilite strong="true" if="true" color="primary"/>
            <editor x-show-titles="false">
              <field name="partnerTypeSelect" showTitle="false"
                onChange="action-partner-group-type-select-onchange" colSpan="12"
                placeholder="Partner Type"/>
              <panel name="companyPartnerNamePanel" showIf="partnerTypeSelect == 1"
                colSpan="12">
                <field name="name" showTitle="false" css="highlight" placeholder="Name"
                  onChange="action-group-base-partner-contact-name-onchange" colSpan="12"/>
              </panel>
              <panel name="individualPartnerNamePanel" showIf="partnerTypeSelect == 2"
                colSpan="12">
                <field name="titleSelect" showTitle="false" placeholder="Civility" colSpan="2"/>
                <field name="name" showTitle="false" css="highlight" placeholder="Name"
                  onChange="action-group-base-partner-contact-name-onchange" colSpan="5"/>
                <field name="firstName" showTitle="false" css="highlight"
                  placeholder="First name"
                  onChange="action-group-base-partner-contact-name-onchange" colSpan="5"/>
              </panel>
            </editor>
          </field>
          <field name="partnerSeq" showTitle="false" colSpan="2" css="label-bold bold large"/>
          <button if="__config__.app.isApp('account')" name="$positiveBalanceBtn"
            title="Balance" colSpan="3" icon="fa-balance-scale"
            onClick="action-partner-view-show-move-lines" widget="info-button" showIf="id"/>
          <field name="$balance" hidden="true"/>
          <static name="duplicatePartnerText" hidden="true" colSpan="12"><![CDATA[<span class='label label-warning'>There is already a partner with this name.</span>]]></static>
          <field name="fullName" hidden="true"/>
        </panel>
        <field name="isProspect" colSpan="2" widget="InlineCheckbox"
          hideIf="isContact || $readonly()"
          onChange="action-partner-attrs-unset-customer,action-partner-record-unset-factor"/>
        <field name="isEmployee" colSpan="2" widget="InlineCheckbox"
          hideIf="$readonly() || isCustomer || isSupplier || isCarrier || isFactor || partnerTypeSelect != 2"
          onChange="action-partner-account-attrs-hide-employee-account,action-partner-record-unset-factor"/>
        <field name="isCustomer" colSpan="2" widget="InlineCheckbox"
          hideIf="isContact || $readonly() || isEmployee"
          onChange="action-partner-group-check-can-change-customer,action-partner-record-invoices-copy-default-value,action-partner-account-attrs-hide-customer-account,action-partner-attrs-unset-prospect,action-partner-record-unset-factor"/>
        <field name="isSupplier" colSpan="2" widget="InlineCheckbox"
          hideIf="isContact || $readonly() || isEmployee"
          onChange="action-partner-group-check-can-change-supplier,action-partner-account-attrs-hide-supplier-account,action-partner-record-unset-factor"/>
        <field name="isSubcontractor" colSpan="2" widget="InlineCheckbox" hideIf="$readonly()"
          if-module="axelor-production"
          if="__config__.app.getApp('production')?.getManageOutsourcing()"/>
        <field name="isInternal" colSpan="2" widget="InlineCheckbox" hideIf="$readonly()"/>
        <spacer if="!__config__.app.getApp('production')?.manageOutsourcing" colSpan="2"/>
        <field name="isCarrier" colSpan="2" widget="InlineCheckbox"
          hideIf="isContact || $readonly() || isEmployee" if="__config__.app.isApp('stock')"
          onChange="action-partner-record-unset-factor"/>
        <field name="isFactor" colSpan="2" widget="InlineCheckbox"
          hideIf="isContact || $readonly() || isEmployee"
          if="__config__.app.getApp('account')?.manageFactors"
          onChange="action-partner-group-check-can-change-factor,action-partner-record-set-factor"/>
        <field name="$viewerPartnerType" showTitle="false" hideIf="isContact || !$readonly()"
          colSpan="12">
          <viewer
            depends="isProspect,isEmployee,isCustomer,isSupplier,isSubcontractor,isFactor,isCarrier">
						<![CDATA[
							<h4 style="text-align: right;">
								<span class="label label-default" style="background-color: #FC6355; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isProspect" x-translate>Prospect</span>
								<span class="label label-default" style="background-color: #5680FC; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isEmployee" x-translate>Employee</span>
								<span class="label label-default" style="background-color: #EF9D3F; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isCustomer" x-translate>Customer</span>
								<span class="label label-default" style="background-color: #7D54FC; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isSupplier" x-translate>Supplier</span>
								<span class="label label-default" style="background-color: #000080; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isSubcontractor" x-translate>Subcontractor</span>
								<span class="label label-default" style="background-color: #54FC62; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isFactor" x-translate>Factor</span>
								<span class="label label-default" style="background-color: #FF0000; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isCarrier" x-translate>Carrier</span>
							</h4>
                        ]]>
          </viewer>
        </field>
        <field name="isContact" hidden="true" colSpan="12"/>
        <panel name="blockingPanel" hideIf="!$readonly()" colOffset="9" colSpan="3">
          <field name="$activeBlockings" showTitle="false" colSpan="12">
            <viewer><![CDATA[
                            <h4 style="text-align: right;">
                                <span ng-repeat="item in record.blockingList" class="label label-important" style="margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="$moment(item.blockingToDate) > $moment(today)">
                                	<i class="fa fa-ban"/>
                                	<span x-translate>{{ {'1':'Remin._block','2':'Inv._block','3':'Reimb._block','4':'Debit_block','5':'Sale_block','6':'Purch._block'}[item.blockingSelect] }}</span>
                                	<!-- hidden spans only there for translation purposes -->
                                	<span x-translate style="display:none">Remin._block</span>
                                	<span x-translate style="display:none">Inv._block</span>
                                	<span x-translate style="display:none">Reimb._block</span>
                                	<span x-translate style="display:none">Debit_block</span>
                                	<span x-translate style="display:none">Sale_block</span>
                                	<span x-translate style="display:none">Purch._block</span>
                                	<i class="fa fa-caret-right" style="margin: 0 4px;"/>
                                	{{ $fmt('item.blockingToDate') }}
                                </span>
                            </h4>
                        ]]></viewer>
          </field>
        </panel>
        <field name="$customerCantBeRemoved" hidden="true" type="boolean" showIf="false"/>
        <field name="$supplierCantBeRemoved" hidden="true" type="boolean" showIf="false"/>
        <field name="$factorCantBeRemoved" hidden="true" type="boolean" showIf="false"/>
      </panel>
    </panel>
    <panel-related name="partnerRoleSetPanel" field="partnerRoleSet"
      form-view="partner-role-form" grid-view="partner-role-grid"
      showIf="isContact || partnerTypeSelect == 2" canNew="false"/>
    <panel name="partnerDetailsPanel" title="Partner Details" hideIf="isEmployee" colSpan="12">
      <panel colSpan="6" name="partnerCategoryPanel">
        <field name="partnerCategory" widget="SuggestBox" colSpan="6"
          form-view="partner-category-form" grid-view="partner-category-grid"/>
        <field name="industrySector" colSpan="6" widget="SuggestBox"
          hideIf="partnerTypeSelect== 2"/>
        <field name="source" canEdit="false" colSpan="6" widget="SuggestBox"
          form-view="source-form" grid-view="source-grid"/>
        <field name="department" colSpan="6" hideIf="partnerTypeSelect== 2"/>
        <panel name="functionPanel" colSpan="12" showIf="isContact || partnerTypeSelect == 2">
          <field name="jobTitleFunction"
            onChange="action-record-base-partner-set-business-card"/>
          <field name="functionBusinessCard"/>
        </panel>
      </panel>
      <panel name="otherPartnerDetailsPanel">
        <field name="registrationCode" hideIf="partnerTypeSelect== 2" colSpan="4"
          onChange="action-method-partner-registration-code-onChange"/>
        <field name="siren" hideIf="partnerTypeSelect== 2" colSpan="4" readonly="true"/>
        <field name="nic" hideIf="partnerTypeSelect== 2" colSpan="4" readonly="true"/>
        <field name="saleTurnover" hideIf="partnerTypeSelect== 2"/>
        <field name="mainActivity" hideIf="partnerTypeSelect== 2" domain="self.isFinal = true"
          form-view="main-activity-form"/>
        <field name="taxNbr" hideIf="partnerTypeSelect== 2"/>
        <field name="paymentDelay" if-module="axelor-cash-management"
          if="__config__.app.isApp('cash-management')"/>
        <field name="parentPartner" hideIf="partnerTypeSelect != 1"
          if="__config__.app.getApp('base')?.getManageSubsidiaryPartner()"
          domain="self.isContact = false AND self.partnerTypeSelect = 1 AND self in (SELECT p FROM Partner p join p.companySet c where c in :companySet)"
          form-view="partner-form" grid-view="partner-grid"/>
        <field name="sellerCode" showIf="isFactor"
          if="__config__.app.isApp('account') &amp;&amp; __config__.app.getApp('account')?.getManageFactors()"/>
        <field name="lostReason" hidden="true" colSpan="6"/>
        <field name="lostReasonStr" showIf="lostReason.freeText" colSpan="6"/>
        <field name="lostReason.freeText" hidden="true"/>
      </panel>
    </panel>
    <panel colSpan="12" itemSpan="6" name="partnerSupplyChainLinkListPanel"
      showIf="isProspect || isCustomer"
      if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain')?.activatePartnerRelations"
      if-module="axelor-supplychain">
      <panel-related field="partner1SupplychainLinkList"
        grid-view="partner-supplychain-link-partner-1-grid"
        form-view="partner-supplychain-link-form" colSpan="6"/>
      <panel-related field="partner2SupplychainLinkList"
        grid-view="partner-supplychain-link-partner-2-grid"
        form-view="partner-supplychain-link-form" colSpan="6"/>
    </panel>
    <panel-dashlet action="action-partner-view-subsidiary-partners"
      name="subsidiaryPartners" showIf="partnerTypeSelect == 1"
      if="__config__.app.getApp('base')?.getManageSubsidiaryPartner()"/>
    <panel-related name="contactPartnerSetPanel" field="contactPartnerSet"
      hideIf="!id || isContact || partnerTypeSelect == 2"
      domain="self.isContact = 'true' AND self in (SELECT p FROM Partner p join p.companySet c where c in :companySet)"
      form-view="partner-contact-form" grid-view="partner-contact-grid"/>
    <panel-tabs name="mainPanelTab">
      <panel name="informationPanel" title="Information">
        <panel name="employeeAddressPanel" title="Contact address" colSpan="12"
          showIf="isEmployee">
          <field name="mainAddress" form-view="address-form" grid-view="address-grid">
            <editor x-show-titles="false">
              <field name="addressL2" x-bind="{{addressL2|uppercase}}"
                placeholder="e.g. Financial department, CEO"/>
              <field name="addressL3" x-bind="{{addressL3|uppercase}}"
                placeholder="e.g. Building A, Entry 2, 2nd Floor, Door 2E"/>
              <field name="addressL4" x-bind="{{addressL4|uppercase}}"/>
              <field name="addressL5" x-bind="{{addressL5|uppercase}}"
                placeholder="e.g. POB 254"/>
              <field name="city" canNew="true" onChange="action-address-change-city"
                form-view="city-form" grid-view="city-grid"/>
              <field name="addressL6" x-bind="{{addressL6|uppercase}}" required="true"/>
              <field name="addressL7Country" required="true" form-view="country-form"
                grid-view="country-grid"/>
            </editor>
          </field>
        </panel>
        <panel name="postalAddressesPanel" title="Postal addresses" colSpan="12"
          hideIf="isEmployee">
          <static name="invoiceAndDeliveryAddressText" hidden="true" colSpan="12"><![CDATA[<span class='label label-warning'>Please add an invoice address and a delivery address by default.</span>]]></static>
          <field name="partnerAddressList" colSpan="12" form-view="partner-address-form"
            grid-view="partner-address-grid">
            <editor x-show-titles="false" onNew="action-partner-address-attrs-set-canselect">
              <panel colSpan="12" css="field-append">
                <field name="$canSelect" hidden="true" colSpan="12"/>
                <label colSpan="12"
                  title="The following address is invalid. Please use '+' button to create a new one :"
                  showIf="address == null || address.addressL4 == null" hidden="true"
                  css="label-bold" name="addressHelperLabel"/>
                <panel colSpan="12" stacked="true" css="field-append">
                  <field name="address" canEdit="!$canSelect" canNew="true"
                    form-view="address-form" grid-view="address-grid" canSelect="$canSelect"
                    required="true"/>
                  <field name="isInvoicingAddr" widget="toggle" hideIf="$readonly()"
                    x-icon="fa-list-alt"/>
                  <field name="isDeliveryAddr" widget="toggle" hideIf="$readonly()"
                    x-icon="fa-shopping-cart"/>
                  <field name="isDefaultAddr" widget="toggle" hideIf="$readonly()"
                    x-icon="fa-star-o"/>
                  <field name="address.addressL4" hidden="true"/>
                </panel>
              </panel>
            </editor>
          </field>
          <spacer/>
          <field name="headOfficeAddress"
            if="__user__.activeCompany?.accountConfig?.displayHeadOfficeAddrOnInvoicePrinting"
            colSpan="12"/>
        </panel>
        <panel name="generalContactDetailsPanel" title="General contact details" colSpan="12">
          <field name="fixedPhone" colSpan="3" widget="phone"
            x-placeholder-number-type="FIXED_LINE"/>
          <field name="mobilePhone" colSpan="3" hideIf="partnerTypeSelect == 1" widget="phone"/>
          <field name="emailAddress" canSelect="false" colSpan="6"
            form-view="email-address-simple-form" x-show-icons="false">
            <editor x-show-titles="false">
              <field name="address" colSpan="12" placeholder="whatever@example.com"
                pattern="^[a-z0-9A-ZáàâäãåçéèêëíìîïñóòôöõúùûüýÿæœÁÀÂÄÃÅÇÉÈÊËÍÌÎÏÑÓÒÔÖÕÚÙÛÜÝŸÆŒ!#$%&amp;'*+/=?^_`{|}~-]+(?:\.[a-z0-9A-ZáàâäãåçéèêëíìîïñóòôöõúùûüýÿæœÁÀÂÄÃÅÇÉÈÊËÍÌÎÏÑÓÒÔÖÕÚÙÛÜÝŸÆŒ!#$%&amp;'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+(?:[a-z]{2,})$"/>
            </editor>
          </field>
          <field name="webSite" placeholder="http://www.url.com" widget="url"
            pattern="^(?:http(?:s)?://)?\S+(?:\.\S+)+$"/>
        </panel>

        <panel name="employeePanel" hidden="true">
          <button name="openEmployeeFormBtn" title="Open employee form" colSpan="6"
            onClick="action-partner-view-open-employee-form"/>
        </panel>

        <panel name="settingsPanel" title="Settings" colSpan="12">
          <field name="language" colSpan="6" canEdit="false"/>
          <field name="groupProductsOnPrintings" showIf="(isCustomer || isSupplier)"
            if="__config__.app.getApp('base')?.getIsRegroupProductsOnPrintings()"
            widget="boolean-switch" colSpan="12"/>
          <panel name="assignedToPanel" title="Assigned to" colSpan="12">
            <field name="user" colSpan="6" form-view="user-form"
              onSelect="action-partner-attrs-user-group" grid-view="user-grid" hideIf="isEmployee"
              canNew="false" canEdit="false" canView="false"/>
            <field name="team" canEdit="false" colSpan="6" form-view="team-form"
              grid-view="team-grid" if="__config__.app.getApp('base')?.getTeamManagement()"
              hideIf="isEmployee"/>
            <field name="companySet" colSpan="12" widget="TagSelect" canNew="false"
              form-view="company-form" grid-view="company-grid"/>
          </panel>
        </panel>
        <panel name="notesPanel" title="Notes" colSpan="12">
          <field name="description" colSpan="12" height="8" showTitle="false" widget="Html"/>
        </panel>
      </panel>
      <panel name="paymentPanel" title="Invoicing/Payment" hideIf="isContact"
        if-module="axelor-account" colSpan="12" if="__config__.app.isApp('invoice')">
        <panel-include view="incl-invoice-payment-partner-form"/>
        <panel-include if-module="axelor-account"
          if="__config__.app.isApp('account') &amp;&amp; __config__.app.getApp('bank-payment')?.manageDirectDebitPayment"
          view="incl-sepa-direct-debit-partner-form"/>
        <panel name="invoiceCommentsPanel" title="Comment to display on invoice" colSpan="12">
          <field name="invoiceComments" widget="html" colSpan="12" showTitle="false"/>
        </panel>
        <panel name="descriptionToDisplayOnProformaPanel"
          title="Comment to display on proforma" colSpan="12">
          <field name="proformaComments" widget="html" colSpan="12" showTitle="false"/>
        </panel>
      </panel>
      <panel-related name="accountingSituationListPanel" if-module="axelor-account"
        if="__config__.app.isApp('account')" field="accountingSituationList"
        title="Accounting situation" hideIf="isContact" colSpan="12"
        grid-view="accounting-situation-partner-grid" form-view="accounting-situation-partner-form"
        onSelect="action-account-accounting-situation-method-update-customer-account"/>
      <panel-include if-module="axelor-account" view="incl-blocking-partner-form"
        if="__config__.app.isApp('account')"/>
      <panel name="eventPanel" title="Events" showIf="id != null" if-module="axelor-crm"
        hideIf="isEmployee" if="__config__.app.isApp('crm')">
        <button name="meetingBtn" title="Create a meeting" link="" icon="fa-pencil-square-o"
          onClick="save,action-partner-view-meeting-event" colSpan="3"/>
        <button name="callBtn" title="Create a call" link="" icon="fa-phone"
          onClick="save,action-partner-view-call-event" colSpan="3"/>
        <button name="taskBtn" title="Create a task" link="" icon="fa-tasks"
          onClick="save,action-partner-view-task-event" colSpan="3"/>
        <button name="noteBtn" title="Create a note" link="" icon="fa-sticky-note-o"
          onClick="save,action-partner-view-note-event" colSpan="3"/>
        <button name="showAllEventsBtn" title="Show all events" css="btn-custom text-left"
          icon="fa-tasks" onClick="action-partner-view-events" readonlyIf="id == null"/>
        <panel-include view="incl-activities-partner-form"/>
      </panel>
      <panel name="opportunitiesPanel" title="Opportunities" showIf="id != null"
        if-module="axelor-crm" hideIf="isEmployee" if="__config__.app.isApp('crm')">
        <button name="createOpportunityBtn" title="Create opportunity"
          onClick="save,action-partner-view-create-opportunity" link="" colSpan="3"/>
        <panel-include view="incl-opportunities-partner-form"/>
      </panel>
      <panel name="emailPanel" title="Emails" showIf="id != null" if-module="axelor-crm"
        hideIf="isEmployee" if="__config__.app.isApp('crm')">
        <button name="emailBtn" title="Create an email" icon="fa-envelope-o" link=""
          onClick="save,action-send-by-email-with-template" colSpan="3"/>
        <panel-dashlet name="sentEmailsPanel" title="Sent emails"
          action="action-partner-method-view-sent-emails" colSpan="12" height="550"/>
        <panel-dashlet name="receivedEmailsPanel" title="Received emails"
          action="action-partner-method-view-received-emails" colSpan="12" height="550"/>
      </panel>
      <panel name="marketingCampaignPanel" title="Marketing campaigns" showIf="id != null"
        if-module="axelor-crm" hideIf="isEmployee" if="__config__.app.isApp('marketing')">
        <panel-dashlet name="marketingCampaignsPanel"
          action="action-partner-view-marketing-campaigns" colSpan="12" height="800"/>
      </panel>
      <panel name="customerPanel" title="Customer" if-module="axelor-sale" showIf="isCustomer"
        if="__config__.app.isApp('sale')">
        <field name="saleOrderInformation"/>
        <field name="payerQuality" if-module="axelor-account"
          if="__config__.app.isApp('account')" hideIf="isEmployee"/>
        <field name="salePartnerPriceList" canEdit="false" domain="self.typeSelect = 1"
          form-view="sale-partner-price-list-form" grid-view="partner-price-list-grid"/>
        <field name="chargeBackPurchaseSelect" colSpan="3" if-module="axelor-business-project"
          if="__config__.app.isApp('business-project')"/>
        <field name="chargeBackPurchase" colSpan="3" showIf="chargeBackPurchaseSelect == 3"
          if-module="axelor-business-project" if="__config__.app.isApp('business-project')"/>
        <panel name="clientPortalAccessPanel" title="Client portal access"
          if-module="axelor-client-portal"
          if="__config__.app.isApp('portal') &amp;&amp; __config__.app.getApp('portal')?.getPortalSelect() == 2">
          <field name="password" widget="password"/>
        </panel>
        <field name="factorizedCustomer"
          if="__config__.app.isApp('account') &amp;&amp; __config__.app.getApp('account')?.getManageFactors()"/>
        <field name="customerCatalogList" colSpan="12"
          form-view="customer-catalog-partner-form" grid-view="customer-catalog-partner-grid"
          if-module="axelor-sale"
          if="__config__.app.isApp('sale') &amp;&amp; __config__.app.getApp('sale')?.getEnableCustomerCatalogMgt()"/>
        <panel name="accountblockedPanel">
          <field name="hasBlockedAccount"
            onChange="action-attrs-update-manually-blocked-account"/>
          <field name="hasManuallyBlockedAccount" hidden="true"/>
        </panel>
        <panel name="saleOrderCommentsPanel" title="Comment to display on sale order"
          colSpan="12">
          <field name="saleOrderComments" widget="html" colSpan="12" showTitle="false"/>
        </panel>
        <panel name="saleOrderPanel" colSpan="12" if="__config__.app.isApp('sale')"
          if-module="axelor-sale">
          <button name="createSaleOrderBtn" title="Create sale quotation" colSpan="4"
            onClick="save,action-partner-view-create-order" readonlyIf="id == null || id &lt; 1"
            showIf="isProspect || isCustomer"/>
          <panel-include view="incl-sales-partner-form"/>
        </panel>
      </panel>

      <panel name="supplierPanel" title="Supplier" if-module="axelor-purchase"
        showIf="isSupplier || isSubcontractor" if="__config__.app.isApp('purchase')">
        <field name="purchaseOrderInformation"/>
        <field name="purchasePartnerPriceList" canEdit="false" domain="self.typeSelect = 2"
          form-view="purchase-partner-price-list-form" grid-view="partner-price-list-grid"/>
        <field name="supplierCatalogList" colSpan="12" x-can-copy="true"
          form-view="supplier-catalog-partner-form" grid-view="supplier-catalog-partner-grid"
          if-module="axelor-purchase"
          if="__config__.app.isApp('purchase') &amp;&amp; __config__.app.getApp('purchase')?.getManageSupplierCatalog()"/>
        <field name="supplierQualityRating" hidden="true"/>
        <field name="supplierQualityRatingSelect" widget="ImageSelect" x-labels="false"
          colSpan="3" onChange="action-record-set-supplier-quality-rating"/>
        <field name="supplierArrivalProductQty" colSpan="3"/>
        <spacer name="supplierSpacer"/>
        <field name="partnerProductQualityRatingList" colSpan="12"
          grid-view="partner-product-quality-rating-grid"
          form-view="partner-product-quality-rating-form"/>
        <panel name="purchaseOrderCommentsPanel" title="Comment to display on purchase order"
          colSpan="12">
          <field name="purchaseOrderComments" widget="html" colSpan="12" showTitle="false"/>
        </panel>
        <panel name="purchaseOrderPanel" colSpan="12" if-module="axelor-purchase"
          if="__config__.app.isApp('purchase')">
          <button name="createPurchaseOrderBtn" title="Create purchase quotation" colSpan="4"
            onClick="save,action-partner-view-create-purchase-quotation"
            readonlyIf="id == null || id &lt; 1" showIf="isSupplier"/>
          <panel-include view="incl-purchases-partner-form"/>
        </panel>
      </panel>
      <panel name="carrierPanel" title="Carrier" showIf="isCarrier">
        <field name="freightCarrierModeList" title="Freight Carrier Mode"
          form-view="freight-carrier-mode-freight-carrier-form"
          grid-view="freight-carrier-mode-freight-carrier-grid" colSpan="12"/>
      </panel>
      <panel name="deliveryPanel" title="Delivery"
        showIf="isSupplier || isCustomer || isSubcontractor" if="__config__.app.isApp('stock')"
        if-module="axelor-stock">
        <field name="deliveryDelay" showIf="isSupplier || isSubcontractor"/>
        <spacer name="deliveryDelaySpacer"/>
        <field name="shipmentMode" form-view="shipment-mode-form"
          grid-view="shipment-mode-grid" onChange="action-partner-record-empty-freight-carrier-mode"
          title="Shipment Mode"/>
        <field name="freightCarrierMode" domain="self.shipmentMode = :shipmentMode"
          onChange="action-partner-record-freight-carrier" form-view="freight-carrier-mode-form"
          grid-view="freight-carrier-mode-grid" readonlyIf="shipmentMode == null"
          title="Freight Carrier Mode"/>
        <field name="carrierPartner" form-view="partner-form" grid-view="partner-grid"
          title="Freight Carrier" readonly="true"/>
        <field name="isIspmRequired" hidden="true" showIf="isCustomer || isProspect"/>
        <field name="isNeedingConformityCertificate" showIf="isCustomer || isProspect"/>
        <field name="partnerStockSettingsList" colSpan="12"
          form-view="partner-stock-settings-form" grid-view="partner-stock-settings-grid"/>
        <panel-include
          view="incl-freight-carrer-customer-account-number-list-partner-form"/>
        <panel name="deliveryCommentsPanel" title="Comment to display on delivery"
          colSpan="12">
          <field name="deliveryComments" widget="html" colSpan="12" showTitle="false"/>
        </panel>
        <panel name="pickingOrderCommentsPanel" title="Comment to display on picking order"
          colSpan="12">
          <field name="pickingOrderComments" widget="html" colSpan="12" showTitle="false"/>
        </panel>
      </panel>
    </panel-tabs>
    <panel name="partnerAttrsPanel">
      <field name="partnerAttrs" colSpan="12"/>
    </panel>
    <panel-mail name="mailsPanel">
      <mail-messages limit="4"/>
      <mail-followers/>
    </panel-mail>
  </form>

  <form id="crm-partner-supplier-form" name="partner-supplier-form" title="Supplier"
    model="com.axelor.apps.base.db.Partner" extension="true">
    <extend target="/">
      <attribute name="onLoad" value="crm-action-group-partner-onload"/>
      <attribute name="onNew" value="crm-action-group-partner-onnew"/>
    </extend>
  </form>

  <form id="crm-partner-light-form" name="partner-light-form" title="Partner"
    model="com.axelor.apps.base.db.Partner" extension="true">
    <extend target="/">
      <attribute name="onLoad" value="crm-action-group-partner-onload"/>
      <attribute name="onNew" value="crm-action-group-partner-onnew"/>
    </extend>
  </form>

  <form id="crm-partner-contact-form" name="partner-contact-form" title="Contact"
    model="com.axelor.apps.base.db.Partner" extension="true">
    <extend target="/">
      <attribute name="onNew" value="action-group-partner-contact-onNew"/>
    </extend>
    <extend target="//label[@name='facebookLabel']">
      <replace/>
    </extend>
    <extend target="//label[@name='twitterLabel']">
      <replace/>
    </extend>
    <extend target="//label[@name='youtubeLabel']">
      <replace/>
    </extend>
    <extend target="//field[@name='simpleFullName']">
      <replace>
        <field name="simpleFullName" showTitle="false" colSpan="12" css="bold">
          <editor x-show-titles="false">
            <field name="titleSelect" colSpan="2" placeholder="Civility" selection-in="[1,2]"/>
            <field name="firstName" colSpan="5" css="highlight" placeholder="First name"
              onChange="action-group-base-partner-contact-name-onchange"/>
            <field name="name" colSpan="5" css="highlight" placeholder="Name"
              onChange="action-group-base-partner-contact-name-onchange"/>
          </editor>
        </field>
      </replace>
    </extend>
    <extend target="//field[@name='jobTitleFunction']">
      <attribute name="x-create" value="function"/>
      <insert position="before">
        <field name="isDoNotCall" colSpan="4" hideIf="$readonly()"/>
        <field name="isDoNotEmail" colSpan="4" hideIf="$readonly()"/>
        <field name="$viewerCallAndEmail" showTitle="false" showIf="$readonly()" colSpan="12">
          <viewer><![CDATA[
			<h4>
				<span class="label label-default" style="background-color: #0285D8; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isDoNotCall" x-translate>Rejection of calls</span>
				<span class="label label-default" style="background-color: #0285D8; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isDoNotEmail" x-translate>Rejection of e-mails</span>
			</h4>
          ]]></viewer>
        </field>
      </insert>
    </extend>
    <extend target="//field[@name='mainPartner']">
      <insert position="after">
        <field name="companyDepartment"/>
      </insert>
    </extend>
    <extend target="//field[@name='language']">
      <insert position="after">
        <field name="createdOn" readonly="true"/>
      </insert>
    </extend>
  </form>

  <grid name="partner-prospect-grid" title="Prospects" model="com.axelor.apps.base.db.Partner"
    orderBy="name" edit-icon="true">
    <menubar>
      <menu name="partnerReportsMenu" title="Reports" showTitle="true" icon="fa-files-o">
        <item name="contactPhoneBookItem" title="Contact PhoneBook"
          action="action-print-phonebook"/>
        <item if="__config__.app.isApp('employee')" name="companyPhoneBookItem"
          title="Company phoneBook" action="action-print-company-phonebook"/>
      </menu>
      <menu name="partnerToolsMenu" title="Tools" showTitle="true" icon="fa-wrench">
        <item name="checkDuplicateItem" title="Check Duplicate"
          action="action-general-check-duplicate-records"/>
        <item name="mergeDuplicatedItem" title="Merge duplicated"
          action="action-validate-select-object-message,action-duplicate-object-wizard-open"/>
      </menu>
    </menubar>
    <field name="partnerSeq" width="120"/>
    <field name="simpleFullName" width="300"/>
    <field name="fixedPhone" widget="phone" x-placeholder-number-type="FIXED_LINE"/>
    <field name="emailAddress.address" title="Email" placeholder="whatever@example.com"/>
    <field name="partnerCategory" form-view="partner-category-form"
      grid-view="partner-category-grid"/>
    <field name="user"/>
    <field if="__config__.app.getApp('base').getEnableMultiCompany()" name="companyStr"/>
    <field name="leadScoringSelect" widget="ImageSelect" x-labels="false"/>
    <button if="__config__.app.isApp('crm')" if-module="axelor-crm" name="scheduleEventBtn"
      title="Schedule Event" icon="fa-group" onClick="action-partner-view-schedule-event"/>
    <button if="__config__.app.isApp('crm')" if-module="axelor-crm" name="sendByEmailBtn"
      title="Send Email" icon="fa-envelope" onClick="action-send-by-email-with-template"/>
  </grid>

  <grid id="crm-partner-grid" name="partner-grid" title="Partners"
    model="com.axelor.apps.base.db.Partner" orderBy="name" extension="true">
    <extend target="//field[@name='companyStr']">
      <insert position="after">
        <field name="leadScoringSelect" widget="ImageSelect" x-labels="false"/>
      </insert>
    </extend>
  </grid>

  <cards id="crm-partner-cards" name="partner-cards" model="com.axelor.apps.base.db.Partner"
    title="Partners" css="rect-image">
    <toolbar>
      <button name="printPhoneBookBtn" title="Contact PhoneBook" icon="fa-print"
        onClick="action-print-phonebook"/>
      <button name="printCompanyPhoneBookBtn" title="Company PhoneBook" icon="fa-print"
        onClick="action-print-company-phonebook" if="__config__.app.isApp('employee')"/>
      <button name="checkDuplicateBtn" title="Check Duplicate"
        onClick="action-general-check-duplicate-records"/>
      <button name="replaceDuplicateBtn" title="Merge duplicated"
        onClick="action-validate-select-object-message,action-duplicate-object-wizard-open"/>
      <button name="advancedExportBtn" title="Advanced export"
        onClick="action-method-advanced-export-wizard-view"/>
    </toolbar>
    <field name="fullName"/>
    <field name="picture"/>
    <field name="fixedPhone"/>
    <field name="emailAddress.address" title="Email"/>
    <field name="partnerCategory"/>
    <field name="partnerTypeSelect"/>
    <field name="titleSelect"/>
    <field name="mainAddress"/>
    <field name="isProspect"/>
    <field name="isEmployee"/>
    <field name="isCustomer"/>
    <field name="isSupplier"/>
    <field name="isSubcontractor"/>
    <field name="isFactor"/>
    <field name="isCarrier"/>
    <field name="leadScoringSelect"/>
    <template><![CDATA[
			<div>
				<div class="span12"><strong>{{fullName}}</strong></div>
		 	</div>
			<div>
			  <div class="span4 card-image" style="width: 128px; height: 64px;">
                <img ng-show="picture" ng-src="{{$image('picture', 'content')}}" style="width: 100%; height: 100%; object-fit: contain;"/>
                <img ng-show="!picture && partnerTypeSelect != 2" src="img/company-default.jpg" />
                <img ng-show="!picture && partnerTypeSelect == 2 && titleSelect == 1" src="img/partner-m-default.png" />
                <img ng-show="!picture && partnerTypeSelect == 2 && titleSelect == 2" src="img/partner-w-default.png" />
                <img ng-show="!picture && partnerTypeSelect == 2 && (titleSelect > 2 || !titleSelect)" src="img/partner-default.png" />
			  </div>
			  <div class="span8">
			  	<address>
			  	{{mainAddress.fullName}}
			  	</address>
			    <span>
			    {{fixedPhone}}<br/>
			    {{emailAddress.address}}<br/>
			    {{partnerCategory.name}}<br/>
			    <span ng-show="record.isProspect">
			    	<span ng-show="!record.leadScoringSelect"><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i></span>
          			<span ng-show="record.leadScoringSelect && leadScoringSelect == 1.00"><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i></span>
          			<span ng-show="record.leadScoringSelect && leadScoringSelect == 2.00"><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i></span>
          			<span ng-show="record.leadScoringSelect && leadScoringSelect == 3.00"><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i></span>
          			<span ng-show="record.leadScoringSelect && leadScoringSelect == 4.00"><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star-o' style='color:#FFD700; font-size:25px;'></i></span>
          			<span ng-show="record.leadScoringSelect && leadScoringSelect == 5.00"><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i><i class='fa fa-star' style='color:#FFD700; font-size:25px;'></i></span>
      			</span><br/>
			    <h4 style="text-align: right;">
					<span class="label label-default" style="background-color: #FC6355; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isProspect" x-translate>Prospect</span>
					<span class="label label-default" style="background-color: #5680FC; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isEmployee" x-translate>Employee</span>
					<span class="label label-default" style="background-color: #EF9D3F; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isCustomer" x-translate>Customer</span>
					<span class="label label-default" style="background-color: #7D54FC; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isSupplier" x-translate>Supplier</span>
					<span class="label label-default" style="background-color: #000080; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isSubcontractor && record.$isSubcontractor" x-translate>Subcontractor</span>
					<span class="label label-default" style="background-color: #54FC62; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isFactor" x-translate>Factor</span>
					<span class="label label-default" style="background-color: #FF0000; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isCarrier" x-translate>Carrier</span>
				</h4>
			  </div>
			</div>
		]]>
    </template>
  </cards>

  <form name="partner-form-lost-popup" model="com.axelor.apps.base.db.Partner"
    title="Lost reason" width="large" onSave="action-crm-group-close-lost-partner">
    <panel name="mainPanel">
      <field name="lostReason" canEdit="false" colOffset="4" colSpan="4"/>
      <field name="lostReasonStr" hideIf="!lostReason.freeText" colOffset="4" colSpan="4"/>
      <button name="lostReasonConfirmBtn" title="Confirm lost reason"
        onClick="action-partner-lost-reason-check,action-partner-method-confirm-lost-reason"
        colOffset="4" colSpan="4"/>
      <field name="lostReason.freeText" hidden="true"/>
    </panel>
  </form>

  <!-- CREATE CRM OBJECT FROM PARTNER -->

  <action-view name="action-partner-view-schedule-event"
    title="Schedule Event (${ fullName })" model="com.axelor.apps.crm.db.Event">
    <view type="form" name="event-form"/>
    <context name="_partner" expr="eval: __this__"/>
  </action-view>

  <action-view name="action-contact-partner-view-schedule-event"
    title="Schedule Event (${ fullName })" model="com.axelor.apps.crm.db.Event">
    <view type="form" name="event-form"/>
    <context name="_contactPartner" expr="eval: __this__"/>
    <context name="_contactMainPartner" expr="eval: __this__.mainPartner"/>
  </action-view>

  <action-view name="action-partner-view-create-opportunity"
    title="Create opportunity (${ fullName })" model="com.axelor.apps.crm.db.Opportunity">
    <view type="form" name="opportunity-form"/>
    <view-param name="popup" value="reload"/>
    <view-param name="show-toolbar" value="false"/>
    <context name="_partner" expr="eval: __this__"/>
    <context name="_internalUserId" expr="eval: __user__.id"/>
  </action-view>

  <action-view name="action-partner-view-meeting-event"
    title="Meeting Event (${ fullName })" model="com.axelor.apps.crm.db.Event">
    <view type="form" name="event-form"/>
    <view-param name="popup" value="reload"/>
    <view-param name="show-toolbar" value="false"/>
    <context name="_partner" expr="eval: __this__"/>
    <context name="_meeting" expr="eval: true"/>
  </action-view>

  <action-view name="action-partner-view-call-event" title="Call Event (${ fullName })"
    model="com.axelor.apps.crm.db.Event">
    <view type="form" name="event-form"/>
    <view-param name="popup" value="reload"/>
    <view-param name="show-toolbar" value="false"/>
    <context name="_partner" expr="eval: __this__"/>
    <context name="_call" expr="eval: true"/>
  </action-view>

  <action-view name="action-partner-view-task-event" title="Task Event (${ fullName })"
    model="com.axelor.apps.crm.db.Event">
    <view type="form" name="event-form"/>
    <view-param name="popup" value="reload"/>
    <view-param name="show-toolbar" value="false"/>
    <context name="_partner" expr="eval: __this__"/>
    <context name="_task" expr="eval: true"/>
  </action-view>

  <action-view name="action-partner-view-note-event" title="Note Event (${ fullName })"
    model="com.axelor.apps.crm.db.Event">
    <view type="form" name="event-form"/>
    <view-param name="popup" value="reload"/>
    <view-param name="show-toolbar" value="false"/>
    <context name="_partner" expr="eval: __this__"/>
    <context name="_note" expr="eval: true"/>
  </action-view>

  <!-- CREATE SALE OBJECT FROM PARTNER -->

  <action-view name="action-partner-view-create-order"
    title="Create order (${ fullName })" model="com.axelor.apps.sale.db.SaleOrder">
    <view type="form" name="sale-order-form-partner"/>
    <context name="_partner" expr="eval: __this__"/>
  </action-view>

  <!-- CREATE PURCHASE OBJECT FROM PARTNER -->

  <action-view name="action-partner-view-create-purchase-quotation"
    title="Create order (${ fullName })" model="com.axelor.apps.purchase.db.PurchaseOrder">
    <view type="form" name="purchase-order-form"/>
    <context name="_partner" expr="eval: __this__"/>
  </action-view>

  <!-- PORTLET -->

  <action-view name="action-partner-view-all-events" title="Events"
    model="com.axelor.apps.crm.db.Event">
    <view type="cards" name="event-cards"/>
    <view type="grid" name="list-event-grid"/>
    <view type="form" name="event-form"/>
    <domain>self.partner.id = :id</domain>
    <context name="id" expr="eval: id"/>
  </action-view>

  <action-view name="action-contact-view-all-events" title="Events"
    model="com.axelor.apps.crm.db.Event">
    <view type="cards" name="event-cards"/>
    <view type="grid" name="list-event-grid"/>
    <view type="form" name="event-form"/>
    <domain>self.contactPartner.id = :id</domain>
    <context name="id" expr="eval: id"/>
  </action-view>

  <action-view name="action-partner-view-opportunities" title="Opportunities"
    model="com.axelor.apps.crm.db.Opportunity">
    <view type="cards" name="opportunity-cards"/>
    <view type="grid" name="opportunity-dashlet-grid"/>
    <view type="form" name="opportunity-form"/>
    <domain>self.partner.id = :id</domain>
    <context name="id" expr="eval: id"/>
  </action-view>

  <action-view name="action-contact-view-opportunities" title="Opportunities"
    model="com.axelor.apps.crm.db.Opportunity">
    <view type="cards" name="opportunity-cards"/>
    <view type="grid" name="opportunity-dashlet-grid"/>
    <view type="form" name="opportunity-form"/>
    <domain>self.contact.id = :id</domain>
    <context name="id" expr="eval: id"/>
  </action-view>

  <action-view name="action-partner-view-events" title="Events"
    model="com.axelor.apps.crm.db.Event">
    <view type="grid" name="list-event-grid"/>
    <view type="form" name="event-form"/>
    <domain>self.partner.id = :_id</domain>
  </action-view>

  <action-view name="action-contact-view-events" title="Events"
    model="com.axelor.apps.crm.db.Event">
    <view type="grid" name="list-event-grid"/>
    <view type="form" name="event-form"/>
    <domain>self.contactPartner.id = :_id</domain>
  </action-view>

  <action-attrs name="action-partner-attrs-unset-integrator">
    <attribute name="value" for="isIntegrator" expr="eval:false"/>
  </action-attrs>

  <action-method name="action-partner-method-get-subsidiary-partners-count">
    <call class="com.axelor.apps.crm.web.PartnerCrmController"
      method="getSubsidiaryPartnersCount"/>
  </action-method>

  <action-group name="crm-action-group-partner-onload">
    <action name="action-group-partner-onload" if="__config__.app.isApp('base')"/>
    <action name="action-partner-method-get-subsidiary-partners-count"/>
  </action-group>

  <action-group name="action-group-partner-contact-onNew">
    <action name="action-partner-contact-record-default"/>
    <action name="action-partner-attrs-partner-seq-editable"/>
    <action name="action-partner-attrs-set-default"/>
  </action-group>

  <action-record name="action-partner-record-set-is-prospect"
    model="com.axelor.apps.base.db.Partner">
    <field name="isProspect" expr="true"
      if="_isProspect || (__user__?.activeCompany?.defaultPartnerCategorySelect == 1 &amp;&amp; !_isSupplier &amp;&amp; !_isCarrier &amp;&amp; !_isSubcontractor)"/>
  </action-record>

  <action-record name="action-partner-record-set-partner-status"
    model="com.axelor.apps.base.db.Partner">
    <field name="partnerStatus" expr="eval: __repo__(PartnerStatus).getDefaultStatus()"/>
  </action-record>

  <action-group name="crm-action-group-partner-onnew">
    <action name="action-group-base-partner-onnew"/>
    <action name="action-partner-record-set-is-prospect"/>
    <action name="action-partner-record-set-partner-status"/>
  </action-group>

  <action-group name="action-partner-group-partner-status-onchange">
    <action name="save"
      if="eval: __this__?.partnerStatus?.id != __config__.app.getApp('crm')?.closedWinPartnerStatus?.id || __this__?.partnerStatus?.id != __config__.app.getApp('crm')?.closedLostPartnerStatus?.id"/>
    <action name="action-partner-view-partner-popup-view"
      if="eval: __this__?.partnerStatus?.id
      == __config__.app.getApp('crm')?.closedLostPartnerStatus?.id"/>
    <action name="action-partner-record-win"
      if="eval: __this__?.partnerStatus?.id == __config__.app.getApp('crm')?.closedWinPartnerStatus?.id"/>
  </action-group>

  <action-view name="action-partner-view-partner-popup-view"
    model="com.axelor.apps.base.db.Partner" title="Lost reason">
    <view type="form" name="partner-form-lost-popup"/>
    <view-param name="popup" value="reload"/>
    <view-param name="show-toolbar" value="false"/>
    <view-param name="show-confirm" value="false"/>
    <view-param name="popup-save" value="true"/>
    <view-param name="forceEdit" value="true"/>
    <context name="_showRecord" expr="eval: id"/>
  </action-view>

  <action-record name="action-partner-record-win"
    model="com.axelor.apps.base.db.Partner">
    <field name="isCustomer" expr="eval: true"/>
    <field name="isProspect" expr="eval: false"/>
  </action-record>

  <action-condition name="action-partner-lost-reason-check">
    <check error="A lost reason must be selected" field="lostReason"
      if="lostReason == null || lostReason == 0"/>
  </action-condition>

  <action-method name="action-partner-method-confirm-lost-reason">
    <call class="com.axelor.apps.crm.web.PartnerCrmController" method="loseLead"/>
  </action-method>
</object-views>
