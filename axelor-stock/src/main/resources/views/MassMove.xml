<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">

  <grid name="mass-move-grid" title="Mass move" model="com.axelor.apps.stock.db.MassMove"
    onNew="action-mass-move-group-onnew">
    <field name="sequence" readonly="true"/>
    <field name="statusSelect" required="true"/>
    <field name="company" required="true"/>
    <field name="commonFromStockLocation"
      domain="self.company = :company AND self.typeSelect != 3"/>
    <field name="cartStockLocation" domain="self.company = :company AND self.typeSelect != 3"/>
    <field name="commonToStockLocation"
      domain="self.company = :company AND self.typeSelect != 3"/>
  </grid>

  <form name="mass-move-form" title="Mass move" model="com.axelor.apps.stock.db.MassMove"
    width="large" onNew="action-mass-move-group-onnew" onSave="save,action-mass-move-group-onsave">
    <panel name="mainPanel">
      <field name="statusSelect" widget="NavSelect" required="true"/>
      <field name="sequence" readonly="true"/>
      <field name="company" required="true"/>
      <field name="cartStockLocation" required="true"
        domain="self.company = :company AND self.typeSelect != 3"/>
    </panel>
    <panel name="productsToMovePanel">
      <field name="commonFromStockLocation"
        domain="self.company = :company AND self.typeSelect != 3"/>
      <field name="commonToStockLocation"
        domain="self.company = :company AND self.typeSelect != 3"/>
      <button name="fillProductsToMoveFromMvtBtn" title="Fill in products from movement"
        onClick=""/>
      <panel-related name="productsToMoveListPanel" field="productsToMoveList"
        grid-view="mass-move-needs-grid" form-view="mass-move-needs-form" editable="true"
        colSpan="12"/>
      <button name="generatePickedLinesBtn" title="Generate product lines to pick" onClick=""/>
    </panel>
    <panel name="pickedProductsPanel">
      <button name="selectPickedProductsFromStockLocationBtn"
        title="Select products from location" readonlyIf="statusSelect != 1"
        onClick="action-method-stock-mass-move-picked-product"
        help="Permet d'ajouter tous les produits de l'emplacement source commun"/>
      <panel-related name="pickedProductsListPanel" field="pickedProductsList"
        grid-view="picked-products-mass-move-grid" form-view="picked-products-form" editable="true"
        colSpan="12"/>
      <button name="realizePickingBtn" title="Pick all / the rest"
        onClick="save,action-method-stock-mass-move-realize-picking,action-refresh-record,save"
        icon="fa-play"/>
      <button name="cancelPickingBtn" title="Cancel picking"
        onClick="action-method-stock-mass-move-cancel-picking" icon="fa-undo"/>

    </panel>
    <panel name="storedProductsPanel">
      <panel-related name="storedProductsListPanel" field="storedProductsList"
        grid-view="stored-products-mass-move-grid" form-view="stored-products-form" editable="true"
        colSpan="12"/>
      <button name="realizeStorageBtn" title="Store all / the rest"
        onClick="save,action-method-stock-mass-move-realize-storage"/>
      <button name="cancelStorageBtn" title="Cancel storage"
        onClick="save,action-method-stock-mass-move-cancel-storage"/>
    </panel>
  </form>

  <action-group name="action-mass-move-group-onnew">
    <action name="action-mass-move-record-set-company"/>
    <action name="action-mass-move-record-default"/>
  </action-group>

  <action-group name="action-mass-move-group-onsave">
    <action name="action-mass-move-method-get-sequence"/>
  </action-group>

  <action-method name="action-method-stock-mass-move-picked-product">
    <call class="com.axelor.apps.stock.web.MassMoveController"
      method="importProductFromStockLocation"/>
  </action-method>

  <action-method name="action-method-stock-mass-move-realize-picking">
    <call class="com.axelor.apps.stock.web.MassMoveController" method="realizePicking"/>
  </action-method>

  <action-method name="action-method-stock-mass-move-cancel-picking">
    <call class="com.axelor.apps.stock.web.MassMoveController" method="cancelPicking"/>
  </action-method>

  <action-method name="action-method-stock-mass-move-realize-storage">
    <call class="com.axelor.apps.stock.web.MassMoveController" method="realizeStorage"/>
  </action-method>

  <action-method name="action-method-stock-mass-move-cancel-storage">
    <call class="com.axelor.apps.stock.web.MassMoveController" method="cancelStorage"/>
  </action-method>

  <action-record name="action-mass-move-record-set-company"
    model="com.axelor.apps.stock.db.MassMove">
    <field name="company" expr="eval:__user__.activeCompany"
      if="__user__.activeCompany != null"/>
    <field name="company" expr="eval:__repo__(Company).all().fetchOne()"
      if="__user__.activeCompany == null &amp;&amp; __repo__(Company).all().count() == 1"/>
  </action-record>

  <action-record name="action-mass-move-record-default"
    model="com.axelor.apps.stock.db.MassMove">
    <field name="cartStockLocation" expr="eval: company.stockConfig?.cartStockLocation"
      if="company.stockConfig.isMassMoveManaged"/>
  </action-record>

  <action-method name="action-mass-move-method-get-sequence">
    <call class="com.axelor.apps.stock.web.MassMoveController" method="getSequence"/>
  </action-method>

</object-views>
