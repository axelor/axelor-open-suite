<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_6.1.xsd">

  <grid name="product-reservation-grid" title="Product reservation"
    model="com.axelor.apps.supplychain.db.ProductReservation" orderBy="product.code"
    canDelete="false">
    <toolbar>
      <button name="cancelBtn" title="Cancel"
        onClick="action-product-reservation-method-cancel" showIf="id" icon="fa-times"/>
      <button name="realiseBtn" title="Realise"
        onClick="action-product-reservation-method-realise" showIf="id" icon="fa-play"/>
    </toolbar>
    <field name="productReservationTypeSelect"/>
    <field name="product"/>
    <field name="qty"/>
    <field name="reservationTypeSelect"/>
    <field name="priorityReservationDateTime"/>
    <field name="stockLocation"/>
    <field name="trackingNumber"/>
    <field name="originSaleOrderLine"/>
    <field name="status"/>
  </grid>

  <grid name="product-reservation-editable-grid" title="Product reservation"
    model="com.axelor.apps.supplychain.db.ProductReservation" canDelete="false"
    groupBy="productReservationTypeSelect" editable="true"
    onNew="product-reservation-editable-grid-record-on-new">
    <field name="productReservationTypeSelect" required="true" selection-in="[1,2]"/>
    <field name="product" readonly="true"/>
    <field name="qty" required="true" title="Quantity"
      readonlyIf="!productReservationTypeSelect" validIf="qty &gt; 0"/>
    <field name="reservationTypeSelect" readonly="true"/>
    <field name="stockLocation"
      readonlyIf="!productReservationTypeSelect || productReservationTypeSelect == 1"
      requiredIf="productReservationTypeSelect == 2"/>
    <field name="trackingNumber"
      readonlyIf="!productReservationTypeSelect || productReservationTypeSelect == 1"
      requiredIf="productReservationTypeSelect == 2 &amp;&amp; product.trackingNumberConfiguration"/>
    <field name="$availableQty" title="Available Qty." type="decimal" readonly="true"/>
    <field name="status" readonly="true"/>
    <field name="product.trackingNumberConfiguration" hidden="true"/>
  </grid>

  <grid name="product-reservation-selection-grid" title="Product reservation"
    model="com.axelor.apps.supplychain.db.ProductReservation" canDelete="false" editable="true">
    <field name="qty" title="Available qty" readonly="true"/>
    <field name="originSaleOrderLine" readonly="true"/>
    <field name="originStockMoveLine" readonly="true"/>
    <field name="selectQty" title="Selected qty" type="decimal" min="0"/>
  </grid>

  <form name="product-reservation-form" title="Reservations / allocations" canDelete="false"
    model="com.axelor.apps.supplychain.db.ProductReservation" width="large">
    <toolbar>
      <button name="cancelBtn" title="Cancel"
        onClick="action-product-reservation-method-cancel" showIf="id" icon="fa-times"/>
      <button name="realiseBtn" title="Realise"
        onClick="action-product-reservation-method-realise" showIf="id" icon="fa-play"/>
    </toolbar>
    <panel name="mainPanel" itemSpan="12" readonlyIf="status &gt;= 1">
      <panel name="general">
        <field name="productReservationTypeSelect" required="true"/>
        <field name="status" readonly="true"/>
        <field name="product" showIf="productReservationTypeSelect" required="true"
          domain="self.productTypeSelect = 'storable' AND self.dtype = 'Product' AND self.stockManaged = true"/>
        <field name="qty" showIf="productReservationTypeSelect" required="true"
          validIf="qty &gt; 0"/>
        <field name="description" colSpan="12" showIf="productReservationTypeSelect"
          widget="html" large="true"/>
      </panel>
      <panel name="reservation" showIf="productReservationTypeSelect == 1 &amp;&amp; product">
        <field name="priorityReservationDateTime" colSpan="6"
          requiredIf="productReservationTypeSelect == 1" widget="date-time"/>
        <field name="reservationTypeSelect" colSpan="6"
          requiredIf="productReservationTypeSelect == 1"/>
      </panel>
      <panel name="allocation" showIf="productReservationTypeSelect == 2 &amp;&amp; product">
        <field name="stockLocation" requiredIf="productReservationTypeSelect == 2"/>
        <field name="trackingNumber" title="Tracking number"
          showIf="product.trackingNumberConfiguration != null"
          requiredIf="product.trackingNumberConfiguration != null"/>
        <field name="product.trackingNumberConfiguration" hidden="true"/>
      </panel>
      <panel name="origin" showIf="product">
        <field name="originSaleOrderLine" required="true" domain="self.product.id = :product"/>
      </panel>
    </panel>
  </form>

  <action-method name="action-product-reservation-method-cancel">
    <call class="com.axelor.apps.supplychain.web.ProductReservationController"
      method="cancelReservation"/>
  </action-method>

  <action-method name="action-product-reservation-method-realise">
    <call class="com.axelor.apps.supplychain.web.ProductReservationController"
      method="realiseReservation"/>
  </action-method>

  <action-record name="product-reservation-editable-grid-record-on-new"
    model="com.axelor.apps.supplychain.db.ProductReservation">
    <field name="reservationTypeSelect" expr="eval: 1"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.sale.db.SaleOrderLine'"/>
    <field name="product" expr="eval: __parent__?.product"/>
  </action-record>

</object-views>
