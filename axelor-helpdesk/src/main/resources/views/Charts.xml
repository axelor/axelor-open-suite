<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">
	  
	<chart name="chart.ticket.no.of.solved.my.ticket" title="My tickets" onInit="action.ticket.chart.set.date.1m">
	  	<search-fields>
	    	<field name="fromDate" title="From Date" type="date" x-required="true"/>
	    	<field name="toDate" title="To Date" type="date" x-required="true"/>
	  	</search-fields>
	  	<dataset type="sql">
			SELECT 
				COUNT(*) AS total_row, 
				'ALL' as _status
			FROM 
				helpdesk_ticket
			WHERE
				DATE(created_on) BETWEEN DATE(:fromDate) AND DATE(:toDate)
				AND assigned_to = :_user_id 
       		UNION ALL
      		SELECT 
      			COUNT(*) AS total_row, 
      			'Resolved' as _status
      		FROM 
      			helpdesk_ticket 
      		WHERE 
      			DATE(created_on) BETWEEN DATE(:fromDate) AND DATE(:toDate)
      			AND assigned_to = :_user_id
      			AND status_select = 2 
		</dataset>
  	<category key="_status" type="text" title="Status"/>
	<series key="total_row" type="bar" groupBy="_status" title="Tickets"/>
	</chart>
	
	<chart name="chart.ticket.no.of.solved.my.team.ticket" title="My team tickets" onInit="action.ticket.chart.set.date.1m">
		<search-fields>
		    <field name="fromDate" title="From Date" type="date" x-required="true"/>
		    <field name="toDate" title="To Date" type="date" x-required="true"/>
		</search-fields>
  		<dataset type="sql">
			SELECT 
				COUNT(*) AS total_row, 
				'ALL' as _status
			FROM 
				helpdesk_ticket AS self
			JOIN
				auth_user AS _user
			ON
				_user.id = :_user_id
			JOIN
				team_team AS _team
			ON
				_user.active_team = _team.id
			WHERE
				DATE(self.created_on) BETWEEN DATE(:fromDate) AND DATE(:toDate)
				AND _team.id = :_myActiveTeam
     		UNION ALL
    		SELECT 
    			COUNT(*) AS total_row, 
    			'Resolved' as _status
    		FROM 
    			helpdesk_ticket AS _ticket
    		JOIN
				auth_user AS _user
			ON
				_user.id = :_user_id
			JOIN
				team_team AS _team
			ON
				_user.active_team = _team.id
    		WHERE 
    			DATE(_ticket.created_on) BETWEEN DATE(:fromDate) AND DATE(:toDate)
    			AND _team.id = :_myActiveTeam
    			AND _ticket.status_select = 2
		</dataset>
		<category key="_status" type="text" title="Status"/>
		<series key="total_row" groupBy="_status" type="bar" title="Tickets"/>
	</chart>

	
	<chart onInit="action.ticket.chart.set.date.1m" name="chart.ticket.no.of.solved.all.ticket" title="All ticktes">
		<search-fields>
			<field type="date" name="fromDate" title="From Date" x-required="true" />
			<field type="date" name="toDate" title="To Date" x-required="true" />
		</search-fields>
		<dataset type="sql">
			SELECT 
				COUNT(*) AS total_row, 
				'ALL' as _status 
			FROM 
				helpdesk_ticket
			WHERE
				DATE(created_on) BETWEEN DATE(:fromDate) AND DATE(:toDate)
       		UNION ALL
      		SELECT 
      			COUNT(*) AS total_row, 
      			'Resolved' as _status
      		FROM 
      			helpdesk_ticket 
      		WHERE 
      			DATE(created_on) BETWEEN DATE(:fromDate) AND DATE(:toDate)
      			AND status_select = 2 
		</dataset>
		<category key="_status" type="text" title="Status"/>
		<series key="total_row" type="bar" groupBy="_status" title="Tickets"/>
	</chart>
	
	<action-record model="com.axelor.apps.helpdesk.db.Ticket" name="action.ticket.chart.set.date.1m">
	  <field name="toDate" expr="eval:__date__" />
	  <field name="fromDate" expr="eval:__date__.minusMonths(1)" />	  
	</action-record>
	
</object-views>
