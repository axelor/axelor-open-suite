{"version":3,"sources":["services/Service.js","BAML/main/moddle/index.js","BAML/main/moddle-xml/index.js","BAML/main/baml-moddle/index.js","BAML/main/baml-js/lib/import/Util.js","BAML/main/baml-js/lib/import/BpmnTreeWalker.js","BAML/main/baml-js/lib/BaseViewer.js","BAML/main/baml-js/lib/import/Importer.js","BAML/main/baml-js/lib/BaseModeler.js","BAML/main/baml-js/lib/util/ModelUtil.js","BAML/main/baml-js/lib/util/DiUtil.js","BAML/main/baml-js/lib/features/label-editing/LabelUtil.js","BAML/main/baml-js/lib/draw/BpmnRenderUtil.js","BAML/main/baml-js/lib/draw/BpmnRenderer.js","BAML/main/baml-js/lib/draw/TextRenderer.js","BAML/main/baml-js/lib/draw/PathMap.js","BAML/main/baml-js/lib/draw/index.js","BAML/main/baml-js/lib/util/LabelUtil.js","BAML/main/baml-js/lib/import/BpmnImporter.js","BAML/main/baml-js/lib/import/index.js","BAML/main/baml-js/lib/core/index.js","BAML/main/baml-js/lib/Viewer.js","BAML/main/baml-js/lib/NavigatedViewer.js","BAML/main/baml-js/lib/features/modeling/util/ModelingUtil.js","BAML/main/baml-js/lib/features/auto-place/AutoPlaceUtil.js","BAML/main/baml-js/lib/features/auto-place/AutoPlace.js","BAML/main/baml-js/lib/features/auto-place/AutoPlaceSelectionBehavior.js","BAML/main/baml-js/lib/features/auto-place/index.js","BAML/main/baml-js/lib/features/auto-resize/BpmnAutoResize.js","BAML/main/baml-js/lib/features/auto-resize/BpmnAutoResizeProvider.js","BAML/main/baml-js/lib/features/auto-resize/index.js","BAML/main/baml-js/lib/features/copy-paste/BpmnCopyPaste.js","BAML/main/baml-js/lib/features/copy-paste/ModdleCopy.js","BAML/main/baml-js/lib/features/copy-paste/index.js","BAML/main/baml-js/lib/features/replace/BpmnReplace.js","BAML/main/baml-js/lib/features/replace/index.js","BAML/main/baml-js/lib/features/popup-menu/util/TypeUtil.js","BAML/main/baml-js/lib/features/replace/ReplaceOptions.js","BAML/main/baml-js/lib/features/popup-menu/ReplaceMenuProvider.js","BAML/main/baml-js/lib/features/popup-menu/index.js","BAML/main/baml-js/lib/features/modeling/util/LaneUtil.js","BAML/main/baml-js/lib/features/context-pad/ContextPadProvider.js","BAML/main/baml-js/lib/features/context-pad/index.js","BAML/main/baml-js/lib/features/distribute-elements/BpmnDistributeElements.js","BAML/main/baml-js/lib/features/distribute-elements/index.js","BAML/main/baml-js/lib/features/editor-actions/BpmnEditorActions.js","BAML/main/baml-js/lib/features/editor-actions/index.js","BAML/main/baml-js/lib/features/grid-snapping/BpmnGridSnapping.js","BAML/main/baml-js/lib/features/grid-snapping/behavior/AutoPlaceBehavior.js","BAML/main/baml-js/lib/features/grid-snapping/behavior/CreateParticipantBehavior.js","BAML/main/baml-js/lib/features/grid-snapping/behavior/LayoutConnectionBehavior.js","BAML/main/baml-js/lib/features/grid-snapping/behavior/index.js","BAML/main/baml-js/lib/features/grid-snapping/index.js","BAML/main/baml-js/lib/features/interaction-events/BpmnInteractionEvents.js","BAML/main/baml-js/lib/features/interaction-events/index.js","BAML/main/baml-js/lib/features/keyboard/BpmnKeyboardBindings.js","BAML/main/baml-js/lib/features/keyboard/index.js","BAML/main/baml-js/lib/features/modeling/behavior/util/CategoryUtil.js","BAML/main/baml-js/lib/features/label-editing/LabelEditingProvider.js","BAML/main/baml-js/lib/features/label-editing/LabelEditingPreview.js","BAML/main/baml-js/lib/features/label-editing/index.js","BAML/main/baml-js/lib/features/modeling/behavior/AdaptiveLabelPositioningBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/AppendBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/AssociationBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/AttachEventBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/BoundaryEventBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/RootElementReferenceBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/CreateBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/FixHoverBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/CreateDataObjectBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/CreateParticipantBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/DataInputAssociationBehavior.js","BAML/main/baml-js/lib/features/modeling/cmd/UpdateSemanticParentHandler.js","BAML/main/baml-js/lib/features/modeling/behavior/DataStoreBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/DeleteLaneBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/DetachEventBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/DropOnFlowBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/EventBasedGatewayBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/GroupBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/util/LineIntersect.js","BAML/main/baml-js/lib/features/modeling/behavior/ImportDockingFix.js","BAML/main/baml-js/lib/features/modeling/behavior/IsHorizontalFix.js","BAML/main/baml-js/lib/features/modeling/behavior/util/GeometricUtil.js","BAML/main/baml-js/lib/features/modeling/behavior/util/LineAttachmentUtil.js","BAML/main/baml-js/lib/features/modeling/behavior/util/LabelLayoutUtil.js","BAML/main/baml-js/lib/features/modeling/behavior/LabelBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/ModelingFeedback.js","BAML/main/baml-js/lib/features/modeling/behavior/ReplaceConnectionBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/RemoveParticipantBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/ReplaceElementBehaviour.js","BAML/main/baml-js/lib/features/modeling/behavior/util/ResizeUtil.js","BAML/main/baml-js/lib/features/modeling/behavior/ResizeBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/ResizeLaneBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/RemoveElementBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/SpaceToolBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/SubProcessStartEventBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/ToggleElementCollapseBehaviour.js","BAML/main/baml-js/lib/features/modeling/behavior/UnclaimIdBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/UpdateFlowNodeRefsBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/UnsetDefaultFlowBehavior.js","BAML/main/baml-js/lib/features/modeling/behavior/index.js","BAML/main/baml-js/lib/features/snapping/BpmnSnappingUtil.js","BAML/main/baml-js/lib/features/rules/BpmnRules.js","BAML/main/baml-js/lib/features/rules/index.js","BAML/main/baml-js/lib/features/di-ordering/BpmnDiOrdering.js","BAML/main/baml-js/lib/features/di-ordering/index.js","BAML/main/baml-js/lib/features/ordering/BpmnOrderingProvider.js","BAML/main/baml-js/lib/features/ordering/index.js","BAML/main/baml-js/lib/features/modeling/BpmnFactory.js","BAML/main/baml-js/lib/features/modeling/BpmnUpdater.js","BAML/main/baml-js/lib/features/modeling/ElementFactory.js","BAML/main/baml-js/lib/features/modeling/cmd/UpdatePropertiesHandler.js","BAML/main/baml-js/lib/features/modeling/cmd/UpdateCanvasRootHandler.js","BAML/main/baml-js/lib/features/modeling/cmd/AddLaneHandler.js","BAML/main/baml-js/lib/features/modeling/cmd/SplitLaneHandler.js","BAML/main/baml-js/lib/features/modeling/cmd/ResizeLaneHandler.js","BAML/main/baml-js/lib/features/modeling/cmd/UpdateFlowNodeRefsHandler.js","BAML/main/baml-js/lib/features/modeling/cmd/IdClaimHandler.js","BAML/main/baml-js/lib/features/modeling/cmd/SetColorHandler.js","BAML/main/baml-js/lib/features/label-editing/cmd/UpdateLabelHandler.js","BAML/main/baml-js/lib/features/modeling/Modeling.js","BAML/main/baml-js/lib/features/modeling/BpmnLayouter.js","BAML/main/baml-js/lib/features/modeling/index.js","BAML/main/baml-js/lib/features/palette/PaletteProvider.js","BAML/main/baml-js/lib/features/palette/index.js","BAML/main/baml-js/lib/features/replace-preview/BpmnReplacePreview.js","BAML/main/baml-js/lib/features/replace-preview/index.js","BAML/main/baml-js/lib/features/snapping/BpmnConnectSnapping.js","BAML/main/baml-js/lib/features/snapping/BpmnCreateMoveSnapping.js","BAML/main/baml-js/lib/features/snapping/index.js","BAML/main/baml-js/lib/features/search/BpmnSearchProvider.js","BAML/main/baml-js/lib/features/search/index.js","BAML/main/baml-js/lib/Modeler.js","BAML/custom/CustomPalette.js","BAML/custom/CustomContextPadProvider.js","BAML/custom/CustomRules.js","BAML/custom/index.js","BAML/mapper-builder/constant.js","BAML/mapper-builder/generator.js","BAML/mapper-builder/services/api.js","BAML/mapper-builder/utils.js","BAML/mapper-builder/components/Selection.js","BAML/mapper-builder/components/FieldPopover.js","BAML/mapper-builder/components/ModelFieldComponent.js","BAML/mapper-builder/components/TextInput.js","BAML/mapper-builder/components/NumberInput.js","BAML/mapper-builder/components/DateTimePicker.js","BAML/mapper-builder/components/Select.js","BAML/mapper-builder/components/DndView.js","BAML/mapper-builder/components/MultiSelector.js","BAML/mapper-builder/DataTable.js","BAML/mapper-builder/store/context.js","BAML/mapper-builder/Builder.js","BAML/mapper-builder/App.js","utils.js","BAML/components/Description.js","BAML/components/Textbox.js","BAML/components/TextField.js","BAML/components/SelectBox.js","BAML/components/Checkbox.js","BAML/components/Select.js","BAML/components/ExtensionElementTable.js","BAML/expression-builder/components/select.js","BAML/expression-builder/components/input.js","BAML/expression-builder/components/button.js","BAML/expression-builder/components/number.js","BAML/expression-builder/extra/data.js","BAML/expression-builder/components/datetime-picker.js","BAML/expression-builder/extra/util.js","BAML/expression-builder/components/auto-complete.js","services/api.js","BAML/components/FieldEditor.js","BAML/views/ScriptBox.js","BAML/expression-builder/services/axelor.rest.js","BAML/expression-builder/services/api.js","BAML/expression-builder/field-editor.js","BAML/expression-builder/editor.js","BAML/expression-builder/expression-builder.js","BAML/expression-builder/index.js","BAML/views/ExtendedQueryProps.js","BAML/views/Builder.js","BAML/views/FieldBuilder.js","BAML/ModelUtil.js","BAML/views/ParameterProps.js","BAML/tabProperty.js","BAML/index.js","App.js","index.js"],"names":["lastCookieString","lastCookies","headers","Headers","append","name","cookieString","document","cookie","split","reduce","obj","value","parts","readCookie","this","baseURL","url","method","options","fetch","then","data","indexOf","toLowerCase","get","includes","json","catch","err","config","Object","assign","credentials","mode","body","JSON","stringify","request","entity","record","post","id","offset","Base","Factory","model","properties","prototype","$model","set","createType","descriptor","props","create","forEach","p","isMany","undefined","default","defineModel","defineDescriptor","ns","ModdleElement","attrs","define","enumerable","writable","bind","val","key","hasType","$instanceOf","BUILTINS","String","Boolean","Integer","Real","Element","TYPE_CONVERTERS","s","parseInt","parseFloat","coerceType","type","converter","isBuiltIn","isSimple","parseName","defaultPrefix","localName","prefix","length","Error","DescriptorBuilder","nameNs","allTypes","allTypesByName","propertiesByName","Registry","packages","packageMap","typeMap","registerPackage","ensureAvailable","pkg","identifierKey","Properties","defineProperty","target","property","isReference","configurable","Moddle","factory","registry","typeCache","build","pick","addProperty","idx","validate","addNamedProperty","splice","push","replaceProperty","oldProperty","newProperty","replace","oldNameNs","rename","isId","setIdProperty","isBody","setBodyProperty","redefineProperty","targetPropertyName","nsPrefix","attrName","redefinedProperty","redefines","propsByName","assertNotDefined","removeNamedProperty","bodyProperty","idProperty","propertyName","definedProperty","definedBy","hasProperty","addTrait","t","inherited","typesByName","types","typeName","replaces","getPackage","uriOrPrefix","getPackages","pkgMap","registerType","uri","superClass","slice","extends","meta","propertyNs","extendsName","extended","traits","definePackage","mapTypes","nsName","iterator","trait","self","traverseTrait","cls","traverseSuper","parentNs","getEffectiveDescriptor","builder","$pkg","getPropertyDescriptor","$attrs","Type","getType","cache","isString","createAny","nsUri","element","$type","isGeneric","a","isObject","getElementDescriptor","$descriptor","getTypeDescriptor","hasLowerCaseAlias","xml","tagAlias","DEFAULT_NS_MAP","xsi","XSI_TYPE","serializeFormat","serialize","serializeAsType","aliasToName","aliasNs","str","charAt","toUpperCase","error","message","getModdleDescriptor","Context","elementsById","references","warnings","addReference","reference","addElement","test","addWarning","warning","BaseHandler","NoopHandler","BodyHandler","ReferenceHandler","context","ValueHandler","propertyDesc","BaseElementHandler","ElementHandler","RootElementHandler","call","GenericElementHandler","Reader","lax","handleEnd","handleText","handleNode","text","node","createReference","parser","handleChild","createElement","propNameNs","attributes","instance","values","prop","v","parseNameNS","getPropertyForNode","elementTypeName","elementType","isAttr","typePrefix","prefixedToName","normalizeXsiTypeName","effectiveType","find","isVirtual","isAttribute","toString","valueHandler","referenceHandler","handler","childHandler","isSimpleType","newElement","$parent","originalName","$children","$body","fromXML","done","rootHandler","Parser","proxy","stack","createStack","handleError","getContext","ctx","line","column","handleWarning","PREAMBLE_START_PATTERN","ENCODING_PATTERN","UTF_8_PATTERN","handleCData","peek","uriMap","on","decodeStr","selfClosing","decodedAttrs","keys","d","handleOpen","question","match","exec","encoding","pop","decodeEntities","trim","setTimeout","parse","i","r","collection","resolveReferences","e","ESCAPE_ATTR_CHARS","ESCAPE_CHARS","Namespaces","parent","prefixMap","used","wellknown","custom","byUri","add","isWellknown","mapPrefix","uriByPrefix","logUsed","getUsed","concat","filter","nameToAlias","string","inherits","ctor","superCtor","super_","constructor","ESCAPE_ATTR_MAP","ESCAPE_MAP","escape","charPattern","replaceMap","ReferenceSerializer","tagName","BodySerializer","ValueSerializer","ElementSerializer","propertyDescriptor","TypeSerializer","SavingWriter","write","FormatingWriter","out","format","indent","appendNewLine","appendIndent","join","unindent","Writer","preamble","toXML","tree","writer","internalWriter","formatingWriter","serializeTo","BpmnModdle","serializeValue","search","otherAttrs","elementDescriptor","parseGeneric","parseNsAttributes","nsPropertyTagName","nsTagName","addTagName","hasOwnProperty","getSerializableProperties","parseAttributes","parseContainments","filterContained","parseGenericAttributes","getElementNs","logNamespaceUsed","getPropertyNs","isLocalNs","nsAttributeName","effectiveNs","getNamespaces","child","parseNsAttribute","logNamespace","actualNs","genericAttrs","nonNsAttr","attr","addAttribute","console","warn","asType","asProperty","serializeAsProperty","serializer","local","parentNamespaces","namespaces","newPrefix","wellknownUri","serializeAttributes","map","getNsAttrs","firstBody","b","typeNs","xmlStr","isFunction","reader","result","bpmn","associations","isAbstract","allowedIn","enumerations","literalValues","bpmndi","dc","di","isReadOnly","isUnique","subsettedProperty","bioc","simple","additionalPackages","elementToString","diRefs","Refs","is","BpmnTreeWalker","translate","handledElements","deferred","contextual","fn","handled","visitIfDi","gfx","visit","logError","registerDi","bpmnElement","handleDiagram","diagram","plane","planeElement","handlePlaneElement","handleDeferred","shift","handleProcess","process","handleFlowElementsContainer","handleIoSpecification","ioSpecification","handleArtifacts","artifacts","handleMessageFlow","messageFlow","handleDataAssociation","association","handleDataInput","dataInput","handleDataOutput","dataOutput","handleArtifact","artifact","dataInputs","dataOutputs","handleLoop","loop","handleFlowNode","flowNode","childCtx","dataInputAssociations","dataOutputAssociations","handleDataElement","dataObject","handleLane","lane","newContext","childLaneSet","handleLaneSet","flowNodeRef","lanes","wireFlowNodeRefs","laneSet","container","flowElements","sequenceFlow","handleSequenceFlow","unshift","businessObject","handleFlowElements","laneSets","handleLaneSets","handleParticipant","participant","newCtx","processRef","handleDefinitions","definitions","diagrams","rootElement","rootElements","findDisplayCandidate","collaboration","root","visitRoot","participants","messageFlows","handleUnhandledProcesses","BaseViewer","DEFAULT_OPTIONS","_moddle","_createModdle","_container","_createContainer","_init","Diagram","importXML","bpmnDiagram","_emit","parseWarnings","checkValidationError","importDefinitions","importWarnings","allWarnings","_setDefinitions","open","bpmnDiagramOrId","_definitions","diagramId","findBPMNDiagram","clear","importer","eventBus","fire","parentShape","render","importBpmnDiagram","saveXML","saveSVG","svg","canvas","contentNode","getDefaultLayer","defsNode","domQuery","_svg","contents","innerSVG","defs","bbox","getBBox","width","height","x","y","getModules","_modules","getDefinitions","bo","destroy","domRemove","event","priority","callback","off","attachTo","parentNode","detach","jquery","appendChild","resized","removeChild","moddle","baseModules","modules","additionalModules","diagramModules","bpmnjs","diagramOptions","omit","domify","style","ensureUnit","position","moddleOptions","_moddleExtensions","moddleExtensions","isNumber","BaseModeler","_collectIds","ids","Ids","claim","getBusinessObject","isExpanded","isEventLoop","triggeredByEvent","hasEventDefinition","eventType","eventDefinitions","getLabelAttr","semantic","getLabel","categoryValueRef","getCategoryValue","isTypedEvent","eventDefinitionType","some","definition","every","matches","getDi","getSemantic","getFillColor","defaultColor","getStrokeColor","RENDERER_IDS","DEFAULT_FILL_OPACITY","BpmnRenderer","styles","pathMap","textRenderer","BaseRenderer","defaultFillColor","defaultStrokeColor","rendererId","next","markers","computeStyle","addMarker","fill","strokeWidth","strokeLinecap","strokeDasharray","ref","scale","marker","svgCreate","svgAttr","svgAppend","viewBox","refX","refY","markerWidth","markerHeight","orient","colorEscape","stroke","sequenceflowEnd","messageflowStart","cx","cy","messageflowEnd","associationStart","associationEnd","conditionalflowMarker","conditionaldefaultflowMarker","createMarker","drawCircle","parentGfx","fillOpacity","circle","Math","round","drawRect","rect","rx","ry","drawLine","waypoints","createLine","drawPath","path","drawMarker","as","handlers","renderer","renderEventContent","isThrowing","isThrowEvent","parallelMultiple","renderLabel","label","size","createText","svgClasses","renderEmbeddedLabel","align","box","padding","renderLaneLabel","textBox","top","transform","createPathFromConnection","connection","pathData","isInterrupting","getScaledPath","xScaleFactor","yScaleFactor","containerWidth","containerHeight","mx","my","linePathData","rotate","outer","attachTaskMarkers","task","abspos","instantiate","businessHeaderPath","businessPath","innerAttrs","TASK_BORDER_RADIUS","participantMultiplicity","diamond","isMarkerVisible","eventGatewayType","parallelPath","innerCircle","drawEvent","x_2","y_2","pointsString","point","polygon","points","drawDiamond","source","strokeLinejoin","markerEnd","conditionExpression","markerStart","associationDirection","messageRef","midPoint","getPointAtLength","getTotalLength","markerPathData","messageAttrs","messageVisibleKind","elementObject","dataObjectRef","isCollection","yPosition","renderDataItemCollection","arrowPathData","getRawPath","cancel","cancelActivity","outerAttrs","pointerEvents","fitBox","getExternalStyle","renderExternalLabel","textElement","ParticipantMultiplicityMarker","SubProcessMarker","markerRect","ConditionalMarker","LoopProcessMarker","strokeMiterlimit","ParallelMarker","parallel","SequentialMarker","seq","CompensationMarker","compensation","LoopMarker","AdhocMarker","adhoc","taskMarkers","isForCompensation","loopCharacteristics","isSequential","_drawPath","$inject","canRender","drawShape","h","drawConnection","getShapePath","shape","radius","circlePath","componentsToPath","getCirclePath","borderRadius","roundRectPath","getRoundRectPath","halfWidth","halfHeight","diamondPath","getDiamondPath","rectPath","getRectPath","TextRenderer","defaultStyle","fontFamily","fontSize","fontWeight","lineHeight","externalStyle","textUtil","TextUtil","getExternalLabelBounds","bounds","layoutedDimensions","getDimensions","ceil","getTextAnnotationBounds","max","getDefaultStyle","tokenRegex","objNotationRegex","__init__","bpmnRenderer","EVENT_MESSAGE","heightElements","widthElements","EVENT_SIGNAL","EVENT_ESCALATION","EVENT_CONDITIONAL","EVENT_LINK","EVENT_ERROR","EVENT_CANCEL_45","EVENT_COMPENSATION","EVENT_TIMER_WH","EVENT_TIMER_LINE","EVENT_MULTIPLE","EVENT_PARALLEL_MULTIPLE","GATEWAY_EXCLUSIVE","GATEWAY_PARALLEL","GATEWAY_EVENT_BASED","GATEWAY_COMPLEX","DATA_OBJECT_PATH","DATA_OBJECT_COLLECTION_PATH","DATA_ARROW","DATA_STORE","TEXT_ANNOTATION","MARKER_SUB_PROCESS","MARKER_CONDITIONAL","MARKER_PARALLEL","MARKER_SEQUENTIAL","MARKER_COMPENSATION","MARKER_LOOP","MARKER_ADHOC","TASK_TYPE_SEND","TASK_TYPE_SCRIPT","TASK_TYPE_USER_1","TASK_TYPE_USER_2","TASK_TYPE_USER_3","TASK_TYPE_MANUAL","TASK_TYPE_INSTANTIATING_SEND","TASK_TYPE_SERVICE","TASK_TYPE_SERVICE_FILL","TASK_TYPE_BUSINESS_RULE_HEADER","TASK_TYPE_BUSINESS_RULE_MAIN","MESSAGE_FLOW_MARKER","pathId","param","rawPath","coordinates","heightRatio","widthRatio","heightIndex","widthIndex","all","res","quote","quotedName","isFunc","replacer","DEFAULT_LABEL_SIZE","isLabelExternal","hasExternalLabel","isLabel","getFlowLabelPosition","mid","first","floor","second","getWaypointsMid","angle","atan","abs","PI","getExternalLabelMid","labelTarget","elementData","getWaypoints","waypoint","getMid","notYetDrawn","refSemantic","referenced","BpmnImporter","elementFactory","elementRegistry","_eventBus","_canvas","_elementFactory","_elementRegistry","_translate","_textRenderer","parentElement","hidden","parentIndex","createRoot","setRootElement","collapsed","isFrame","isFrameElement","createShape","_attachBoundary","isPointInsideBBox","getRootElement","addShape","_getSource","_getTarget","createConnection","addConnection","addLabel","boundarySemantic","boundaryElement","hostSemantic","attachedToRef","host","attachers","createLabel","_getEnd","side","_getElement","__depends__","DrawModule","bpmnImporter","Viewer","CoreModule","TranslateModule","SelectionModule","OverlaysModule","NavigatedViewer","_navigationModules","KeyboardMoveModule","MoveCanvasModule","ZoomScrollModule","isAny","getParent","anyType","getNewShapePosition","sourceTrbl","asTRBL","right","deconflictPosition","margin","rowSize","getTextAnnotationPosition","bottom","getDataElementPosition","sourceMid","horizontalDistance","c","toTargetNode","weight","distanceTo","left","toSourceNode","shapeTrbl","nodes","getTargets","getSources","distancesGrouped","currentDistance","currentDistanceCount","currentDistanceEntry","fav","count","getFlowNodeDistance","orientation","getOrientation","getVerticalDistance","getFlowNodePosition","getDefaultPosition","getConnectedAtPosition","closure","allConnected","getConnected","shapes","attacher","getAutoPlaceClosure","escapeDelta","nextPosition","existingElement","newPosition","axis","axisDelta","dimension","min","existingTarget","noneFilter","connectionFilter","incoming","outgoing","AutoPlace","modeling","emit","payload","newShape","appendShape","AutoPlaceSelectionBehavior","selection","select","autoPlace","autoPlaceSelectionBehavior","BpmnAutoResize","injector","invoke","AutoResize","resize","newBounds","hints","_modeling","resizeLane","resizeShape","BpmnAutoResizeProvider","AutoResizeProvider","canResize","elements","bpmnAutoResize","bpmnAutoResizeProvider","copyProperties","isArray","isUndefined","BpmnCopyPaste","bpmnFactory","moddleCopy","oldBusinessObject","bpmnProcess","copyElement","newBusinessObject","array","DISALLOWED_PROPERTIES","ModdleCopy","_bpmnFactory","propertyNames","sortBy","parentDescriptor","matchPattern","getPropertyNames","keepDefaultProperties","sourceElement","targetElement","canCopyProperties","sourceProperty","has","copiedProperty","copyProperty","isDefined","childProperties","childProperty","CopyPasteModule","bpmnCopyPaste","CUSTOM_PROPERTIES","BpmnReplace","replaceElement","isLoop","oldCollapsed","toggeling","toggleCollapse","a2","elementProps","newElementProps","copyProps","el","moveChildren","_getDefaultSize","ReplaceModule","bpmnReplace","isDifferentType","entry","eventDefinition","isTypeEqual","isEventDefinitionEqual","isTriggeredByEventEqual","isExpandedEqual","START_EVENT","actionName","className","INTERMEDIATE_EVENT","END_EVENT","GATEWAY","LOOP_EXPANDED","TRANSACTION","EVENT_SUB_PROCESS","TASK","BOUNDARY_EVENT","EVENT_SUB_PROCESS_START_EVENT","SEQUENCE_FLOW","PARTICIPANT","ReplaceMenuProvider","popupMenu","rules","_popupMenu","_bpmnReplace","_rules","register","registerProvider","getEntries","entries","allowed","differentType","replaceOptions","_createEntries","isInterruptingEqual","isCancelActivityEqual","isTargetLoop","isTargetExpanded","_createSequenceFlowEntries","getHeaderEntries","headerEntries","_getLoopEntries","_getAdHocEntry","menuEntries","_createMenuEntry","sourceRef","updateProperties","action","toggleLoopEntry","active","isParallel","title","isAdHoc","autoResize","layoutConnection","PopupMenuModule","replaceMenuProvider","LANE_PARENTS","LANE_INDENTATION","collectLanes","collectedShapes","children","getChildLanes","getLanesRoot","computeLanesResize","allLanes","shapeNewTrbl","trblResize","oldBounds","substractTRBL","getTRBLResize","resizeNeeded","other","topResize","rightResize","bottomResize","leftResize","otherTrbl","resizeTRBL","ContextPadProvider","contextPad","connect","_contextPad","_connect","_create","_autoPlace","hasPrimaryModifier","isOpen","click","isEventType","eventBo","isType","isDefinition","def","getContextPadEntries","actions","startConnect","start","appendAction","appendStart","group","dragstart","splitLaneHandler","splitLane","childLanes","addLane","isEmpty","diagramContainer","getContainer","pad","getPad","html","diagramRect","getBoundingClientRect","padRect","getReplaceMenuPosition","cursor","deleteAllowed","delete","removeElements","DirectEditingModule","ContextPadModule","ConnectModule","CreateModule","contextPadProvider","BpmnDistributeElements","distributeElements","registerFilter","cannotDistribute","DistributeElementsModule","bpmnDistributeElements","BpmnEditorActions","EditorActions","_registerDefaultActions","spaceTool","lassoTool","handTool","globalConnect","alignElements","directEditing","searchPad","_registerAction","toggle","opts","currentSelection","trigger","aligneableElements","setColor","activate","boundingBox","moveElements","EditorActionsModule","editorActions","BpmnGridSnapping","gridSnappingContext","snapLocation","AutoPlaceBehavior","gridSnapping","isHorizontal","snapValue","CreateParticipantBehavior","createConstraints","LayoutConnectionBehavior","CommandInterceptor","_gridSnapping","postExecuted","connectionStart","connectionEnd","createElementsBehavior","hasMiddleSegments","updateWaypoints","snapMiddleSegments","snapSegment","segmentStart","segmentEnd","aligned","pointsAligned","snapped","horizontallyAligned","verticallyAligned","gridSnappingAutoPlaceBehavior","gridSnappingCreateParticipantBehavior","gridSnappingLayoutConnectionBehavior","GridSnappingModule","GridSnappingBehaviorModule","bpmnGridSnapping","BpmnInteractionEvents","interactionEvents","_interactionEvents","createParticipantHit","createDefaultHit","createLoopHit","removeHits","createBoxHit","bpmnInteractionEvents","BpmnKeyboardBindings","KeyboardBindings","registerBindings","keyboard","addListener","isRegistered","keyEvent","isKey","isCmd","hasModifier","KeyboardModule","keyboardBindings","createCategoryValue","categoryValue","category","collectionAdd","LabelEditingProvider","resizeHandles","activateDirectEdit","force","isCollapsedLoop","isActive","complete","removeResizers","canExecute","isTouch","getEditingBBox","centerVertically","resizable","getAbsoluteBBox","zoom","externalFontSize","externalLineHeight","defaultFontSize","defaultLineHeight","isExpandedPool","paddingTop","paddingBottom","paddingLeft","paddingRight","isCollapsedPool","isExpandedLoop","externalLabelMid","absoluteBBox","minWidth","minHeight","textAlign","update","newLabel","activeContextText","updateLabel","MARKER_HIDDEN","MARKER_LABEL_HIDDEN","LabelEditingPreview","absoluteElementBBox","defaultLayer","activeProvider","textPathData","dy","newElementHeight","removeMarker","svgRemove","ChangeSupportModule","ResizeModule","labelEditingProvider","labelEditingPreview","ALIGNMENTS","ELEMENT_LABEL_DISTANCE","AdaptiveLabelPositioningBehavior","checkLabelAdjustment","optimalPosition","labelMid","labelOrientation","getApproximateOrientation","takenAlignments","elementMid","getTakenConnectionAlignments","takenHostAlignments","freeAlignments","hostElement","hostOrientation","alignment","getTakenHostAlignments","getOptimalPosition","newLabelMid","elementTrbl","delta","substract","moveShape","adjustLabelPosition","p0","p1","AppendBehavior","bpmnRules","preExecute","AssociationBehavior","postExecute","newParent","moveConnection","AttachEventBehavior","shouldReplace","index","replaceShape","newHost","BoundaryEventBehavior","getBoundaryEvents","boundaryEvents","oldSource","newSource","attachedboundaryEvents","getEventDefinition","boundaryEvent","RootElementReferenceBehavior","canHaveRootElementReference","hasAnyEventDefinition","hasRootElement","getRootElementReferencePropertyName","executed","addedRootElement","reverted","collectionRemove","referencedRootElement","CreateBehavior","HIGH_PRIORITY","FixHoverBehavior","hover","hoverGfx","getGraphics","CreateDataObjectBehavior","HORIZONTAL_PARTICIPANT_PADDING","VERTICAL_PARTICIPANT_PADDING","ensureCollaboration","makeCollaboration","isConnection","childrenBBox","participantBounds","getParticipantBounds","getParticipantCreateConstraints","rootElementGfx","ensureHoveringProcess","once","execute","oldProcessRef","revert","processChildren","findParticipant","TARGET_REF_PLACEHOLDER_NAME","DataInputAssociationBehavior","getTargetRef","targetRefProp","cleanupTargetRef","targetRef","removedConnection","inputAssociations","usesTargetRef","fixTargetRef","connectionBo","targetBo","newTarget","newTargetBo","oldTarget","oldTargetBo","dataAssociation","ifDataInputAssociation","UpdateSemanticParentHandler","bpmnUpdater","_bpmnUpdater","DataStoreBehavior","commandStack","getDataStores","updateDataStoreParent","dataStore","newDataStoreParent","dataStoreBo","newDataStoreParentBo","newSemanticParent","newDiParent","registerHandler","oldParent","getAncestor","descendant","ancestor","descendantBo","ancestorBo","isDescendant","oldRoot","newRoot","oldSemanticParent","oldDiParent","updateSemanticParent","updateDiParent","DeleteLaneBehavior","nested","topAdjustments","bottomAdjustments","siblings","topAffected","bottomAffected","eachElement","calculateAdjustments","makeSpace","movingShapes","resizingShapes","compensateLaneDelete","DetachEventBehavior","item","intermediateEvent","DropOnFlowBehavior","insertShape","targetFlow","positionOrBounds","waypointsBefore","waypointsAfter","dockingPoint","intersection","getApproxIntersection","bendpoint","copy","duplicateConnections","shapeMid","newShapeMid","canInsert","EventBasedGatewayBehavior","preExecuted","existingIncomingConnections","isSequenceFlow","removeConnection","sequenceFlows","incomingSequenceFlows","GroupBehavior","removeReferencedCategoryValue","removeCategory","groupElements","lineIntersect","l1s","l1e","l2s","l2e","denominator","ImportDockingFix","adjustDocking","startPoint","nextPoint","centerIntersect","elementTop","elementLeft","verticalIntersect","horizontalIntersect","getDistance","original","fixDockings","p2","sqrt","pow","IsHorizontalFix","elementTypesToUpdate","vectorLength","getAngle","perpendicularFoot","bd","system","n","lambda","solveLambaSystem","getDistancePointLine","pfPoint","getDistancePointPoint","point1","point2","sq","getCircleSegmentIntersections","s1","s2","cc","cr","baX","baY","caX","caY","pBy2","disc","tmpSqrt","abScalingFactor1","abScalingFactor2","i1","fenced","isPointInSegment","rangeStart","rangeEnd","EQUAL_THRESHOLD","pointsEqual","getLabelAdjustment","newWaypoints","oldWaypoints","labelPosition","getLabelMid","attachment","segmentStartDistance","segmentEndDistance","attachmentPosition","intersections","attachmentDistance","closestAttachmentDistance","closestAttachment","segmentIndex","bendpointIndex","relativeLocation","getAttachment","oldLabelLineIndex","newLabelLineIndex","segmentMove","oldSegmentStartIndex","segmentStartIndex","newSegmentStartIndex","bendpointMove","newIndex","insert","relativePositionMidWaypoint","findNewLabelLineStartIndex","oldLabelLine","getLine","newLabelLine","oldFoot","relativeFootPosition","foot","lengthToFoot","getRelativeFootPosition","angleDelta","l1","l2","a1","getAngleDelta","oldBendpointIndex","oldBendpoint","newBendpoint","vector","newFoot","newLabelVector","cos","sin","roundPoint","distanceSegment1","DEFAULT_LABEL_DIMENSIONS","NAME_PROPERTY","TEXT_PROPERTY","LabelBehavior","labelCenter","labelDimensions","unsetLabel","removeShape","labelBehavior","labelAdjustment","startChanged","endChanged","getVisibleLabelAdjustment","oldShape","referencePoint","newReferencePoint","getNewAttachPoint","getReferencePointDelta","lines","nearestLine","distances","l","distance","getNearestLine","getReferencePoint","COLLAB_ERR_MSG","ModelingFeedback","tooltips","showError","timeout","ReplaceConnectionBehavior","dragging","fixConnection","replacementType","remove","canConnectSequenceFlow","canConnectMessageFlow","canConnectAssociation","allConnections","replacement","canConnect","oldConnection","newConnection","previousSelection","cleanDraggingSelection","RemoveParticipantBehavior","collaborationRoot","makeProcess","ReplaceElementBehaviour","_selection","topLevel","topLevelElements","canReplace","replaceElements","replacements","unclaimId","newElements","newElementType","oldElement","oldElementId","addToTrbl","trbl","choice","current","addMin","addMax","PARTICIPANT_MIN_DIMENSIONS","SUB_PROCESS_MIN_DIMENSIONS","TEXT_ANNOTATION_MIN_DIMENSIONS","ResizeBehavior","direction","balanced","resizeConstraints","laneShape","resizeDirection","lanesRoot","isFirst","isLast","laneTrbl","maxTrbl","minTrbl","flowElement","flowElementTrbl","getParticipantResizeConstraints","minDimensions","ResizeLaneBehavior","SLIGHTLY_HIGHER_PRIORITY","roundBounds","RemoveElementBehavior","inConnection","outConnection","inWaypoints","outWaypoints","getDocking","getNewWaypoints","reconnectEnd","SpaceToolBehavior","SubProcessStartEventBehavior","ToggleElementCollapseBehaviour","defaultSize","collapsedBounds","visibleElements","visibleBBox","computeChildrenBBox","expandedBounds","UnclaimIdBehavior","shapeBo","unclaim","rootElementBo","UpdateFlowNodeRefsBehavior","laneRefUpdateEvents","UpdateContext","enter","triggerUpdate","leave","updateLaneRefs","flowNodes","releaseContext","updateContext","addFlowNode","counter","DeleteSequenceFlowBehavior","sourceBo","isDefaultFlow","adaptiveLabelPositioningBehavior","appendBehavior","associationBehavior","attachEventBehavior","boundaryEventBehavior","rootElementReferenceBehavior","createBehavior","fixHoverBehavior","createDataObjectBehavior","createParticipantBehavior","dataInputAssociationBehavior","dataStoreBehavior","deleteLaneBehavior","detachEventBehavior","dropOnFlowBehavior","eventBasedGatewayBehavior","groupBehavior","importDockingFix","isHorizontalFix","modelingFeedback","replaceConnectionBehavior","removeParticipantBehavior","replaceElementBehaviour","resizeBehavior","resizeLaneBehavior","removeElementBehavior","toggleElementCollapseBehaviour","spaceToolBehavior","subProcessStartEventBehavior","unclaimIdBehavior","updateFlowNodeRefsBehavior","unsetDefaultFlowBehavior","UnsetDefaultFlowBehavior","getBoundaryAttachment","targetBounds","BpmnRules","RuleProvider","nonExistingOrLabel","getOrganizationalParent","isTextAnnotation","isGroup","isCompensationBoundary","getScopeParent","hasEventDefinitionOrNone","isEventBasedTarget","isParent","possibleParent","parents","getParents","connectDataAssociation","canConnectDataAssociation","canDrop","hasNoEventDefinition","hasCommonBoundaryIntermediateEventDefinition","isLane","isBoundaryCandidate","isBoundaryEvent","hasOneOfEventDefinitions","canAttach","Array","isBoundaryAttachment","isReceiveTaskAfterEventBasedGateway","hasErrorEventDefinition","hasEscalationEventDefinition","hasCompensateEventDefinition","canMove","canCreate","sourceTextAnnotation","targetTextAnnotation","isOneTextAnnotation","isMessageFlowTarget","connections","isOutgoingEventBasedGatewayConnection","isSequenceFlowTarget","flow","canCopy","init","addRule","canStartConnection","targetParent","targetAttach","RulesModule","BpmnDiOrdering","diElements","rootDi","selfAndAllChildren","bpmnDiOrdering","BpmnOrderingProvider","OrderingProvider","orders","order","level","containers","getOrder","o","computeOrder","getOrdering","elementOrder","actualParent","findActualParent","currentIndex","insertIndex","findIndex","bpmnOrderingProvider","BpmnFactory","_model","_needsId","_ensureId","nextPrefixed","createDiLabel","createDiBounds","createDiShape","createDiWaypoints","pos","createDiWaypoint","createDiEdge","createDiPlane","BpmnUpdater","connectionDocking","updateRoot","updateParent","updateBounds","updateConnection","updateConnectionWaypoints","updateAttachment","cropped","getCroppedWaypoints","ifBpmn","oldSourceBo","newSourceBo","oldConditionExpression","oldDefault","Label","parentBusinessObject","parentDi","updateFlowNodeRefs","_getLabel","newContainment","oldContainment","oldRefs","newRefs","updateDiConnection","planeElements","getLaneSet","visualParent","containment","diChildren","inverseSet","ElementFactory","BaseElementFactory","applyAttribute","attributeName","baseCreate","createBpmnElement","newEventDefinition","attributeNames","applyAttributes","condition","createParticipantShape","DEFAULT_FLOW","ID","DI","NULL_DIMENSIONS","UpdatePropertiesHandler","isIdChange","setProperties","setDiProperties","changed","unwrappedProps","referencePropertyNames","unwrapBusinessObjects","oldProperties","getDiProperties","getProperties","updateId","newLabelBounds","UpdateCanvasRootHandler","AddLaneHandler","_spaceTool","SplitLaneHandler","ResizeLaneHandler","newRootBusinessObject","oldRootBusinessObject","bpmnDefinitions","diPlane","location","isRoot","laneParent","allAffected","lanePosition","spacePos","adjustments","newLane","newLanesCount","existingLanesCount","laneY","laneHeight","laneBounds","newLaneAttrs","newLanesHeight","resizeBalanced","resizeSpace","change","newTrbl","trblDiff","FLOW_NODE_REFS_ATTR","LANES_ATTR","UpdateFlowNodeRefsHandler","IdClaimHandler","computeUpdates","flowNodeShapes","laneShapes","handledNodes","updates","participantCache","allFlowNodeShapes","addFlowNodeShape","flowNodeShape","getNewLanes","getAllLaneShapes","isInLaneShape","oldLane","claiming","DEFAULT_COLORS","SetColorHandler","_commandStack","colors","UpdateLabelHandler","setText","isExternal","setLabel","isEmptyText","oldLabel","Modeling","BaseModeling","_bpmnRules","getHandlers","targetLaneShape","targetLane","collaborationElement","claimId","moddleElement","oppositeOrientationMapping","orientationDirectionMapping","BpmnLayouter","getMessageFlowPreserveDocking","getConnectionDocking","isCompensationAssociation","isSame","getHorizontalOrientation","getVerticalOrientation","isHorizontalOrientation","getLoopPreferredLayout","getBoundaryEventPreferredLayouts","end","targetMid","attachOrientation","attachedElement","getAttachOrientation","attachedToSide","targetOrientation","targetLayout","sourceLayout","shouldConnectToSameSide","getBoundaryEventLoopLayout","getBoundaryEventSourceLayout","horizontalOrientation","oppositeHorizontalOrientation","isOppositeHorizontalOrientation","verticalOrientation","oppositeVerticalOrientation","isOppositeVerticalOrientation","getBoundaryEventTargetLayout","areCloseOnAxis","threshold","BaseLayouter","manhattanOptions","updatedWaypoints","preferredLayouts","preserveDocking","getMessageFlowManhattanOptions","withoutRedundantPoints","repairConnection","BehaviorModule","DiOrderingModule","OrderingModule","CommandModule","TooltipsModule","LabelSupportModule","AttachSupportModule","SpaceToolModule","layouter","CroppingConnectionDocking","PaletteProvider","palette","_palette","_lassoTool","_handTool","_globalConnect","getPaletteEntries","createAction","createListener","shortType","createLoop","startEvent","autoSelect","createParticipant","activateHand","activateSelection","separator","PaletteModule","LassoToolModule","HandToolModule","GlobalConnectModule","paletteProvider","BpmnReplacePreview","previewSupport","visualReplacements","tempShape","cssEscape","dragGroup","display","dragger","addDragger","replaceVisual","originalGfx","restoreVisual","PreviewSupportModule","bpmnReplacePreview","BOUNDARY_TO_HOST_THRESHOLD","AXES","BpmnConnectSnapping","originalEvent","initialConnectionStart","dimensionForAxis","getDimensionForAxis","setSnapped","snapToShape","getTargetBoundsPadding","snapToPosition","isMid","snapToTargetMid","isReverse","axes","newCoordinate","coordinate","snapBoundaryEventLoop","BpmnCreateMoveSnapping","CreateMoveSnapping","setSnappedIfConstrained","attach","isSnapped","targetTRBL","snapBoundaryEvent","getDockingSnapOrigin","docking","isMove","initSnap","snapContext","setSnapOrigin","setSnapLocations","addSnapTargetPoints","snapPoints","snapTargets","getSnapTargets","snapTarget","isContainer","topLeft","bottomRight","SnappingModule","connectSnapping","createMoveSnapping","BpmnSearchProvider","hasMatched","tokens","matched","matchAndSplit","pattern","originalText","normal","substr","primaryTokens","secondaryTokens","SearchPadModule","bpmnSearch","Modeler","CustomContextPadProvider","autoActivate","removeElement","createParentNode","createDiagram","_interactionModules","TouchModule","_modelingModules","AlignElementsModule","AutoPlaceModule","AutoScrollModule","AutoResizeModule","BendpointsModule","ConnectionPreviewModule","InteractionEventsModule","KeyboardMoveSelectionModule","LabelEditingModule","ModelingModule","MoveModule","ReplacePreviewModule","SearchModule","isCustom","CustomRules","CustomPalette","customRules","excludedFields","VALUE_FROM","CONTEXT","SELF","NONE","SOURCE","PARENT","ModelType","DATE_FORMAT","date","time","datetime","RelationalFieldList","excludedRelationalFields","excludedUITypes","getModelSubField","subFields","subField","version","fullName","modelType","targetJsonModel","jsonModel","targetModel","generateJson","currentJson","defaultFrom","sourceModel","jsonData","getValue","modelSubField","from","newValue","selected","modelFieldValue","fields","modelFieldText","field","fieldName","lowerCaseFirstLetter","getModelFieldValue","firstField","sourceModelName","contextKey","dataPath","modelTarget","getTarget","jsonTarget","isRemoved","sourceField","selfField","fetchSelectionByName","services","_domain","_domainContext","limit","items","list","getModels","metaModalType","criteria","getMetaModels","models","getCustomModels","metaJsonModels","allModels","fetchModelByName","modelName","operator","status","customModelData","criteriaParent","customModelCriteria","fetchFields","searchData","selectionList","jsonFields","fieldKey","jsonField","newFields","fetchCustomFields","newData","getCustomModelData","getCustomModelByDomain","jsonModelDomain","getNameFieldByDomain","jsonModelName","getData","generateScriptString","jsonString","_jsonString","responseData","_scriptString","useDebounce","cb","duration","timer","React","useRef","clearTimer","clearTimeout","setTimer","useEffect","args","upperCaseFirstLetter","window","_t","sort","excludeFields","otherFields","excludeFieldList","dataList","isRelationalField","_type","generatePath","targetName","dndItemTypes","getKey","useStyles","makeStyles","theme","listbox","maxHeight","input","inputSelected","color","border","background","overflow","whiteSpace","textOverflow","AutoComplete","useState","setOpen","setOptions","isMulti","selectedValue","setSelectedValue","inputValue","setInputValue","onChange","flatOptions","optionLabelKey","optionValueKey","fetchAPI","inline","InputProps","filterSelectedOptions","disableCloseOnSelect","readOnly","concatValue","isProcessContext","inputRootClass","classes","loading","setLoading","findOption","useCallback","option","delayChange","onKeyDown","handleChange","reason","checkValue","Autocomplete","getOptionSelected","getOptionLabel","_uniqueId","onOpen","onClose","disabled","multiple","onInputChange","inputRoot","renderInput","params","TextField","fullWidth","onClick","endAdornment","Fragment","CircularProgress","circularProgress","dialogPaper","cardContent","cardContentItemText","cardContentItemContainer","marginLeft","cardContentItemTitle","cardActionView","justifyContent","noFields","save","spacing","backgroundColor","borderColor","textTransform","dialogTitle","subHeaderRow","borderBottom","fieldListViewContainer","marginRight","marginTop","overflowY","searchField","checkbox","backgrounColor","FieldPopoverComponent","onSubmit","setSelected","selectAll","setSelectAll","searchText","setSearchText","handleClose","stopPropagation","handleSubmit","handleCheckbox","handleSelectAll","_selectAll","f","handleFieldSearch","Dialog","aria-labelledby","DialogTitle","DialogContent","dividers","FormControlLabel","control","Checkbox","checked","placeholder","Grid","Typography","CardActions","Button","variant","FieldPopover","memo","parentField","clickableView","fieldNameColumn","addFieldButton","row","ModelFieldComponent","handleAdd","showSubField","setShowSubField","getFields","classNames","iconButton","icon","buttonTitle","iconButtonClassName","ModelField","InputField","autoTitle","onBlur","Input","inputProps","autoComplete","defaultProps","rows","NumberField","blur","customeFormat","setVal","formatValue","Number","toFixed","PICKERS","KeyboardDatePicker","KeyboardTimePicker","KeyboardDateTimePicker","DateTimePicker","valueRef","Picker","utils","MomentUtils","autoOk","ampm","views","PopoverProps","anchorOrigin","vertical","horizontal","transformOrigin","disableToolbar","invalidDateMessage","animateYearScrolling","keyCode","flexWrap","Selection","rest","FormControl","classnames","formControl","InputLabel","Select","MenuItem","marginBottom","Card","moveCard","useDrop","accept","collect","monitor","handlerId","getHandlerId","dragIndex","hoverIndex","hoverBoundingRect","hoverMiddleY","hoverClientY","getClientOffset","drop","useDrag","isDragging","drag","preview","opacity","listStyle","chip","rightIcon","MultiSelector","parentRow","isContext","isM2o","getModel","getIndex","hasValue","containerClassName","object","renderTags","tags","getTagProps","tag","Chip","overflowX","table","tableRowRoot","valueInputContainer","radioInput","deleteIcon","headerTitle","getOptions","getSelfValue","getExpressionValue","getCustomStyle","getOptionDisabled","getParentValueTarget","contextModel","getTargetName","nameField","RenderRelationalWidget","editor","internalProps","setNameField","fetchData","fieldData","_value","_selectId","MuiAutocompleteRoot","RenderSimpleWidget","Component","value2","RenderWidget","parentType","fieldValue","fieldValue2","widgetProps","moment","stringToDate","booleanOptions","DataTable","onRowChange","metaFields","onRemove","errors","onClearError","onSubFieldAdd","manageFieldClick","onReorder","getDefaultFrom","rowIndex","handleRemove","renderRow","isHidden","TableRow","data-handler-id","TableCell","onSubFieldChange","subFieldName","disableClearable","IconButton","Tooltip","Close","Paper","startIcon","AddRounded","Table","aria-label","stickyHeader","TableHead","TableBody","StoreContext","createContext","useStore","useContext","StoreProvider","defaultValue","state","setState","updater","produce","useMutableState","builderFields","Provider","metaFieldGrid","flex","flexDirection","newRecordSwitch","newRecordSwitchText","newRecordInputView","modelFieldSelection","addModelFieldIcon","saveButton","capitalizeText","saveButtonText","saveMessageAlert","topView","loaderView","alignItems","zIndex","paper","maxWidth","selectContainer","targetModelInputRoot","getCustomTarget","getFieldInfo","getContextValue","splitedValue","findFields","getNewBuilderFields","newField","hasChildrenShow","newFieldlist","clearChildrenParentValue","shouldChangeFrom","Builder","onSave","bpmnModeler","setModel","setSourceModel","sourceModelList","setSourceModelList","newRecord","setNewRecord","modelFieldMap","setModelFieldMap","setMetaFields","setErrors","manageField","setManageField","openAlert","setAlert","alertMessage","alertTitle","alertConfig","setAlertConfig","isClose","setClose","setBuilderFields","draft","handleRowChange","recordIndex","prevFields","handleRowRemove","handleSubFieldAdd","expand","resultMetaField","builderJSONFields","builderField","jsonFieldList","contextValue","hideFields","getBuilderFields","jsonFieldIndex","processId","getMetaFields","_builderRecord","handleClearError","getJSON","sourceModelString","getSourceModelString","isJson","handleSave","jsonQuery","scriptString","resultField","targetField","handleModelSelect","delayFetch","handleManageFieldClick","handleCloseManageField","handleReorder","modelResult","lastSourceModel","sourceModelResult","justify","buttonClassName","Switch","aria-describedby","dialog","DialogContentText","DialogActions","autoFocus","AppContent","setValues","App","DndProvider","backend","HTML5Backend","download","encodedData","encodeURIComponent","dl","setAttribute","getItemsByType","view","collectItems","getFormName","formString","form","getBool","desciption","Description","verticalAlign","textarea","boxShadow","outline","Textbox","description","setValue","errorMessage","setErrorMessage","isError","setError","getProperty","updateProperty","setProperty","getValidation","valid","TextareaAutosize","Date","rowsMin","fieldWrapper","clearButton","canRemove","rootClass","labelClass","modelProperty","SelectBox","emptyParameter","selectOptions","canBeDisabled","canBeHidden","selectedOption","setSelectedOption","dynamicOptions","htmlFor","data-disable","data-show","common","black","errorDescription","labelTitle","SelectComponent","optionLabel","criteriaIds","propOptions","setsearchText","fetchMethod","valueObj","fetchOptions","interval","isMounted","useDebounceEffect","inputFocused","clearIndicator","popupIndicator","clearOnEscape","optionName","helperText","disableUnderline","InputLabelProps","assignElements","ExtensionElementTable","defaultOptions","setOptionLabelValue","createExtensionElement","onSelectionChange","removeExtensionElement","data-list-entry-container","button","buttonLabel","ButtonComp","Icon","endIcon","combinator","map_combinator","and","or","map_bpm_combinator","join_operator","JS","GROOVY","BPM","dateFormat","positive_operators","query_custom_types","allowed_types","operators_by_type","enum","integer","boolean","map_operator","in","notIn","like","notLike","isNotNull","isNull","isTrue","isFalse","contains","notContains","operators","isBPMQuery","getJsonExpression","getMetaModal","Service","relationJsonModel","allowAllFields","getResultedFields","metaModel","resultFields","dmnModels","getDMNModels","getDMNFields","allFields","nestedFields","getViews","_","getButtons","buttons","metaModeNames","modelNames","modelFullName","formName","formView","btns","buttonFields","getFormViews","formViewNames","names","allowTitles","defaultForms","arrs","accumulator","Promise","resolve","forms","formData","getAllModels","FieldEditor","initValue","isUserPath","startModel","excludeUITypes","isDatePath","setFields","isShow","setShow","isButton","setButton","allFieldValues","setAllFieldValues","startValue","hasManyValues","relationModel","newFieldName","relationalField","reverse","transformValue","isSubscribed","lastValue","previousField","getSubMetaField","expressionBuilder","newIcon","new","textbox","ScriptProps","setReadOnly","openMapper","setMapper","setAlertTitle","setAlertMessage","handleCloseMapper","getPropertyValue","updateScript","scriptValue","scriptMetaValue","script","scriptMeta","NotInterested","Edit","expr","getExpression","joinURL","subURL","AxelorService","_subURL","spread","records","metaModalService","metaFieldService","isQuery","isM2OField","isContextValue","packageName","zonedDateTimeFieldsRes","zonedDateTimeFields","isM2MFields","isAllowedButtons","replaceAll","modelService","getNameField","expression","parentExpression","isBPM","isField","setInitialField","isAllowButtons","allField","propIsShow","isName","fieldType","isM2MField","isOneToOne","spiltedValues","getUpdatedValue","fieldNames","filterFields","fName","fieldNameValue","initValues","Container","rulesGroupHeader","valueFrom","radio","timelineConnector","timeline","timelineOppositeContent","fetchField","metaModals","getMetaFieldsAPI","isNameField","Rule","onRemoveRule","parentMetaModal","isRelationalValue","relatedValueModal","relatedValueFieldName","relatedElseValueModal","relatedElseValueFieldName","showMetaModelField","isShowMetaModelField","showElseMetaModelField","isShowElseMetaModelField","setField","metaModal","setMetaModal","setIsShowMetaModelField","elseMetaModal","setElseMetaModal","setIsShowElseMetaModelField","elseNameValue","setElseNameValue","nameValue","setNameValue","addOperatorByType","operatorsOptions","operatorType","RadioGroup","Radio","DeleteIcon","Editor","onAddGroup","isRemoveGroup","onRemoveGroup","onAddRule","getChildEditors","isDisable","setBPM","childEditors","Timeline","TimelineItem","TimelineOppositeContent","TimelineSeparator","TimelineDot","TimelineConnector","TimelineContent","AddIcon","rule","MuiAutocompleteRoot1","flexGrow","popoverContainer","typography","popoverHeader","defaultRules","parentId","defaultState","ExpressionBuilder","processConfigs","defaultModel","setMetaModals","setRules","editorId","editorIndex","dmnFieldIds","outputDmnFieldList","dmnFields","expressionContainer","timelineItem","allowAllModels","setCombinator","ExpressionComponent","expressionComponents","setExpressionComponents","generateWithId","setGenerateWithId","initialValues","setInitialValues","getRelationalCondition","map_operators","propFieldName","nameColumn","findRelational","nestedFieldName","isDateTime","jsStringEscape","getDateTimeValue","isManyToManyField","temp","fieldNew","isJsonField","toISOString","getCondition","modalName","returnValues","fValue","isNaN","map_type","getBPMCondition","parentCount","parentCustomField","jsonFieldName","getBPMCriteria","isChildren","allConditions","childrenConditions","parentValues","co","childrenValues","conditions","newValues","apply","childConditions","childValues","isChild","getCriteria","getListOfTree","roots","generateExpression","expressionValues","vals","isValid","parentNodes","flattenDeep","allRules","checkValidation","expressions","resultVariable","listOfTree","expressionValue","metaModalName","decisionId","dmnNodeId","parameters","ele","dmnTables","dmnNodeNameId","metaModels","fetchValue","combinators","onRemoveExpressionEditor","generateExpressionValues","ExtendedQueryProps","setIsJson","openExpressionBuilder","setExpressionBuilder","fetchModel","widget","errror","dialogContent","FieldBuilder","setExpression","expressionPathDummy","setExpressionPathDummy","groupLabel","transition","fontStyle","divider","borderTop","PARAMETER_ELEMENT","getParameterElements","fetchParameterElements","getParameters","ParameterProps","parameterEntity","setParameterEntity","parameterOptions","setParameterOptions","getBO","getParameterElement","addOptions","isInitial","idGeneration","extensionEle","newElem","ind","parameterElement","tabProperty","resizeStyle","borderLeft","drawer","drawerWidth","flexShrink","drawerPaper","drawerContainer","nodeTitle","propertyLable","btnContainer","defaultXml","getStartElements","getSequencedChildElements","startElements","startElement","updateChildFlowElements","seqFlow","addFlowElements","elementIds","_elements","basicElements","updateXml","getSequencedFlowElements","uploadXml","getElementById","BamlEditor","setWidth","setHeight","drawerOpen","setDrawerOpen","setElement","baml","setBaml","messageType","openSnackbar","setSnackbar","setCSSWidth","documentElement","generateCode","bamlXml","actionResponse","resultScript","updatedRes","handleSnackbarClick","handleSnackbarClose","toolBarButtons","Save","tooltipText","Panorama","GetApp","Publish","Code","openDiagramImage","fetchDiagram","fetchId","uploadFile","files","FileReader","readAsText","onload","renderComponent","BpmnModeler","bindTo","customControlsModule","matchBPMNId","regexBPMN","href","btn","onResizeStop","innerWidth","Drawer","anchor","Snackbar","autoHideDuration","Alert","elevation","severity","BAML","ReactDOM"],"mappings":"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AAM,eACNsD,QAAS,mCACTyM,QAAQ,EACRhL,KAAM,UAER,CACE/E,KAAM,UACN+E,KAAM,SACN3B,QAAQ,GAEV,CACEpD,KAAM,aACN+E,KAAM,YACN3B,QAAQ,GAEV,CACEpD,KAAM,eACN+E,KAAM,cACN3B,QAAQ,GAEV,CACEpD,KAAM,WACNoD,QAAQ,EACR2B,KAAM,sBAER,CACE/E,KAAM,WACN+P,QAAQ,EACRhL,KAAM,UAER,CACE/E,KAAM,gBACN+E,KAAM,eACN3B,QAAQ,GAEV,CACEpD,KAAM,kBACN+P,QAAQ,EACRhL,KAAM,aAkJZyV,aA7IiB,CACjB,CACExa,KAAM,cACNya,cAAe,CACb,CACEza,KAAM,QAER,CACEA,KAAM,UAER,CACEA,KAAM,aAIZ,CACEA,KAAM,mBACNya,cAAe,CACb,CACEza,KAAM,eAER,CACEA,KAAM,cAER,CACEA,KAAM,aAER,CACEA,KAAM,WAIZ,CACEA,KAAM,wBACNya,cAAe,CACb,CACEza,KAAM,YAER,CACEA,KAAM,eAIZ,CACEA,KAAM,wBACNya,cAAe,CACb,CACEza,KAAM,QAER,CACEA,KAAM,WAER,CACEA,KAAM,YAER,CACEA,KAAM,UAIZ,CACEA,KAAM,WACNya,cAAe,CACb,CACEza,KAAM,YAER,CACEA,KAAM,iBAIZ,CACEA,KAAM,uBACNya,cAAe,CACb,CACEza,KAAM,QAER,CACEA,KAAM,YAER,CACEA,KAAM,2BAER,CACEA,KAAM,2BAIZ,CACEA,KAAM,uBACNya,cAAe,CACb,CACEza,KAAM,QAER,CACEA,KAAM,OAER,CACEA,KAAM,UAIZ,CACEA,KAAM,wBACNya,cAAe,CACb,CACEza,KAAM,QAER,CACEA,KAAM,OAER,CACEA,KAAM,OAER,CACEA,KAAM,aAIZ,CACEA,KAAM,gBACNya,cAAe,CACb,CACEza,KAAM,YAER,CACEA,KAAM,iBAgBZsF,OAXW,OAYX8G,IAXQ,CACRC,SAAU,YACV2D,WAAY,MA0kBZ0K,OA3YkB,CAClB1a,KApLW,SAqLX6J,IApLU,2CAqLVR,MApLY,CACZ,CACErJ,KAAM,cACN0C,WA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","file":"static/js/main.48b7d26c.chunk.js","sourcesContent":["let lastCookieString;\nlet lastCookies = {};\n\nfunction readCookie(name) {\n  let cookieString = document.cookie || \"\";\n  if (cookieString !== lastCookieString) {\n    lastCookieString = cookieString;\n    lastCookies = cookieString.split(\"; \").reduce((obj, value) => {\n      let parts = value.split(\"=\");\n      obj[parts[0]] = parts[1];\n      return obj;\n    }, {});\n  }\n  return lastCookies[name];\n}\n\nexport class Service {\n  constructor() {\n    const headers = new Headers();\n    headers.append(\"Accept\", \"application/json\");\n    headers.append(\"Content-Type\", \"application/json\");\n    headers.append(\"X-Requested-With\", \"XMLHttpRequest\");\n    headers.append(\"X-CSRF-Token\", readCookie(\"CSRF-TOKEN\"));\n    this.baseURL = process.env.NODE_ENV === \"production\" ? \"..\" : \"bpm-new\";\n    this.headers = headers;\n  }\n\n  fetch(url, method, options) {\n    return fetch(url, options)\n      .then((data) => {\n        if ([\"head\", \"delete\"].indexOf(method.toLowerCase()) !== -1)\n          return data;\n        let isJSON = data.headers\n          .get(\"content-type\")\n          .includes(\"application/json\");\n        return isJSON ? data.json() : data;\n      })\n      .catch((err) => {});\n  }\n\n  request(url, config = {}, data = {}) {\n    const options = Object.assign(\n      {\n        method: \"POST\",\n        credentials: \"include\",\n        headers: this.headers,\n        mode: \"cors\",\n        body: JSON.stringify(data),\n      },\n      config\n    );\n    if (config.method === \"GET\") {\n      delete options.body;\n    }\n    return this.fetch(\n      `${this.baseURL}${url.indexOf(\"/\") === 0 ? url : `/${url}`}`,\n      config.method,\n      options\n    );\n  }\n\n  get(url) {\n    const config = {\n      method: \"GET\",\n    };\n    return this.request(url, config);\n  }\n\n  post(url, data) {\n    const config = {\n      method: \"POST\",\n    };\n    return this.request(url, config, data);\n  }\n\n  add(entity, record) {\n    const data = {\n      data: record,\n    };\n    const url = `ws/rest/${entity}`;\n    return this.post(url, data);\n  }\n\n  fetchId(entity, id, data = {}) {\n    const url = `ws/rest/${entity}/${id}/fetch`;\n    return this.post(url, data);\n  }\n\n  search(entity, options) {\n    const data = {\n      offset: 0,\n      ...options,\n    };\n    const url = `ws/rest/${entity}/search`;\n    return this.post(url, data);\n  }\n\n  action(data) {\n    const url = `ws/action`;\n    return this.post(url, data);\n  }\n\n  fields(data) {\n    const url = \"/ws/meta/view/fields\";\n    return this.post(url, data);\n  }\n\n  view(data) {\n    const url = \"/ws/meta/view\";\n    return this.post(url, data);\n  }\n\n  fetchFields(entity) {\n    const url = `/ws/meta/fields/${entity}`;\n    return this.get(url);\n  }\n\n  fetchRecord(entity, id, data = {}) {\n    const url = `ws/rest/${entity}/${id}/fetch`;\n    return this.post(url, data);\n  }\n}\n\nexport default new Service();\n","import { forEach, bind, pick, assign, isString, isObject } from \"min-dash\";\n\n/**\n * Moddle base element.\n */\nfunction Base() {}\n\nBase.prototype.get = function (name) {\n  return this.$model.properties.get(this, name);\n};\n\nBase.prototype.set = function (name, value) {\n  this.$model.properties.set(this, name, value);\n};\n\n/**\n * A model element factory.\n *\n * @param {Moddle} model\n * @param {Properties} properties\n */\nfunction Factory(model, properties) {\n  this.model = model;\n  this.properties = properties;\n}\n\nFactory.prototype.createType = function (descriptor) {\n  let model = this.model;\n\n  let props = this.properties,\n    prototype = Object.create(Base.prototype);\n\n  // initialize default values\n  forEach(descriptor.properties, function (p) {\n    if (!p.isMany && p.default !== undefined) {\n      prototype[p.name] = p.default;\n    }\n  });\n\n  props.defineModel(prototype, model);\n  props.defineDescriptor(prototype, descriptor);\n\n  let name = descriptor.ns.name;\n\n  /**\n   * The new type constructor\n   */\n  function ModdleElement(attrs) {\n    props.define(this, \"$type\", { value: name, enumerable: true });\n    props.define(this, \"$attrs\", { value: {} });\n    props.define(this, \"$parent\", { writable: true });\n\n    forEach(\n      attrs,\n      bind(function (val, key) {\n        this.set(key, val);\n      }, this)\n    );\n  }\n\n  ModdleElement.prototype = prototype;\n\n  ModdleElement.hasType = prototype.$instanceOf = this.model.hasType;\n\n  // static links\n  props.defineModel(ModdleElement, model);\n  props.defineDescriptor(ModdleElement, descriptor);\n\n  return ModdleElement;\n};\n\n/**\n * Built-in moddle types\n */\nlet BUILTINS = {\n  String: true,\n  Boolean: true,\n  Integer: true,\n  Real: true,\n  Element: true,\n};\n\n/**\n * Converters for built in types from string representations\n */\nlet TYPE_CONVERTERS = {\n  String: function (s) {\n    return s;\n  },\n  Boolean: function (s) {\n    return s === \"true\";\n  },\n  Integer: function (s) {\n    return parseInt(s, 10);\n  },\n  Real: function (s) {\n    return parseFloat(s, 10);\n  },\n};\n\n/**\n * Convert a type to its real representation\n */\nfunction coerceType(type, value) {\n  let converter = TYPE_CONVERTERS[type];\n\n  if (converter) {\n    return converter(value);\n  } else {\n    return value;\n  }\n}\n\n/**\n * Return whether the given type is built-in\n */\nfunction isBuiltIn(type) {\n  return !!BUILTINS[type];\n}\n\n/**\n * Return whether the given type is simple\n */\nfunction isSimple(type) {\n  return !!TYPE_CONVERTERS[type];\n}\n\n/**\n * Parses a namespaced attribute name of the form (ns:)localName to an object,\n * given a default prefix to assume in case no explicit namespace is given.\n *\n * @param {String} name\n * @param {String} [defaultPrefix] the default prefix to take, if none is present.\n *\n * @return {Object} the parsed name\n */\nfunction parseName(name, defaultPrefix) {\n  let parts = name.split(/:/),\n    localName,\n    prefix;\n\n  // no prefix (i.e. only local name)\n  if (parts.length === 1) {\n    localName = name;\n    prefix = defaultPrefix;\n  }\n  // prefix + local name\n  else if (parts.length === 2) {\n    localName = parts[1];\n    prefix = parts[0];\n  } else {\n    throw new Error(\"expected <prefix:localName> or <localName>, got \" + name);\n  }\n\n  name = (prefix ? prefix + \":\" : \"\") + localName;\n\n  return {\n    name: name,\n    prefix: prefix,\n    localName: localName,\n  };\n}\n\n/**\n * A utility to build element descriptors.\n */\nfunction DescriptorBuilder(nameNs) {\n  this.ns = nameNs;\n  this.name = nameNs.name;\n  this.allTypes = [];\n  this.allTypesByName = {};\n  this.properties = [];\n  this.propertiesByName = {};\n}\n\nDescriptorBuilder.prototype.build = function () {\n  return pick(this, [\n    \"ns\",\n    \"name\",\n    \"allTypes\",\n    \"allTypesByName\",\n    \"properties\",\n    \"propertiesByName\",\n    \"bodyProperty\",\n    \"idProperty\",\n  ]);\n};\n\n/**\n * Add property at given index.\n *\n * @param {Object} p\n * @param {Number} [idx]\n * @param {Boolean} [validate=true]\n */\nDescriptorBuilder.prototype.addProperty = function (p, idx, validate) {\n  if (typeof idx === \"boolean\") {\n    validate = idx;\n    idx = undefined;\n  }\n\n  this.addNamedProperty(p, validate !== false);\n\n  let properties = this.properties;\n\n  if (idx !== undefined) {\n    properties.splice(idx, 0, p);\n  } else {\n    properties.push(p);\n  }\n};\n\nDescriptorBuilder.prototype.replaceProperty = function (\n  oldProperty,\n  newProperty,\n  replace\n) {\n  let oldNameNs = oldProperty.ns;\n\n  let props = this.properties,\n    propertiesByName = this.propertiesByName,\n    rename = oldProperty.name !== newProperty.name;\n\n  if (oldProperty.isId) {\n    if (!newProperty.isId) {\n      throw new Error(\n        \"property <\" +\n          newProperty.ns.name +\n          \"> must be id property \" +\n          \"to refine <\" +\n          oldProperty.ns.name +\n          \">\"\n      );\n    }\n\n    this.setIdProperty(newProperty, false);\n  }\n\n  if (oldProperty.isBody) {\n    if (!newProperty.isBody) {\n      throw new Error(\n        \"property <\" +\n          newProperty.ns.name +\n          \"> must be body property \" +\n          \"to refine <\" +\n          oldProperty.ns.name +\n          \">\"\n      );\n    }\n\n    // TODO: Check compatibility\n    this.setBodyProperty(newProperty, false);\n  }\n\n  // validate existence and get location of old property\n  let idx = props.indexOf(oldProperty);\n  if (idx === -1) {\n    throw new Error(\n      \"property <\" + oldNameNs.name + \"> not found in property list\"\n    );\n  }\n\n  // remove old property\n  props.splice(idx, 1);\n\n  // replacing the named property is intentional\n  //\n  //  * validate only if this is a \"rename\" operation\n  //  * add at specific index unless we \"replace\"\n  //\n  this.addProperty(newProperty, replace ? undefined : idx, rename);\n\n  // make new property available under old name\n  propertiesByName[oldNameNs.name] = propertiesByName[\n    oldNameNs.localName\n  ] = newProperty;\n};\n\nDescriptorBuilder.prototype.redefineProperty = function (\n  p,\n  targetPropertyName,\n  replace\n) {\n  let nsPrefix = p.ns.prefix;\n  let parts = targetPropertyName.split(\"#\");\n\n  let name = parseName(parts[0], nsPrefix);\n  let attrName = parseName(parts[1], name.prefix).name;\n\n  let redefinedProperty = this.propertiesByName[attrName];\n  if (!redefinedProperty) {\n    throw new Error(\"refined property <\" + attrName + \"> not found\");\n  } else {\n    this.replaceProperty(redefinedProperty, p, replace);\n  }\n\n  delete p.redefines;\n};\n\nDescriptorBuilder.prototype.addNamedProperty = function (p, validate) {\n  let ns = p.ns,\n    propsByName = this.propertiesByName;\n\n  if (validate) {\n    this.assertNotDefined(p, ns.name);\n    this.assertNotDefined(p, ns.localName);\n  }\n\n  propsByName[ns.name] = propsByName[ns.localName] = p;\n};\n\nDescriptorBuilder.prototype.removeNamedProperty = function (p) {\n  let ns = p.ns,\n    propsByName = this.propertiesByName;\n\n  delete propsByName[ns.name];\n  delete propsByName[ns.localName];\n};\n\nDescriptorBuilder.prototype.setBodyProperty = function (p, validate) {\n  if (validate && this.bodyProperty) {\n    throw new Error(\n      \"body property defined multiple times \" +\n        \"(<\" +\n        this.bodyProperty.ns.name +\n        \">, <\" +\n        p.ns.name +\n        \">)\"\n    );\n  }\n\n  this.bodyProperty = p;\n};\n\nDescriptorBuilder.prototype.setIdProperty = function (p, validate) {\n  if (validate && this.idProperty) {\n    throw new Error(\n      \"id property defined multiple times \" +\n        \"(<\" +\n        this.idProperty.ns.name +\n        \">, <\" +\n        p.ns.name +\n        \">)\"\n    );\n  }\n\n  this.idProperty = p;\n};\n\nDescriptorBuilder.prototype.assertNotDefined = function (p, name) {\n  let propertyName = p.name,\n    definedProperty = this.propertiesByName[propertyName];\n\n  if (definedProperty) {\n    throw new Error(\n      \"property <\" +\n        propertyName +\n        \"> already defined; \" +\n        \"override of <\" +\n        definedProperty.definedBy.ns.name +\n        \"#\" +\n        definedProperty.ns.name +\n        \"> by \" +\n        \"<\" +\n        p.definedBy.ns.name +\n        \"#\" +\n        p.ns.name +\n        \"> not allowed without redefines\"\n    );\n  }\n};\n\nDescriptorBuilder.prototype.hasProperty = function (name) {\n  return this.propertiesByName[name];\n};\n\nDescriptorBuilder.prototype.addTrait = function (t, inherited) {\n  let typesByName = this.allTypesByName,\n    types = this.allTypes;\n\n  let typeName = t.name;\n\n  if (typeName in typesByName) {\n    return;\n  }\n\n  forEach(\n    t.properties,\n    bind(function (p) {\n      // clone property to allow extensions\n      p = assign({}, p, {\n        name: p.ns.localName,\n        inherited: inherited,\n      });\n\n      Object.defineProperty(p, \"definedBy\", {\n        value: t,\n      });\n\n      let replaces = p.replaces,\n        redefines = p.redefines;\n\n      // add replace/redefine support\n      if (replaces || redefines) {\n        this.redefineProperty(p, replaces || redefines, replaces);\n      } else {\n        if (p.isBody) {\n          this.setBodyProperty(p);\n        }\n        if (p.isId) {\n          this.setIdProperty(p);\n        }\n        this.addProperty(p);\n      }\n    }, this)\n  );\n\n  types.push(t);\n  typesByName[typeName] = t;\n};\n\n/**\n * A registry of Moddle packages.\n *\n * @param {Array<Package>} packages\n * @param {Properties} properties\n */\nfunction Registry(packages, properties) {\n  this.packageMap = {};\n  this.typeMap = {};\n\n  this.packages = [];\n\n  this.properties = properties;\n\n  forEach(packages, bind(this.registerPackage, this));\n}\n\nRegistry.prototype.getPackage = function (uriOrPrefix) {\n  return this.packageMap[uriOrPrefix];\n};\n\nRegistry.prototype.getPackages = function () {\n  return this.packages;\n};\n\nRegistry.prototype.registerPackage = function (pkg) {\n  // copy package\n  pkg = assign({}, pkg);\n\n  let pkgMap = this.packageMap;\n\n  ensureAvailable(pkgMap, pkg, \"prefix\");\n  ensureAvailable(pkgMap, pkg, \"uri\");\n\n  // register types\n  forEach(\n    pkg.types,\n    bind(function (descriptor) {\n      this.registerType(descriptor, pkg);\n    }, this)\n  );\n\n  pkgMap[pkg.uri] = pkgMap[pkg.prefix] = pkg;\n  this.packages.push(pkg);\n};\n\n/**\n * Register a type from a specific package with us\n */\nRegistry.prototype.registerType = function (type, pkg) {\n  type = assign({}, type, {\n    superClass: (type.superClass || []).slice(),\n    extends: (type.extends || []).slice(),\n    properties: (type.properties || []).slice(),\n    meta: assign(type.meta || {}),\n  });\n\n  let ns = parseName(type.name, pkg.prefix),\n    name = ns.name,\n    propertiesByName = {};\n\n  // parse properties\n  forEach(\n    type.properties,\n    bind(function (p) {\n      // namespace property names\n      let propertyNs = parseName(p.name, ns.prefix),\n        propertyName = propertyNs.name;\n\n      // namespace property types\n      if (!isBuiltIn(p.type)) {\n        p.type = parseName(p.type, propertyNs.prefix).name;\n      }\n\n      assign(p, {\n        ns: propertyNs,\n        name: propertyName,\n      });\n\n      propertiesByName[propertyName] = p;\n    }, this)\n  );\n\n  // update ns + name\n  assign(type, {\n    ns: ns,\n    name: name,\n    propertiesByName: propertiesByName,\n  });\n\n  forEach(\n    type.extends,\n    bind(function (extendsName) {\n      let extended = this.typeMap[extendsName];\n\n      extended.traits = extended.traits || [];\n      extended.traits.push(name);\n    }, this)\n  );\n\n  // link to package\n  this.definePackage(type, pkg);\n\n  // register\n  this.typeMap[name] = type;\n};\n\n/**\n * Traverse the type hierarchy from bottom to top,\n * calling iterator with (type, inherited) for all elements in\n * the inheritance chain.\n *\n * @param {Object} nsName\n * @param {Function} iterator\n * @param {Boolean} [trait=false]\n */\nRegistry.prototype.mapTypes = function (nsName, iterator, trait) {\n  let type = isBuiltIn(nsName.name)\n    ? { name: nsName.name }\n    : this.typeMap[nsName.name];\n\n  let self = this;\n\n  /**\n   * Traverse the selected trait.\n   *\n   * @param {String} cls\n   */\n  function traverseTrait(cls) {\n    return traverseSuper(cls, true);\n  }\n\n  /**\n   * Traverse the selected super type or trait\n   *\n   * @param {String} cls\n   * @param {Boolean} [trait=false]\n   */\n  function traverseSuper(cls, trait) {\n    let parentNs = parseName(cls, isBuiltIn(cls) ? \"\" : nsName.prefix);\n    self.mapTypes(parentNs, iterator, trait);\n  }\n\n  if (!type) {\n    throw new Error(\"unknown type <\" + nsName.name + \">\");\n  }\n\n  forEach(type.superClass, trait ? traverseTrait : traverseSuper);\n\n  // call iterator with (type, inherited=!trait)\n  iterator(type, !trait);\n\n  forEach(type.traits, traverseTrait);\n};\n\n/**\n * Returns the effective descriptor for a type.\n *\n * @param  {String} type the namespaced name (ns:localName) of the type\n *\n * @return {Descriptor} the resulting effective descriptor\n */\nRegistry.prototype.getEffectiveDescriptor = function (name) {\n  let nsName = parseName(name);\n\n  let builder = new DescriptorBuilder(nsName);\n\n  this.mapTypes(nsName, function (type, inherited) {\n    builder.addTrait(type, inherited);\n  });\n\n  let descriptor = builder.build();\n\n  // define package link\n  this.definePackage(\n    descriptor,\n    descriptor.allTypes[descriptor.allTypes.length - 1].$pkg\n  );\n\n  return descriptor;\n};\n\nRegistry.prototype.definePackage = function (target, pkg) {\n  this.properties.define(target, \"$pkg\", { value: pkg });\n};\n\n///////// helpers ////////////////////////////\n\nfunction ensureAvailable(packageMap, pkg, identifierKey) {\n  let value = pkg[identifierKey];\n\n  if (value in packageMap) {\n    throw new Error(\n      \"package with \" + identifierKey + \" <\" + value + \"> already defined\"\n    );\n  }\n}\n\n/**\n * A utility that gets and sets properties of model elements.\n *\n * @param {Model} model\n */\nfunction Properties(model) {\n  this.model = model;\n}\n\n/**\n * Sets a named property on the target element.\n * If the value is undefined, the property gets deleted.\n *\n * @param {Object} target\n * @param {String} name\n * @param {Object} value\n */\nProperties.prototype.set = function (target, name, value) {\n  let property = this.model.getPropertyDescriptor(target, name);\n\n  let propertyName = property && property.name;\n\n  if (isUndefined(value)) {\n    // unset the property, if the specified value is undefined;\n    // delete from $attrs (for extensions) or the target itself\n    if (property) {\n      delete target[propertyName];\n    } else {\n      delete target.$attrs[name];\n    }\n  } else {\n    // set the property, defining well defined properties on the fly\n    // or simply updating them in target.$attrs (for extensions)\n    if (property) {\n      if (propertyName in target) {\n        target[propertyName] = value;\n      } else {\n        defineProperty(target, property, value);\n      }\n    } else {\n      target.$attrs[name] = value;\n    }\n  }\n};\n\n/**\n * Returns the named property of the given element\n *\n * @param  {Object} target\n * @param  {String} name\n *\n * @return {Object}\n */\nProperties.prototype.get = function (target, name) {\n  let property = this.model.getPropertyDescriptor(target, name);\n\n  if (!property) {\n    return target.$attrs[name];\n  }\n\n  let propertyName = property.name;\n\n  // check if access to collection property and lazily initialize it\n  if (!target[propertyName] && property.isMany) {\n    defineProperty(target, property, []);\n  }\n\n  return target[propertyName];\n};\n\n/**\n * Define a property on the target element\n *\n * @param  {Object} target\n * @param  {String} name\n * @param  {Object} options\n */\nProperties.prototype.define = function (target, name, options) {\n  Object.defineProperty(target, name, options);\n};\n\n/**\n * Define the descriptor for an element\n */\nProperties.prototype.defineDescriptor = function (target, descriptor) {\n  this.define(target, \"$descriptor\", { value: descriptor });\n};\n\n/**\n * Define the model for an element\n */\nProperties.prototype.defineModel = function (target, model) {\n  this.define(target, \"$model\", { value: model });\n};\n\nfunction isUndefined(val) {\n  return typeof val === \"undefined\";\n}\n\nfunction defineProperty(target, property, value) {\n  Object.defineProperty(target, property.name, {\n    enumerable: !property.isReference,\n    writable: true,\n    value: value,\n    configurable: true,\n  });\n}\n\n//// Moddle implementation /////////////////////////////////////////////////\n\n/**\n * @class Moddle\n *\n * A model that can be used to create elements of a specific type.\n *\n * @example\n *\n * let Moddle = require('moddle');\n *\n * let pkg = {\n *   name: 'mypackage',\n *   prefix: 'my',\n *   types: [\n *     { name: 'Root' }\n *   ]\n * };\n *\n * let moddle = new Moddle([pkg]);\n *\n * @param {Array<Package>} packages the packages to contain\n */\nfunction Moddle(packages) {\n  this.properties = new Properties(this);\n\n  this.factory = new Factory(this, this.properties);\n  this.registry = new Registry(packages, this.properties);\n\n  this.typeCache = {};\n}\n\n/**\n * Create an instance of the specified type.\n *\n * @method Moddle#create\n *\n * @example\n *\n * let foo = moddle.create('my:Foo');\n * let bar = moddle.create('my:Bar', { id: 'BAR_1' });\n *\n * @param  {String|Object} descriptor the type descriptor or name know to the model\n * @param  {Object} attrs   a number of attributes to initialize the model instance with\n * @return {Object}         model instance\n */\nModdle.prototype.create = function (descriptor, attrs) {\n  let Type = this.getType(descriptor);\n\n  if (!Type) {\n    throw new Error(\"unknown type <\" + descriptor + \">\");\n  }\n\n  return new Type(attrs);\n};\n\n/**\n * Returns the type representing a given descriptor\n *\n * @method Moddle#getType\n *\n * @example\n *\n * let Foo = moddle.getType('my:Foo');\n * let foo = new Foo({ 'id' : 'FOO_1' });\n *\n * @param  {String|Object} descriptor the type descriptor or name know to the model\n * @return {Object}         the type representing the descriptor\n */\nModdle.prototype.getType = function (descriptor) {\n  let cache = this.typeCache;\n\n  let name = isString(descriptor) ? descriptor : descriptor.ns.name;\n\n  let type = cache[name];\n\n  if (!type) {\n    descriptor = this.registry.getEffectiveDescriptor(name);\n    type = cache[name] = this.factory.createType(descriptor);\n  }\n\n  return type;\n};\n\n/**\n * Creates an any-element type to be used within model instances.\n *\n * This can be used to create custom elements that lie outside the meta-model.\n * The created element contains all the meta-data required to serialize it\n * as part of meta-model elements.\n *\n * @method Moddle#createAny\n *\n * @example\n *\n * let foo = moddle.createAny('vendor:Foo', 'http://vendor', {\n *   value: 'bar'\n * });\n *\n * let container = moddle.create('my:Container', 'http://my', {\n *   any: [ foo ]\n * });\n *\n * // go ahead and serialize the stuff\n *\n *\n * @param  {String} name  the name of the element\n * @param  {String} nsUri the namespace uri of the element\n * @param  {Object} [properties] a map of properties to initialize the instance with\n * @return {Object} the any type instance\n */\nModdle.prototype.createAny = function (name, nsUri, properties) {\n  let nameNs = parseName(name);\n\n  let element = {\n    $type: name,\n    $instanceOf: function (type) {\n      return type === this.$type;\n    },\n  };\n\n  let descriptor = {\n    name: name,\n    isGeneric: true,\n    ns: {\n      prefix: nameNs.prefix,\n      localName: nameNs.localName,\n      uri: nsUri,\n    },\n  };\n\n  this.properties.defineDescriptor(element, descriptor);\n  this.properties.defineModel(element, this);\n  this.properties.define(element, \"$parent\", {\n    enumerable: false,\n    writable: true,\n  });\n\n  forEach(properties, function (a, key) {\n    if (isObject(a) && a.value !== undefined) {\n      element[a.name] = a.value;\n    } else {\n      element[key] = a;\n    }\n  });\n\n  return element;\n};\n\n/**\n * Returns a registered package by uri or prefix\n *\n * @return {Object} the package\n */\nModdle.prototype.getPackage = function (uriOrPrefix) {\n  return this.registry.getPackage(uriOrPrefix);\n};\n\n/**\n * Returns a snapshot of all known packages\n *\n * @return {Object} the package\n */\nModdle.prototype.getPackages = function () {\n  return this.registry.getPackages();\n};\n\n/**\n * Returns the descriptor for an element\n */\nModdle.prototype.getElementDescriptor = function (element) {\n  return element.$descriptor;\n};\n\n/**\n * Returns true if the given descriptor or instance\n * represents the given type.\n *\n * May be applied to this, if element is omitted.\n */\nModdle.prototype.hasType = function (element, type) {\n  if (type === undefined) {\n    type = element;\n    element = this;\n  }\n\n  let descriptor = element.$model.getElementDescriptor(element);\n\n  return type in descriptor.allTypesByName;\n};\n\n/**\n * Returns the descriptor of an elements named property\n */\nModdle.prototype.getPropertyDescriptor = function (element, property) {\n  return this.getElementDescriptor(element).propertiesByName[property];\n};\n\n/**\n * Returns a mapped type's descriptor\n */\nModdle.prototype.getTypeDescriptor = function (type) {\n  return this.registry.typeMap[type];\n};\n\nexport {\n  Moddle,\n  coerceType,\n  isBuiltIn as isBuiltInType,\n  isSimple as isSimpleType,\n  parseName as parseNameNS,\n};\n","import { forEach, assign, find, filter, isString, map } from \"min-dash\";\nimport { Parser } from \"saxen\";\nimport { coerceType, parseNameNS, isSimpleType, Moddle } from \"../moddle\";\n\nfunction hasLowerCaseAlias(pkg) {\n  return pkg.xml && pkg.xml.tagAlias === \"lowerCase\";\n}\n\nconst DEFAULT_NS_MAP = {\n  xsi: \"http://www.w3.org/2001/XMLSchema-instance\",\n};\n\nconst XSI_TYPE = \"xsi:type\";\n\nfunction serializeFormat(element) {\n  return element.xml && element.xml.serialize;\n}\n\nfunction serializeAsType(element) {\n  return serializeFormat(element) === XSI_TYPE;\n}\n\nfunction serializeAsProperty(element) {\n  return serializeFormat(element) === \"property\";\n}\n\nfunction capitalize(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nfunction aliasToName(aliasNs, pkg) {\n  if (!hasLowerCaseAlias(pkg)) {\n    return aliasNs.name;\n  }\n\n  return aliasNs.prefix + \":\" + capitalize(aliasNs.localName);\n}\n\nfunction prefixedToName(nameNs, pkg) {\n  let name = nameNs.name,\n    localName = nameNs.localName;\n\n  let typePrefix = pkg.xml && pkg.xml.typePrefix;\n\n  if (typePrefix && localName.indexOf(typePrefix) === 0) {\n    return nameNs.prefix + \":\" + localName.slice(typePrefix.length);\n  } else {\n    return name;\n  }\n}\n\nfunction normalizeXsiTypeName(name, model) {\n  let nameNs = parseNameNS(name);\n  let pkg = model.getPackage(nameNs.prefix);\n\n  return prefixedToName(nameNs, pkg);\n}\n\nfunction error(message) {\n  return new Error(message);\n}\n\n/**\n * Get the moddle descriptor for a given instance or type.\n *\n * @param  {ModdleElement|Function} element\n *\n * @return {Object} the moddle descriptor\n */\nfunction getModdleDescriptor(element) {\n  return element.$descriptor;\n}\n\nfunction defer(fn) {\n  setTimeout(fn, 0);\n}\n\n/**\n * A parse context.\n *\n * @class\n *\n * @param {Object} options\n * @param {ElementHandler} options.rootHandler the root handler for parsing a document\n * @param {boolean} [options.lax=false] whether or not to ignore invalid elements\n */\nfunction Context(options) {\n  /**\n   * @property {ElementHandler} rootHandler\n   */\n\n  /**\n   * @property {Boolean} lax\n   */\n\n  assign(this, options);\n\n  this.elementsById = {};\n  this.references = [];\n  this.warnings = [];\n\n  /**\n   * Add an unresolved reference.\n   *\n   * @param {Object} reference\n   */\n  this.addReference = function (reference) {\n    this.references.push(reference);\n  };\n\n  /**\n   * Add a processed element.\n   *\n   * @param {ModdleElement} element\n   */\n  this.addElement = function (element) {\n    if (!element) {\n      throw error(\"expected element\");\n    }\n\n    let elementsById = this.elementsById;\n\n    let descriptor = getModdleDescriptor(element);\n\n    let idProperty = descriptor.idProperty,\n      id;\n\n    if (idProperty) {\n      id = element.get(idProperty.name);\n\n      if (id) {\n        // for QName validation as per http://www.w3.org/TR/REC-xml/#NT-NameChar\n        if (!/^([a-z][\\w-.]*:)?[a-z_][\\w-.]*$/i.test(id)) {\n          throw new Error(\"illegal ID <\" + id + \">\");\n        }\n\n        if (elementsById[id]) {\n          throw error(\"duplicate ID <\" + id + \">\");\n        }\n\n        elementsById[id] = element;\n      }\n    }\n  };\n\n  /**\n   * Add an import warning.\n   *\n   * @param {Object} warning\n   * @param {String} warning.message\n   * @param {Error} [warning.error]\n   */\n  this.addWarning = function (warning) {\n    this.warnings.push(warning);\n  };\n}\n\nfunction BaseHandler() {}\n\nBaseHandler.prototype.handleEnd = function () {};\nBaseHandler.prototype.handleText = function () {};\nBaseHandler.prototype.handleNode = function () {};\n\n/**\n * A simple pass through handler that does nothing except for\n * ignoring all input it receives.\n *\n * This is used to ignore unknown elements and\n * attributes.\n */\nfunction NoopHandler() {}\n\nNoopHandler.prototype = Object.create(BaseHandler.prototype);\n\nNoopHandler.prototype.handleNode = function () {\n  return this;\n};\n\nfunction BodyHandler() {}\n\nBodyHandler.prototype = Object.create(BaseHandler.prototype);\n\nBodyHandler.prototype.handleText = function (text) {\n  this.body = (this.body || \"\") + text;\n};\n\nfunction ReferenceHandler(property, context) {\n  this.property = property;\n  this.context = context;\n}\n\nReferenceHandler.prototype = Object.create(BodyHandler.prototype);\n\nReferenceHandler.prototype.handleNode = function (node) {\n  if (this.element) {\n    throw error(\"expected no sub nodes\");\n  } else {\n    this.element = this.createReference(node);\n  }\n\n  return this;\n};\n\nReferenceHandler.prototype.handleEnd = function () {\n  this.element.id = this.body;\n};\n\nReferenceHandler.prototype.createReference = function (node) {\n  return {\n    property: this.property.ns.name,\n    id: \"\",\n  };\n};\n\nfunction ValueHandler(propertyDesc, element) {\n  this.element = element;\n  this.propertyDesc = propertyDesc;\n}\n\nValueHandler.prototype = Object.create(BodyHandler.prototype);\n\nValueHandler.prototype.handleEnd = function () {\n  let value = this.body || \"\",\n    element = this.element,\n    propertyDesc = this.propertyDesc;\n\n  value = coerceType(propertyDesc.type, value);\n\n  if (propertyDesc.isMany) {\n    element.get(propertyDesc.name).push(value);\n  } else {\n    element.set(propertyDesc.name, value);\n  }\n};\n\nfunction BaseElementHandler() {}\n\nBaseElementHandler.prototype = Object.create(BodyHandler.prototype);\n\nBaseElementHandler.prototype.handleNode = function (node) {\n  let parser = this,\n    element = this.element;\n\n  if (!element) {\n    element = this.element = this.createElement(node);\n\n    this.context.addElement(element);\n  } else {\n    parser = this.handleChild(node);\n  }\n\n  return parser;\n};\n\n/**\n * @class Reader.ElementHandler\n *\n */\nfunction ElementHandler(model, typeName, context) {\n  this.model = model;\n  this.type = model.getType(typeName);\n  this.context = context;\n}\n\nElementHandler.prototype = Object.create(BaseElementHandler.prototype);\n\nElementHandler.prototype.addReference = function (reference) {\n  this.context.addReference(reference);\n};\n\nElementHandler.prototype.handleText = function (text) {\n  let element = this.element,\n    descriptor = getModdleDescriptor(element),\n    bodyProperty = descriptor.bodyProperty;\n\n  if (!bodyProperty) {\n    throw error(\"unexpected body text <\" + text + \">\");\n  }\n\n  BodyHandler.prototype.handleText.call(this, text);\n};\n\nElementHandler.prototype.handleEnd = function () {\n  let value = this.body,\n    element = this.element,\n    descriptor = getModdleDescriptor(element),\n    bodyProperty = descriptor.bodyProperty;\n\n  if (bodyProperty && value !== undefined) {\n    value = coerceType(bodyProperty.type, value);\n    element.set(bodyProperty.name, value);\n  }\n};\n\n/**\n * Create an instance of the model from the given node.\n *\n * @param  {Element} node the xml node\n */\nElementHandler.prototype.createElement = function (node) {\n  let attributes = node.attributes,\n    Type = this.type,\n    descriptor = getModdleDescriptor(Type),\n    context = this.context,\n    instance = new Type({}),\n    model = this.model,\n    propNameNs;\n\n  forEach(attributes, function (value, name) {\n    let prop = descriptor.propertiesByName[name],\n      values;\n\n    if (prop && prop.isReference) {\n      if (!prop.isMany) {\n        context.addReference({\n          element: instance,\n          property: prop.ns.name,\n          id: value,\n        });\n      } else {\n        // IDREFS: parse references as whitespace-separated list\n        values = value.split(\" \");\n\n        forEach(values, function (v) {\n          context.addReference({\n            element: instance,\n            property: prop.ns.name,\n            id: v,\n          });\n        });\n      }\n    } else {\n      if (prop) {\n        value = coerceType(prop.type, value);\n      } else if (name !== \"xmlns\") {\n        propNameNs = parseNameNS(name, descriptor.ns.prefix);\n\n        // check whether attribute is defined in a well-known namespace\n        // if that is the case we emit a warning to indicate potential misuse\n        if (model.getPackage(propNameNs.prefix)) {\n          context.addWarning({\n            message: \"unknown attribute <\" + name + \">\",\n            element: instance,\n            property: name,\n            value: value,\n          });\n        }\n      }\n\n      instance.set(name, value);\n    }\n  });\n\n  return instance;\n};\n\nElementHandler.prototype.getPropertyForNode = function (node) {\n  let name = node.name;\n  let nameNs = parseNameNS(name);\n\n  let type = this.type,\n    model = this.model,\n    descriptor = getModdleDescriptor(type);\n\n  let propertyName = nameNs.name,\n    property = descriptor.propertiesByName[propertyName],\n    elementTypeName,\n    elementType;\n\n  // search for properties by name first\n\n  if (property && !property.isAttr) {\n    if (serializeAsType(property)) {\n      elementTypeName = node.attributes[XSI_TYPE];\n\n      // xsi type is optional, if it does not exists the\n      // default type is assumed\n      if (elementTypeName) {\n        // take possible type prefixes from XML\n        // into account, i.e.: xsi:type=\"t{ActualType}\"\n        elementTypeName = normalizeXsiTypeName(elementTypeName, model);\n\n        elementType = model.getType(elementTypeName);\n\n        return assign({}, property, {\n          effectiveType: getModdleDescriptor(elementType).name,\n        });\n      }\n    }\n\n    // search for properties by name first\n    return property;\n  }\n\n  let pkg = model.getPackage(nameNs.prefix);\n\n  if (pkg) {\n    elementTypeName = aliasToName(nameNs, pkg);\n    elementType = model.getType(elementTypeName);\n\n    // search for collection members later\n    property = find(descriptor.properties, function (p) {\n      return (\n        !p.isVirtual &&\n        !p.isReference &&\n        !p.isAttribute &&\n        elementType.hasType(p.type)\n      );\n    });\n\n    if (property) {\n      return assign({}, property, {\n        effectiveType: getModdleDescriptor(elementType).name,\n      });\n    }\n  } else {\n    // parse unknown element (maybe extension)\n    property = find(descriptor.properties, function (p) {\n      return !p.isReference && !p.isAttribute && p.type === \"Element\";\n    });\n\n    if (property) {\n      return property;\n    }\n  }\n\n  throw error(\"unrecognized element <\" + nameNs.name + \">\");\n};\n\nElementHandler.prototype.toString = function () {\n  return \"ElementDescriptor[\" + getModdleDescriptor(this.type).name + \"]\";\n};\n\nElementHandler.prototype.valueHandler = function (propertyDesc, element) {\n  return new ValueHandler(propertyDesc, element);\n};\n\nElementHandler.prototype.referenceHandler = function (propertyDesc) {\n  return new ReferenceHandler(propertyDesc, this.context);\n};\n\nElementHandler.prototype.handler = function (type) {\n  if (type === \"Element\") {\n    return new GenericElementHandler(this.model, type, this.context);\n  } else {\n    return new ElementHandler(this.model, type, this.context);\n  }\n};\n\n/**\n * Handle the child element parsing\n *\n * @param  {Element} node the xml node\n */\nElementHandler.prototype.handleChild = function (node) {\n  let propertyDesc, type, element, childHandler;\n\n  propertyDesc = this.getPropertyForNode(node);\n  element = this.element;\n\n  type = propertyDesc.effectiveType || propertyDesc.type;\n\n  if (isSimpleType(type)) {\n    return this.valueHandler(propertyDesc, element);\n  }\n\n  if (propertyDesc.isReference) {\n    childHandler = this.referenceHandler(propertyDesc).handleNode(node);\n  } else {\n    childHandler = this.handler(type).handleNode(node);\n  }\n\n  let newElement = childHandler.element;\n\n  // child handles may decide to skip elements\n  // by not returning anything\n  if (newElement !== undefined) {\n    if (propertyDesc.isMany) {\n      element.get(propertyDesc.name).push(newElement);\n    } else {\n      element.set(propertyDesc.name, newElement);\n    }\n\n    if (propertyDesc.isReference) {\n      assign(newElement, {\n        element: element,\n      });\n\n      this.context.addReference(newElement);\n    } else {\n      // establish child -> parent relationship\n      newElement.$parent = element;\n    }\n  }\n\n  return childHandler;\n};\n\n/**\n * An element handler that performs special validation\n * to ensure the node it gets initialized with matches\n * the handlers type (namespace wise).\n *\n * @param {Moddle} model\n * @param {String} typeName\n * @param {Context} context\n */\nfunction RootElementHandler(model, typeName, context) {\n  ElementHandler.call(this, model, typeName, context);\n}\n\nRootElementHandler.prototype = Object.create(ElementHandler.prototype);\n\nRootElementHandler.prototype.createElement = function (node) {\n  let name = node.name,\n    nameNs = parseNameNS(name),\n    model = this.model,\n    type = this.type,\n    pkg = model.getPackage(nameNs.prefix),\n    typeName = (pkg && aliasToName(nameNs, pkg)) || name;\n\n  // verify the correct namespace if we parse\n  // the first element in the handler tree\n  //\n  // this ensures we don't mistakenly import wrong namespace elements\n  if (!type.hasType(typeName)) {\n    throw error(\"unexpected element <\" + node.originalName + \">\");\n  }\n\n  return ElementHandler.prototype.createElement.call(this, node);\n};\n\nfunction GenericElementHandler(model, typeName, context) {\n  this.model = model;\n  this.context = context;\n}\n\nGenericElementHandler.prototype = Object.create(BaseElementHandler.prototype);\n\nGenericElementHandler.prototype.createElement = function (node) {\n  let name = node.name,\n    ns = parseNameNS(name),\n    prefix = ns.prefix,\n    uri = node.ns[prefix + \"$uri\"],\n    attributes = node.attributes;\n\n  return this.model.createAny(name, uri, attributes);\n};\n\nGenericElementHandler.prototype.handleChild = function (node) {\n  let handler = new GenericElementHandler(\n      this.model,\n      \"Element\",\n      this.context\n    ).handleNode(node),\n    element = this.element;\n\n  let newElement = handler.element,\n    children;\n\n  if (newElement !== undefined) {\n    children = element.$children = element.$children || [];\n    children.push(newElement);\n\n    // establish child -> parent relationship\n    newElement.$parent = element;\n  }\n\n  return handler;\n};\n\nGenericElementHandler.prototype.handleEnd = function () {\n  if (this.body) {\n    this.element.$body = this.body;\n  }\n};\n\n/**\n * A reader for a meta-model\n *\n * @param {Object} options\n * @param {Model} options.model used to read xml files\n * @param {Boolean} options.lax whether to make parse errors warnings\n */\nfunction Reader(options) {\n  if (options instanceof Moddle) {\n    options = {\n      model: options,\n    };\n  }\n\n  assign(this, { lax: false }, options);\n}\n\n/**\n * Parse the given XML into a moddle document tree.\n *\n * @param {String} xml\n * @param {ElementHandler|Object} options or rootHandler\n * @param  {Function} done\n */\nReader.prototype.fromXML = function (xml, options, done) {\n  let rootHandler = options.rootHandler;\n\n  if (options instanceof ElementHandler) {\n    // root handler passed via (xml, { rootHandler: ElementHandler }, ...)\n    rootHandler = options;\n    options = {};\n  } else {\n    if (typeof options === \"string\") {\n      // rootHandler passed via (xml, 'someString', ...)\n      rootHandler = this.handler(options);\n      options = {};\n    } else if (typeof rootHandler === \"string\") {\n      // rootHandler passed via (xml, { rootHandler: 'someString' }, ...)\n      rootHandler = this.handler(rootHandler);\n    }\n  }\n\n  let model = this.model,\n    lax = this.lax;\n\n  let context = new Context(assign({}, options, { rootHandler: rootHandler })),\n    parser = new Parser({ proxy: true }),\n    stack = createStack();\n\n  rootHandler.context = context;\n\n  // push root handler\n  stack.push(rootHandler);\n\n  /**\n   * Handle error.\n   *\n   * @param  {Error} err\n   * @param  {Function} getContext\n   * @param  {boolean} lax\n   *\n   * @return {boolean} true if handled\n   */\n  function handleError(err, getContext, lax) {\n    let ctx = getContext();\n\n    let line = ctx.line,\n      column = ctx.column,\n      data = ctx.data;\n\n    // we receive the full context data here,\n    // for elements trim down the information\n    // to the tag name, only\n    if (data.charAt(0) === \"<\" && data.indexOf(\" \") !== -1) {\n      data = data.slice(0, data.indexOf(\" \")) + \">\";\n    }\n\n    let message =\n      \"unparsable content \" +\n      (data ? data + \" \" : \"\") +\n      \"detected\\n\\t\" +\n      \"line: \" +\n      line +\n      \"\\n\\t\" +\n      \"column: \" +\n      column +\n      \"\\n\\t\" +\n      \"nested error: \" +\n      err.message;\n\n    if (lax) {\n      context.addWarning({\n        message: message,\n        error: err,\n      });\n\n      return true;\n    } else {\n      throw error(message);\n    }\n  }\n\n  function handleWarning(err, getContext) {\n    // just like handling errors in <lax=true> mode\n    return handleError(err, getContext, true);\n  }\n\n  /**\n   * Resolve collected references on parse end.\n   */\n  function resolveReferences() {\n    let elementsById = context.elementsById;\n    let references = context.references;\n\n    let i, r;\n\n    for (i = 0; (r = references[i]); i++) {\n      let element = r.element;\n      let reference = elementsById[r.id];\n      let property = getModdleDescriptor(element).propertiesByName[r.property];\n\n      if (!reference) {\n        context.addWarning({\n          message: \"unresolved reference <\" + r.id + \">\",\n          element: r.element,\n          property: r.property,\n          value: r.id,\n        });\n      }\n\n      if (property.isMany) {\n        let collection = element.get(property.name),\n          idx = collection.indexOf(r);\n\n        // we replace an existing place holder (idx != -1) or\n        // append to the collection instead\n        if (idx === -1) {\n          idx = collection.length;\n        }\n\n        if (!reference) {\n          // remove unresolvable reference\n          collection.splice(idx, 1);\n        } else {\n          // add or update reference in collection\n          collection[idx] = reference;\n        }\n      } else {\n        element.set(property.name, reference);\n      }\n    }\n  }\n\n  function handleClose() {\n    stack.pop().handleEnd();\n  }\n\n  let PREAMBLE_START_PATTERN = /^<\\?xml /i;\n\n  let ENCODING_PATTERN = / encoding=\"([^\"]+)\"/i;\n\n  let UTF_8_PATTERN = /^utf-8$/i;\n\n  function handleQuestion(question) {\n    if (!PREAMBLE_START_PATTERN.test(question)) {\n      return;\n    }\n\n    let match = ENCODING_PATTERN.exec(question);\n    let encoding = match && match[1];\n\n    if (!encoding || UTF_8_PATTERN.test(encoding)) {\n      return;\n    }\n\n    context.addWarning({\n      message:\n        \"unsupported document encoding <\" +\n        encoding +\n        \">, \" +\n        \"falling back to UTF-8\",\n    });\n  }\n\n  function handleOpen(node, getContext) {\n    let handler = stack.peek();\n\n    try {\n      stack.push(handler.handleNode(node));\n    } catch (err) {\n      if (handleError(err, getContext, lax)) {\n        stack.push(new NoopHandler());\n      }\n    }\n  }\n\n  function handleCData(text, getContext) {\n    try {\n      stack.peek().handleText(text);\n    } catch (err) {\n      handleWarning(err, getContext);\n    }\n  }\n\n  function handleText(text, getContext) {\n    // strip whitespace only nodes, i.e. before\n    // <!CDATA[ ... ]> sections and in between tags\n    text = text.trim();\n\n    if (!text) {\n      return;\n    }\n\n    handleCData(text, getContext);\n  }\n\n  let uriMap = model.getPackages().reduce(function (uriMap, p) {\n    uriMap[p.uri] = p.prefix;\n\n    return uriMap;\n  }, {});\n\n  parser\n    .ns(uriMap)\n    .on(\"openTag\", function (obj, decodeStr, selfClosing, getContext) {\n      // gracefully handle unparsable attributes (attrs=false)\n      let attrs = obj.attrs || {};\n\n      let decodedAttrs = Object.keys(attrs).reduce(function (d, key) {\n        let value = decodeStr(attrs[key]);\n\n        d[key] = value;\n\n        return d;\n      }, {});\n\n      let node = {\n        name: obj.name,\n        originalName: obj.originalName,\n        attributes: decodedAttrs,\n        ns: obj.ns,\n      };\n\n      handleOpen(node, getContext);\n    })\n    .on(\"question\", handleQuestion)\n    .on(\"closeTag\", handleClose)\n    .on(\"cdata\", handleCData)\n    .on(\"text\", function (text, decodeEntities, getContext) {\n      handleText(decodeEntities(text), getContext);\n    })\n    .on(\"error\", handleError)\n    .on(\"warn\", handleWarning);\n\n  // deferred parse XML to make loading really ascnchronous\n  // this ensures the execution environment (node or browser)\n  // is kept responsive and that certain optimization strategies\n  // can kick in\n  defer(function () {\n    let err;\n\n    try {\n      parser.parse(xml);\n\n      resolveReferences();\n    } catch (e) {\n      err = e;\n    }\n\n    let element = rootHandler.element;\n\n    // handle the situation that we could not extract\n    // the desired root element from the document\n    if (!err && !element) {\n      err = error(\n        \"failed to parse document as <\" +\n          rootHandler.type.$descriptor.name +\n          \">\"\n      );\n    }\n\n    done(err, err ? undefined : element, context);\n  });\n};\n\nReader.prototype.handler = function (name) {\n  return new RootElementHandler(this.model, name);\n};\n\n// helpers //////////////////////////\n\nfunction createStack() {\n  let stack = [];\n\n  Object.defineProperty(stack, \"peek\", {\n    value: function () {\n      return this[this.length - 1];\n    },\n  });\n\n  return stack;\n}\n\nlet XML_PREAMBLE = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n';\n\nlet ESCAPE_ATTR_CHARS = /<|>|'|\"|&|\\n\\r|\\n/g;\nlet ESCAPE_CHARS = /<|>|&/g;\n\nfunction Namespaces(parent) {\n  let prefixMap = {};\n  let uriMap = {};\n  let used = {};\n\n  let wellknown = [];\n  let custom = [];\n\n  // API\n\n  this.byUri = function (uri) {\n    return uriMap[uri] || (parent && parent.byUri(uri));\n  };\n\n  this.add = function (ns, isWellknown) {\n    uriMap[ns.uri] = ns;\n\n    if (isWellknown) {\n      wellknown.push(ns);\n    } else {\n      custom.push(ns);\n    }\n\n    this.mapPrefix(ns.prefix, ns.uri);\n  };\n\n  this.uriByPrefix = function (prefix) {\n    return prefixMap[prefix || \"xmlns\"];\n  };\n\n  this.mapPrefix = function (prefix, uri) {\n    prefixMap[prefix || \"xmlns\"] = uri;\n  };\n\n  this.logUsed = function (ns) {\n    let uri = ns.uri;\n\n    used[uri] = this.byUri(uri);\n  };\n\n  this.getUsed = function (ns) {\n    function isUsed(ns) {\n      return used[ns.uri];\n    }\n\n    let allNs = [].concat(wellknown, custom);\n\n    return allNs.filter(isUsed);\n  };\n}\n\nfunction lower(string) {\n  return string.charAt(0).toLowerCase() + string.slice(1);\n}\n\nfunction nameToAlias(name, pkg) {\n  if (hasLowerCaseAlias(pkg)) {\n    return lower(name);\n  } else {\n    return name;\n  }\n}\n\nfunction inherits(ctor, superCtor) {\n  ctor.super_ = superCtor;\n  ctor.prototype = Object.create(superCtor.prototype, {\n    constructor: {\n      value: ctor,\n      enumerable: false,\n      writable: true,\n      configurable: true,\n    },\n  });\n}\n\nfunction nsName(ns) {\n  if (isString(ns)) {\n    return ns;\n  } else {\n    // return ns.localName\n    return (ns.prefix ? ns.prefix + \":\" : \"\") + ns.localName;\n  }\n}\n\nfunction getNsAttrs(namespaces) {\n  return map(namespaces.getUsed(), function (ns) {\n    let name = \"xmlns\" + (ns.prefix ? \":\" + ns.prefix : \"\");\n    return { name: name, value: ns.uri };\n  });\n}\n\nfunction getElementNs(ns, descriptor) {\n  if (descriptor.isGeneric) {\n    return assign({ localName: descriptor.ns.localName }, ns);\n  } else {\n    return assign(\n      { localName: nameToAlias(descriptor.ns.localName, descriptor.$pkg) },\n      ns\n    );\n  }\n}\n\nfunction getPropertyNs(ns, descriptor) {\n  return assign({ localName: descriptor.ns.localName }, ns);\n}\n\nfunction getSerializableProperties(element) {\n  let descriptor = element.$descriptor;\n\n  return filter(descriptor.properties, function (p) {\n    let name = p.name;\n\n    if (p.isVirtual) {\n      return false;\n    }\n\n    // do not serialize defaults\n    if (!element.hasOwnProperty(name)) {\n      return false;\n    }\n\n    let value = element[name];\n\n    // do not serialize default equals\n    if (value === p.default) {\n      return false;\n    }\n\n    // do not serialize null properties\n    if (value === null) {\n      return false;\n    }\n\n    return p.isMany ? value.length : true;\n  });\n}\n\nlet ESCAPE_ATTR_MAP = {\n  \"\\n\": \"#10\",\n  \"\\n\\r\": \"#10\",\n  '\"': \"#34\",\n  \"'\": \"#39\",\n  \"<\": \"#60\",\n  \">\": \"#62\",\n  \"&\": \"#38\",\n};\n\nlet ESCAPE_MAP = {\n  \"<\": \"lt\",\n  \">\": \"gt\",\n  \"&\": \"amp\",\n};\n\nfunction escape(str, charPattern, replaceMap) {\n  // ensure we are handling strings here\n  str = isString(str) ? str : \"\" + str;\n\n  return str.replace(charPattern, function (s) {\n    return \"&\" + replaceMap[s] + \";\";\n  });\n}\n\n/**\n * Escape a string attribute to not contain any bad values (line breaks, '\"', ...)\n *\n * @param {String} str the string to escape\n * @return {String} the escaped string\n */\nfunction escapeAttr(str) {\n  return escape(str, ESCAPE_ATTR_CHARS, ESCAPE_ATTR_MAP);\n}\n\nfunction escapeBody(str) {\n  return escape(str, ESCAPE_CHARS, ESCAPE_MAP);\n}\n\nfunction filterAttributes(props) {\n  return filter(props, function (p) {\n    return p.isAttr;\n  });\n}\n\nfunction filterContained(props) {\n  return filter(props, function (p) {\n    return !p.isAttr;\n  });\n}\n\nfunction ReferenceSerializer(tagName) {\n  this.tagName = tagName;\n}\n\nReferenceSerializer.prototype.build = function (element) {\n  this.element = element;\n  return this;\n};\n\nReferenceSerializer.prototype.serializeTo = function (writer) {\n  writer\n    .appendIndent()\n    .append(\n      \"<\" + this.tagName + \">\" + this.element.id + \"</\" + this.tagName + \">\"\n    )\n    .appendNewLine();\n};\n\nfunction BodySerializer() {}\n\nBodySerializer.prototype.serializeValue = BodySerializer.prototype.serializeTo = function (\n  writer\n) {\n  writer.append(this.escape ? escapeBody(this.value) : this.value);\n};\n\nBodySerializer.prototype.build = function (prop, value) {\n  this.value = value;\n\n  if (prop.type === \"String\" && value.search(ESCAPE_CHARS) !== -1) {\n    this.escape = true;\n  }\n\n  return this;\n};\n\nfunction ValueSerializer(tagName) {\n  this.tagName = tagName;\n}\n\ninherits(ValueSerializer, BodySerializer);\n\nValueSerializer.prototype.serializeTo = function (writer) {\n  writer.appendIndent().append(\"<\" + this.tagName + \">\");\n\n  this.serializeValue(writer);\n\n  writer.append(\"</\" + this.tagName + \">\").appendNewLine();\n};\n\nfunction ElementSerializer(parent, propertyDescriptor) {\n  this.body = [];\n  this.attrs = [];\n\n  this.parent = parent;\n  this.propertyDescriptor = propertyDescriptor;\n}\n\nElementSerializer.prototype.build = function (element) {\n  this.element = element;\n\n  let elementDescriptor = element.$descriptor,\n    propertyDescriptor = this.propertyDescriptor;\n\n  let otherAttrs, properties;\n\n  let isGeneric = elementDescriptor.isGeneric;\n\n  if (isGeneric) {\n    otherAttrs = this.parseGeneric(element);\n  } else {\n    otherAttrs = this.parseNsAttributes(element);\n  }\n\n  if (propertyDescriptor) {\n    this.ns = this.nsPropertyTagName(propertyDescriptor);\n  } else {\n    this.ns = this.nsTagName(elementDescriptor);\n  }\n\n  // compute tag name\n  this.tagName = this.addTagName(this.ns);\n\n  if (!isGeneric) {\n    properties = getSerializableProperties(element);\n\n    this.parseAttributes(filterAttributes(properties));\n    this.parseContainments(filterContained(properties));\n  }\n\n  this.parseGenericAttributes(element, otherAttrs);\n\n  return this;\n};\n\nElementSerializer.prototype.nsTagName = function (descriptor) {\n  let effectiveNs = this.logNamespaceUsed(descriptor.ns);\n  return getElementNs(effectiveNs, descriptor);\n};\n\nElementSerializer.prototype.nsPropertyTagName = function (descriptor) {\n  let effectiveNs = this.logNamespaceUsed(descriptor.ns);\n  return getPropertyNs(effectiveNs, descriptor);\n};\n\nElementSerializer.prototype.isLocalNs = function (ns) {\n  return ns.uri === this.ns.uri;\n};\n\n/**\n * Get the actual ns attribute name for the given element.\n *\n * @param {Object} element\n * @param {Boolean} [element.inherited=false]\n *\n * @return {Object} nsName\n */\nElementSerializer.prototype.nsAttributeName = function (element) {\n  let ns;\n\n  if (isString(element)) {\n    ns = parseNameNS(element);\n  } else {\n    ns = element.ns;\n  }\n\n  // return just local name for inherited attributes\n  if (element.inherited) {\n    return { localName: ns.localName };\n  }\n\n  // parse + log effective ns\n  let effectiveNs = this.logNamespaceUsed(ns);\n\n  // LOG ACTUAL namespace use\n  this.getNamespaces().logUsed(effectiveNs);\n\n  // strip prefix if same namespace like parent\n  if (this.isLocalNs(effectiveNs)) {\n    return { localName: ns.localName };\n  } else {\n    return assign({ localName: ns.localName }, effectiveNs);\n  }\n};\n\nElementSerializer.prototype.parseGeneric = function (element) {\n  let self = this,\n    body = this.body;\n\n  let attributes = [];\n\n  forEach(element, function (val, key) {\n    let nonNsAttr;\n\n    if (key === \"$body\") {\n      body.push(new BodySerializer().build({ type: \"String\" }, val));\n    } else if (key === \"$children\") {\n      forEach(val, function (child) {\n        body.push(new ElementSerializer(self).build(child));\n      });\n    } else if (key.indexOf(\"$\") !== 0) {\n      nonNsAttr = self.parseNsAttribute(element, key, val);\n\n      if (nonNsAttr) {\n        attributes.push({ name: key, value: val });\n      }\n    }\n  });\n\n  return attributes;\n};\n\nElementSerializer.prototype.parseNsAttribute = function (element, name, value) {\n  let model = element.$model;\n\n  let nameNs = parseNameNS(name);\n\n  let ns;\n\n  // parse xmlns:foo=\"http://foo.bar\"\n  if (nameNs.prefix === \"xmlns\") {\n    ns = { prefix: nameNs.localName, uri: value };\n  }\n\n  // parse xmlns=\"http://foo.bar\"\n  if (!nameNs.prefix && nameNs.localName === \"xmlns\") {\n    ns = { uri: value };\n  }\n\n  if (!ns) {\n    return {\n      name: name,\n      value: value,\n    };\n  }\n\n  if (model && model.getPackage(value)) {\n    // register well known namespace\n    this.logNamespace(ns, true, true);\n  } else {\n    // log custom namespace directly as used\n    let actualNs = this.logNamespaceUsed(ns, true);\n\n    this.getNamespaces().logUsed(actualNs);\n  }\n};\n\n/**\n * Parse namespaces and return a list of left over generic attributes\n *\n * @param  {Object} element\n * @return {Array<Object>}\n */\nElementSerializer.prototype.parseNsAttributes = function (element, attrs) {\n  let self = this;\n\n  let genericAttrs = element.$attrs;\n\n  let attributes = [];\n\n  // parse namespace attributes first\n  // and log them. push non namespace attributes to a list\n  // and process them later\n  forEach(genericAttrs, function (value, name) {\n    let nonNsAttr = self.parseNsAttribute(element, name, value);\n\n    if (nonNsAttr) {\n      attributes.push(nonNsAttr);\n    }\n  });\n\n  return attributes;\n};\n\nElementSerializer.prototype.parseGenericAttributes = function (\n  element,\n  attributes\n) {\n  let self = this;\n\n  forEach(attributes, function (attr) {\n    // do not serialize xsi:type attribute\n    // it is set manually based on the actual implementation type\n    if (attr.name === XSI_TYPE) {\n      return;\n    }\n\n    try {\n      self.addAttribute(self.nsAttributeName(attr.name), attr.value);\n    } catch (e) {\n      console.warn(\n        \"missing namespace information for \",\n        attr.name,\n        \"=\",\n        attr.value,\n        \"on\",\n        element,\n        e\n      );\n    }\n  });\n};\n\nElementSerializer.prototype.parseContainments = function (properties) {\n  let self = this,\n    body = this.body,\n    element = this.element;\n\n  forEach(properties, function (p) {\n    let value = element.get(p.name),\n      isReference = p.isReference,\n      isMany = p.isMany;\n\n    if (!isMany) {\n      value = [value];\n    }\n\n    if (p.isBody) {\n      body.push(new BodySerializer().build(p, value[0]));\n    } else if (isSimpleType(p.type)) {\n      forEach(value, function (v) {\n        body.push(\n          new ValueSerializer(self.addTagName(self.nsPropertyTagName(p))).build(\n            p,\n            v\n          )\n        );\n      });\n    } else if (isReference) {\n      forEach(value, function (v) {\n        body.push(\n          new ReferenceSerializer(\n            self.addTagName(self.nsPropertyTagName(p))\n          ).build(v)\n        );\n      });\n    } else {\n      // allow serialization via type\n      // rather than element name\n      let asType = serializeAsType(p),\n        asProperty = serializeAsProperty(p);\n\n      forEach(value, function (v) {\n        let serializer;\n\n        if (asType) {\n          serializer = new TypeSerializer(self, p);\n        } else if (asProperty) {\n          serializer = new ElementSerializer(self, p);\n        } else {\n          serializer = new ElementSerializer(self);\n        }\n\n        body.push(serializer.build(v));\n      });\n    }\n  });\n};\n\nElementSerializer.prototype.getNamespaces = function (local) {\n  let namespaces = this.namespaces,\n    parent = this.parent,\n    parentNamespaces;\n\n  if (!namespaces) {\n    parentNamespaces = parent && parent.getNamespaces();\n\n    if (local || !parentNamespaces) {\n      this.namespaces = namespaces = new Namespaces(parentNamespaces);\n    } else {\n      namespaces = parentNamespaces;\n    }\n  }\n\n  return namespaces;\n};\n\nElementSerializer.prototype.logNamespace = function (ns, wellknown, local) {\n  let namespaces = this.getNamespaces(local);\n\n  let nsUri = ns.uri,\n    nsPrefix = ns.prefix;\n\n  let existing = namespaces.byUri(nsUri);\n\n  if (!existing) {\n    namespaces.add(ns, wellknown);\n  }\n\n  namespaces.mapPrefix(nsPrefix, nsUri);\n\n  return ns;\n};\n\nElementSerializer.prototype.logNamespaceUsed = function (ns, local) {\n  let element = this.element,\n    model = element.$model,\n    namespaces = this.getNamespaces(local);\n\n  // ns may be\n  //\n  //   * prefix only\n  //   * prefix:uri\n  //   * localName only\n\n  let prefix = ns.prefix,\n    uri = ns.uri,\n    newPrefix,\n    idx,\n    wellknownUri;\n\n  // handle anonymous namespaces (elementForm=unqualified), cf. #23\n  if (!prefix && !uri) {\n    return { localName: ns.localName };\n  }\n\n  wellknownUri =\n    DEFAULT_NS_MAP[prefix] || (model && (model.getPackage(prefix) || {}).uri);\n\n  uri = uri || wellknownUri || namespaces.uriByPrefix(prefix);\n\n  if (!uri) {\n    throw new Error(\"no namespace uri given for prefix <\" + prefix + \">\");\n  }\n\n  ns = namespaces.byUri(uri);\n\n  if (!ns) {\n    newPrefix = prefix;\n    idx = 1;\n\n    // find a prefix that is not mapped yet\n    while (namespaces.uriByPrefix(newPrefix)) {\n      newPrefix = prefix + \"_\" + idx++;\n    }\n\n    ns = this.logNamespace(\n      { prefix: newPrefix, uri: uri },\n      wellknownUri === uri\n    );\n  }\n\n  if (prefix) {\n    namespaces.mapPrefix(prefix, uri);\n  }\n\n  return ns;\n};\n\nElementSerializer.prototype.parseAttributes = function (properties) {\n  let self = this,\n    element = this.element;\n\n  forEach(properties, function (p) {\n    let value = element.get(p.name);\n\n    if (p.isReference) {\n      if (!p.isMany) {\n        value = value.id;\n      } else {\n        let values = [];\n        forEach(value, function (v) {\n          values.push(v.id);\n        });\n        // IDREFS is a whitespace-separated list of references.\n        value = values.join(\" \");\n      }\n    }\n\n    self.addAttribute(self.nsAttributeName(p), value);\n  });\n};\n\nElementSerializer.prototype.addTagName = function (nsTagName) {\n  let actualNs = this.logNamespaceUsed(nsTagName);\n\n  this.getNamespaces().logUsed(actualNs);\n\n  return nsName(nsTagName);\n};\n\nElementSerializer.prototype.addAttribute = function (name, value) {\n  let attrs = this.attrs;\n\n  if (isString(value)) {\n    value = escapeAttr(value);\n  }\n\n  attrs.push({ name: name, value: value });\n};\n\nElementSerializer.prototype.serializeAttributes = function (writer) {\n  let attrs = this.attrs,\n    namespaces = this.namespaces;\n\n  if (namespaces) {\n    attrs = getNsAttrs(namespaces).concat(attrs);\n  }\n\n  forEach(attrs, function (a) {\n    writer\n      .append(\" \")\n      .append(nsName(a.name))\n      .append('=\"')\n      .append(a.value)\n      .append('\"');\n  });\n};\n\nElementSerializer.prototype.serializeTo = function (writer) {\n  let firstBody = this.body[0],\n    indent = firstBody && firstBody.constructor !== BodySerializer;\n\n  writer.appendIndent().append(\"<\" + this.tagName);\n\n  this.serializeAttributes(writer);\n\n  writer.append(firstBody ? \">\" : \" />\");\n\n  if (firstBody) {\n    if (indent) {\n      writer.appendNewLine().indent();\n    }\n\n    forEach(this.body, function (b) {\n      b.serializeTo(writer);\n    });\n\n    if (indent) {\n      writer.unindent().appendIndent();\n    }\n\n    writer.append(\"</\" + this.tagName + \">\");\n  }\n\n  writer.appendNewLine();\n};\n\n/**\n * A serializer for types that handles serialization of data types\n */\nfunction TypeSerializer(parent, propertyDescriptor) {\n  ElementSerializer.call(this, parent, propertyDescriptor);\n}\n\ninherits(TypeSerializer, ElementSerializer);\n\nTypeSerializer.prototype.parseNsAttributes = function (element) {\n  // extracted attributes\n  let attributes = ElementSerializer.prototype.parseNsAttributes.call(\n    this,\n    element\n  );\n\n  let descriptor = element.$descriptor;\n\n  // only serialize xsi:type if necessary\n  if (descriptor.name === this.propertyDescriptor.type) {\n    return attributes;\n  }\n\n  let typeNs = (this.typeNs = this.nsTagName(descriptor));\n  this.getNamespaces().logUsed(this.typeNs);\n\n  // add xsi:type attribute to represent the elements\n  // actual type\n\n  let pkg = element.$model.getPackage(typeNs.uri),\n    typePrefix = (pkg.xml && pkg.xml.typePrefix) || \"\";\n\n  this.addAttribute(\n    this.nsAttributeName(XSI_TYPE),\n    (typeNs.prefix ? typeNs.prefix + \":\" : \"\") +\n      typePrefix +\n      descriptor.ns.localName\n  );\n\n  return attributes;\n};\n\nTypeSerializer.prototype.isLocalNs = function (ns) {\n  return ns.uri === (this.typeNs || this.ns).uri;\n};\n\nfunction SavingWriter() {\n  this.value = \"\";\n\n  this.write = function (str) {\n    this.value += str;\n  };\n}\n\nfunction FormatingWriter(out, format) {\n  let indent = [\"\"];\n\n  this.append = function (str) {\n    out.write(str);\n\n    return this;\n  };\n\n  this.appendNewLine = function () {\n    if (format) {\n      out.write(\"\\n\");\n    }\n\n    return this;\n  };\n\n  this.appendIndent = function () {\n    if (format) {\n      out.write(indent.join(\"  \"));\n    }\n\n    return this;\n  };\n\n  this.indent = function () {\n    indent.push(\"\");\n    return this;\n  };\n\n  this.unindent = function () {\n    indent.pop();\n    return this;\n  };\n}\n\n/**\n * A writer for meta-model backed document trees\n *\n * @param {Object} options output options to pass into the writer\n */\nfunction Writer(options) {\n  options = assign({ format: false, preamble: true }, options || {});\n\n  function toXML(tree, writer) {\n    let internalWriter = writer || new SavingWriter();\n    let formatingWriter = new FormatingWriter(internalWriter, options.format);\n\n    if (options.preamble) {\n      formatingWriter.append(XML_PREAMBLE);\n    }\n\n    new ElementSerializer().build(tree).serializeTo(formatingWriter);\n\n    if (!writer) {\n      return internalWriter.value;\n    }\n  }\n\n  return {\n    toXML: toXML,\n  };\n}\n\nexport { Reader, Writer };\n","import { isString, isFunction, assign } from \"min-dash\";\nimport { Moddle } from \"../moddle\";\nimport { Reader, Writer } from \"../moddle-xml\";\n\n/**\n * A sub class of {@link Moddle} with support for import and export of BPMN 2.0 xml files.\n *\n * @class BpmnModdle\n * @extends Moddle\n *\n * @param {Object|Array} packages to use for instantiating the model\n * @param {Object} [options] additional options to pass over\n */\nfunction BpmnModdle(packages, options) {\n  Moddle.call(this, packages, options);\n}\n\nBpmnModdle.prototype = Object.create(Moddle.prototype);\n\n/**\n * Instantiates a BPMN model tree from a given xml string.\n *\n * @param {String}   xmlStr\n * @param {String}   [typeName='bpmn:Process-actions'] name of the root element\n * @param {Object}   [options]  options to pass to the underlying reader\n * @param {Function} done       callback that is invoked with (err, result, parseContext)\n *                              once the import completes\n */\nBpmnModdle.prototype.fromXML = function (xmlStr, typeName, options, done) {\n  if (!isString(typeName)) {\n    done = options;\n    options = typeName;\n    typeName = \"bpmn:Process-actions\";\n  }\n\n  if (isFunction(options)) {\n    done = options;\n    options = {};\n  }\n\n  let reader = new Reader(assign({ model: this, lax: true }, options));\n  let rootHandler = reader.handler(typeName);\n\n  reader.fromXML(xmlStr, rootHandler, done);\n};\n\n/**\n * Serializes a BPMN 2.0 object tree to XML.\n *\n * @param {String}   element    the root element, typically an instance of `bpmn:Process-actions`\n * @param {Object}   [options]  to pass to the underlying writer\n * @param {Function} done       callback invoked with (err, xmlStr) once the import completes\n */\nBpmnModdle.prototype.toXML = function (element, options, done) {\n  if (isFunction(options)) {\n    done = options;\n    options = {};\n  }\n\n  let writer = new Writer(options);\n\n  let result;\n  let err;\n\n  try {\n    result = writer.toXML(element);\n  } catch (e) {\n    err = e;\n  }\n\n  return done(err, result);\n};\n\nlet name = \"BPMN20\";\nlet uri = \"http://www.omg.org/spec/BPMN/20100524/MODEL\";\nlet associations = [];\nlet types = [\n  {\n    name: \"Interface\",\n    superClass: [\"RootElement\"],\n    properties: [\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"operations\",\n        type: \"Operation\",\n        isMany: true,\n      },\n      {\n        name: \"implementationRef\",\n        type: \"String\",\n        isAttr: true,\n      },\n    ],\n  },\n  {\n    name: \"Operation\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"inMessageRef\",\n        type: \"Message\",\n        isReference: true,\n      },\n      {\n        name: \"outMessageRef\",\n        type: \"Message\",\n        isReference: true,\n      },\n      {\n        name: \"errorRef\",\n        type: \"Error\",\n        isMany: true,\n        isReference: true,\n      },\n      {\n        name: \"implementationRef\",\n        type: \"String\",\n        isAttr: true,\n      },\n    ],\n  },\n  {\n    name: \"EndPoint\",\n    superClass: [\"RootElement\"],\n  },\n  {\n    name: \"Auditing\",\n    superClass: [\"BaseElement\"],\n  },\n  {\n    name: \"GlobalTask\",\n    superClass: [\"CallableElement\"],\n    properties: [\n      {\n        name: \"resources\",\n        type: \"ResourceRole\",\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"Monitoring\",\n    superClass: [\"BaseElement\"],\n  },\n  {\n    name: \"Performer\",\n    superClass: [\"ResourceRole\"],\n  },\n  {\n    name: \"Process-action\",\n    superClass: [\"FlowElementsContainer\", \"CallableElement\"],\n    properties: [\n      {\n        name: \"targetModel\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"sourceModel\",\n        isAttr: true,\n        type: \"String\",\n      },\n      // {\n      //   name: \"staticCompile\",\n      //   isAttr: true,\n      //   type: \"Boolean\",\n      //   default: true,\n      // },\n    ],\n  },\n  {\n    name: \"Gateway\",\n    isAbstract: true,\n    superClass: [\"FlowNode\"],\n    properties: [\n      {\n        name: \"gatewayDirection\",\n        type: \"GatewayDirection\",\n        default: \"Unspecified\",\n        isAttr: true,\n      },\n    ],\n  },\n  {\n    name: \"EventBasedGateway\",\n    superClass: [\"Gateway\"],\n    properties: [\n      {\n        name: \"instantiate\",\n        default: false,\n        isAttr: true,\n        type: \"Boolean\",\n      },\n      {\n        name: \"eventGatewayType\",\n        type: \"EventBasedGatewayType\",\n        isAttr: true,\n        default: \"Exclusive\",\n      },\n    ],\n  },\n  {\n    name: \"Parameter\",\n    superClass: [\"Element\"],\n    meta: {\n      allowedIn: [\"bpmn:Function\", \"bpmn:Query\"],\n    },\n    properties: [\n      {\n        name: \"id\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"target\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"expression\",\n        isAttr: true,\n        type: \"String\",\n      },\n    ],\n  },\n  {\n    name: \"Query\",\n    superClass: [\"Gateway\"],\n    properties: [\n      {\n        name: \"target\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"expression\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"expressionValue\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"model\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"isJson\",\n        isAttr: true,\n        type: \"Boolean\",\n        default: false,\n      },\n      {\n        name: \"returnType\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"values\",\n        type: \"Element\",\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"RootElement\",\n    isAbstract: true,\n    superClass: [\"BaseElement\"],\n  },\n  {\n    name: \"Relationship\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"type\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"direction\",\n        type: \"RelationshipDirection\",\n        isAttr: true,\n      },\n      {\n        name: \"source\",\n        isMany: true,\n        isReference: true,\n        type: \"Element\",\n      },\n      {\n        name: \"target\",\n        isMany: true,\n        isReference: true,\n        type: \"Element\",\n      },\n    ],\n  },\n  {\n    name: \"BaseElement\",\n    isAbstract: true,\n    properties: [\n      {\n        name: \"id\",\n        isAttr: true,\n        type: \"String\",\n        isId: true,\n      },\n      {\n        name: \"documentation\",\n        type: \"Documentation\",\n        isMany: true,\n      },\n      {\n        name: \"extensionDefinitions\",\n        type: \"ExtensionDefinition\",\n        isMany: true,\n        isReference: true,\n      },\n      {\n        name: \"assignElements\",\n        type: \"AssignElements\",\n      },\n      {\n        name: \"parameters\",\n        type: \"Parameters\",\n      },\n    ],\n  },\n  {\n    name: \"Extension\",\n    properties: [\n      {\n        name: \"mustUnderstand\",\n        default: false,\n        isAttr: true,\n        type: \"Boolean\",\n      },\n      {\n        name: \"definition\",\n        type: \"ExtensionDefinition\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"ExtensionDefinition\",\n    properties: [\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"extensionAttributeDefinitions\",\n        type: \"ExtensionAttributeDefinition\",\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"ExtensionAttributeDefinition\",\n    properties: [\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"type\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"isReference\",\n        default: false,\n        isAttr: true,\n        type: \"Boolean\",\n      },\n      {\n        name: \"extensionDefinition\",\n        type: \"ExtensionDefinition\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"AssignElements\",\n    properties: [\n      {\n        name: \"valueRef\",\n        isAttr: true,\n        isReference: true,\n        type: \"Element\",\n      },\n      {\n        name: \"values\",\n        type: \"Element\",\n        isMany: true,\n      },\n      {\n        name: \"extensionAttributeDefinition\",\n        type: \"ExtensionAttributeDefinition\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"Parameters\",\n    properties: [\n      {\n        name: \"values\",\n        type: \"Element\",\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"FlowElement\",\n    isAbstract: true,\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"auditing\",\n        type: \"Auditing\",\n      },\n      {\n        name: \"monitoring\",\n        type: \"Monitoring\",\n      },\n      {\n        name: \"categoryValueRef\",\n        type: \"CategoryValue\",\n        isMany: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"SequenceFlow\",\n    superClass: [\"FlowElement\"],\n    properties: [\n      {\n        name: \"isImmediate\",\n        isAttr: true,\n        type: \"Boolean\",\n      },\n      {\n        name: \"conditionExpression\",\n        type: \"Expression\",\n        xml: {\n          serialize: \"xsi:type\",\n        },\n      },\n      {\n        name: \"sourceRef\",\n        type: \"FlowNode\",\n        isAttr: true,\n        isReference: true,\n      },\n      {\n        name: \"targetRef\",\n        type: \"FlowNode\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"FlowElementsContainer\",\n    isAbstract: true,\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"laneSets\",\n        type: \"LaneSet\",\n        isMany: true,\n      },\n      {\n        name: \"flowElements\",\n        type: \"FlowElement\",\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"CallableElement\",\n    isAbstract: true,\n    superClass: [\"RootElement\"],\n    properties: [\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"ioSpecification\",\n        type: \"InputOutputSpecification\",\n        xml: {\n          serialize: \"property\",\n        },\n      },\n      {\n        name: \"supportedInterfaceRef\",\n        type: \"Interface\",\n        isMany: true,\n        isReference: true,\n      },\n      {\n        name: \"ioBinding\",\n        type: \"InputOutputBinding\",\n        isMany: true,\n        xml: {\n          serialize: \"property\",\n        },\n      },\n    ],\n  },\n  {\n    name: \"FlowNode\",\n    isAbstract: true,\n    superClass: [\"FlowElement\"],\n    properties: [\n      // {\n      //   name: \"incoming\",\n      //   type: \"SequenceFlow\",\n      //   isMany: true,\n      //   isReference: true,\n      // },\n      // {\n      //   name: \"outgoing\",\n      //   type: \"SequenceFlow\",\n      //   isMany: true,\n      //   isReference: true,\n      // },\n      {\n        name: \"lanes\",\n        type: \"Lane\",\n        isVirtual: true,\n        isMany: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"CorrelationPropertyRetrievalExpression\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"messagePath\",\n        type: \"FormalExpression\",\n      },\n      {\n        name: \"messageRef\",\n        type: \"Message\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"CorrelationPropertyBinding\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"dataPath\",\n        type: \"FormalExpression\",\n      },\n      {\n        name: \"correlationPropertyRef\",\n        type: \"CorrelationProperty\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"Resource\",\n    superClass: [\"RootElement\"],\n    properties: [\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"resourceParameters\",\n        type: \"ResourceParameter\",\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"ResourceParameter\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"isRequired\",\n        isAttr: true,\n        type: \"Boolean\",\n      },\n      {\n        name: \"type\",\n        type: \"ItemDefinition\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"CorrelationSubscription\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"correlationKeyRef\",\n        type: \"CorrelationKey\",\n        isAttr: true,\n        isReference: true,\n      },\n      {\n        name: \"correlationPropertyBinding\",\n        type: \"CorrelationPropertyBinding\",\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"MessageFlow\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"sourceRef\",\n        type: \"InteractionNode\",\n        isAttr: true,\n        isReference: true,\n      },\n      {\n        name: \"targetRef\",\n        type: \"InteractionNode\",\n        isAttr: true,\n        isReference: true,\n      },\n      {\n        name: \"messageRef\",\n        type: \"Message\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"MessageFlowAssociation\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"innerMessageFlowRef\",\n        type: \"MessageFlow\",\n        isAttr: true,\n        isReference: true,\n      },\n      {\n        name: \"outerMessageFlowRef\",\n        type: \"MessageFlow\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"InteractionNode\",\n    isAbstract: true,\n    properties: [\n      {\n        name: \"incomingConversationLinks\",\n        type: \"ConversationLink\",\n        isVirtual: true,\n        isMany: true,\n        isReference: true,\n      },\n      {\n        name: \"outgoingConversationLinks\",\n        type: \"ConversationLink\",\n        isVirtual: true,\n        isMany: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"Participant\",\n    superClass: [\"InteractionNode\", \"BaseElement\"],\n    properties: [\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"interfaceRef\",\n        type: \"Interface\",\n        isMany: true,\n        isReference: true,\n      },\n      {\n        name: \"participantMultiplicity\",\n        type: \"ParticipantMultiplicity\",\n      },\n      {\n        name: \"endPointRefs\",\n        type: \"EndPoint\",\n        isMany: true,\n        isReference: true,\n      },\n      {\n        name: \"processRef\",\n        type: \"Process-action\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"ParticipantAssociation\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"innerParticipantRef\",\n        type: \"Participant\",\n        isAttr: true,\n        isReference: true,\n      },\n      {\n        name: \"outerParticipantRef\",\n        type: \"Participant\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"ParticipantMultiplicity\",\n    properties: [\n      {\n        name: \"minimum\",\n        default: 0,\n        isAttr: true,\n        type: \"Integer\",\n      },\n      {\n        name: \"maximum\",\n        default: 1,\n        isAttr: true,\n        type: \"Integer\",\n      },\n    ],\n    superClass: [\"BaseElement\"],\n  },\n  {\n    name: \"Collaboration\",\n    superClass: [\"RootElement\"],\n    properties: [\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"isClosed\",\n        isAttr: true,\n        type: \"Boolean\",\n      },\n      {\n        name: \"participants\",\n        type: \"Participant\",\n        isMany: true,\n      },\n      {\n        name: \"messageFlows\",\n        type: \"MessageFlow\",\n        isMany: true,\n      },\n      {\n        name: \"artifacts\",\n        type: \"Artifact\",\n        isMany: true,\n      },\n      {\n        name: \"conversations\",\n        type: \"ConversationNode\",\n        isMany: true,\n      },\n      {\n        name: \"conversationAssociations\",\n        type: \"ConversationAssociation\",\n      },\n      {\n        name: \"participantAssociations\",\n        type: \"ParticipantAssociation\",\n        isMany: true,\n      },\n      {\n        name: \"messageFlowAssociations\",\n        type: \"MessageFlowAssociation\",\n        isMany: true,\n      },\n      {\n        name: \"correlationKeys\",\n        type: \"CorrelationKey\",\n        isMany: true,\n      },\n      {\n        name: \"choreographyRef\",\n        type: \"Choreography\",\n        isMany: true,\n        isReference: true,\n      },\n      {\n        name: \"conversationLinks\",\n        type: \"ConversationLink\",\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"ChoreographyActivity\",\n    isAbstract: true,\n    superClass: [\"FlowNode\"],\n    properties: [\n      {\n        name: \"participantRef\",\n        type: \"Participant\",\n        isMany: true,\n        isReference: true,\n      },\n      {\n        name: \"initiatingParticipantRef\",\n        type: \"Participant\",\n        isAttr: true,\n        isReference: true,\n      },\n      {\n        name: \"correlationKeys\",\n        type: \"CorrelationKey\",\n        isMany: true,\n      },\n      {\n        name: \"loopType\",\n        type: \"ChoreographyLoopType\",\n        default: \"None\",\n        isAttr: true,\n      },\n    ],\n  },\n  {\n    name: \"CallChoreography\",\n    superClass: [\"ChoreographyActivity\"],\n    properties: [\n      {\n        name: \"calledChoreographyRef\",\n        type: \"Choreography\",\n        isAttr: true,\n        isReference: true,\n      },\n      {\n        name: \"participantAssociations\",\n        type: \"ParticipantAssociation\",\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"SubChoreography\",\n    superClass: [\"ChoreographyActivity\", \"FlowElementsContainer\"],\n    properties: [\n      {\n        name: \"artifacts\",\n        type: \"Artifact\",\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"ChoreographyTask\",\n    superClass: [\"ChoreographyActivity\"],\n    properties: [\n      {\n        name: \"messageFlowRef\",\n        type: \"MessageFlow\",\n        isMany: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"Choreography\",\n    superClass: [\"Collaboration\", \"FlowElementsContainer\"],\n  },\n  {\n    name: \"GlobalChoreographyTask\",\n    superClass: [\"Choreography\"],\n    properties: [\n      {\n        name: \"initiatingParticipantRef\",\n        type: \"Participant\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n  },\n  {\n    name: \"TextAnnotation\",\n    superClass: [\"Artifact\"],\n    properties: [\n      {\n        name: \"text\",\n        type: \"String\",\n      },\n      {\n        name: \"textFormat\",\n        default: \"text/plain\",\n        isAttr: true,\n        type: \"String\",\n      },\n    ],\n  },\n  {\n    name: \"Activity\",\n    isAbstract: true,\n    superClass: [\"FlowNode\"],\n    properties: [\n      {\n        name: \"isForCompensation\",\n        default: false,\n        isAttr: true,\n        type: \"Boolean\",\n      },\n      {\n        name: \"ioSpecification\",\n        type: \"InputOutputSpecification\",\n        xml: {\n          serialize: \"property\",\n        },\n      },\n      {\n        name: \"boundaryEventRefs\",\n        type: \"BoundaryEvent\",\n        isMany: true,\n        isReference: true,\n      },\n      {\n        name: \"properties\",\n        type: \"Property\",\n        isMany: true,\n      },\n      {\n        name: \"dataInputAssociations\",\n        type: \"DataInputAssociation\",\n        isMany: true,\n      },\n      {\n        name: \"dataOutputAssociations\",\n        type: \"DataOutputAssociation\",\n        isMany: true,\n      },\n      {\n        name: \"startQuantity\",\n        default: 1,\n        isAttr: true,\n        type: \"Integer\",\n      },\n      {\n        name: \"resources\",\n        type: \"ResourceRole\",\n        isMany: true,\n      },\n      {\n        name: \"completionQuantity\",\n        default: 1,\n        isAttr: true,\n        type: \"Integer\",\n      },\n    ],\n  },\n  {\n    name: \"Conditional\",\n    superClass: [\"Activity\", \"FlowElementsContainer\", \"InteractionNode\"],\n    properties: [\n      {\n        name: \"triggeredByEvent\",\n        default: false,\n        isAttr: true,\n        type: \"Boolean\",\n      },\n      {\n        name: \"artifacts\",\n        type: \"Artifact\",\n        isMany: true,\n      },\n      {\n        name: \"expression\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"expressionValue\",\n        isAttr: true,\n        type: \"String\",\n      },\n    ],\n  },\n  {\n    name: \"Loop\",\n    superClass: [\"Activity\", \"FlowElementsContainer\", \"InteractionNode\"],\n    properties: [\n      {\n        name: \"triggeredByEvent\",\n        default: false,\n        isAttr: true,\n        type: \"Boolean\",\n      },\n      {\n        name: \"artifacts\",\n        type: \"Artifact\",\n        isMany: true,\n      },\n      {\n        name: \"target\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"expression\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"expressionValue\",\n        isAttr: true,\n        type: \"String\",\n      },\n    ],\n  },\n  {\n    name: \"Task\",\n    superClass: [\"Activity\", \"InteractionNode\"],\n  },\n  {\n    name: \"Mapper\",\n    superClass: [\"Task\"],\n    properties: [\n      {\n        name: \"script\",\n        type: \"Script\",\n      },\n      {\n        name: \"scriptMeta\",\n        type: \"ScriptMeta\",\n      },\n      {\n        name: \"sourceField\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"targetField\",\n        isAttr: true,\n        type: \"String\",\n      },\n    ],\n  },\n  {\n    name: \"Script\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"value\",\n        isBody: true,\n        type: \"String\",\n      },\n    ],\n  },\n  {\n    name: \"ScriptMeta\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"value\",\n        isBody: true,\n        type: \"String\",\n      },\n    ],\n  },\n  {\n    name: \"Function\",\n    superClass: [\"Task\"],\n    properties: [\n      {\n        name: \"returnType\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"functionName\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"values\",\n        type: \"Element\",\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"GlobalScriptTask\",\n    superClass: [\"GlobalTask\"],\n    properties: [\n      {\n        name: \"scriptLanguage\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"script\",\n        isAttr: true,\n        type: \"String\",\n      },\n    ],\n  },\n  {\n    name: \"GlobalBusinessRuleTask\",\n    superClass: [\"GlobalTask\"],\n    properties: [\n      {\n        name: \"implementation\",\n        isAttr: true,\n        type: \"String\",\n      },\n    ],\n  },\n  {\n    name: \"ComplexBehaviorDefinition\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"condition\",\n        type: \"FormalExpression\",\n      },\n      {\n        name: \"event\",\n        type: \"ImplicitThrowEvent\",\n      },\n    ],\n  },\n  {\n    name: \"ResourceRole\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"resourceRef\",\n        type: \"Resource\",\n        isReference: true,\n      },\n      {\n        name: \"resourceParameterBindings\",\n        type: \"ResourceParameterBinding\",\n        isMany: true,\n      },\n      {\n        name: \"resourceAssignmentExpression\",\n        type: \"ResourceAssignmentExpression\",\n      },\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n    ],\n  },\n  {\n    name: \"ResourceParameterBinding\",\n    properties: [\n      {\n        name: \"expression\",\n        type: \"Expression\",\n        xml: {\n          serialize: \"xsi:type\",\n        },\n      },\n      {\n        name: \"parameterRef\",\n        type: \"ResourceParameter\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n    superClass: [\"BaseElement\"],\n  },\n  {\n    name: \"ResourceAssignmentExpression\",\n    properties: [\n      {\n        name: \"expression\",\n        type: \"Expression\",\n        xml: {\n          serialize: \"xsi:type\",\n        },\n      },\n    ],\n    superClass: [\"BaseElement\"],\n  },\n  {\n    name: \"Import\",\n    properties: [\n      {\n        name: \"importType\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"location\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"namespace\",\n        isAttr: true,\n        type: \"String\",\n      },\n    ],\n  },\n  {\n    name: \"Process-actions\",\n    superClass: [\"BaseElement\"],\n    properties: [\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"targetNamespace\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"expressionLanguage\",\n        default: \"http://www.w3.org/1999/XPath\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"typeLanguage\",\n        default: \"http://www.w3.org/2001/XMLSchema\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"imports\",\n        type: \"Import\",\n        isMany: true,\n      },\n      {\n        name: \"extensions\",\n        type: \"Extension\",\n        isMany: true,\n      },\n      {\n        name: \"rootElements\",\n        type: \"RootElement\",\n        isMany: true,\n      },\n      {\n        name: \"diagrams\",\n        isMany: true,\n        type: \"bpmndi:BPMNDiagram\",\n      },\n      {\n        name: \"exporter\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"relationships\",\n        type: \"Relationship\",\n        isMany: true,\n      },\n      {\n        name: \"exporterVersion\",\n        isAttr: true,\n        type: \"String\",\n      },\n    ],\n  },\n];\nlet enumerations = [\n  {\n    name: \"ProcessType\",\n    literalValues: [\n      {\n        name: \"None\",\n      },\n      {\n        name: \"Public\",\n      },\n      {\n        name: \"Private\",\n      },\n    ],\n  },\n  {\n    name: \"GatewayDirection\",\n    literalValues: [\n      {\n        name: \"Unspecified\",\n      },\n      {\n        name: \"Converging\",\n      },\n      {\n        name: \"Diverging\",\n      },\n      {\n        name: \"Mixed\",\n      },\n    ],\n  },\n  {\n    name: \"EventBasedGatewayType\",\n    literalValues: [\n      {\n        name: \"Parallel\",\n      },\n      {\n        name: \"Exclusive\",\n      },\n    ],\n  },\n  {\n    name: \"RelationshipDirection\",\n    literalValues: [\n      {\n        name: \"None\",\n      },\n      {\n        name: \"Forward\",\n      },\n      {\n        name: \"Backward\",\n      },\n      {\n        name: \"Both\",\n      },\n    ],\n  },\n  {\n    name: \"ItemKind\",\n    literalValues: [\n      {\n        name: \"Physical\",\n      },\n      {\n        name: \"Information\",\n      },\n    ],\n  },\n  {\n    name: \"ChoreographyLoopType\",\n    literalValues: [\n      {\n        name: \"None\",\n      },\n      {\n        name: \"Standard\",\n      },\n      {\n        name: \"MultiInstanceSequential\",\n      },\n      {\n        name: \"MultiInstanceParallel\",\n      },\n    ],\n  },\n  {\n    name: \"AssociationDirection\",\n    literalValues: [\n      {\n        name: \"None\",\n      },\n      {\n        name: \"One\",\n      },\n      {\n        name: \"Both\",\n      },\n    ],\n  },\n  {\n    name: \"MultiInstanceBehavior\",\n    literalValues: [\n      {\n        name: \"None\",\n      },\n      {\n        name: \"One\",\n      },\n      {\n        name: \"All\",\n      },\n      {\n        name: \"Complex\",\n      },\n    ],\n  },\n  {\n    name: \"AdHocOrdering\",\n    literalValues: [\n      {\n        name: \"Parallel\",\n      },\n      {\n        name: \"Sequential\",\n      },\n    ],\n  },\n];\nlet prefix = \"bpmn\";\nlet xml = {\n  tagAlias: \"lowerCase\",\n  typePrefix: \"t\",\n};\nlet BpmnPackage = {\n  name: name,\n  uri: uri,\n  associations: associations,\n  types: types,\n  enumerations: enumerations,\n  prefix: prefix,\n  xml: xml,\n};\n\nlet name$1 = \"BPMNDI\";\nlet uri$1 = \"http://www.omg.org/spec/BPMN/20100524/DI\";\nlet types$1 = [\n  {\n    name: \"BPMNDiagram\",\n    properties: [\n      {\n        name: \"plane\",\n        type: \"BPMNPlane\",\n        redefines: \"di:Diagram#rootElement\",\n      },\n      {\n        name: \"labelStyle\",\n        type: \"BPMNLabelStyle\",\n        isMany: true,\n      },\n    ],\n    superClass: [\"di:Diagram\"],\n  },\n  {\n    name: \"BPMNPlane\",\n    properties: [\n      {\n        name: \"bpmnElement\",\n        isAttr: true,\n        isReference: true,\n        type: \"bpmn:BaseElement\",\n        redefines: \"di:DiagramElement#modelElement\",\n      },\n    ],\n    superClass: [\"di:Plane\"],\n  },\n  {\n    name: \"BPMNShape\",\n    properties: [\n      {\n        name: \"bpmnElement\",\n        isAttr: true,\n        isReference: true,\n        type: \"bpmn:BaseElement\",\n        redefines: \"di:DiagramElement#modelElement\",\n      },\n      {\n        name: \"isHorizontal\",\n        isAttr: true,\n        type: \"Boolean\",\n      },\n      {\n        name: \"isExpanded\",\n        isAttr: true,\n        type: \"Boolean\",\n      },\n      {\n        name: \"isMarkerVisible\",\n        isAttr: true,\n        type: \"Boolean\",\n      },\n      {\n        name: \"label\",\n        type: \"BPMNLabel\",\n      },\n      {\n        name: \"isMessageVisible\",\n        isAttr: true,\n        type: \"Boolean\",\n      },\n      {\n        name: \"participantBandKind\",\n        type: \"ParticipantBandKind\",\n        isAttr: true,\n      },\n      {\n        name: \"choreographyActivityShape\",\n        type: \"BPMNShape\",\n        isAttr: true,\n        isReference: true,\n      },\n    ],\n    superClass: [\"di:LabeledShape\"],\n  },\n  {\n    name: \"BPMNEdge\",\n    properties: [\n      {\n        name: \"label\",\n        type: \"BPMNLabel\",\n      },\n      {\n        name: \"bpmnElement\",\n        isAttr: true,\n        isReference: true,\n        type: \"bpmn:BaseElement\",\n        redefines: \"di:DiagramElement#modelElement\",\n      },\n      {\n        name: \"sourceElement\",\n        isAttr: true,\n        isReference: true,\n        type: \"di:DiagramElement\",\n        redefines: \"di:Edge#source\",\n      },\n      {\n        name: \"targetElement\",\n        isAttr: true,\n        isReference: true,\n        type: \"di:DiagramElement\",\n        redefines: \"di:Edge#target\",\n      },\n      {\n        name: \"messageVisibleKind\",\n        type: \"MessageVisibleKind\",\n        isAttr: true,\n        default: \"initiating\",\n      },\n    ],\n    superClass: [\"di:LabeledEdge\"],\n  },\n  {\n    name: \"BPMNLabel\",\n    properties: [\n      {\n        name: \"labelStyle\",\n        type: \"BPMNLabelStyle\",\n        isAttr: true,\n        isReference: true,\n        redefines: \"di:DiagramElement#style\",\n      },\n    ],\n    superClass: [\"di:Label\"],\n  },\n  {\n    name: \"BPMNLabelStyle\",\n    properties: [\n      {\n        name: \"font\",\n        type: \"dc:Font\",\n      },\n    ],\n    superClass: [\"di:Style\"],\n  },\n];\nlet enumerations$1 = [\n  {\n    name: \"ParticipantBandKind\",\n    literalValues: [\n      {\n        name: \"top_initiating\",\n      },\n      {\n        name: \"middle_initiating\",\n      },\n      {\n        name: \"bottom_initiating\",\n      },\n      {\n        name: \"top_non_initiating\",\n      },\n      {\n        name: \"middle_non_initiating\",\n      },\n      {\n        name: \"bottom_non_initiating\",\n      },\n    ],\n  },\n  {\n    name: \"MessageVisibleKind\",\n    literalValues: [\n      {\n        name: \"initiating\",\n      },\n      {\n        name: \"non_initiating\",\n      },\n    ],\n  },\n];\nlet associations$1 = [];\nlet prefix$1 = \"bpmndi\";\nlet BpmnDiPackage = {\n  name: name$1,\n  uri: uri$1,\n  types: types$1,\n  enumerations: enumerations$1,\n  associations: associations$1,\n  prefix: prefix$1,\n};\n\nlet name$2 = \"DC\";\nlet uri$2 = \"http://www.omg.org/spec/DD/20100524/DC\";\nlet types$2 = [\n  {\n    name: \"Boolean\",\n  },\n  {\n    name: \"Integer\",\n  },\n  {\n    name: \"Real\",\n  },\n  {\n    name: \"String\",\n  },\n  {\n    name: \"Font\",\n    properties: [\n      {\n        name: \"name\",\n        type: \"String\",\n        isAttr: true,\n      },\n      {\n        name: \"size\",\n        type: \"Real\",\n        isAttr: true,\n      },\n      {\n        name: \"isBold\",\n        type: \"Boolean\",\n        isAttr: true,\n      },\n      {\n        name: \"isItalic\",\n        type: \"Boolean\",\n        isAttr: true,\n      },\n      {\n        name: \"isUnderline\",\n        type: \"Boolean\",\n        isAttr: true,\n      },\n      {\n        name: \"isStrikeThrough\",\n        type: \"Boolean\",\n        isAttr: true,\n      },\n    ],\n  },\n  {\n    name: \"Point\",\n    properties: [\n      {\n        name: \"x\",\n        type: \"Real\",\n        default: \"0\",\n        isAttr: true,\n      },\n      {\n        name: \"y\",\n        type: \"Real\",\n        default: \"0\",\n        isAttr: true,\n      },\n    ],\n  },\n  {\n    name: \"Bounds\",\n    properties: [\n      {\n        name: \"x\",\n        type: \"Real\",\n        default: \"0\",\n        isAttr: true,\n      },\n      {\n        name: \"y\",\n        type: \"Real\",\n        default: \"0\",\n        isAttr: true,\n      },\n      {\n        name: \"width\",\n        type: \"Real\",\n        isAttr: true,\n      },\n      {\n        name: \"height\",\n        type: \"Real\",\n        isAttr: true,\n      },\n    ],\n  },\n];\nlet prefix$2 = \"dc\";\nlet associations$2 = [];\nlet DcPackage = {\n  name: name$2,\n  uri: uri$2,\n  types: types$2,\n  prefix: prefix$2,\n  associations: associations$2,\n};\n\nlet name$3 = \"DI\";\nlet uri$3 = \"http://www.omg.org/spec/DD/20100524/DI\";\nlet types$3 = [\n  {\n    name: \"DiagramElement\",\n    isAbstract: true,\n    properties: [\n      {\n        name: \"id\",\n        type: \"String\",\n        isAttr: true,\n        isId: true,\n      },\n      {\n        name: \"extension\",\n        type: \"Extension\",\n      },\n      {\n        name: \"owningDiagram\",\n        type: \"Diagram\",\n        isReadOnly: true,\n        isVirtual: true,\n        isReference: true,\n      },\n      {\n        name: \"owningElement\",\n        type: \"DiagramElement\",\n        isReadOnly: true,\n        isVirtual: true,\n        isReference: true,\n      },\n      {\n        name: \"modelElement\",\n        isReadOnly: true,\n        isVirtual: true,\n        isReference: true,\n        type: \"Element\",\n      },\n      {\n        name: \"style\",\n        type: \"Style\",\n        isReadOnly: true,\n        isVirtual: true,\n        isReference: true,\n      },\n      {\n        name: \"ownedElement\",\n        type: \"DiagramElement\",\n        isReadOnly: true,\n        isVirtual: true,\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"Node\",\n    isAbstract: true,\n    superClass: [\"DiagramElement\"],\n  },\n  {\n    name: \"Edge\",\n    isAbstract: true,\n    superClass: [\"DiagramElement\"],\n    properties: [\n      {\n        name: \"source\",\n        type: \"DiagramElement\",\n        isReadOnly: true,\n        isVirtual: true,\n        isReference: true,\n      },\n      {\n        name: \"target\",\n        type: \"DiagramElement\",\n        isReadOnly: true,\n        isVirtual: true,\n        isReference: true,\n      },\n      {\n        name: \"waypoint\",\n        isUnique: false,\n        isMany: true,\n        type: \"dc:Point\",\n        xml: {\n          serialize: \"xsi:type\",\n        },\n      },\n    ],\n  },\n  {\n    name: \"Diagram\",\n    isAbstract: true,\n    properties: [\n      {\n        name: \"id\",\n        type: \"String\",\n        isAttr: true,\n        isId: true,\n      },\n      {\n        name: \"rootElement\",\n        type: \"DiagramElement\",\n        isReadOnly: true,\n        isVirtual: true,\n      },\n      {\n        name: \"name\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"documentation\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"resolution\",\n        isAttr: true,\n        type: \"Real\",\n      },\n      {\n        name: \"ownedStyle\",\n        type: \"Style\",\n        isReadOnly: true,\n        isVirtual: true,\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"Shape\",\n    isAbstract: true,\n    superClass: [\"Node\"],\n    properties: [\n      {\n        name: \"bounds\",\n        type: \"dc:Bounds\",\n      },\n    ],\n  },\n  {\n    name: \"Plane\",\n    isAbstract: true,\n    superClass: [\"Node\"],\n    properties: [\n      {\n        name: \"planeElement\",\n        type: \"DiagramElement\",\n        subsettedProperty: \"DiagramElement-ownedElement\",\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"LabeledEdge\",\n    isAbstract: true,\n    superClass: [\"Edge\"],\n    properties: [\n      {\n        name: \"ownedLabel\",\n        type: \"Label\",\n        isReadOnly: true,\n        subsettedProperty: \"DiagramElement-ownedElement\",\n        isVirtual: true,\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"LabeledShape\",\n    isAbstract: true,\n    superClass: [\"Shape\"],\n    properties: [\n      {\n        name: \"ownedLabel\",\n        type: \"Label\",\n        isReadOnly: true,\n        subsettedProperty: \"DiagramElement-ownedElement\",\n        isVirtual: true,\n        isMany: true,\n      },\n    ],\n  },\n  {\n    name: \"Label\",\n    isAbstract: true,\n    superClass: [\"Node\"],\n    properties: [\n      {\n        name: \"bounds\",\n        type: \"dc:Bounds\",\n      },\n    ],\n  },\n  {\n    name: \"Style\",\n    isAbstract: true,\n    properties: [\n      {\n        name: \"id\",\n        type: \"String\",\n        isAttr: true,\n        isId: true,\n      },\n    ],\n  },\n  {\n    name: \"Extension\",\n    properties: [\n      {\n        name: \"values\",\n        type: \"Element\",\n        isMany: true,\n      },\n    ],\n  },\n];\nlet associations$3 = [];\nlet prefix$3 = \"di\";\nlet xml$1 = {\n  tagAlias: \"lowerCase\",\n};\nlet DiPackage = {\n  name: name$3,\n  uri: uri$3,\n  types: types$3,\n  associations: associations$3,\n  prefix: prefix$3,\n  xml: xml$1,\n};\n\nlet name$4 = \"bpmn.io colors for BPMN\";\nlet uri$4 = \"http://bpmn.io/schema/bpmn/biocolor/1.0\";\nlet prefix$4 = \"bioc\";\nlet types$4 = [\n  {\n    name: \"ColoredShape\",\n    extends: [\"bpmndi:BPMNShape\"],\n    properties: [\n      {\n        name: \"stroke\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"fill\",\n        isAttr: true,\n        type: \"String\",\n      },\n    ],\n  },\n  {\n    name: \"ColoredEdge\",\n    extends: [\"bpmndi:BPMNEdge\"],\n    properties: [\n      {\n        name: \"stroke\",\n        isAttr: true,\n        type: \"String\",\n      },\n      {\n        name: \"fill\",\n        isAttr: true,\n        type: \"String\",\n      },\n    ],\n  },\n];\nlet enumerations$2 = [];\nlet associations$4 = [];\nlet BiocPackage = {\n  name: name$4,\n  uri: uri$4,\n  prefix: prefix$4,\n  types: types$4,\n  enumerations: enumerations$2,\n  associations: associations$4,\n};\n\nlet packages = {\n  bpmn: BpmnPackage,\n  bpmndi: BpmnDiPackage,\n  dc: DcPackage,\n  di: DiPackage,\n  bioc: BiocPackage,\n};\n\nfunction simple(additionalPackages, options) {\n  let pks = assign({}, packages, additionalPackages);\n\n  return new BpmnModdle(pks, options);\n}\n\nexport default simple;\n","export function elementToString(e) {\n  if (!e) {\n    return \"<null>\";\n  }\n\n  return \"<\" + e.$type + (e.id ? ' id=\"' + e.id : \"\") + '\" />';\n}\n","import { filter, find, forEach } from \"min-dash\";\n\nimport Refs from \"object-refs\";\n\nimport { elementToString } from \"./Util\";\n\nlet diRefs = new Refs(\n  { name: \"bpmnElement\", enumerable: true },\n  { name: \"di\", configurable: true }\n);\n\n/**\n * Returns true if an element has the given meta-model type\n *\n * @param  {ModdleElement}  element\n * @param  {String}         type\n *\n * @return {Boolean}\n */\nfunction is(element, type) {\n  return element.$instanceOf(type);\n}\n\n/**\n * Find a suitable display candidate for definitions where the DI does not\n * correctly specify one.\n */\nfunction findDisplayCandidate(definitions) {\n  return find(definitions.rootElements, function (e) {\n    return is(e, \"bpmn:Process-action\") || is(e, \"bpmn:Collaboration\");\n  });\n}\n\nexport default function BpmnTreeWalker(handler, translate) {\n  // list of containers already walked\n  let handledElements = {};\n\n  // list of elements to handle deferred to ensure\n  // prerequisites are drawn\n  let deferred = [];\n\n  // Helpers //////////////////////\n\n  function contextual(fn, ctx) {\n    return function (e) {\n      fn(e, ctx);\n    };\n  }\n\n  function handled(element) {\n    handledElements[element.id] = element;\n  }\n\n  function isHandled(element) {\n    return handledElements[element.id];\n  }\n\n  function visit(element, ctx) {\n    let gfx = element.gfx;\n\n    // avoid multiple rendering of elements\n    if (gfx) {\n      throw new Error(\n        translate(\"already rendered {element}\", {\n          element: elementToString(element),\n        })\n      );\n    }\n\n    // call handler\n    return handler.element(element, ctx);\n  }\n\n  function visitRoot(element, diagram) {\n    return handler.root(element, diagram);\n  }\n\n  function visitIfDi(element, ctx) {\n    try {\n      let gfx = element.di && visit(element, ctx);\n\n      handled(element);\n\n      return gfx;\n    } catch (e) {\n      logError(e.message, { element: element, error: e });\n\n      console.error(\n        translate(\"failed to import {element}\", {\n          element: elementToString(element),\n        })\n      );\n      console.error(e);\n    }\n  }\n\n  function logError(message, context) {\n    handler.error(message, context);\n  }\n\n  // DI handling //////////////////////\n\n  function registerDi(di) {\n    let bpmnElement = di.bpmnElement;\n\n    if (bpmnElement) {\n      if (bpmnElement.di) {\n        logError(\n          translate(\"multiple DI elements defined for {element}\", {\n            element: elementToString(bpmnElement),\n          }),\n          { element: bpmnElement }\n        );\n      } else {\n        diRefs.bind(bpmnElement, \"di\");\n        bpmnElement.di = di;\n      }\n    } else {\n      logError(\n        translate(\"no bpmnElement referenced in {element}\", {\n          element: elementToString(di),\n        }),\n        { element: di }\n      );\n    }\n  }\n\n  function handleDiagram(diagram) {\n    handlePlane(diagram.plane);\n  }\n\n  function handlePlane(plane) {\n    registerDi(plane);\n\n    forEach(plane.planeElement, handlePlaneElement);\n  }\n\n  function handlePlaneElement(planeElement) {\n    registerDi(planeElement);\n  }\n\n  // Semantic handling //////////////////////\n\n  /**\n   * Handle definitions and return the rendered diagram (if any)\n   *\n   * @param {ModdleElement} definitions to walk and import\n   * @param {ModdleElement} [diagram] specific diagram to import and display\n   *\n   * @throws {Error} if no diagram to display could be found\n   */\n  function handleDefinitions(definitions, diagram) {\n    // make sure we walk the correct bpmnElement\n\n    let diagrams = definitions.diagrams;\n\n    if (diagram && diagrams.indexOf(diagram) === -1) {\n      throw new Error(translate(\"diagram not part of bpmn:Process-actions\"));\n    }\n\n    if (!diagram && diagrams && diagrams.length) {\n      diagram = diagrams[0];\n    }\n\n    // no diagram -> nothing to import\n    if (!diagram) {\n      throw new Error(translate(\"no diagram to display\"));\n    }\n\n    // load DI from selected diagram only\n    handleDiagram(diagram);\n\n    let plane = diagram.plane;\n\n    if (!plane) {\n      throw new Error(\n        translate(\"no plane for {element}\", {\n          element: elementToString(diagram),\n        })\n      );\n    }\n\n    let rootElement = plane.bpmnElement;\n\n    // ensure we default to a suitable display candidate (process or collaboration),\n    // even if non is specified in DI\n    if (!rootElement) {\n      rootElement = findDisplayCandidate(definitions);\n\n      if (!rootElement) {\n        throw new Error(translate(\"no process or collaboration to display\"));\n      } else {\n        logError(\n          translate(\n            \"correcting missing bpmnElement on {plane} to {rootElement}\",\n            {\n              plane: elementToString(plane),\n              rootElement: elementToString(rootElement),\n            }\n          )\n        );\n\n        // correct DI on the fly\n        plane.bpmnElement = rootElement;\n        registerDi(plane);\n      }\n    }\n\n    let ctx = visitRoot(rootElement, plane);\n\n    if (is(rootElement, \"bpmn:Process-action\")) {\n      handleProcess(rootElement, ctx);\n    } else if (is(rootElement, \"bpmn:Collaboration\")) {\n      handleCollaboration(rootElement, ctx);\n\n      // force drawing of everything not yet drawn that is part of the target DI\n      handleUnhandledProcesses(definitions.rootElements, ctx);\n    } else {\n      throw new Error(\n        translate(\"unsupported bpmnElement for {plane}: {rootElement}\", {\n          plane: elementToString(plane),\n          rootElement: elementToString(rootElement),\n        })\n      );\n    }\n\n    // handle all deferred elements\n    handleDeferred(deferred);\n  }\n\n  function handleDeferred() {\n    let fn;\n\n    // drain deferred until empty\n    while (deferred.length) {\n      fn = deferred.shift();\n\n      fn();\n    }\n  }\n\n  function handleProcess(process, context) {\n    handleFlowElementsContainer(process, context);\n    handleIoSpecification(process.ioSpecification, context);\n\n    handleArtifacts(process.artifacts, context);\n\n    // log process handled\n    handled(process);\n  }\n\n  function handleUnhandledProcesses(rootElements, ctx) {\n    // walk through all processes that have not yet been drawn and draw them\n    // if they contain lanes with DI information.\n    // we do this to pass the free-floating lane test cases in the MIWG test suite\n    let processes = filter(rootElements, function (e) {\n      return !isHandled(e) && is(e, \"bpmn:Process-action\") && e.laneSets;\n    });\n\n    processes.forEach(contextual(handleProcess, ctx));\n  }\n\n  function handleMessageFlow(messageFlow, context) {\n    visitIfDi(messageFlow, context);\n  }\n\n  function handleMessageFlows(messageFlows, context) {\n    forEach(messageFlows, contextual(handleMessageFlow, context));\n  }\n\n  function handleDataAssociation(association, context) {\n    visitIfDi(association, context);\n  }\n\n  function handleDataInput(dataInput, context) {\n    visitIfDi(dataInput, context);\n  }\n\n  function handleDataOutput(dataOutput, context) {\n    visitIfDi(dataOutput, context);\n  }\n\n  function handleArtifact(artifact, context) {\n    // bpmn:TextAnnotation\n    // bpmn:Group\n    // bpmn:Association\n\n    visitIfDi(artifact, context);\n  }\n\n  function handleArtifacts(artifacts, context) {\n    forEach(artifacts, function (e) {\n      if (is(e, \"bpmn:Association\")) {\n        deferred.push(function () {\n          handleArtifact(e, context);\n        });\n      } else {\n        handleArtifact(e, context);\n      }\n    });\n  }\n\n  function handleIoSpecification(ioSpecification, context) {\n    if (!ioSpecification) {\n      return;\n    }\n\n    forEach(ioSpecification.dataInputs, contextual(handleDataInput, context));\n    forEach(ioSpecification.dataOutputs, contextual(handleDataOutput, context));\n  }\n\n  function handleLoop(loop, context) {\n    handleFlowElementsContainer(loop, context);\n    handleArtifacts(loop.artifacts, context);\n  }\n\n  function handleFlowNode(flowNode, context) {\n    let childCtx = visitIfDi(flowNode, context);\n\n    if (is(flowNode, \"bpmn:Loop\")) {\n      handleLoop(flowNode, childCtx || context);\n    }\n\n    if (is(flowNode, \"bpmn:Conditional\")) {\n      handleLoop(flowNode, childCtx || context);\n    }\n\n    if (is(flowNode, \"bpmn:Activity\")) {\n      handleIoSpecification(flowNode.ioSpecification, context);\n    }\n\n    // defer handling of associations\n    // affected types:\n    //\n    //   * bpmn:Activity\n    //   * bpmn:ThrowEvent\n    //   * bpmn:CatchEvent\n    //\n    deferred.push(function () {\n      forEach(\n        flowNode.dataInputAssociations,\n        contextual(handleDataAssociation, context)\n      );\n      forEach(\n        flowNode.dataOutputAssociations,\n        contextual(handleDataAssociation, context)\n      );\n    });\n  }\n\n  function handleSequenceFlow(sequenceFlow, context) {\n    visitIfDi(sequenceFlow, context);\n  }\n\n  function handleDataElement(dataObject, context) {\n    visitIfDi(dataObject, context);\n  }\n\n  function handleLane(lane, context) {\n    deferred.push(function () {\n      let newContext = visitIfDi(lane, context);\n\n      if (lane.childLaneSet) {\n        handleLaneSet(lane.childLaneSet, newContext || context);\n      }\n\n      wireFlowNodeRefs(lane);\n    });\n  }\n\n  function handleLaneSet(laneSet, context) {\n    forEach(laneSet.lanes, contextual(handleLane, context));\n  }\n\n  function handleLaneSets(laneSets, context) {\n    forEach(laneSets, contextual(handleLaneSet, context));\n  }\n\n  function handleFlowElementsContainer(container, context) {\n    handleFlowElements(container.flowElements, context);\n\n    if (container.laneSets) {\n      handleLaneSets(container.laneSets, context);\n    }\n  }\n\n  function handleFlowElements(flowElements, context) {\n    forEach(flowElements, function (e) {\n      if (is(e, \"bpmn:SequenceFlow\")) {\n        deferred.push(function () {\n          handleSequenceFlow(e, context);\n        });\n      } else if (is(e, \"bpmn:BoundaryEvent\")) {\n        deferred.unshift(function () {\n          handleFlowNode(e, context);\n        });\n      } else if (is(e, \"bpmn:FlowNode\")) {\n        handleFlowNode(e, context);\n      } else if (is(e, \"bpmn:DataObject\")) {\n        // SKIP (assume correct referencing via DataObjectReference)\n      } else if (is(e, \"bpmn:DataStoreReference\")) {\n        handleDataElement(e, context);\n      } else if (is(e, \"bpmn:DataObjectReference\")) {\n        handleDataElement(e, context);\n      } else {\n        logError(\n          translate(\"unrecognized flowElement {element} in context {context}\", {\n            element: elementToString(e),\n            context: context ? elementToString(context.businessObject) : \"null\",\n          }),\n          { element: e, context: context }\n        );\n      }\n    });\n  }\n\n  function handleParticipant(participant, context) {\n    let newCtx = visitIfDi(participant, context);\n\n    let process = participant.processRef;\n    if (process) {\n      handleProcess(process, newCtx || context);\n    }\n  }\n\n  function handleCollaboration(collaboration) {\n    forEach(collaboration.participants, contextual(handleParticipant));\n\n    handleArtifacts(collaboration.artifacts);\n\n    // handle message flows latest in the process\n    deferred.push(function () {\n      handleMessageFlows(collaboration.messageFlows);\n    });\n  }\n\n  function wireFlowNodeRefs(lane) {\n    // wire the virtual flowNodeRefs <-> relationship\n    forEach(lane.flowNodeRef, function (flowNode) {\n      let lanes = flowNode.get(\"lanes\");\n\n      if (lanes) {\n        lanes.push(lane);\n      }\n    });\n  }\n\n  // API //////////////////////\n\n  return {\n    handleDeferred: handleDeferred,\n    handleDefinitions: handleDefinitions,\n    handleLoop: handleLoop,\n    registerDi: registerDi,\n  };\n}\n","import { assign, find, isFunction, isNumber, omit } from \"min-dash\";\nimport { domify, query as domQuery, remove as domRemove } from \"min-dom\";\nimport { innerSVG } from \"tiny-svg\";\n\nimport Diagram from \"diagram-js\";\nimport BpmnModdle from \"../../baml-moddle\";\n\nimport inherits from \"inherits\";\n\nimport { importBpmnDiagram } from \"./import/Importer\";\n\n/**\n * A base viewer for BPMN 2.0 diagrams.\n *\n * Have a look at {@link Viewer}, {@link NavigatedViewer} or {@link Modeler} for\n * bundles that include actual features.\n *\n * @param {Object} [options] configuration options to pass to the viewer\n * @param {DOMElement} [options.container] the container to render the viewer in, defaults to body.\n * @param {String|Number} [options.width] the width of the viewer\n * @param {String|Number} [options.height] the height of the viewer\n * @param {Object} [options.moddleExtensions] extension packages to provide\n * @param {Array<didi.Module>} [options.modules] a list of modules to override the default modules\n * @param {Array<didi.Module>} [options.additionalModules] a list of modules to use with the default modules\n */\nexport default function BaseViewer(options) {\n  options = assign({}, DEFAULT_OPTIONS, options);\n\n  this._moddle = this._createModdle(options);\n\n  this._container = this._createContainer(options);\n  this._init(this._container, this._moddle, options);\n}\n\ninherits(BaseViewer, Diagram);\n\n/**\n * Parse and render a BPMN 2.0 diagram.\n *\n * Once finished the viewer reports back the result to the\n * provided callback function with (err, warnings).\n *\n * ## Life-Cycle Events\n *\n * During import the viewer will fire life-cycle events:\n *\n *   * import.parse.start (about to read model from xml)\n *   * import.parse.complete (model read; may have worked or not)\n *   * import.render.start (graphical import start)\n *   * import.render.complete (graphical import finished)\n *   * import.done (everything done)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @param {String} xml the BPMN 2.0 xml\n * @param {ModdleElement<BPMNDiagram>|String} [bpmnDiagram] BPMN diagram or id of diagram to render (if not provided, the first one will be rendered)\n * @param {Function} [done] invoked with (err, warnings=[])\n */\nBaseViewer.prototype.importXML = function (xml, bpmnDiagram, done) {\n  if (isFunction(bpmnDiagram)) {\n    done = bpmnDiagram;\n    bpmnDiagram = null;\n  }\n\n  // done is optional\n  done = done || function () {};\n\n  let self = this;\n\n  // hook in pre-parse listeners +\n  // allow xml manipulation\n  xml = this._emit(\"import.parse.start\", { xml: xml }) || xml;\n\n  this._moddle.fromXML(xml, \"bpmn:Process-actions\", function (\n    err,\n    definitions,\n    context\n  ) {\n    // hook in post parse listeners +\n    // allow definitions manipulation\n    definitions =\n      self._emit(\"import.parse.complete\", {\n        error: err,\n        definitions: definitions,\n        context: context,\n      }) || definitions;\n\n    let parseWarnings = context.warnings;\n\n    if (err) {\n      err = checkValidationError(err);\n\n      self._emit(\"import.done\", { error: err, warnings: parseWarnings });\n\n      return done(err, parseWarnings);\n    }\n\n    self.importDefinitions(definitions, bpmnDiagram, function (\n      err,\n      importWarnings\n    ) {\n      let allWarnings = [].concat(parseWarnings, importWarnings || []);\n\n      self._emit(\"import.done\", { error: err, warnings: allWarnings });\n\n      done(err, allWarnings);\n    });\n  });\n};\n\n/**\n * Import parsed definitions and render a BPMN 2.0 diagram.\n *\n * Once finished the viewer reports back the result to the\n * provided callback function with (err, warnings).\n *\n * ## Life-Cycle Events\n *\n * During import the viewer will fire life-cycle events:\n *\n *   * import.render.start (graphical import start)\n *   * import.render.complete (graphical import finished)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @param {ModdleElement<Process-actions>} definitions parsed BPMN 2.0 definitions\n * @param {ModdleElement<BPMNDiagram>|String} [bpmnDiagram] BPMN diagram or id of diagram to render (if not provided, the first one will be rendered)\n * @param {Function} [done] invoked with (err, warnings=[])\n */\nBaseViewer.prototype.importDefinitions = function (\n  definitions,\n  bpmnDiagram,\n  done\n) {\n  if (isFunction(bpmnDiagram)) {\n    done = bpmnDiagram;\n    bpmnDiagram = null;\n  }\n\n  // done is optional\n  done = done || function () {};\n\n  this._setDefinitions(definitions);\n\n  return this.open(bpmnDiagram, done);\n};\n\n/**\n * Open diagram of previously imported XML.\n *\n * Once finished the viewer reports back the result to the\n * provided callback function with (err, warnings).\n *\n * ## Life-Cycle Events\n *\n * During switch the viewer will fire life-cycle events:\n *\n *   * import.render.start (graphical import start)\n *   * import.render.complete (graphical import finished)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @param {String|ModdleElement<BPMNDiagram>} [bpmnDiagramOrId] id or the diagram to open\n * @param {Function} [done] invoked with (err, warnings=[])\n */\nBaseViewer.prototype.open = function (bpmnDiagramOrId, done) {\n  if (isFunction(bpmnDiagramOrId)) {\n    done = bpmnDiagramOrId;\n    bpmnDiagramOrId = null;\n  }\n\n  let definitions = this._definitions;\n  let bpmnDiagram = bpmnDiagramOrId;\n\n  // done is optional\n  done = done || function () {};\n\n  if (!definitions) {\n    return done(new Error(\"no XML imported\"));\n  }\n\n  if (typeof bpmnDiagramOrId === \"string\") {\n    bpmnDiagram = findBPMNDiagram(definitions, bpmnDiagramOrId);\n\n    if (!bpmnDiagram) {\n      return done(new Error(\"BPMNDiagram <\" + bpmnDiagramOrId + \"> not found\"));\n    }\n  }\n\n  // clear existing rendered diagram\n  // catch synchronous exceptions during #clear()\n  try {\n    this.clear();\n  } catch (error) {\n    return done(error);\n  }\n\n  // perform graphical import\n  return importBpmnDiagram(this, definitions, bpmnDiagram, done);\n};\n\n/**\n * Export the currently displayed BPMN 2.0 diagram as\n * a BPMN 2.0 XML document.\n *\n * ## Life-Cycle Events\n *\n * During XML saving the viewer will fire life-cycle events:\n *\n *   * saveXML.start (before serialization)\n *   * saveXML.serialized (after xml generation)\n *   * saveXML.done (everything done)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @param {Object} [options] export options\n * @param {Boolean} [options.format=false] output formatted XML\n * @param {Boolean} [options.preamble=true] output preamble\n *\n * @param {Function} done invoked with (err, xml)\n */\nBaseViewer.prototype.saveXML = function (options, done) {\n  if (!done) {\n    done = options;\n    options = {};\n  }\n\n  let self = this;\n\n  let definitions = this._definitions;\n\n  if (!definitions) {\n    return done(new Error(\"no definitions loaded\"));\n  }\n\n  // allow to fiddle around with definitions\n  definitions =\n    this._emit(\"saveXML.start\", {\n      definitions: definitions,\n    }) || definitions;\n\n  this._moddle.toXML(definitions, options, function (err, xml) {\n    try {\n      xml =\n        self._emit(\"saveXML.serialized\", {\n          error: err,\n          xml: xml,\n        }) || xml;\n\n      self._emit(\"saveXML.done\", {\n        error: err,\n        xml: xml,\n      });\n    } catch (e) {\n      console.error(\"error in saveXML life-cycle listener\", e);\n    }\n\n    done(err, xml);\n  });\n};\n\n/**\n * Export the currently displayed BPMN 2.0 diagram as\n * an SVG image.\n *\n * ## Life-Cycle Events\n *\n * During SVG saving the viewer will fire life-cycle events:\n *\n *   * saveSVG.start (before serialization)\n *   * saveSVG.done (everything done)\n *\n * You can use these events to hook into the life-cycle.\n *\n * @param {Object} [options]\n * @param {Function} done invoked with (err, svgStr)\n */\nBaseViewer.prototype.saveSVG = function (options, done) {\n  if (!done) {\n    done = options;\n    options = {};\n  }\n\n  this._emit(\"saveSVG.start\");\n\n  let svg, err;\n\n  try {\n    let canvas = this.get(\"canvas\");\n\n    let contentNode = canvas.getDefaultLayer(),\n      defsNode = domQuery(\"defs\", canvas._svg);\n\n    let contents = innerSVG(contentNode),\n      defs = defsNode ? \"<defs>\" + innerSVG(defsNode) + \"</defs>\" : \"\";\n\n    let bbox = contentNode.getBBox();\n\n    svg =\n      '<?xml version=\"1.0\" encoding=\"utf-8\"?>\\n' +\n      \"<!-- created with bpmn-js / http://bpmn.io -->\\n\" +\n      '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n' +\n      '<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" ' +\n      'width=\"' +\n      bbox.width +\n      '\" height=\"' +\n      bbox.height +\n      '\" ' +\n      'viewBox=\"' +\n      bbox.x +\n      \" \" +\n      bbox.y +\n      \" \" +\n      bbox.width +\n      \" \" +\n      bbox.height +\n      '\" version=\"1.1\">' +\n      defs +\n      contents +\n      \"</svg>\";\n  } catch (e) {\n    err = e;\n  }\n\n  this._emit(\"saveSVG.done\", {\n    error: err,\n    svg: svg,\n  });\n\n  done(err, svg);\n};\n\n/**\n * Get a named diagram service.\n *\n * @example\n *\n * let elementRegistry = viewer.get('elementRegistry');\n * let startEventShape = elementRegistry.get('StartEvent_1');\n *\n * @param {String} name\n *\n * @return {Object} diagram service instance\n *\n * @method BaseViewer#get\n */\n\n/**\n * Invoke a function in the context of this viewer.\n *\n * @example\n *\n * viewer.invoke(function(elementRegistry) {\n *   let startEventShape = elementRegistry.get('StartEvent_1');\n * });\n *\n * @param {Function} fn to be invoked\n *\n * @return {Object} the functions return value\n *\n * @method BaseViewer#invoke\n */\n\nBaseViewer.prototype._setDefinitions = function (definitions) {\n  this._definitions = definitions;\n};\n\nBaseViewer.prototype.getModules = function () {\n  return this._modules;\n};\n\n/**\n * Remove all drawn elements from the viewer.\n *\n * After calling this method the viewer can still\n * be reused for opening another diagram.\n *\n * @method BaseViewer#clear\n */\nBaseViewer.prototype.clear = function () {\n  if (!this.getDefinitions()) {\n    // no diagram to clear\n    return;\n  }\n\n  // remove businessObject#di binding\n  //\n  // this is necessary, as we establish the bindings\n  // in the BpmnTreeWalker (and assume none are given\n  // on reimport)\n  this.get(\"elementRegistry\").forEach(function (element) {\n    let bo = element.businessObject;\n\n    if (bo && bo.di) {\n      delete bo.di;\n    }\n  });\n\n  // remove drawn elements\n  Diagram.prototype.clear.call(this);\n};\n\n/**\n * Destroy the viewer instance and remove all its\n * remainders from the document tree.\n */\nBaseViewer.prototype.destroy = function () {\n  // diagram destroy\n  Diagram.prototype.destroy.call(this);\n\n  // dom detach\n  domRemove(this._container);\n};\n\n/**\n * Register an event listener\n *\n * Remove a previously added listener via {@link #off(event, callback)}.\n *\n * @param {String} event\n * @param {Number} [priority]\n * @param {Function} callback\n * @param {Object} [that]\n */\nBaseViewer.prototype.on = function (event, priority, callback, target) {\n  return this.get(\"eventBus\").on(event, priority, callback, target);\n};\n\n/**\n * De-register an event listener\n *\n * @param {String} event\n * @param {Function} callback\n */\nBaseViewer.prototype.off = function (event, callback) {\n  this.get(\"eventBus\").off(event, callback);\n};\n\nBaseViewer.prototype.attachTo = function (parentNode) {\n  if (!parentNode) {\n    throw new Error(\"parentNode required\");\n  }\n\n  // ensure we detach from the\n  // previous, old parent\n  this.detach();\n\n  // unwrap jQuery if provided\n  if (parentNode.get && parentNode.constructor.prototype.jquery) {\n    parentNode = parentNode.get(0);\n  }\n\n  if (typeof parentNode === \"string\") {\n    parentNode = domQuery(parentNode);\n  }\n\n  parentNode.appendChild(this._container);\n\n  this._emit(\"attach\", {});\n\n  this.get(\"canvas\").resized();\n};\n\nBaseViewer.prototype.getDefinitions = function () {\n  return this._definitions;\n};\n\nBaseViewer.prototype.detach = function () {\n  let container = this._container,\n    parentNode = container.parentNode;\n\n  if (!parentNode) {\n    return;\n  }\n\n  this._emit(\"detach\", {});\n\n  parentNode.removeChild(container);\n};\n\nBaseViewer.prototype._init = function (container, moddle, options) {\n  let baseModules = options.modules || this.getModules(),\n    additionalModules = options.additionalModules || [],\n    staticModules = [\n      {\n        bpmnjs: [\"value\", this],\n        moddle: [\"value\", moddle],\n      },\n    ];\n\n  let diagramModules = [].concat(staticModules, baseModules, additionalModules);\n\n  let diagramOptions = assign(omit(options, [\"additionalModules\"]), {\n    canvas: assign({}, options.canvas, { container: container }),\n    modules: diagramModules,\n  });\n\n  // invoke diagram constructor\n  Diagram.call(this, diagramOptions);\n\n  if (options && options.container) {\n    this.attachTo(options.container);\n  }\n};\n\n/**\n * Emit an event on the underlying {@link EventBus}\n *\n * @param  {String} type\n * @param  {Object} event\n *\n * @return {Object} event processing result (if any)\n */\nBaseViewer.prototype._emit = function (type, event) {\n  return this.get(\"eventBus\").fire(type, event);\n};\n\nBaseViewer.prototype._createContainer = function (options) {\n  let container = domify('<div class=\"bjs-container\"></div>');\n\n  assign(container.style, {\n    width: ensureUnit(options.width),\n    height: ensureUnit(options.height),\n    position: options.position,\n  });\n\n  return container;\n};\n\nBaseViewer.prototype._createModdle = function (options) {\n  let moddleOptions = assign(\n    {},\n    this._moddleExtensions,\n    options.moddleExtensions\n  );\n\n  return new BpmnModdle(moddleOptions);\n};\n\nBaseViewer.prototype._modules = [];\n\n// helpers ///////////////\n\nfunction checkValidationError(err) {\n  // check if we can help the user by indicating wrong BPMN 2.0 xml\n  // (in case he or the exporting tool did not get that right)\n\n  let pattern = /unparsable content <([^>]+)> detected([\\s\\S]*)$/;\n  let match = pattern.exec(err.message);\n\n  if (match) {\n    err.message =\n      \"unparsable content <\" +\n      match[1] +\n      \"> detected; \" +\n      \"this may indicate an invalid BPMN 2.0 diagram file\" +\n      match[2];\n  }\n\n  return err;\n}\n\nlet DEFAULT_OPTIONS = {\n  width: \"100%\",\n  height: \"100%\",\n  position: \"relative\",\n};\n\n/**\n * Ensure the passed argument is a proper unit (defaulting to px)\n */\nfunction ensureUnit(val) {\n  return val + (isNumber(val) ? \"px\" : \"\");\n}\n\n/**\n * Find BPMNDiagram in definitions by ID\n *\n * @param {ModdleElement<Process-actions>} definitions\n * @param {String} diagramId\n *\n * @return {ModdleElement<BPMNDiagram>|null}\n */\nfunction findBPMNDiagram(definitions, diagramId) {\n  if (!diagramId) {\n    return null;\n  }\n\n  return (\n    find(definitions.diagrams, function (element) {\n      return element.id === diagramId;\n    }) || null\n  );\n}\n","import BpmnTreeWalker from \"./BpmnTreeWalker\";\n\nimport { isFunction } from \"min-dash\";\n\n/**\n * Import the definitions into a diagram.\n *\n * Errors and warnings are reported through the specified callback.\n *\n * @param  {djs.Diagram} diagram\n * @param  {ModdleElement<Process-actions>} definitions\n * @param  {ModdleElement<BPMNDiagram>} [bpmnDiagram] the diagram to be rendered\n * (if not provided, the first one will be rendered)\n * @param  {Function} done the callback, invoked with (err, [ warning ]) once the import is done\n */\nexport function importBpmnDiagram(diagram, definitions, bpmnDiagram, done) {\n  if (isFunction(bpmnDiagram)) {\n    done = bpmnDiagram;\n    bpmnDiagram = null;\n  }\n\n  let importer, eventBus, translate;\n\n  let error,\n    warnings = [];\n\n  /**\n   * Walk the diagram semantically, importing (=drawing)\n   * all elements you encounter.\n   *\n   * @param {ModdleElement<Process-actions>} definitions\n   * @param {ModdleElement<BPMNDiagram>} bpmnDiagram\n   */\n  function render(definitions, bpmnDiagram) {\n    let visitor = {\n      root: function (element) {\n        return importer.add(element);\n      },\n\n      element: function (element, parentShape) {\n        return importer.add(element, parentShape);\n      },\n\n      error: function (message, context) {\n        warnings.push({ message: message, context: context });\n      },\n    };\n\n    let walker = new BpmnTreeWalker(visitor, translate);\n\n    // traverse BPMN 2.0 document model,\n    // starting at definitions\n    walker.handleDefinitions(definitions, bpmnDiagram);\n  }\n\n  try {\n    importer = diagram.get(\"bpmnImporter\");\n    eventBus = diagram.get(\"eventBus\");\n    translate = diagram.get(\"translate\");\n\n    eventBus.fire(\"import.render.start\", { definitions: definitions });\n\n    render(definitions, bpmnDiagram);\n\n    eventBus.fire(\"import.render.complete\", {\n      error: error,\n      warnings: warnings,\n    });\n  } catch (e) {\n    error = e;\n  }\n\n  done(error, warnings);\n}\n","import inherits from \"inherits\";\n\nimport Ids from \"ids\";\n\nimport BaseViewer from \"./BaseViewer\";\n\n/**\n * A base modeler for BPMN 2.0 diagrams.\n *\n * Have a look at {@link Modeler} for a bundle that includes actual features.\n *\n * @param {Object} [options] configuration options to pass to the viewer\n * @param {DOMElement} [options.container] the container to render the viewer in, defaults to body.\n * @param {String|Number} [options.width] the width of the viewer\n * @param {String|Number} [options.height] the height of the viewer\n * @param {Object} [options.moddleExtensions] extension packages to provide\n * @param {Array<didi.Module>} [options.modules] a list of modules to override the default modules\n * @param {Array<didi.Module>} [options.additionalModules] a list of modules to use with the default modules\n */\nexport default function BaseModeler(options) {\n  BaseViewer.call(this, options);\n\n  // hook ID collection into the modeler\n  this.on(\n    \"import.parse.complete\",\n    function (event) {\n      if (!event.error) {\n        this._collectIds(event.definitions, event.context);\n      }\n    },\n    this\n  );\n\n  this.on(\n    \"diagram.destroy\",\n    function () {\n      this.get(\"moddle\").ids.clear();\n    },\n    this\n  );\n}\n\ninherits(BaseModeler, BaseViewer);\n\n/**\n * Create a moddle instance, attaching ids to it.\n *\n * @param {Object} options\n */\nBaseModeler.prototype._createModdle = function (options) {\n  let moddle = BaseViewer.prototype._createModdle.call(this, options);\n\n  // attach ids to moddle to be able to track\n  // and validated ids in the BPMN 2.0 XML document\n  // tree\n  moddle.ids = new Ids([32, 36, 1]);\n\n  return moddle;\n};\n\n/**\n * Collect ids processed during parsing of the\n * definitions object.\n *\n * @param {ModdleElement} definitions\n * @param {Context} context\n */\nBaseModeler.prototype._collectIds = function (definitions, context) {\n  let moddle = definitions.$model,\n    ids = moddle.ids,\n    id;\n\n  // remove references from previous import\n  ids.clear();\n\n  for (id in context.elementsById) {\n    ids.claim(id, context.elementsById[id]);\n  }\n};\n","/**\n * Is an element of the given BPMN type?\n *\n * @param  {djs.model.Base|ModdleElement} element\n * @param  {String} type\n *\n * @return {Boolean}\n */\nexport function is(element, type) {\n  let bo = getBusinessObject(element);\n\n  return bo && typeof bo.$instanceOf === \"function\" && bo.$instanceOf(type);\n}\n\n/**\n * Return the business object for a given element.\n *\n * @param  {djs.model.Base|ModdleElement} element\n *\n * @return {ModdleElement}\n */\nexport function getBusinessObject(element) {\n  return (element && element.businessObject) || element;\n}\n","import { is, getBusinessObject } from \"./ModelUtil\";\n\nimport { forEach } from \"min-dash\";\n\nexport function isExpanded(element) {\n  if (is(element, \"bpmn:CallActivity\")) {\n    return false;\n  }\n\n  if (is(element, \"bpmn:Loop\")) {\n    return !!getBusinessObject(element).di.isExpanded;\n  }\n\n  if (is(element, \"bpmn:Conditional\")) {\n    return !!getBusinessObject(element).di.isExpanded;\n  }\n\n  if (is(element, \"bpmn:Participant\")) {\n    return !!getBusinessObject(element).processRef;\n  }\n\n  return true;\n}\n\nexport function isInterrupting(element) {\n  return element && getBusinessObject(element).isInterrupting !== false;\n}\n\nexport function isEventLoop(element) {\n  return element && !!getBusinessObject(element).triggeredByEvent;\n}\n\nexport function hasEventDefinition(element, eventType) {\n  let bo = getBusinessObject(element),\n    hasEventDefinition = false;\n\n  if (bo.eventDefinitions) {\n    forEach(bo.eventDefinitions, function (event) {\n      if (is(event, eventType)) {\n        hasEventDefinition = true;\n      }\n    });\n  }\n\n  return hasEventDefinition;\n}\n\nexport function hasErrorEventDefinition(element) {\n  return hasEventDefinition(element, \"bpmn:ErrorEventDefinition\");\n}\n\nexport function hasEscalationEventDefinition(element) {\n  return hasEventDefinition(element, \"bpmn:EscalationEventDefinition\");\n}\n\nexport function hasCompensateEventDefinition(element) {\n  return hasEventDefinition(element, \"bpmn:CompensateEventDefinition\");\n}\n","import { is } from \"../../util/ModelUtil\";\n\nfunction getLabelAttr(semantic) {\n  if (\n    is(semantic, \"bpmn:FlowElement\") ||\n    is(semantic, \"bpmn:Participant\") ||\n    is(semantic, \"bpmn:Lane\") ||\n    is(semantic, \"bpmn:SequenceFlow\") ||\n    is(semantic, \"bpmn:MessageFlow\") ||\n    is(semantic, \"bpmn:DataInput\") ||\n    is(semantic, \"bpmn:DataOutput\")\n  ) {\n    return \"name\";\n  }\n\n  if (is(semantic, \"bpmn:TextAnnotation\")) {\n    return \"text\";\n  }\n\n  if (is(semantic, \"bpmn:Group\")) {\n    return \"categoryValueRef\";\n  }\n}\n\nfunction getCategoryValue(semantic) {\n  let categoryValueRef = semantic[\"categoryValueRef\"];\n\n  if (!categoryValueRef) {\n    return \"\";\n  }\n\n  return categoryValueRef.value || \"\";\n}\n\nexport function getLabel(element) {\n  let semantic = element.businessObject,\n    attr = getLabelAttr(semantic);\n\n  if (attr) {\n    if (attr === \"categoryValueRef\") {\n      return getCategoryValue(semantic);\n    }\n\n    return semantic[attr] || \"\";\n  }\n}\n\nexport function setLabel(element, text, isExternal) {\n  let semantic = element.businessObject,\n    attr = getLabelAttr(semantic);\n\n  if (attr) {\n    if (attr === \"categoryValueRef\") {\n      semantic[\"categoryValueRef\"].value = text;\n    } else {\n      semantic[attr] = text;\n    }\n  }\n\n  return element;\n}\n","import { every, some } from \"min-dash\";\nimport { componentsToPath } from \"diagram-js/lib/util/RenderUtil\";\n\nexport function isTypedEvent(event, eventDefinitionType, filter) {\n  function matches(definition, filter) {\n    return every(filter, function (val, key) {\n      return definition[key] === val;\n    });\n  }\n\n  return some(event.eventDefinitions, function (definition) {\n    return definition.$type === eventDefinitionType && matches(event, filter);\n  });\n}\n\nexport function isThrowEvent(event) {\n  return (\n    event.$type === \"bpmn:IntermediateThrowEvent\" ||\n    event.$type === \"bpmn:EndEvent\"\n  );\n}\n\nexport function isCollection(element) {\n  let dataObject = element.dataObjectRef;\n\n  return element.isCollection || (dataObject && dataObject.isCollection);\n}\n\nexport function getDi(element) {\n  return element.businessObject.di;\n}\n\nexport function getSemantic(element) {\n  return element.businessObject;\n}\n\nexport function getFillColor(element, defaultColor) {\n  return getDi(element).get(\"bioc:fill\") || defaultColor || \"white\";\n}\n\nexport function getStrokeColor(element, defaultColor) {\n  return getDi(element).get(\"bioc:stroke\") || defaultColor || \"black\";\n}\n\nexport function getCirclePath(shape) {\n  let cx = shape.x + shape.width / 2,\n    cy = shape.y + shape.height / 2,\n    radius = shape.width / 2;\n\n  let circlePath = [\n    [\"M\", cx, cy],\n    [\"m\", 0, -radius],\n    [\"a\", radius, radius, 0, 1, 1, 0, 2 * radius],\n    [\"a\", radius, radius, 0, 1, 1, 0, -2 * radius],\n    [\"z\"],\n  ];\n\n  return componentsToPath(circlePath);\n}\n\nexport function getRoundRectPath(shape, borderRadius) {\n  let x = shape.x,\n    y = shape.y,\n    width = shape.width,\n    height = shape.height;\n\n  let roundRectPath = [\n    [\"M\", x + borderRadius, y],\n    [\"l\", width - borderRadius * 2, 0],\n    [\"a\", borderRadius, borderRadius, 0, 0, 1, borderRadius, borderRadius],\n    [\"l\", 0, height - borderRadius * 2],\n    [\"a\", borderRadius, borderRadius, 0, 0, 1, -borderRadius, borderRadius],\n    [\"l\", borderRadius * 2 - width, 0],\n    [\"a\", borderRadius, borderRadius, 0, 0, 1, -borderRadius, -borderRadius],\n    [\"l\", 0, borderRadius * 2 - height],\n    [\"a\", borderRadius, borderRadius, 0, 0, 1, borderRadius, -borderRadius],\n    [\"z\"],\n  ];\n\n  return componentsToPath(roundRectPath);\n}\n\nexport function getDiamondPath(shape) {\n  let width = shape.width,\n    height = shape.height,\n    x = shape.x,\n    y = shape.y,\n    halfWidth = width / 2,\n    halfHeight = height / 2;\n\n  let diamondPath = [\n    [\"M\", x + halfWidth, y],\n    [\"l\", halfWidth, halfHeight],\n    [\"l\", -halfWidth, halfHeight],\n    [\"l\", -halfWidth, -halfHeight],\n    [\"z\"],\n  ];\n\n  return componentsToPath(diamondPath);\n}\n\nexport function getRectPath(shape) {\n  let x = shape.x,\n    y = shape.y,\n    width = shape.width,\n    height = shape.height;\n\n  let rectPath = [\n    [\"M\", x, y],\n    [\"l\", width, 0],\n    [\"l\", 0, height],\n    [\"l\", -width, 0],\n    [\"z\"],\n  ];\n\n  return componentsToPath(rectPath);\n}\n","import inherits from \"inherits\";\nimport BaseRenderer from \"diagram-js/lib/draw/BaseRenderer\";\nimport Ids from \"ids\";\nimport { createLine } from \"diagram-js/lib/util/RenderUtil\";\nimport { isObject, assign, forEach } from \"min-dash\";\nimport { query as domQuery } from \"min-dom\";\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  classes as svgClasses,\n} from \"tiny-svg\";\nimport {\n  rotate,\n  transform,\n  translate,\n} from \"diagram-js/lib/util/SvgTransformUtil\";\n\nimport { isExpanded, isEventLoop } from \"../util/DiUtil\";\nimport { getLabel } from \"../features/label-editing/LabelUtil\";\nimport { is } from \"../util/ModelUtil\";\nimport {\n  isTypedEvent,\n  isThrowEvent,\n  isCollection,\n  getDi,\n  getSemantic,\n  getCirclePath,\n  getRoundRectPath,\n  getDiamondPath,\n  getRectPath,\n  getFillColor,\n  getStrokeColor,\n} from \"./BpmnRenderUtil\";\n\nconst RENDERER_IDS = new Ids();\n\nconst TASK_BORDER_RADIUS = 10;\nconst INNER_OUTER_DIST = 3;\n\nconst DEFAULT_FILL_OPACITY = 0.95,\n  HIGH_FILL_OPACITY = 0.35;\n\nexport default function BpmnRenderer(\n  config,\n  eventBus,\n  styles,\n  pathMap,\n  canvas,\n  textRenderer,\n  priority\n) {\n  BaseRenderer.call(this, eventBus, priority);\n\n  let defaultFillColor = config && config.defaultFillColor,\n    defaultStrokeColor = config && config.defaultStrokeColor;\n\n  let rendererId = RENDERER_IDS.next();\n\n  let markers = {};\n\n  let computeStyle = styles.computeStyle;\n\n  function addMarker(id, options) {\n    let attrs = assign(\n      {\n        fill: \"black\",\n        strokeWidth: 1,\n        strokeLinecap: \"round\",\n        strokeDasharray: \"none\",\n      },\n      options.attrs\n    );\n\n    let ref = options.ref || { x: 0, y: 0 };\n\n    let scale = options.scale || 1;\n\n    // fix for safari / chrome / firefox bug not correctly\n    // resetting stroke dash array\n    if (attrs.strokeDasharray === \"none\") {\n      attrs.strokeDasharray = [10000, 1];\n    }\n\n    let marker = svgCreate(\"marker\");\n\n    svgAttr(options.element, attrs);\n\n    svgAppend(marker, options.element);\n\n    svgAttr(marker, {\n      id: id,\n      viewBox: \"0 0 20 20\",\n      refX: ref.x,\n      refY: ref.y,\n      markerWidth: 20 * scale,\n      markerHeight: 20 * scale,\n      orient: \"auto\",\n    });\n\n    let defs = domQuery(\"defs\", canvas._svg);\n\n    if (!defs) {\n      defs = svgCreate(\"defs\");\n\n      svgAppend(canvas._svg, defs);\n    }\n\n    svgAppend(defs, marker);\n\n    markers[id] = marker;\n  }\n\n  function colorEscape(str) {\n    // only allow characters and numbers\n    return str.replace(/[^0-9a-zA-z]+/g, \"_\");\n  }\n\n  function marker(type, fill, stroke) {\n    let id =\n      type +\n      \"-\" +\n      colorEscape(fill) +\n      \"-\" +\n      colorEscape(stroke) +\n      \"-\" +\n      rendererId;\n\n    if (!markers[id]) {\n      createMarker(id, type, fill, stroke);\n    }\n\n    return \"url(#\" + id + \")\";\n  }\n\n  function createMarker(id, type, fill, stroke) {\n    if (type === \"sequenceflow-end\") {\n      let sequenceflowEnd = svgCreate(\"path\");\n      svgAttr(sequenceflowEnd, { d: \"M 1 5 L 11 10 L 1 15 Z\" });\n\n      addMarker(id, {\n        element: sequenceflowEnd,\n        ref: { x: 11, y: 10 },\n        scale: 0.5,\n        attrs: {\n          fill: stroke,\n          stroke: stroke,\n        },\n      });\n    }\n\n    if (type === \"messageflow-start\") {\n      let messageflowStart = svgCreate(\"circle\");\n      svgAttr(messageflowStart, { cx: 6, cy: 6, r: 3.5 });\n\n      addMarker(id, {\n        element: messageflowStart,\n        attrs: {\n          fill: fill,\n          stroke: stroke,\n        },\n        ref: { x: 6, y: 6 },\n      });\n    }\n\n    if (type === \"messageflow-end\") {\n      let messageflowEnd = svgCreate(\"path\");\n      svgAttr(messageflowEnd, { d: \"m 1 5 l 0 -3 l 7 3 l -7 3 z\" });\n\n      addMarker(id, {\n        element: messageflowEnd,\n        attrs: {\n          fill: fill,\n          stroke: stroke,\n          strokeLinecap: \"butt\",\n        },\n        ref: { x: 8.5, y: 5 },\n      });\n    }\n\n    if (type === \"association-start\") {\n      let associationStart = svgCreate(\"path\");\n      svgAttr(associationStart, { d: \"M 11 5 L 1 10 L 11 15\" });\n\n      addMarker(id, {\n        element: associationStart,\n        attrs: {\n          fill: \"none\",\n          stroke: stroke,\n          strokeWidth: 1.5,\n        },\n        ref: { x: 1, y: 10 },\n        scale: 0.5,\n      });\n    }\n\n    if (type === \"association-end\") {\n      let associationEnd = svgCreate(\"path\");\n      svgAttr(associationEnd, { d: \"M 1 5 L 11 10 L 1 15\" });\n\n      addMarker(id, {\n        element: associationEnd,\n        attrs: {\n          fill: \"none\",\n          stroke: stroke,\n          strokeWidth: 1.5,\n        },\n        ref: { x: 12, y: 10 },\n        scale: 0.5,\n      });\n    }\n\n    if (type === \"conditional-flow-marker\") {\n      let conditionalflowMarker = svgCreate(\"path\");\n      svgAttr(conditionalflowMarker, { d: \"M 0 10 L 8 6 L 16 10 L 8 14 Z\" });\n\n      addMarker(id, {\n        element: conditionalflowMarker,\n        attrs: {\n          fill: fill,\n          stroke: stroke,\n        },\n        ref: { x: -1, y: 10 },\n        scale: 0.5,\n      });\n    }\n\n    if (type === \"conditional-default-flow-marker\") {\n      let conditionaldefaultflowMarker = svgCreate(\"path\");\n      svgAttr(conditionaldefaultflowMarker, { d: \"M 6 4 L 10 16\" });\n\n      addMarker(id, {\n        element: conditionaldefaultflowMarker,\n        attrs: {\n          stroke: stroke,\n        },\n        ref: { x: 0, y: 10 },\n        scale: 0.5,\n      });\n    }\n  }\n\n  function drawCircle(parentGfx, width, height, offset, attrs) {\n    if (isObject(offset)) {\n      attrs = offset;\n      offset = 0;\n    }\n\n    offset = offset || 0;\n\n    attrs = computeStyle(attrs, {\n      stroke: \"black\",\n      strokeWidth: 2,\n      fill: \"white\",\n    });\n\n    if (attrs.fill === \"none\") {\n      delete attrs.fillOpacity;\n    }\n\n    let cx = width / 2,\n      cy = height / 2;\n\n    let circle = svgCreate(\"circle\");\n    svgAttr(circle, {\n      cx: cx,\n      cy: cy,\n      r: Math.round((width + height) / 4 - offset),\n    });\n    svgAttr(circle, attrs);\n\n    svgAppend(parentGfx, circle);\n\n    return circle;\n  }\n\n  function drawRect(parentGfx, width, height, r, offset, attrs) {\n    if (isObject(offset)) {\n      attrs = offset;\n      offset = 0;\n    }\n\n    offset = offset || 0;\n\n    attrs = computeStyle(attrs, {\n      stroke: \"black\",\n      strokeWidth: 2,\n      fill: \"white\",\n    });\n\n    let rect = svgCreate(\"rect\");\n    svgAttr(rect, {\n      x: offset,\n      y: offset,\n      width: width - offset * 2,\n      height: height - offset * 2,\n      rx: r,\n      ry: r,\n    });\n    svgAttr(rect, attrs);\n\n    svgAppend(parentGfx, rect);\n\n    return rect;\n  }\n\n  function drawDiamond(parentGfx, width, height, attrs) {\n    let x_2 = width / 2;\n    let y_2 = height / 2;\n\n    let points = [\n      { x: x_2, y: 0 },\n      { x: width, y: y_2 },\n      { x: x_2, y: height },\n      { x: 0, y: y_2 },\n    ];\n\n    let pointsString = points\n      .map(function (point) {\n        return point.x + \",\" + point.y;\n      })\n      .join(\" \");\n\n    attrs = computeStyle(attrs, {\n      stroke: \"black\",\n      strokeWidth: 2,\n      fill: \"white\",\n    });\n\n    let polygon = svgCreate(\"polygon\");\n    svgAttr(polygon, {\n      points: pointsString,\n    });\n    svgAttr(polygon, attrs);\n\n    svgAppend(parentGfx, polygon);\n\n    return polygon;\n  }\n\n  function drawLine(parentGfx, waypoints, attrs) {\n    attrs = computeStyle(attrs, [\"no-fill\"], {\n      stroke: \"black\",\n      strokeWidth: 2,\n      fill: \"none\",\n    });\n\n    let line = createLine(waypoints, attrs);\n\n    svgAppend(parentGfx, line);\n\n    return line;\n  }\n\n  function drawPath(parentGfx, d, attrs) {\n    attrs = computeStyle(attrs, [\"no-fill\"], {\n      strokeWidth: 2,\n      stroke: \"black\",\n    });\n\n    let path = svgCreate(\"path\");\n    svgAttr(path, { d: d });\n    svgAttr(path, attrs);\n\n    svgAppend(parentGfx, path);\n\n    return path;\n  }\n\n  function drawMarker(type, parentGfx, path, attrs) {\n    return drawPath(parentGfx, path, assign({ \"data-marker\": type }, attrs));\n  }\n\n  function as(type) {\n    return function (parentGfx, element) {\n      return handlers[type](parentGfx, element);\n    };\n  }\n\n  function renderer(type) {\n    return handlers[type];\n  }\n\n  function renderEventContent(element, parentGfx) {\n    let event = getSemantic(element);\n    let isThrowing = isThrowEvent(event);\n\n    if (event.eventDefinitions && event.eventDefinitions.length > 1) {\n      if (event.parallelMultiple) {\n        return renderer(\"bpmn:ParallelMultipleEventDefinition\")(\n          parentGfx,\n          element,\n          isThrowing\n        );\n      } else {\n        return renderer(\"bpmn:MultipleEventDefinition\")(\n          parentGfx,\n          element,\n          isThrowing\n        );\n      }\n    }\n\n    if (isTypedEvent(event, \"bpmn:MessageEventDefinition\")) {\n      return renderer(\"bpmn:MessageEventDefinition\")(\n        parentGfx,\n        element,\n        isThrowing\n      );\n    }\n\n    if (isTypedEvent(event, \"bpmn:TimerEventDefinition\")) {\n      return renderer(\"bpmn:TimerEventDefinition\")(\n        parentGfx,\n        element,\n        isThrowing\n      );\n    }\n\n    if (isTypedEvent(event, \"bpmn:ConditionalEventDefinition\")) {\n      return renderer(\"bpmn:ConditionalEventDefinition\")(parentGfx, element);\n    }\n\n    if (isTypedEvent(event, \"bpmn:SignalEventDefinition\")) {\n      return renderer(\"bpmn:SignalEventDefinition\")(\n        parentGfx,\n        element,\n        isThrowing\n      );\n    }\n\n    if (isTypedEvent(event, \"bpmn:EscalationEventDefinition\")) {\n      return renderer(\"bpmn:EscalationEventDefinition\")(\n        parentGfx,\n        element,\n        isThrowing\n      );\n    }\n\n    if (isTypedEvent(event, \"bpmn:LinkEventDefinition\")) {\n      return renderer(\"bpmn:LinkEventDefinition\")(\n        parentGfx,\n        element,\n        isThrowing\n      );\n    }\n\n    if (isTypedEvent(event, \"bpmn:ErrorEventDefinition\")) {\n      return renderer(\"bpmn:ErrorEventDefinition\")(\n        parentGfx,\n        element,\n        isThrowing\n      );\n    }\n\n    if (isTypedEvent(event, \"bpmn:CancelEventDefinition\")) {\n      return renderer(\"bpmn:CancelEventDefinition\")(\n        parentGfx,\n        element,\n        isThrowing\n      );\n    }\n\n    if (isTypedEvent(event, \"bpmn:CompensateEventDefinition\")) {\n      return renderer(\"bpmn:CompensateEventDefinition\")(\n        parentGfx,\n        element,\n        isThrowing\n      );\n    }\n\n    if (isTypedEvent(event, \"bpmn:TerminateEventDefinition\")) {\n      return renderer(\"bpmn:TerminateEventDefinition\")(\n        parentGfx,\n        element,\n        isThrowing\n      );\n    }\n\n    return null;\n  }\n\n  function renderLabel(parentGfx, label, options) {\n    options = assign(\n      {\n        size: {\n          width: 100,\n        },\n      },\n      options\n    );\n\n    let text = textRenderer.createText(label || \"\", options);\n\n    svgClasses(text).add(\"djs-label\");\n\n    svgAppend(parentGfx, text);\n\n    return text;\n  }\n\n  function renderEmbeddedLabel(parentGfx, element, align) {\n    let semantic = getSemantic(element);\n\n    return renderLabel(parentGfx, semantic.name, {\n      box: element,\n      align: align,\n      padding: 5,\n      style: {\n        fill: getStrokeColor(element, defaultStrokeColor),\n      },\n    });\n  }\n\n  function renderExternalLabel(parentGfx, element) {\n    let box = {\n      width: 90,\n      height: 30,\n      x: element.width / 2 + element.x,\n      y: element.height / 2 + element.y,\n    };\n\n    return renderLabel(parentGfx, getLabel(element), {\n      box: box,\n      fitBox: true,\n      style: assign({}, textRenderer.getExternalStyle(), {\n        fill: getStrokeColor(element, defaultStrokeColor),\n      }),\n    });\n  }\n\n  function renderLaneLabel(parentGfx, text, element) {\n    let textBox = renderLabel(parentGfx, text, {\n      box: {\n        height: 30,\n        width: element.height,\n      },\n      align: \"center-middle\",\n      style: {\n        fill: getStrokeColor(element, defaultStrokeColor),\n      },\n    });\n\n    let top = -1 * element.height;\n\n    transform(textBox, 0, -top, 270);\n  }\n\n  function createPathFromConnection(connection) {\n    let waypoints = connection.waypoints;\n\n    let pathData = \"m  \" + waypoints[0].x + \",\" + waypoints[0].y;\n    for (let i = 1; i < waypoints.length; i++) {\n      pathData += \"L\" + waypoints[i].x + \",\" + waypoints[i].y + \" \";\n    }\n    return pathData;\n  }\n\n  let handlers = (this.handlers = {\n    \"bpmn:Event\": function (parentGfx, element, attrs) {\n      if (!(\"fillOpacity\" in attrs)) {\n        attrs.fillOpacity = DEFAULT_FILL_OPACITY;\n      }\n\n      return drawCircle(parentGfx, element.width, element.height, attrs);\n    },\n    \"bpmn:StartEvent\": function (parentGfx, element) {\n      let attrs = {\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      };\n\n      let semantic = getSemantic(element);\n\n      if (!semantic.isInterrupting) {\n        attrs = {\n          strokeDasharray: \"6\",\n          strokeLinecap: \"round\",\n          fill: getFillColor(element, defaultFillColor),\n          stroke: getStrokeColor(element, defaultStrokeColor),\n        };\n      }\n\n      let circle = renderer(\"bpmn:Event\")(parentGfx, element, attrs);\n\n      renderEventContent(element, parentGfx);\n\n      return circle;\n    },\n    \"bpmn:MessageEventDefinition\": function (parentGfx, element, isThrowing) {\n      let pathData = pathMap.getScaledPath(\"EVENT_MESSAGE\", {\n        xScaleFactor: 0.9,\n        yScaleFactor: 0.9,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.235,\n          my: 0.315,\n        },\n      });\n\n      let fill = isThrowing\n        ? getStrokeColor(element, defaultStrokeColor)\n        : getFillColor(element, defaultFillColor);\n      let stroke = isThrowing\n        ? getFillColor(element, defaultFillColor)\n        : getStrokeColor(element, defaultStrokeColor);\n\n      let messagePath = drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: fill,\n        stroke: stroke,\n      });\n\n      return messagePath;\n    },\n    \"bpmn:TimerEventDefinition\": function (parentGfx, element) {\n      let circle = drawCircle(\n        parentGfx,\n        element.width,\n        element.height,\n        0.2 * element.height,\n        {\n          strokeWidth: 2,\n          fill: getFillColor(element, defaultFillColor),\n          stroke: getStrokeColor(element, defaultStrokeColor),\n        }\n      );\n\n      let pathData = pathMap.getScaledPath(\"EVENT_TIMER_WH\", {\n        xScaleFactor: 0.75,\n        yScaleFactor: 0.75,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.5,\n          my: 0.5,\n        },\n      });\n\n      drawPath(parentGfx, pathData, {\n        strokeWidth: 2,\n        strokeLinecap: \"square\",\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      for (let i = 0; i < 12; i++) {\n        let linePathData = pathMap.getScaledPath(\"EVENT_TIMER_LINE\", {\n          xScaleFactor: 0.75,\n          yScaleFactor: 0.75,\n          containerWidth: element.width,\n          containerHeight: element.height,\n          position: {\n            mx: 0.5,\n            my: 0.5,\n          },\n        });\n\n        let width = element.width / 2;\n        let height = element.height / 2;\n\n        drawPath(parentGfx, linePathData, {\n          strokeWidth: 1,\n          strokeLinecap: \"square\",\n          transform: \"rotate(\" + i * 30 + \",\" + height + \",\" + width + \")\",\n          stroke: getStrokeColor(element, defaultStrokeColor),\n        });\n      }\n\n      return circle;\n    },\n    \"bpmn:EscalationEventDefinition\": function (parentGfx, event, isThrowing) {\n      let pathData = pathMap.getScaledPath(\"EVENT_ESCALATION\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.5,\n          my: 0.2,\n        },\n      });\n\n      let fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor)\n        : \"none\";\n\n      return drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: fill,\n        stroke: getStrokeColor(event, defaultStrokeColor),\n      });\n    },\n    \"bpmn:ConditionalEventDefinition\": function (parentGfx, event) {\n      let pathData = pathMap.getScaledPath(\"EVENT_CONDITIONAL\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.5,\n          my: 0.222,\n        },\n      });\n\n      return drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        stroke: getStrokeColor(event, defaultStrokeColor),\n      });\n    },\n    \"bpmn:LinkEventDefinition\": function (parentGfx, event, isThrowing) {\n      let pathData = pathMap.getScaledPath(\"EVENT_LINK\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.57,\n          my: 0.263,\n        },\n      });\n\n      let fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor)\n        : \"none\";\n\n      return drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: fill,\n        stroke: getStrokeColor(event, defaultStrokeColor),\n      });\n    },\n    \"bpmn:ErrorEventDefinition\": function (parentGfx, event, isThrowing) {\n      let pathData = pathMap.getScaledPath(\"EVENT_ERROR\", {\n        xScaleFactor: 1.1,\n        yScaleFactor: 1.1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.2,\n          my: 0.722,\n        },\n      });\n\n      let fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor)\n        : \"none\";\n\n      return drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: fill,\n        stroke: getStrokeColor(event, defaultStrokeColor),\n      });\n    },\n    \"bpmn:CancelEventDefinition\": function (parentGfx, event, isThrowing) {\n      let pathData = pathMap.getScaledPath(\"EVENT_CANCEL_45\", {\n        xScaleFactor: 1.0,\n        yScaleFactor: 1.0,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.638,\n          my: -0.055,\n        },\n      });\n\n      let fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor)\n        : \"none\";\n\n      let path = drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: fill,\n        stroke: getStrokeColor(event, defaultStrokeColor),\n      });\n\n      rotate(path, 45);\n\n      return path;\n    },\n    \"bpmn:CompensateEventDefinition\": function (parentGfx, event, isThrowing) {\n      let pathData = pathMap.getScaledPath(\"EVENT_COMPENSATION\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.22,\n          my: 0.5,\n        },\n      });\n\n      let fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor)\n        : \"none\";\n\n      return drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: fill,\n        stroke: getStrokeColor(event, defaultStrokeColor),\n      });\n    },\n    \"bpmn:SignalEventDefinition\": function (parentGfx, event, isThrowing) {\n      let pathData = pathMap.getScaledPath(\"EVENT_SIGNAL\", {\n        xScaleFactor: 0.9,\n        yScaleFactor: 0.9,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.5,\n          my: 0.2,\n        },\n      });\n\n      let fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor)\n        : \"none\";\n\n      return drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: fill,\n        stroke: getStrokeColor(event, defaultStrokeColor),\n      });\n    },\n    \"bpmn:MultipleEventDefinition\": function (parentGfx, event, isThrowing) {\n      let pathData = pathMap.getScaledPath(\"EVENT_MULTIPLE\", {\n        xScaleFactor: 1.1,\n        yScaleFactor: 1.1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.222,\n          my: 0.36,\n        },\n      });\n\n      let fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor)\n        : \"none\";\n\n      return drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: fill,\n      });\n    },\n    \"bpmn:ParallelMultipleEventDefinition\": function (parentGfx, event) {\n      let pathData = pathMap.getScaledPath(\"EVENT_PARALLEL_MULTIPLE\", {\n        xScaleFactor: 1.2,\n        yScaleFactor: 1.2,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.458,\n          my: 0.194,\n        },\n      });\n\n      return drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: getStrokeColor(event, defaultStrokeColor),\n        stroke: getStrokeColor(event, defaultStrokeColor),\n      });\n    },\n    \"bpmn:EndEvent\": function (parentGfx, element) {\n      let circle = renderer(\"bpmn:Event\")(parentGfx, element, {\n        strokeWidth: 4,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      renderEventContent(element, parentGfx, true);\n\n      return circle;\n    },\n    \"bpmn:TerminateEventDefinition\": function (parentGfx, element) {\n      let circle = drawCircle(parentGfx, element.width, element.height, 8, {\n        strokeWidth: 4,\n        fill: getStrokeColor(element, defaultStrokeColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      return circle;\n    },\n    \"bpmn:IntermediateEvent\": function (parentGfx, element) {\n      let outer = renderer(\"bpmn:Event\")(parentGfx, element, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      /* inner */\n      drawCircle(parentGfx, element.width, element.height, INNER_OUTER_DIST, {\n        strokeWidth: 1,\n        fill: getFillColor(element, \"none\"),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      renderEventContent(element, parentGfx);\n\n      return outer;\n    },\n    \"bpmn:IntermediateCatchEvent\": as(\"bpmn:IntermediateEvent\"),\n    \"bpmn:IntermediateThrowEvent\": as(\"bpmn:IntermediateEvent\"),\n\n    \"bpmn:Activity\": function (parentGfx, element, attrs) {\n      attrs = attrs || {};\n\n      if (!(\"fillOpacity\" in attrs)) {\n        attrs.fillOpacity = DEFAULT_FILL_OPACITY;\n      }\n\n      return drawRect(\n        parentGfx,\n        element.width,\n        element.height,\n        TASK_BORDER_RADIUS,\n        attrs\n      );\n    },\n\n    \"bpmn:Task\": function (parentGfx, element) {\n      let attrs = {\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      };\n\n      let rect = renderer(\"bpmn:Activity\")(parentGfx, element, attrs);\n\n      renderEmbeddedLabel(parentGfx, element, \"center-middle\");\n      attachTaskMarkers(parentGfx, element);\n\n      return rect;\n    },\n    \"bpmn:Mapper\": function (parentGfx, element) {\n      let attrs = {\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      };\n\n      let rect = renderer(\"bpmn:Activity\")(parentGfx, element, attrs);\n\n      renderEmbeddedLabel(parentGfx, element, \"center-middle\");\n      attachTaskMarkers(parentGfx, element);\n\n      return rect;\n    },\n    \"bpmn:Function\": function (parentGfx, element) {\n      let attrs = {\n        fill: getFillColor(element, defaultFillColor),\n        stroke: \"#00b0ff\",\n      };\n\n      let rect = renderer(\"bpmn:Activity\")(parentGfx, element, attrs);\n\n      renderEmbeddedLabel(parentGfx, element, \"center-middle\");\n      attachTaskMarkers(parentGfx, element);\n\n      return rect;\n    },\n    \"bpmn:ServiceTask\": function (parentGfx, element) {\n      let task = renderer(\"bpmn:Task\")(parentGfx, element);\n\n      let pathDataBG = pathMap.getScaledPath(\"TASK_TYPE_SERVICE\", {\n        abspos: {\n          x: 12,\n          y: 18,\n        },\n      });\n\n      /* service bg */ drawPath(parentGfx, pathDataBG, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      let fillPathData = pathMap.getScaledPath(\"TASK_TYPE_SERVICE_FILL\", {\n        abspos: {\n          x: 17.2,\n          y: 18,\n        },\n      });\n\n      /* service fill */ drawPath(parentGfx, fillPathData, {\n        strokeWidth: 0,\n        fill: getFillColor(element, defaultFillColor),\n      });\n\n      let pathData = pathMap.getScaledPath(\"TASK_TYPE_SERVICE\", {\n        abspos: {\n          x: 17,\n          y: 22,\n        },\n      });\n\n      /* service */ drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      return task;\n    },\n    \"bpmn:UserTask\": function (parentGfx, element) {\n      let task = renderer(\"bpmn:Task\")(parentGfx, element);\n\n      let x = 15;\n      let y = 12;\n\n      let pathData = pathMap.getScaledPath(\"TASK_TYPE_USER_1\", {\n        abspos: {\n          x: x,\n          y: y,\n        },\n      });\n\n      /* user path */ drawPath(parentGfx, pathData, {\n        strokeWidth: 0.5,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      let pathData2 = pathMap.getScaledPath(\"TASK_TYPE_USER_2\", {\n        abspos: {\n          x: x,\n          y: y,\n        },\n      });\n\n      /* user2 path */ drawPath(parentGfx, pathData2, {\n        strokeWidth: 0.5,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      let pathData3 = pathMap.getScaledPath(\"TASK_TYPE_USER_3\", {\n        abspos: {\n          x: x,\n          y: y,\n        },\n      });\n\n      /* user3 path */ drawPath(parentGfx, pathData3, {\n        strokeWidth: 0.5,\n        fill: getStrokeColor(element, defaultStrokeColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      return task;\n    },\n    \"bpmn:ManualTask\": function (parentGfx, element) {\n      let task = renderer(\"bpmn:Task\")(parentGfx, element);\n\n      let pathData = pathMap.getScaledPath(\"TASK_TYPE_MANUAL\", {\n        abspos: {\n          x: 17,\n          y: 15,\n        },\n      });\n\n      /* manual path */ drawPath(parentGfx, pathData, {\n        strokeWidth: 0.5, // 0.25,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      return task;\n    },\n    \"bpmn:SendTask\": function (parentGfx, element) {\n      let task = renderer(\"bpmn:Task\")(parentGfx, element);\n\n      let pathData = pathMap.getScaledPath(\"TASK_TYPE_SEND\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: 21,\n        containerHeight: 14,\n        position: {\n          mx: 0.285,\n          my: 0.357,\n        },\n      });\n\n      /* send path */ drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: getStrokeColor(element, defaultStrokeColor),\n        stroke: getFillColor(element, defaultFillColor),\n      });\n\n      return task;\n    },\n    \"bpmn:ReceiveTask\": function (parentGfx, element) {\n      let semantic = getSemantic(element);\n\n      let task = renderer(\"bpmn:Task\")(parentGfx, element);\n      let pathData;\n\n      if (semantic.instantiate) {\n        drawCircle(parentGfx, 28, 28, 20 * 0.22, { strokeWidth: 1 });\n\n        pathData = pathMap.getScaledPath(\"TASK_TYPE_INSTANTIATING_SEND\", {\n          abspos: {\n            x: 7.77,\n            y: 9.52,\n          },\n        });\n      } else {\n        pathData = pathMap.getScaledPath(\"TASK_TYPE_SEND\", {\n          xScaleFactor: 0.9,\n          yScaleFactor: 0.9,\n          containerWidth: 21,\n          containerHeight: 14,\n          position: {\n            mx: 0.3,\n            my: 0.4,\n          },\n        });\n      }\n\n      /* receive path */ drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      return task;\n    },\n    \"bpmn:ScriptTask\": function (parentGfx, element) {\n      let task = renderer(\"bpmn:Task\")(parentGfx, element);\n\n      let pathData = pathMap.getScaledPath(\"TASK_TYPE_SCRIPT\", {\n        abspos: {\n          x: 15,\n          y: 20,\n        },\n      });\n\n      /* script path */ drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      return task;\n    },\n    \"bpmn:BusinessRuleTask\": function (parentGfx, element) {\n      let task = renderer(\"bpmn:Task\")(parentGfx, element);\n\n      let headerPathData = pathMap.getScaledPath(\n        \"TASK_TYPE_BUSINESS_RULE_HEADER\",\n        {\n          abspos: {\n            x: 8,\n            y: 8,\n          },\n        }\n      );\n\n      let businessHeaderPath = drawPath(parentGfx, headerPathData);\n      svgAttr(businessHeaderPath, {\n        strokeWidth: 1,\n        fill: getFillColor(element, \"#aaaaaa\"),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      let headerData = pathMap.getScaledPath(\"TASK_TYPE_BUSINESS_RULE_MAIN\", {\n        abspos: {\n          x: 8,\n          y: 8,\n        },\n      });\n\n      let businessPath = drawPath(parentGfx, headerData);\n      svgAttr(businessPath, {\n        strokeWidth: 1,\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      return task;\n    },\n    \"bpmn:Loop\": function (parentGfx, element, attrs) {\n      attrs = assign(\n        {\n          fill: getFillColor(element, defaultFillColor),\n          stroke: getStrokeColor(element, defaultStrokeColor),\n        },\n        attrs\n      );\n\n      let rect = renderer(\"bpmn:Activity\")(parentGfx, element, attrs);\n\n      if (isEventLoop(element)) {\n        svgAttr(rect, {\n          strokeDasharray: \"1,2\",\n        });\n      }\n\n      renderEmbeddedLabel(parentGfx, element, \"center-top\");\n      attachTaskMarkers(parentGfx, element, [\"LoopProcessMarker\"]);\n      return rect;\n    },\n    \"bpmn:Conditional\": function (parentGfx, element, attrs) {\n      attrs = assign(\n        {\n          fill: getFillColor(element, defaultFillColor),\n          stroke: getStrokeColor(element, defaultStrokeColor),\n        },\n        attrs\n      );\n\n      let rect = renderer(\"bpmn:Activity\")(parentGfx, element, attrs);\n\n      if (isEventLoop(element)) {\n        svgAttr(rect, {\n          strokeDasharray: \"1,2\",\n        });\n      }\n      renderEmbeddedLabel(parentGfx, element, \"center-top\");\n      attachTaskMarkers(parentGfx, element, [\"ConditionalMarker\"]);\n      return rect;\n    },\n    \"bpmn:AdHocSubProcess\": function (parentGfx, element) {\n      return renderer(\"bpmn:Loop\")(parentGfx, element);\n    },\n    \"bpmn:Transaction\": function (parentGfx, element) {\n      let outer = renderer(\"bpmn:Loop\")(parentGfx, element);\n\n      let innerAttrs = styles.style([\"no-fill\", \"no-events\"], {\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      /* inner path */ drawRect(\n        parentGfx,\n        element.width,\n        element.height,\n        TASK_BORDER_RADIUS - 2,\n        INNER_OUTER_DIST,\n        innerAttrs\n      );\n\n      return outer;\n    },\n    \"bpmn:CallActivity\": function (parentGfx, element) {\n      return renderer(\"bpmn:Loop\")(parentGfx, element, {\n        strokeWidth: 5,\n      });\n    },\n    \"bpmn:Participant\": function (parentGfx, element) {\n      let attrs = {\n        fillOpacity: DEFAULT_FILL_OPACITY,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      };\n\n      let lane = renderer(\"bpmn:Lane\")(parentGfx, element, attrs);\n\n      let expandedPool = isExpanded(element);\n\n      if (expandedPool) {\n        drawLine(\n          parentGfx,\n          [\n            { x: 30, y: 0 },\n            { x: 30, y: element.height },\n          ],\n          {\n            stroke: getStrokeColor(element, defaultStrokeColor),\n          }\n        );\n        let text = getSemantic(element).name;\n        renderLaneLabel(parentGfx, text, element);\n      } else {\n        // Collapsed pool draw text inline\n        let text2 = getSemantic(element).name;\n        renderLabel(parentGfx, text2, {\n          box: element,\n          align: \"center-middle\",\n          style: {\n            fill: getStrokeColor(element, defaultStrokeColor),\n          },\n        });\n      }\n\n      let participantMultiplicity = !!getSemantic(element)\n        .participantMultiplicity;\n\n      if (participantMultiplicity) {\n        renderer(\"ParticipantMultiplicityMarker\")(parentGfx, element);\n      }\n\n      return lane;\n    },\n    \"bpmn:Lane\": function (parentGfx, element, attrs) {\n      let rect = drawRect(\n        parentGfx,\n        element.width,\n        element.height,\n        0,\n        assign(\n          {\n            fill: getFillColor(element, defaultFillColor),\n            fillOpacity: HIGH_FILL_OPACITY,\n            stroke: getStrokeColor(element, defaultStrokeColor),\n          },\n          attrs\n        )\n      );\n\n      let semantic = getSemantic(element);\n\n      if (semantic.$type === \"bpmn:Lane\") {\n        let text = semantic.name;\n        renderLaneLabel(parentGfx, text, element);\n      }\n\n      return rect;\n    },\n    \"bpmn:InclusiveGateway\": function (parentGfx, element) {\n      let diamond = renderer(\"bpmn:Gateway\")(parentGfx, element);\n\n      /* circle path */\n      drawCircle(\n        parentGfx,\n        element.width,\n        element.height,\n        element.height * 0.24,\n        {\n          strokeWidth: 2.5,\n          fill: getFillColor(element, defaultFillColor),\n          stroke: getStrokeColor(element, defaultStrokeColor),\n        }\n      );\n\n      return diamond;\n    },\n    \"bpmn:ExclusiveGateway\": function (parentGfx, element) {\n      let diamond = renderer(\"bpmn:Gateway\")(parentGfx, element);\n\n      let pathData = pathMap.getScaledPath(\"GATEWAY_EXCLUSIVE\", {\n        xScaleFactor: 0.4,\n        yScaleFactor: 0.4,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.32,\n          my: 0.3,\n        },\n      });\n\n      if (getDi(element).isMarkerVisible) {\n        drawPath(parentGfx, pathData, {\n          strokeWidth: 1,\n          fill: getStrokeColor(element, defaultStrokeColor),\n          stroke: getStrokeColor(element, defaultStrokeColor),\n        });\n      }\n\n      return diamond;\n    },\n    \"bpmn:Query\": function (parentGfx, element) {\n      let diamond = renderer(\"bpmn:Gateway\")(parentGfx, element);\n\n      let pathData = pathMap.getScaledPath(\"GATEWAY_EXCLUSIVE\", {\n        xScaleFactor: 0.4,\n        yScaleFactor: 0.4,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.32,\n          my: 0.3,\n        },\n      });\n\n      if (getDi(element).isMarkerVisible) {\n        drawPath(parentGfx, pathData, {\n          strokeWidth: 1,\n          fill: getStrokeColor(element, defaultStrokeColor),\n          stroke: getStrokeColor(element, defaultStrokeColor),\n        });\n      }\n\n      return diamond;\n    },\n    \"bpmn:ComplexGateway\": function (parentGfx, element) {\n      let diamond = renderer(\"bpmn:Gateway\")(parentGfx, element);\n\n      let pathData = pathMap.getScaledPath(\"GATEWAY_COMPLEX\", {\n        xScaleFactor: 0.5,\n        yScaleFactor: 0.5,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.46,\n          my: 0.26,\n        },\n      });\n\n      /* complex path */ drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: getStrokeColor(element, defaultStrokeColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      return diamond;\n    },\n    \"bpmn:ParallelGateway\": function (parentGfx, element) {\n      let diamond = renderer(\"bpmn:Gateway\")(parentGfx, element);\n\n      let pathData = pathMap.getScaledPath(\"GATEWAY_PARALLEL\", {\n        xScaleFactor: 0.6,\n        yScaleFactor: 0.6,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.46,\n          my: 0.2,\n        },\n      });\n\n      /* parallel path */ drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill: getStrokeColor(element, defaultStrokeColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      return diamond;\n    },\n    \"bpmn:EventBasedGateway\": function (parentGfx, element) {\n      let semantic = getSemantic(element);\n\n      let diamond = renderer(\"bpmn:Gateway\")(parentGfx, element);\n\n      /* outer circle path */ drawCircle(\n        parentGfx,\n        element.width,\n        element.height,\n        element.height * 0.2,\n        {\n          strokeWidth: 1,\n          fill: \"none\",\n          stroke: getStrokeColor(element, defaultStrokeColor),\n        }\n      );\n\n      let type = semantic.eventGatewayType;\n      let instantiate = !!semantic.instantiate;\n\n      function drawEvent() {\n        let pathData = pathMap.getScaledPath(\"GATEWAY_EVENT_BASED\", {\n          xScaleFactor: 0.18,\n          yScaleFactor: 0.18,\n          containerWidth: element.width,\n          containerHeight: element.height,\n          position: {\n            mx: 0.36,\n            my: 0.44,\n          },\n        });\n\n        let attrs = {\n          strokeWidth: 2,\n          fill: getFillColor(element, \"none\"),\n          stroke: getStrokeColor(element, defaultStrokeColor),\n        };\n\n        /* event path */ drawPath(parentGfx, pathData, attrs);\n      }\n\n      if (type === \"Parallel\") {\n        let pathData = pathMap.getScaledPath(\"GATEWAY_PARALLEL\", {\n          xScaleFactor: 0.4,\n          yScaleFactor: 0.4,\n          containerWidth: element.width,\n          containerHeight: element.height,\n          position: {\n            mx: 0.474,\n            my: 0.296,\n          },\n        });\n\n        let parallelPath = drawPath(parentGfx, pathData);\n        svgAttr(parallelPath, {\n          strokeWidth: 1,\n          fill: \"none\",\n        });\n      } else if (type === \"Exclusive\") {\n        if (!instantiate) {\n          let innerCircle = drawCircle(\n            parentGfx,\n            element.width,\n            element.height,\n            element.height * 0.26\n          );\n          svgAttr(innerCircle, {\n            strokeWidth: 1,\n            fill: \"none\",\n            stroke: getStrokeColor(element, defaultStrokeColor),\n          });\n        }\n\n        drawEvent();\n      }\n\n      return diamond;\n    },\n    \"bpmn:Gateway\": function (parentGfx, element) {\n      let attrs = {\n        fill: getFillColor(element, defaultFillColor),\n        fillOpacity: DEFAULT_FILL_OPACITY,\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      };\n\n      return drawDiamond(parentGfx, element.width, element.height, attrs);\n    },\n    \"bpmn:SequenceFlow\": function (parentGfx, element) {\n      let pathData = createPathFromConnection(element);\n\n      let fill = getFillColor(element, defaultFillColor),\n        stroke = getStrokeColor(element, defaultStrokeColor);\n\n      let attrs = {\n        strokeLinejoin: \"round\",\n        markerEnd: marker(\"sequenceflow-end\", fill, stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      };\n\n      let path = drawPath(parentGfx, pathData, attrs);\n\n      let sequenceFlow = getSemantic(element);\n\n      let source;\n\n      if (element.source) {\n        source = element.source.businessObject;\n\n        // conditional flow marker\n        if (\n          sequenceFlow.conditionExpression &&\n          source.$instanceOf(\"bpmn:Activity\")\n        ) {\n          svgAttr(path, {\n            markerStart: marker(\"conditional-flow-marker\", fill, stroke),\n          });\n        }\n\n        // default marker\n        if (\n          source.default &&\n          (source.$instanceOf(\"bpmn:Gateway\") ||\n            source.$instanceOf(\"bpmn:Activity\")) &&\n          source.default === sequenceFlow\n        ) {\n          svgAttr(path, {\n            markerStart: marker(\n              \"conditional-default-flow-marker\",\n              fill,\n              stroke\n            ),\n          });\n        }\n      }\n\n      return path;\n    },\n    \"bpmn:Association\": function (parentGfx, element, attrs) {\n      let semantic = getSemantic(element);\n\n      let fill = getFillColor(element, defaultFillColor),\n        stroke = getStrokeColor(element, defaultStrokeColor);\n\n      attrs = assign(\n        {\n          strokeDasharray: \"0.5, 5\",\n          strokeLinecap: \"round\",\n          strokeLinejoin: \"round\",\n          stroke: getStrokeColor(element, defaultStrokeColor),\n        },\n        attrs || {}\n      );\n\n      if (\n        semantic.associationDirection === \"One\" ||\n        semantic.associationDirection === \"Both\"\n      ) {\n        attrs.markerEnd = marker(\"association-end\", fill, stroke);\n      }\n\n      if (semantic.associationDirection === \"Both\") {\n        attrs.markerStart = marker(\"association-start\", fill, stroke);\n      }\n\n      return drawLine(parentGfx, element.waypoints, attrs);\n    },\n    \"bpmn:DataInputAssociation\": function (parentGfx, element) {\n      let fill = getFillColor(element, defaultFillColor),\n        stroke = getStrokeColor(element, defaultStrokeColor);\n\n      return renderer(\"bpmn:Association\")(parentGfx, element, {\n        markerEnd: marker(\"association-end\", fill, stroke),\n      });\n    },\n    \"bpmn:DataOutputAssociation\": function (parentGfx, element) {\n      let fill = getFillColor(element, defaultFillColor),\n        stroke = getStrokeColor(element, defaultStrokeColor);\n\n      return renderer(\"bpmn:Association\")(parentGfx, element, {\n        markerEnd: marker(\"association-end\", fill, stroke),\n      });\n    },\n    \"bpmn:MessageFlow\": function (parentGfx, element) {\n      let semantic = getSemantic(element),\n        di = getDi(element);\n\n      let fill = getFillColor(element, defaultFillColor),\n        stroke = getStrokeColor(element, defaultStrokeColor);\n\n      let pathData = createPathFromConnection(element);\n\n      let attrs = {\n        markerEnd: marker(\"messageflow-end\", fill, stroke),\n        markerStart: marker(\"messageflow-start\", fill, stroke),\n        strokeDasharray: \"10, 12\",\n        strokeLinecap: \"round\",\n        strokeLinejoin: \"round\",\n        strokeWidth: \"1.5px\",\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      };\n\n      let path = drawPath(parentGfx, pathData, attrs);\n\n      if (semantic.messageRef) {\n        let midPoint = path.getPointAtLength(path.getTotalLength() / 2);\n\n        let markerPathData = pathMap.getScaledPath(\"MESSAGE_FLOW_MARKER\", {\n          abspos: {\n            x: midPoint.x,\n            y: midPoint.y,\n          },\n        });\n\n        let messageAttrs = { strokeWidth: 1 };\n\n        if (di.messageVisibleKind === \"initiating\") {\n          messageAttrs.fill = \"white\";\n          messageAttrs.stroke = \"black\";\n        } else {\n          messageAttrs.fill = \"#888\";\n          messageAttrs.stroke = \"white\";\n        }\n\n        drawPath(parentGfx, markerPathData, messageAttrs);\n      }\n\n      return path;\n    },\n    \"bpmn:DataObject\": function (parentGfx, element) {\n      let pathData = pathMap.getScaledPath(\"DATA_OBJECT_PATH\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.474,\n          my: 0.296,\n        },\n      });\n\n      let elementObject = drawPath(parentGfx, pathData, {\n        fill: getFillColor(element, defaultFillColor),\n        fillOpacity: DEFAULT_FILL_OPACITY,\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      let semantic = getSemantic(element);\n\n      if (isCollection(semantic)) {\n        renderDataItemCollection(parentGfx, element);\n      }\n\n      return elementObject;\n    },\n    \"bpmn:DataObjectReference\": as(\"bpmn:DataObject\"),\n    \"bpmn:DataInput\": function (parentGfx, element) {\n      let arrowPathData = pathMap.getRawPath(\"DATA_ARROW\");\n\n      // page\n      let elementObject = renderer(\"bpmn:DataObject\")(parentGfx, element);\n\n      /* input arrow path */ drawPath(parentGfx, arrowPathData, {\n        strokeWidth: 1,\n      });\n\n      return elementObject;\n    },\n    \"bpmn:DataOutput\": function (parentGfx, element) {\n      let arrowPathData = pathMap.getRawPath(\"DATA_ARROW\");\n\n      // page\n      let elementObject = renderer(\"bpmn:DataObject\")(parentGfx, element);\n\n      /* output arrow path */ drawPath(parentGfx, arrowPathData, {\n        strokeWidth: 1,\n        fill: \"black\",\n      });\n\n      return elementObject;\n    },\n    \"bpmn:DataStoreReference\": function (parentGfx, element) {\n      let DATA_STORE_PATH = pathMap.getScaledPath(\"DATA_STORE\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0,\n          my: 0.133,\n        },\n      });\n\n      let elementStore = drawPath(parentGfx, DATA_STORE_PATH, {\n        strokeWidth: 2,\n        fill: getFillColor(element, defaultFillColor),\n        fillOpacity: DEFAULT_FILL_OPACITY,\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      return elementStore;\n    },\n    \"bpmn:BoundaryEvent\": function (parentGfx, element) {\n      let semantic = getSemantic(element),\n        cancel = semantic.cancelActivity;\n\n      let attrs = {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      };\n\n      if (!cancel) {\n        attrs.strokeDasharray = \"6\";\n        attrs.strokeLinecap = \"round\";\n      }\n\n      // apply fillOpacity\n      let outerAttrs = assign({}, attrs, {\n        fillOpacity: 1,\n      });\n\n      // apply no-fill\n      let innerAttrs = assign({}, attrs, {\n        fill: \"none\",\n      });\n\n      let outer = renderer(\"bpmn:Event\")(parentGfx, element, outerAttrs);\n\n      /* inner path */ drawCircle(\n        parentGfx,\n        element.width,\n        element.height,\n        INNER_OUTER_DIST,\n        innerAttrs\n      );\n\n      renderEventContent(element, parentGfx);\n\n      return outer;\n    },\n    \"bpmn:Group\": function (parentGfx, element) {\n      let group = drawRect(\n        parentGfx,\n        element.width,\n        element.height,\n        TASK_BORDER_RADIUS,\n        {\n          stroke: getStrokeColor(element, defaultStrokeColor),\n          strokeWidth: 1,\n          strokeDasharray: \"8,3,1,3\",\n          fill: \"none\",\n          pointerEvents: \"none\",\n        }\n      );\n\n      return group;\n    },\n    label: function (parentGfx, element) {\n      return renderExternalLabel(parentGfx, element);\n    },\n    \"bpmn:TextAnnotation\": function (parentGfx, element) {\n      let style = {\n        fill: \"none\",\n        stroke: \"none\",\n      };\n\n      let textElement = drawRect(\n        parentGfx,\n        element.width,\n        element.height,\n        0,\n        0,\n        style\n      );\n\n      let textPathData = pathMap.getScaledPath(\"TEXT_ANNOTATION\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.0,\n          my: 0.0,\n        },\n      });\n\n      drawPath(parentGfx, textPathData, {\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      let text = getSemantic(element).text || \"\";\n      renderLabel(parentGfx, text, {\n        box: element,\n        align: \"left-top\",\n        padding: 5,\n        style: {\n          fill: getStrokeColor(element, defaultStrokeColor),\n        },\n      });\n\n      return textElement;\n    },\n    ParticipantMultiplicityMarker: function (parentGfx, element) {\n      let markerPath = pathMap.getScaledPath(\"MARKER_PARALLEL\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: element.width / 2 / element.width,\n          my: (element.height - 15) / element.height,\n        },\n      });\n\n      drawMarker(\"participant-multiplicity\", parentGfx, markerPath, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n    },\n    SubProcessMarker: function (parentGfx, element) {\n      let markerRect = drawRect(parentGfx, 14, 14, 0, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      // Process marker is placed in the middle of the box\n      // therefore fixed values can be used here\n      translate(markerRect, element.width / 2 - 7.5, element.height - 20);\n\n      let markerPath = pathMap.getScaledPath(\"MARKER_SUB_PROCESS\", {\n        xScaleFactor: 1.5,\n        yScaleFactor: 1.5,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: (element.width / 2 - 7.5) / element.width,\n          my: (element.height - 20) / element.height,\n        },\n      });\n\n      drawMarker(\"sub-process\", parentGfx, markerPath, {\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n    },\n    ConditionalMarker: function (parentGfx, element) {\n      let markerRect = drawRect(parentGfx, 20, 20, 0, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n\n      // Process marker is placed in the middle of the box\n      // therefore fixed values can be used here\n      translate(markerRect, element.width / 2 - 7.5, element.height - 25);\n\n      let markerPath = pathMap.getScaledPath(\"MARKER_CONDITIONAL\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: (element.width / 2 - 4.5) / element.width,\n          my: (element.height - 22) / element.height,\n        },\n      });\n\n      drawMarker(\"sub-process\", parentGfx, markerPath, {\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n    },\n    LoopProcessMarker: function (parentGfx, element, position) {\n      let markerRect = drawRect(parentGfx, 20, 20, 0, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n      translate(markerRect, element.width / 2 - 7.5, element.height - 25);\n      let markerPath = pathMap.getScaledPath(\"MARKER_LOOP\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: (element.width / 2 + position.loop + 2) / element.width,\n          my: (element.height - 9) / element.height,\n        },\n      });\n\n      drawMarker(\"loop\", parentGfx, markerPath, {\n        strokeWidth: 1.5,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n        strokeLinecap: \"round\",\n        strokeMiterlimit: 0.5,\n      });\n      // let markerDiamond = drawDiamond(parentGfx, 30, 30);\n      // let circle = drawCircle(parentGfx, 25, 25, 25 * 0.24, {\n      //   strokeWidth: 2.5,\n      //   fill: getFillColor(element, defaultFillColor),\n      //   stroke: getStrokeColor(element, defaultStrokeColor),\n      // });\n      // translate(markerDiamond, element.width / 2 - 7.5, element.height - 35);\n      // translate(circle, element.width / 2 - 5, element.height - 32.5);\n    },\n    ParallelMarker: function (parentGfx, element, position) {\n      let markerPath = pathMap.getScaledPath(\"MARKER_PARALLEL\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: (element.width / 2 + position.parallel) / element.width,\n          my: (element.height - 20) / element.height,\n        },\n      });\n\n      drawMarker(\"parallel\", parentGfx, markerPath, {\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n    },\n    SequentialMarker: function (parentGfx, element, position) {\n      let markerPath = pathMap.getScaledPath(\"MARKER_SEQUENTIAL\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: (element.width / 2 + position.seq) / element.width,\n          my: (element.height - 19) / element.height,\n        },\n      });\n\n      drawMarker(\"sequential\", parentGfx, markerPath, {\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n    },\n    CompensationMarker: function (parentGfx, element, position) {\n      let markerMath = pathMap.getScaledPath(\"MARKER_COMPENSATION\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: (element.width / 2 + position.compensation) / element.width,\n          my: (element.height - 13) / element.height,\n        },\n      });\n\n      drawMarker(\"compensation\", parentGfx, markerMath, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n    },\n    LoopMarker: function (parentGfx, element, position) {\n      let markerPath = pathMap.getScaledPath(\"MARKER_LOOP\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: (element.width / 2 + position.loop) / element.width,\n          my: (element.height - 7) / element.height,\n        },\n      });\n\n      drawMarker(\"loop\", parentGfx, markerPath, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n        strokeLinecap: \"round\",\n        strokeMiterlimit: 0.5,\n      });\n    },\n    AdhocMarker: function (parentGfx, element, position) {\n      let markerPath = pathMap.getScaledPath(\"MARKER_ADHOC\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: (element.width / 2 + position.adhoc) / element.width,\n          my: (element.height - 15) / element.height,\n        },\n      });\n\n      drawMarker(\"adhoc\", parentGfx, markerPath, {\n        strokeWidth: 1,\n        fill: getStrokeColor(element, defaultStrokeColor),\n        stroke: getStrokeColor(element, defaultStrokeColor),\n      });\n    },\n  });\n\n  function attachTaskMarkers(parentGfx, element, taskMarkers) {\n    let obj = getSemantic(element);\n\n    let loop = taskMarkers && taskMarkers.indexOf(\"SubProcessMarker\") !== -1;\n    let position;\n\n    if (loop) {\n      position = {\n        seq: -21,\n        parallel: -22,\n        compensation: -42,\n        loop: -18,\n        adhoc: 10,\n      };\n    } else {\n      position = {\n        seq: -3,\n        parallel: -6,\n        compensation: -27,\n        loop: 0,\n        adhoc: 10,\n      };\n    }\n\n    forEach(taskMarkers, function (marker) {\n      renderer(marker)(parentGfx, element, position);\n    });\n\n    if (obj.isForCompensation) {\n      renderer(\"CompensationMarker\")(parentGfx, element, position);\n    }\n\n    if (obj.$type === \"bpmn:AdHocSubProcess\") {\n      renderer(\"AdhocMarker\")(parentGfx, element, position);\n    }\n\n    let loopCharacteristics = obj.loopCharacteristics,\n      isSequential = loopCharacteristics && loopCharacteristics.isSequential;\n\n    if (loopCharacteristics) {\n      if (isSequential === undefined) {\n        renderer(\"LoopMarker\")(parentGfx, element, position);\n      }\n\n      if (isSequential === false) {\n        renderer(\"ParallelMarker\")(parentGfx, element, position);\n      }\n\n      if (isSequential === true) {\n        renderer(\"SequentialMarker\")(parentGfx, element, position);\n      }\n    }\n  }\n\n  function renderDataItemCollection(parentGfx, element) {\n    let yPosition = (element.height - 16) / element.height;\n\n    let pathData = pathMap.getScaledPath(\"DATA_OBJECT_COLLECTION_PATH\", {\n      xScaleFactor: 1,\n      yScaleFactor: 1,\n      containerWidth: element.width,\n      containerHeight: element.height,\n      position: {\n        mx: 0.451,\n        my: yPosition,\n      },\n    });\n\n    /* collection path */ drawPath(parentGfx, pathData, {\n      strokeWidth: 2,\n    });\n  }\n\n  // extension API, use at your own risk\n  this._drawPath = drawPath;\n}\n\ninherits(BpmnRenderer, BaseRenderer);\n\nBpmnRenderer.$inject = [\n  \"config.bpmnRenderer\",\n  \"eventBus\",\n  \"styles\",\n  \"pathMap\",\n  \"canvas\",\n  \"textRenderer\",\n];\n\nBpmnRenderer.prototype.canRender = function (element) {\n  return is(element, \"bpmn:BaseElement\");\n};\n\nBpmnRenderer.prototype.drawShape = function (parentGfx, element) {\n  let type = element.type;\n  let h = this.handlers[type];\n\n  /* jshint -W040 */\n  return h(parentGfx, element);\n};\n\nBpmnRenderer.prototype.drawConnection = function (parentGfx, element) {\n  let type = element.type;\n  let h = this.handlers[type];\n\n  /* jshint -W040 */\n  return h(parentGfx, element);\n};\n\nBpmnRenderer.prototype.getShapePath = function (element) {\n  if (is(element, \"bpmn:Event\")) {\n    return getCirclePath(element);\n  }\n\n  if (is(element, \"bpmn:Activity\")) {\n    return getRoundRectPath(element, TASK_BORDER_RADIUS);\n  }\n\n  if (is(element, \"bpmn:Gateway\")) {\n    return getDiamondPath(element);\n  }\n\n  return getRectPath(element);\n};\n","import { assign } from \"min-dash\";\n\nimport TextUtil from \"diagram-js/lib/util/Text\";\n\nconst DEFAULT_FONT_SIZE = 12;\nconst LINE_HEIGHT_RATIO = 1.2;\n\nconst MIN_TEXT_ANNOTATION_HEIGHT = 30;\n\nexport default function TextRenderer(config) {\n  let defaultStyle = assign(\n    {\n      fontFamily: \"Arial, sans-serif\",\n      fontSize: DEFAULT_FONT_SIZE,\n      fontWeight: \"normal\",\n      lineHeight: LINE_HEIGHT_RATIO,\n    },\n    (config && config.defaultStyle) || {}\n  );\n\n  let fontSize = parseInt(defaultStyle.fontSize, 10) - 1;\n\n  let externalStyle = assign(\n    {},\n    defaultStyle,\n    {\n      fontSize: fontSize,\n    },\n    (config && config.externalStyle) || {}\n  );\n\n  let textUtil = new TextUtil({\n    style: defaultStyle,\n  });\n\n  /**\n   * Get the new bounds of an externally rendered,\n   * layouted label.\n   *\n   * @param  {Bounds} bounds\n   * @param  {String} text\n   *\n   * @return {Bounds}\n   */\n  this.getExternalLabelBounds = function (bounds, text) {\n    let layoutedDimensions = textUtil.getDimensions(text, {\n      box: {\n        width: 90,\n        height: 30,\n        x: bounds.width / 2 + bounds.x,\n        y: bounds.height / 2 + bounds.y,\n      },\n      style: externalStyle,\n    });\n\n    // resize label shape to fit label text\n    return {\n      x: Math.round(bounds.x + bounds.width / 2 - layoutedDimensions.width / 2),\n      y: Math.round(bounds.y),\n      width: Math.ceil(layoutedDimensions.width),\n      height: Math.ceil(layoutedDimensions.height),\n    };\n  };\n\n  /**\n   * Get the new bounds of text annotation.\n   *\n   * @param  {Bounds} bounds\n   * @param  {String} text\n   *\n   * @return {Bounds}\n   */\n  this.getTextAnnotationBounds = function (bounds, text) {\n    let layoutedDimensions = textUtil.getDimensions(text, {\n      box: bounds,\n      style: defaultStyle,\n      align: \"left-top\",\n      padding: 5,\n    });\n\n    return {\n      x: bounds.x,\n      y: bounds.y,\n      width: bounds.width,\n      height: Math.max(\n        MIN_TEXT_ANNOTATION_HEIGHT,\n        Math.round(layoutedDimensions.height)\n      ),\n    };\n  };\n\n  /**\n   * Create a layouted text element.\n   *\n   * @param {String} text\n   * @param {Object} [options]\n   *\n   * @return {SVGElement} rendered text\n   */\n  this.createText = function (text, options) {\n    return textUtil.createText(text, options || {});\n  };\n\n  /**\n   * Get default text style.\n   */\n  this.getDefaultStyle = function () {\n    return defaultStyle;\n  };\n\n  /**\n   * Get the external text style.\n   */\n  this.getExternalStyle = function () {\n    return externalStyle;\n  };\n}\n\nTextRenderer.$inject = [\"config.textRenderer\"];\n","export default function PathMap() {\n  this.pathMap = {\n    EVENT_MESSAGE: {\n      d:\n        \"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}\",\n      height: 36,\n      width: 36,\n      heightElements: [6, 14],\n      widthElements: [10.5, 21],\n    },\n    EVENT_SIGNAL: {\n      d: \"M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z\",\n      height: 36,\n      width: 36,\n      heightElements: [18],\n      widthElements: [10, 20],\n    },\n    EVENT_ESCALATION: {\n      d: \"M {mx},{my} l {e.x0},{e.y0} l -{e.x0},-{e.y1} l -{e.x0},{e.y1} Z\",\n      height: 36,\n      width: 36,\n      heightElements: [20, 7],\n      widthElements: [8],\n    },\n    EVENT_CONDITIONAL: {\n      d:\n        \"M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z \" +\n        \"M {e.x2},{e.y3} l {e.x0},0 \" +\n        \"M {e.x2},{e.y4} l {e.x0},0 \" +\n        \"M {e.x2},{e.y5} l {e.x0},0 \" +\n        \"M {e.x2},{e.y6} l {e.x0},0 \" +\n        \"M {e.x2},{e.y7} l {e.x0},0 \" +\n        \"M {e.x2},{e.y8} l {e.x0},0 \",\n      height: 36,\n      width: 36,\n      heightElements: [8.5, 14.5, 18, 11.5, 14.5, 17.5, 20.5, 23.5, 26.5],\n      widthElements: [10.5, 14.5, 12.5],\n    },\n    EVENT_LINK: {\n      d:\n        \"m {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z\",\n      height: 36,\n      width: 36,\n      heightElements: [4.4375, 6.75, 7.8125],\n      widthElements: [9.84375, 13.5],\n    },\n    EVENT_ERROR: {\n      d:\n        \"m {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z\",\n      height: 36,\n      width: 36,\n      heightElements: [0.023, 8.737, 8.151, 16.564, 10.591, 8.714],\n      widthElements: [0.085, 6.672, 6.97, 4.273, 5.337, 6.636],\n    },\n    EVENT_CANCEL_45: {\n      d:\n        \"m {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 \" +\n        \"0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z\",\n      height: 36,\n      width: 36,\n      heightElements: [4.75, 8.5],\n      widthElements: [4.75, 8.5],\n    },\n    EVENT_COMPENSATION: {\n      d:\n        \"m {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z\",\n      height: 36,\n      width: 36,\n      heightElements: [6.5, 13, 0.4, 6.1],\n      widthElements: [9, 9.3, 8.7],\n    },\n    EVENT_TIMER_WH: {\n      d: \"M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} \",\n      height: 36,\n      width: 36,\n      heightElements: [10, 2],\n      widthElements: [3, 7],\n    },\n    EVENT_TIMER_LINE: {\n      d: `M {mx},{my}  m {e.x0},{e.y0} l -{e.x1},{e.y1} `,\n      height: 36,\n      width: 36,\n      heightElements: [10, 3],\n      widthElements: [0, 0],\n    },\n    EVENT_MULTIPLE: {\n      d: \"m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z\",\n      height: 36,\n      width: 36,\n      heightElements: [6.28099, 12.56199],\n      widthElements: [3.1405, 9.42149, 12.56198],\n    },\n    EVENT_PARALLEL_MULTIPLE: {\n      d:\n        \"m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} \" +\n        \"-{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z\",\n      height: 36,\n      width: 36,\n      heightElements: [2.56228, 7.68683],\n      widthElements: [2.56228, 7.68683],\n    },\n    GATEWAY_EXCLUSIVE: {\n      d:\n        \"m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} \" +\n        \"{e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} \" +\n        \"{e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z\",\n      height: 17.5,\n      width: 17.5,\n      heightElements: [8.5, 6.5312, -6.5312, -8.5],\n      widthElements: [6.5, -6.5, 3, -3, 5, -5],\n    },\n    GATEWAY_PARALLEL: {\n      d:\n        \"m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 \" +\n        \"0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z\",\n      height: 30,\n      width: 30,\n      heightElements: [5, 12.5],\n      widthElements: [5, 12.5],\n    },\n    GATEWAY_EVENT_BASED: {\n      d: \"m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z\",\n      height: 11,\n      width: 11,\n      heightElements: [-6, 6, 12, -12],\n      widthElements: [9, -3, -12],\n    },\n    GATEWAY_COMPLEX: {\n      d:\n        \"m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} \" +\n        \"{e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} \" +\n        \"{e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} \" +\n        \"-{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z\",\n      height: 17.125,\n      width: 17.125,\n      heightElements: [4.875, 3.4375, 2.125, 3],\n      widthElements: [3.4375, 2.125, 4.875, 3],\n    },\n    DATA_OBJECT_PATH: {\n      d:\n        \"m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0\",\n      height: 61,\n      width: 51,\n      heightElements: [10, 50, 60],\n      widthElements: [10, 40, 50, 60],\n    },\n    DATA_OBJECT_COLLECTION_PATH: {\n      d:\n        \"m {mx}, {my} \" +\n        \"m  0 15  l 0 -15 \" +\n        \"m  4 15  l 0 -15 \" +\n        \"m  4 15  l 0 -15 \",\n      height: 61,\n      width: 51,\n      heightElements: [12],\n      widthElements: [1, 6, 12, 15],\n    },\n    DATA_ARROW: {\n      d: \"m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z\",\n      height: 61,\n      width: 51,\n      heightElements: [],\n      widthElements: [],\n    },\n    DATA_STORE: {\n      d:\n        \"m  {mx},{my} \" +\n        \"l  0,{e.y2} \" +\n        \"c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 \" +\n        \"l  0,-{e.y2} \" +\n        \"c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0\" +\n        \"c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 \" +\n        \"m  -{e.x2},{e.y0}\" +\n        \"c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0\" +\n        \"m  -{e.x2},{e.y0}\" +\n        \"c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0\",\n      height: 61,\n      width: 61,\n      heightElements: [7, 10, 45],\n      widthElements: [2, 58, 60],\n    },\n    TEXT_ANNOTATION: {\n      d: \"m {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0\",\n      height: 30,\n      width: 10,\n      heightElements: [30],\n      widthElements: [10],\n    },\n    MARKER_SUB_PROCESS: {\n      d: \"m{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0\",\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: [],\n    },\n    MARKER_CONDITIONAL: {\n      d: \"m{mx},{my} m 2,4 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0\",\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: [],\n    },\n    MARKER_PARALLEL: {\n      d: \"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10\",\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: [],\n    },\n    MARKER_SEQUENTIAL: {\n      d: \"m{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0\",\n      height: 10,\n      width: 10,\n      heightElements: [],\n      widthElements: [],\n    },\n    MARKER_COMPENSATION: {\n      d: \"m {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z\",\n      height: 10,\n      width: 21,\n      heightElements: [],\n      widthElements: [],\n    },\n    MARKER_LOOP: {\n      d:\n        \"m {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 \" +\n        \"-6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 \" +\n        \"0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 \" +\n        \"l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902\",\n      height: 13.9,\n      width: 13.7,\n      heightElements: [],\n      widthElements: [],\n    },\n    MARKER_ADHOC: {\n      d:\n        \"m {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 \" +\n        \"3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 \" +\n        \"1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 \" +\n        \"-3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 \" +\n        \"-2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z\",\n      height: 4,\n      width: 15,\n      heightElements: [],\n      widthElements: [],\n    },\n    TASK_TYPE_SEND: {\n      d:\n        \"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}\",\n      height: 14,\n      width: 21,\n      heightElements: [6, 14],\n      widthElements: [10.5, 21],\n    },\n    TASK_TYPE_SCRIPT: {\n      d:\n        \"m {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 \" +\n        \"c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z \" +\n        \"m -7,-12 l 5,0 \" +\n        \"m -4.5,3 l 4.5,0 \" +\n        \"m -3,3 l 5,0\" +\n        \"m -4,3 l 5,0\",\n      height: 15,\n      width: 12.6,\n      heightElements: [6, 14],\n      widthElements: [10.5, 21],\n    },\n    TASK_TYPE_USER_1: {\n      d:\n        \"m {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 \" +\n        \"-4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 \" +\n        \"0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 \" +\n        \"h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 z\" +\n        \"m -8,6 l 0,5.5 m 11,0 l 0,-5\",\n    },\n    TASK_TYPE_USER_2: {\n      d:\n        \"m {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 \" +\n        \"-2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 \",\n    },\n    TASK_TYPE_USER_3: {\n      d:\n        \"m {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 \" +\n        \"4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 \" +\n        \"-4.20799998,3.36699999 -4.20699998,4.34799999 z\",\n    },\n    TASK_TYPE_MANUAL: {\n      d:\n        \"m {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 \" +\n        \"-0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 \" +\n        \"0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 \" +\n        \"-1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 \" +\n        \"0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 \" +\n        \"-10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 \" +\n        \"2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 \" +\n        \"-0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 \" +\n        \"-1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 \" +\n        \"-0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 \" +\n        \"0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 \" +\n        \"-5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z\",\n    },\n    TASK_TYPE_INSTANTIATING_SEND: {\n      d: \"m {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6\",\n    },\n    TASK_TYPE_SERVICE: {\n      d:\n        \"m {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 \" +\n        \"0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 \" +\n        \"-1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 \" +\n        \"v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 \" +\n        \"-0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 \" +\n        \"-1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 \" +\n        \"h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 \" +\n        \"-0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 \" +\n        \"c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 \" +\n        \"l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 \" +\n        \"0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 \" +\n        \"c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z \" +\n        \"m 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 \" +\n        \"0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 \" +\n        \"0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z\",\n    },\n    TASK_TYPE_SERVICE_FILL: {\n      d:\n        \"m {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 \" +\n        \"0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 \" +\n        \"0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z\",\n    },\n    TASK_TYPE_BUSINESS_RULE_HEADER: {\n      d: \"m {mx},{my} 0,4 20,0 0,-4 z\",\n    },\n    TASK_TYPE_BUSINESS_RULE_MAIN: {\n      d: `m {mx},{my} 0,12 20,0 0,-12 z m 0,8 l 20,0 m -13,-4 l 0,8`,\n    },\n    MESSAGE_FLOW_MARKER: {\n      d: \"m {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6\",\n    },\n  };\n\n  this.getRawPath = function getRawPath(pathId) {\n    return this.pathMap[pathId].d;\n  };\n\n  this.getScaledPath = function getScaledPath(pathId, param) {\n    let rawPath = this.pathMap[pathId];\n    let mx, my;\n\n    if (param.abspos) {\n      mx = param.abspos.x;\n      my = param.abspos.y;\n    } else {\n      mx = param.containerWidth * param.position.mx;\n      my = param.containerHeight * param.position.my;\n    }\n\n    let coordinates = {}; // map for the scaled coordinates\n    if (param.position) {\n      // path\n      let heightRatio =\n        (param.containerHeight / rawPath.height) * param.yScaleFactor;\n      let widthRatio =\n        (param.containerWidth / rawPath.width) * param.xScaleFactor;\n\n      // Apply height ratio\n      for (\n        let heightIndex = 0;\n        heightIndex < rawPath.heightElements.length;\n        heightIndex++\n      ) {\n        coordinates[\"y\" + heightIndex] =\n          rawPath.heightElements[heightIndex] * heightRatio;\n      }\n\n      // Apply width ratio\n      for (\n        let widthIndex = 0;\n        widthIndex < rawPath.widthElements.length;\n        widthIndex++\n      ) {\n        coordinates[\"x\" + widthIndex] =\n          rawPath.widthElements[widthIndex] * widthRatio;\n      }\n    }\n\n    // Apply value to raw path\n    let path = format(rawPath.d, {\n      mx: mx,\n      my: my,\n      e: coordinates,\n    });\n    return path;\n  };\n}\n\nlet tokenRegex = /\\{([^}]+)\\}/g,\n  objNotationRegex = /(?:(?:^|\\.)(.+?)(?=\\[|\\.|$|\\()|\\[('|\")(.+?)\\2\\])(\\(\\))?/g; // matches .xxxxx or [\"xxxxx\"] to run over object properties\n\nfunction replacer(all, key, obj) {\n  let res = obj;\n  key.replace(\n    objNotationRegex,\n    function (all, name, quote, quotedName, isFunc) {\n      name = name || quotedName;\n      if (res) {\n        if (name in res) {\n          res = res[name];\n        }\n        typeof res == \"function\" && isFunc && (res = res());\n      }\n    }\n  );\n  res = (res == null || res === obj ? all : res) + \"\";\n\n  return res;\n}\n\nfunction format(str, obj) {\n  return String(str).replace(tokenRegex, function (all, key) {\n    return replacer(all, key, obj);\n  });\n}\n","import BpmnRenderer from \"./BpmnRenderer\";\nimport TextRenderer from \"./TextRenderer\";\n\nimport PathMap from \"./PathMap\";\n\nexport default {\n  __init__: [\"bpmnRenderer\"],\n  bpmnRenderer: [\"type\", BpmnRenderer],\n  textRenderer: [\"type\", TextRenderer],\n  pathMap: [\"type\", PathMap],\n};\n","import { assign } from \"min-dash\";\n\nimport { is } from \"./ModelUtil\";\n\nexport let DEFAULT_LABEL_SIZE = {\n  width: 90,\n  height: 20,\n};\n\nexport let FLOW_LABEL_INDENT = 15;\n\n/**\n * Returns true if the given semantic has an external label\n *\n * @param {BpmnElement} semantic\n * @return {Boolean} true if has label\n */\nexport function isLabelExternal(semantic) {\n  return (\n    is(semantic, \"bpmn:Event\") ||\n    is(semantic, \"bpmn:Gateway\") ||\n    is(semantic, \"bpmn:DataStoreReference\") ||\n    is(semantic, \"bpmn:DataObjectReference\") ||\n    is(semantic, \"bpmn:DataInput\") ||\n    is(semantic, \"bpmn:DataOutput\") ||\n    is(semantic, \"bpmn:SequenceFlow\") ||\n    is(semantic, \"bpmn:MessageFlow\") ||\n    is(semantic, \"bpmn:Group\")\n  );\n}\n\n/**\n * Returns true if the given element has an external label\n *\n * @param {djs.model.shape} element\n * @return {Boolean} true if has label\n */\nexport function hasExternalLabel(element) {\n  return isLabel(element.label);\n}\n\n/**\n * Get the position for sequence flow labels\n *\n * @param  {Array<Point>} waypoints\n * @return {Point} the label position\n */\nexport function getFlowLabelPosition(waypoints) {\n  // get the waypoints mid\n  let mid = waypoints.length / 2 - 1;\n\n  let first = waypoints[Math.floor(mid)];\n  let second = waypoints[Math.ceil(mid + 0.01)];\n\n  // get position\n  let position = getWaypointsMid(waypoints);\n\n  // calculate angle\n  let angle = Math.atan((second.y - first.y) / (second.x - first.x));\n\n  let x = position.x,\n    y = position.y;\n\n  if (Math.abs(angle) < Math.PI / 2) {\n    y -= FLOW_LABEL_INDENT;\n  } else {\n    x += FLOW_LABEL_INDENT;\n  }\n\n  return { x: x, y: y };\n}\n\n/**\n * Get the middle of a number of waypoints\n *\n * @param  {Array<Point>} waypoints\n * @return {Point} the mid point\n */\nexport function getWaypointsMid(waypoints) {\n  let mid = waypoints.length / 2 - 1;\n\n  let first = waypoints[Math.floor(mid)];\n  let second = waypoints[Math.ceil(mid + 0.01)];\n\n  return {\n    x: first.x + (second.x - first.x) / 2,\n    y: first.y + (second.y - first.y) / 2,\n  };\n}\n\nexport function getExternalLabelMid(element) {\n  if (element.waypoints) {\n    return getFlowLabelPosition(element.waypoints);\n  } else if (is(element, \"bpmn:Group\")) {\n    return {\n      x: element.x + element.width / 2,\n      y: element.y + DEFAULT_LABEL_SIZE.height / 2,\n    };\n  } else {\n    return {\n      x: element.x + element.width / 2,\n      y: element.y + element.height + DEFAULT_LABEL_SIZE.height / 2,\n    };\n  }\n}\n\n/**\n * Returns the bounds of an elements label, parsed from the elements DI or\n * generated from its bounds.\n *\n * @param {BpmnElement} semantic\n * @param {djs.model.Base} element\n */\nexport function getExternalLabelBounds(semantic, element) {\n  let mid,\n    size,\n    bounds,\n    di = semantic.di,\n    label = di.label;\n\n  if (label && label.bounds) {\n    bounds = label.bounds;\n\n    size = {\n      width: Math.max(DEFAULT_LABEL_SIZE.width, bounds.width),\n      height: bounds.height,\n    };\n\n    mid = {\n      x: bounds.x + bounds.width / 2,\n      y: bounds.y + bounds.height / 2,\n    };\n  } else {\n    mid = getExternalLabelMid(element);\n\n    size = DEFAULT_LABEL_SIZE;\n  }\n\n  return assign(\n    {\n      x: mid.x - size.width / 2,\n      y: mid.y - size.height / 2,\n    },\n    size\n  );\n}\n\nexport function isLabel(element) {\n  return element && !!element.labelTarget;\n}\n","import { assign } from \"min-dash\";\n\nimport { is } from \"../util/ModelUtil\";\n\nimport { isLabelExternal, getExternalLabelBounds } from \"../util/LabelUtil\";\n\nimport { getMid } from \"diagram-js/lib/layout/LayoutUtil\";\n\nimport { isExpanded } from \"../util/DiUtil\";\n\nimport { getLabel } from \"../features/label-editing/LabelUtil\";\n\nimport { elementToString } from \"./Util\";\n\nfunction elementData(semantic, attrs) {\n  return assign(\n    {\n      id: semantic.id,\n      type: semantic.$type,\n      businessObject: semantic,\n    },\n    attrs\n  );\n}\n\nfunction getWaypoints(bo, source, target) {\n  let waypoints = bo.di.waypoint;\n\n  if (!waypoints || waypoints.length < 2) {\n    return [getMid(source), getMid(target)];\n  }\n\n  return waypoints.map(function (p) {\n    return { x: p.x, y: p.y };\n  });\n}\n\nfunction notYetDrawn(translate, semantic, refSemantic, property) {\n  return new Error(\n    translate(\n      \"element {element} referenced by {referenced}#{property} not yet drawn\",\n      {\n        element: elementToString(refSemantic),\n        referenced: elementToString(semantic),\n        property: property,\n      }\n    )\n  );\n}\n\n/**\n * An importer that adds bpmn elements to the canvas\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {ElementFactory} elementFactory\n * @param {ElementRegistry} elementRegistry\n * @param {Function} translate\n * @param {TextRenderer} textRenderer\n */\nexport default function BpmnImporter(\n  eventBus,\n  canvas,\n  elementFactory,\n  elementRegistry,\n  translate,\n  textRenderer\n) {\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n  this._elementFactory = elementFactory;\n  this._elementRegistry = elementRegistry;\n  this._translate = translate;\n  this._textRenderer = textRenderer;\n}\n\nBpmnImporter.$inject = [\n  \"eventBus\",\n  \"canvas\",\n  \"elementFactory\",\n  \"elementRegistry\",\n  \"translate\",\n  \"textRenderer\",\n];\n\n/**\n * Add bpmn element (semantic) to the canvas onto the\n * specified parent shape.\n */\nBpmnImporter.prototype.add = function (semantic, parentElement) {\n  let di = semantic.di,\n    element,\n    translate = this._translate,\n    hidden;\n\n  let parentIndex;\n\n  // ROOT ELEMENT\n  // handle the special case that we deal with a\n  // invisible root element (process or collaboration)\n  if (is(di, \"bpmndi:BPMNPlane\")) {\n    // add a virtual element (not being drawn)\n    element = this._elementFactory.createRoot(elementData(semantic));\n\n    this._canvas.setRootElement(element);\n  }\n\n  // SHAPE\n  else if (is(di, \"bpmndi:BPMNShape\")) {\n    let collapsed = !isExpanded(semantic),\n      isFrame = isFrameElement(semantic);\n    hidden = parentElement && (parentElement.hidden || parentElement.collapsed);\n\n    let bounds = semantic.di.bounds;\n\n    element = this._elementFactory.createShape(\n      elementData(semantic, {\n        collapsed: collapsed,\n        hidden: hidden,\n        x: Math.round(bounds.x),\n        y: Math.round(bounds.y),\n        width: Math.round(bounds.width),\n        height: Math.round(bounds.height),\n        isFrame: isFrame,\n      })\n    );\n\n    if (is(semantic, \"bpmn:BoundaryEvent\")) {\n      this._attachBoundary(semantic, element);\n    }\n\n    // insert lanes behind other flow nodes (cf. #727)\n    if (is(semantic, \"bpmn:Lane\")) {\n      parentIndex = 0;\n    }\n\n    if (is(semantic, \"bpmn:DataStoreReference\")) {\n      // check whether data store is inside our outside of its semantic parent\n      if (!isPointInsideBBox(parentElement, getMid(bounds))) {\n        parentElement = this._canvas.getRootElement();\n      }\n    }\n\n    this._canvas.addShape(element, parentElement, parentIndex);\n  }\n\n  // CONNECTION\n  else if (is(di, \"bpmndi:BPMNEdge\")) {\n    let source = this._getSource(semantic),\n      target = this._getTarget(semantic);\n\n    hidden = parentElement && (parentElement.hidden || parentElement.collapsed);\n\n    element = this._elementFactory.createConnection(\n      elementData(semantic, {\n        hidden: hidden,\n        source: source,\n        target: target,\n        waypoints: getWaypoints(semantic, source, target),\n      })\n    );\n\n    if (is(semantic, \"bpmn:DataAssociation\")) {\n      // render always on top; this ensures DataAssociations\n      // are rendered correctly across different \"hacks\" people\n      // love to model such as cross participant / sub process\n      // associations\n      parentElement = null;\n    }\n\n    // insert sequence flows behind other flow nodes (cf. #727)\n    if (is(semantic, \"bpmn:SequenceFlow\")) {\n      parentIndex = 0;\n    }\n\n    this._canvas.addConnection(element, parentElement, parentIndex);\n  } else {\n    throw new Error(\n      translate(\"unknown di {di} for element {semantic}\", {\n        di: elementToString(di),\n        semantic: elementToString(semantic),\n      })\n    );\n  }\n\n  // (optional) LABEL\n  if (isLabelExternal(semantic) && getLabel(element)) {\n    this.addLabel(semantic, element);\n  }\n\n  this._eventBus.fire(\"bpmnElement.added\", { element: element });\n\n  return element;\n};\n\n/**\n * Attach the boundary element to the given host\n *\n * @param {ModdleElement} boundarySemantic\n * @param {djs.model.Base} boundaryElement\n */\nBpmnImporter.prototype._attachBoundary = function (\n  boundarySemantic,\n  boundaryElement\n) {\n  let translate = this._translate;\n  let hostSemantic = boundarySemantic.attachedToRef;\n\n  if (!hostSemantic) {\n    throw new Error(\n      translate(\"missing {semantic}#attachedToRef\", {\n        semantic: elementToString(boundarySemantic),\n      })\n    );\n  }\n\n  let host = this._elementRegistry.get(hostSemantic.id),\n    attachers = host && host.attachers;\n\n  if (!host) {\n    throw notYetDrawn(\n      translate,\n      boundarySemantic,\n      hostSemantic,\n      \"attachedToRef\"\n    );\n  }\n\n  // wire element.host <> host.attachers\n  boundaryElement.host = host;\n\n  if (!attachers) {\n    host.attachers = attachers = [];\n  }\n\n  if (attachers.indexOf(boundaryElement) === -1) {\n    attachers.push(boundaryElement);\n  }\n};\n\n/**\n * add label for an element\n */\nBpmnImporter.prototype.addLabel = function (semantic, element) {\n  let bounds, text, label;\n\n  bounds = getExternalLabelBounds(semantic, element);\n\n  text = getLabel(element);\n\n  if (text) {\n    // get corrected bounds from actual layouted text\n    bounds = this._textRenderer.getExternalLabelBounds(bounds, text);\n  }\n\n  label = this._elementFactory.createLabel(\n    elementData(semantic, {\n      id: semantic.id + \"_label\",\n      labelTarget: element,\n      type: \"label\",\n      hidden: element.hidden || !getLabel(element),\n      x: Math.round(bounds.x),\n      y: Math.round(bounds.y),\n      width: Math.round(bounds.width),\n      height: Math.round(bounds.height),\n    })\n  );\n\n  return this._canvas.addShape(label, element.parent);\n};\n\n/**\n * Return the drawn connection end based on the given side.\n *\n * @throws {Error} if the end is not yet drawn\n */\nBpmnImporter.prototype._getEnd = function (semantic, side) {\n  let element,\n    refSemantic,\n    type = semantic.$type,\n    translate = this._translate;\n\n  refSemantic = semantic[side + \"Ref\"];\n\n  // handle mysterious isMany DataAssociation#sourceRef\n  if (side === \"source\" && type === \"bpmn:DataInputAssociation\") {\n    refSemantic = refSemantic && refSemantic[0];\n  }\n\n  // fix source / target for DataInputAssociation / DataOutputAssociation\n  if (\n    (side === \"source\" && type === \"bpmn:DataOutputAssociation\") ||\n    (side === \"target\" && type === \"bpmn:DataInputAssociation\")\n  ) {\n    refSemantic = semantic.$parent;\n  }\n\n  element = refSemantic && this._getElement(refSemantic);\n\n  if (element) {\n    return element;\n  }\n\n  if (refSemantic) {\n    throw notYetDrawn(translate, semantic, refSemantic, side + \"Ref\");\n  } else {\n    throw new Error(\n      translate(\"{semantic}#{side} Ref not specified\", {\n        semantic: elementToString(semantic),\n        side: side,\n      })\n    );\n  }\n};\n\nBpmnImporter.prototype._getSource = function (semantic) {\n  return this._getEnd(semantic, \"source\");\n};\n\nBpmnImporter.prototype._getTarget = function (semantic) {\n  return this._getEnd(semantic, \"target\");\n};\n\nBpmnImporter.prototype._getElement = function (semantic) {\n  return this._elementRegistry.get(semantic.id);\n};\n\n// helpers ////////////////////\n\nfunction isPointInsideBBox(bbox, point) {\n  let x = point.x,\n    y = point.y;\n\n  return (\n    x >= bbox.x &&\n    x <= bbox.x + bbox.width &&\n    y >= bbox.y &&\n    y <= bbox.y + bbox.height\n  );\n}\n\nfunction isFrameElement(semantic) {\n  return is(semantic, \"bpmn:Group\");\n}\n","import translate from \"diagram-js/lib/i18n/translate\";\n\nimport BpmnImporter from \"./BpmnImporter\";\n\nexport default {\n  __depends__: [translate],\n  bpmnImporter: [\"type\", BpmnImporter],\n};\n","import DrawModule from \"../draw\";\nimport ImportModule from \"../import\";\n\nexport default {\n  __depends__: [DrawModule, ImportModule],\n};\n","import inherits from \"inherits\";\n\nimport CoreModule from \"./core\";\nimport TranslateModule from \"diagram-js/lib/i18n/translate\";\nimport SelectionModule from \"diagram-js/lib/features/selection\";\nimport OverlaysModule from \"diagram-js/lib/features/overlays\";\n\nimport BaseViewer from \"./BaseViewer\";\n\n/**\n * @param {Object} [options] configuration options to pass to the viewer\n * @param {DOMElement} [options.container] the container to render the viewer in, defaults to body.\n * @param {String|Number} [options.width] the width of the viewer\n * @param {String|Number} [options.height] the height of the viewer\n * @param {Object} [options.moddleExtensions] extension packages to provide\n * @param {Array<didi.Module>} [options.modules] a list of modules to override the default modules\n * @param {Array<didi.Module>} [options.additionalModules] a list of modules to use with the default modules\n */\nexport default function Viewer(options) {\n  BaseViewer.call(this, options);\n}\n\ninherits(Viewer, BaseViewer);\n\n// modules the viewer is composed of\nViewer.prototype._modules = [\n  CoreModule,\n  TranslateModule,\n  SelectionModule,\n  OverlaysModule,\n];\n\n// default moddle extensions the viewer is composed of\nViewer.prototype._moddleExtensions = {};\n","import inherits from \"inherits\";\n\nimport Viewer from \"./Viewer\";\n\nimport KeyboardMoveModule from \"diagram-js/lib/navigation/keyboard-move\";\nimport MoveCanvasModule from \"diagram-js/lib/navigation/movecanvas\";\nimport ZoomScrollModule from \"diagram-js/lib/navigation/zoomscroll\";\n\n/**\n * A viewer that includes mouse navigation facilities\n *\n * @param {Object} options\n */\nexport default function NavigatedViewer(options) {\n  Viewer.call(this, options);\n}\n\ninherits(NavigatedViewer, Viewer);\n\nNavigatedViewer.prototype._navigationModules = [\n  KeyboardMoveModule,\n  MoveCanvasModule,\n  ZoomScrollModule,\n];\n\nNavigatedViewer.prototype._modules = [].concat(\n  Viewer.prototype._modules,\n  NavigatedViewer.prototype._navigationModules\n);\n","import { some } from \"min-dash\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\n/**\n * Return true if element has any of the given types.\n *\n * @param {djs.model.Base} element\n * @param {Array<String>} types\n *\n * @return {Boolean}\n */\nexport function isAny(element, types) {\n  return some(types, function (t) {\n    return is(element, t);\n  });\n}\n\n/**\n * Return the parent of the element with any of the given types.\n *\n * @param {djs.model.Base} element\n * @param {String|Array<String>} anyType\n *\n * @return {djs.model.Base}\n */\nexport function getParent(element, anyType) {\n  if (typeof anyType === \"string\") {\n    anyType = [anyType];\n  }\n\n  while ((element = element.parent)) {\n    if (isAny(element, anyType)) {\n      return element;\n    }\n  }\n\n  return null;\n}\n","import { is } from \"../../util/ModelUtil\";\nimport { isAny } from \"../modeling/util/ModelingUtil\";\n\nimport {\n  getMid,\n  asTRBL,\n  getOrientation,\n} from \"diagram-js/lib/layout/LayoutUtil\";\n\nimport { find, reduce } from \"min-dash\";\n\nconst DEFAULT_HORIZONTAL_DISTANCE = 50;\n\nconst MAX_HORIZONTAL_DISTANCE = 250;\n\n// padding to detect element placement\nconst PLACEMENT_DETECTION_PAD = 10;\n\n/**\n * Find the new position for the target element to\n * connect to source.\n *\n * @param  {djs.model.Shape} source\n * @param  {djs.model.Shape} element\n *\n * @return {Point}\n */\nexport function getNewShapePosition(source, element) {\n  if (is(element, \"bpmn:TextAnnotation\")) {\n    return getTextAnnotationPosition(source, element);\n  }\n\n  if (isAny(element, [\"bpmn:DataObjectReference\", \"bpmn:DataStoreReference\"])) {\n    return getDataElementPosition(source, element);\n  }\n\n  if (is(element, \"bpmn:FlowNode\")) {\n    return getFlowNodePosition(source, element);\n  }\n\n  return getDefaultPosition(source, element);\n}\n\n/**\n * Always try to place element right of source;\n * compute actual distance from previous nodes in flow.\n */\nexport function getFlowNodePosition(source, element) {\n  let sourceTrbl = asTRBL(source);\n  let sourceMid = getMid(source);\n\n  let horizontalDistance = getFlowNodeDistance(source, element);\n\n  let orientation = \"left\",\n    rowSize = 80,\n    margin = 30;\n\n  if (is(source, \"bpmn:BoundaryEvent\")) {\n    orientation = getOrientation(source, source.host, -25);\n\n    if (orientation.indexOf(\"top\") !== -1) {\n      margin *= -1;\n    }\n  }\n\n  function getVerticalDistance(orient) {\n    if (orient.indexOf(\"top\") !== -1) {\n      return -1 * rowSize;\n    } else if (orient.indexOf(\"bottom\") !== -1) {\n      return rowSize;\n    } else {\n      return 0;\n    }\n  }\n\n  let position = {\n    x: sourceTrbl.right + horizontalDistance + element.width / 2,\n    y: sourceMid.y + getVerticalDistance(orientation),\n  };\n\n  let escapeDirection = {\n    y: {\n      margin: margin,\n      rowSize: rowSize,\n    },\n  };\n\n  return deconflictPosition(source, element, position, escapeDirection);\n}\n\n/**\n * Compute best distance between source and target,\n * based on existing connections to and from source.\n *\n * @param {djs.model.Shape} source\n * @param {djs.model.Shape} element\n *\n * @return {Number} distance\n */\nexport function getFlowNodeDistance(source, element) {\n  let sourceTrbl = asTRBL(source);\n\n  // is connection a reference to consider?\n  function isReference(c) {\n    return is(c, \"bpmn:SequenceFlow\");\n  }\n\n  function toTargetNode(weight) {\n    return function (shape) {\n      return {\n        shape: shape,\n        weight: weight,\n        distanceTo: function (shape) {\n          let shapeTrbl = asTRBL(shape);\n\n          return shapeTrbl.left - sourceTrbl.right;\n        },\n      };\n    };\n  }\n\n  function toSourceNode(weight) {\n    return function (shape) {\n      return {\n        shape: shape,\n        weight: weight,\n        distanceTo: function (shape) {\n          let shapeTrbl = asTRBL(shape);\n\n          return sourceTrbl.left - shapeTrbl.right;\n        },\n      };\n    };\n  }\n\n  // we create a list of nodes to take into consideration\n  // for calculating the optimal flow node distance\n  //\n  //   * weight existing target nodes higher than source nodes\n  //   * only take into account individual nodes once\n  //\n  let nodes = reduce(\n    [].concat(\n      getTargets(source, isReference).map(toTargetNode(5)),\n      getSources(source, isReference).map(toSourceNode(1))\n    ),\n    function (nodes, node) {\n      // filter out shapes connected twice via source or target\n      nodes[node.shape.id + \"__weight_\" + node.weight] = node;\n\n      return nodes;\n    },\n    {}\n  );\n\n  // compute distances between source and incoming nodes;\n  // group at the same time by distance and expose the\n  // favourite distance as { fav: { count, value } }.\n  let distancesGrouped = reduce(\n    nodes,\n    function (result, node) {\n      let shape = node.shape,\n        weight = node.weight,\n        distanceTo = node.distanceTo;\n\n      let fav = result.fav,\n        currentDistance,\n        currentDistanceCount,\n        currentDistanceEntry;\n\n      currentDistance = distanceTo(shape);\n\n      // ignore too far away peers\n      // or non-left to right modeled nodes\n      if (currentDistance < 0 || currentDistance > MAX_HORIZONTAL_DISTANCE) {\n        return result;\n      }\n\n      currentDistanceEntry = result[String(currentDistance)] = result[\n        String(currentDistance)\n      ] || {\n        value: currentDistance,\n        count: 0,\n      };\n\n      // inc diff count\n      currentDistanceCount = currentDistanceEntry.count += 1 * weight;\n\n      if (!fav || fav.count < currentDistanceCount) {\n        result.fav = currentDistanceEntry;\n      }\n\n      return result;\n    },\n    {}\n  );\n\n  if (distancesGrouped.fav) {\n    return distancesGrouped.fav.value;\n  } else {\n    return DEFAULT_HORIZONTAL_DISTANCE;\n  }\n}\n\n/**\n * Always try to place text annotations top right of source.\n */\nexport function getTextAnnotationPosition(source, element) {\n  let sourceTrbl = asTRBL(source);\n\n  let position = {\n    x: sourceTrbl.right + element.width / 2,\n    y: sourceTrbl.top - 50 - element.height / 2,\n  };\n\n  let escapeDirection = {\n    y: {\n      margin: -30,\n      rowSize: 20,\n    },\n  };\n\n  return deconflictPosition(source, element, position, escapeDirection);\n}\n\n/**\n * Always put element bottom right of source.\n */\nexport function getDataElementPosition(source, element) {\n  let sourceTrbl = asTRBL(source);\n\n  let position = {\n    x: sourceTrbl.right - 10 + element.width / 2,\n    y: sourceTrbl.bottom + 40 + element.width / 2,\n  };\n\n  let escapeDirection = {\n    x: {\n      margin: 30,\n      rowSize: 30,\n    },\n  };\n\n  return deconflictPosition(source, element, position, escapeDirection);\n}\n\n/**\n * Always put element right of source per default.\n */\nexport function getDefaultPosition(source, element) {\n  let sourceTrbl = asTRBL(source);\n\n  let sourceMid = getMid(source);\n\n  // simply put element right next to source\n  return {\n    x: sourceTrbl.right + DEFAULT_HORIZONTAL_DISTANCE + element.width / 2,\n    y: sourceMid.y,\n  };\n}\n\n/**\n * Returns all connected elements around the given source.\n *\n * This includes:\n *\n *   - connected elements\n *   - host connected elements\n *   - attachers connected elements\n *\n * @param  {djs.model.Shape} source\n * @param  {djs.model.Shape} element\n *\n * @return {Array<djs.model.Shape>}\n */\nfunction getAutoPlaceClosure(source, element) {\n  let allConnected = getConnected(source);\n\n  if (source.host) {\n    allConnected = allConnected.concat(getConnected(source.host));\n  }\n\n  if (source.attachers) {\n    allConnected = allConnected.concat(\n      source.attachers.reduce(function (shapes, attacher) {\n        return shapes.concat(getConnected(attacher));\n      }, [])\n    );\n  }\n\n  return allConnected;\n}\n\n/**\n * Return target at given position, if defined.\n *\n * This takes connected elements from host and attachers\n * into account, too.\n */\nexport function getConnectedAtPosition(source, position, element) {\n  let bounds = {\n    x: position.x - element.width / 2,\n    y: position.y - element.height / 2,\n    width: element.width,\n    height: element.height,\n  };\n\n  let closure = getAutoPlaceClosure(source, element);\n\n  return find(closure, function (target) {\n    if (target === element) {\n      return false;\n    }\n\n    let orientation = getOrientation(target, bounds, PLACEMENT_DETECTION_PAD);\n\n    return orientation === \"intersect\";\n  });\n}\n\n/**\n * Returns a new, position for the given element\n * based on the given element that is not occupied\n * by some element connected to source.\n *\n * Take into account the escapeDirection (where to move\n * on positioning clashes) in the computation.\n *\n * @param {djs.model.Shape} source\n * @param {djs.model.Shape} element\n * @param {Point} position\n * @param {Object} escapeDelta\n *\n * @return {Point}\n */\nexport function deconflictPosition(source, element, position, escapeDelta) {\n  function nextPosition(existingElement) {\n    let newPosition = {\n      x: position.x,\n      y: position.y,\n    };\n\n    [\"x\", \"y\"].forEach(function (axis) {\n      let axisDelta = escapeDelta[axis];\n\n      if (!axisDelta) {\n        return;\n      }\n\n      let dimension = axis === \"x\" ? \"width\" : \"height\";\n\n      let margin = axisDelta.margin,\n        rowSize = axisDelta.rowSize;\n\n      if (margin < 0) {\n        newPosition[axis] = Math.min(\n          existingElement[axis] + margin - element[dimension] / 2,\n          position[axis] - rowSize + margin\n        );\n      } else {\n        newPosition[axis] = Math.max(\n          existingTarget[axis] +\n            existingTarget[dimension] +\n            margin +\n            element[dimension] / 2,\n          position[axis] + rowSize + margin\n        );\n      }\n    });\n\n    return newPosition;\n  }\n\n  let existingTarget;\n\n  // deconflict position until free slot is found\n  while ((existingTarget = getConnectedAtPosition(source, position, element))) {\n    position = nextPosition(existingTarget);\n  }\n\n  return position;\n}\n\n// helpers //////////////////////\n\nfunction noneFilter() {\n  return true;\n}\n\nfunction getConnected(element, connectionFilter) {\n  return [].concat(\n    getTargets(element, connectionFilter),\n    getSources(element, connectionFilter)\n  );\n}\n\nfunction getSources(shape, connectionFilter) {\n  if (!connectionFilter) {\n    connectionFilter = noneFilter;\n  }\n\n  return shape.incoming.filter(connectionFilter).map(function (c) {\n    return c.source;\n  });\n}\n\nfunction getTargets(shape, connectionFilter) {\n  if (!connectionFilter) {\n    connectionFilter = noneFilter;\n  }\n\n  return shape.outgoing.filter(connectionFilter).map(function (c) {\n    return c.target;\n  });\n}\n","import { getNewShapePosition } from \"./AutoPlaceUtil\";\n\n/**\n * A service that places elements connected to existing ones\n * to an appropriate position in an _automated_ fashion.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function AutoPlace(eventBus, modeling) {\n  function emit(event, payload) {\n    return eventBus.fire(event, payload);\n  }\n\n  /**\n   * Append shape to source at appropriate position.\n   *\n   * @param {djs.model.Shape} source\n   * @param {djs.model.Shape} shape\n   *\n   * @return {djs.model.Shape} appended shape\n   */\n  this.append = function (source, shape) {\n    emit(\"autoPlace.start\", {\n      source: source,\n      shape: shape,\n    });\n\n    // allow others to provide the position\n    let position = emit(\"autoPlace\", {\n      source: source,\n      shape: shape,\n    });\n\n    if (!position) {\n      position = getNewShapePosition(source, shape);\n    }\n\n    let newShape = modeling.appendShape(source, shape, position, source.parent);\n\n    emit(\"autoPlace.end\", {\n      source: source,\n      shape: newShape,\n    });\n\n    return newShape;\n  };\n}\n\nAutoPlace.$inject = [\"eventBus\", \"modeling\"];\n","/**\n * Select element after auto placement.\n *\n * @param {EventBus} eventBus\n * @param {Selection} selection\n */\nexport default function AutoPlaceSelectionBehavior(eventBus, selection) {\n  eventBus.on(\"autoPlace.end\", 500, function (e) {\n    selection.select(e.shape);\n  });\n}\n\nAutoPlaceSelectionBehavior.$inject = [\"eventBus\", \"selection\"];\n","import AutoPlace from \"./AutoPlace\";\nimport AutoPlaceSelectionBehavior from \"./AutoPlaceSelectionBehavior\";\n\nexport default {\n  __init__: [\"autoPlaceSelectionBehavior\"],\n  autoPlace: [\"type\", AutoPlace],\n  autoPlaceSelectionBehavior: [\"type\", AutoPlaceSelectionBehavior],\n};\n","import AutoResize from \"diagram-js/lib/features/auto-resize/AutoResize\";\n\nimport inherits from \"inherits\";\n\nimport { is } from \"../../util/ModelUtil\";\n\n/**\n * Sub class of the AutoResize module which implements a BPMN\n * specific resize function.\n */\nexport default function BpmnAutoResize(injector) {\n  injector.invoke(AutoResize, this);\n}\n\nBpmnAutoResize.$inject = [\"injector\"];\n\ninherits(BpmnAutoResize, AutoResize);\n\n/**\n * Resize shapes and lanes.\n *\n * @param {djs.model.Shape} target\n * @param {Bounds} newBounds\n * @param {Object} hints\n */\nBpmnAutoResize.prototype.resize = function (target, newBounds, hints) {\n  if (is(target, \"bpmn:Participant\")) {\n    this._modeling.resizeLane(target, newBounds, null, hints);\n  } else {\n    this._modeling.resizeShape(target, newBounds, null, hints);\n  }\n};\n","import { is } from \"../../util/ModelUtil\";\n\nimport inherits from \"inherits\";\n\nimport { forEach } from \"min-dash\";\n\nimport AutoResizeProvider from \"diagram-js/lib/features/auto-resize/AutoResizeProvider\";\n\n/**\n * This module is a provider for automatically resizing parent BPMN elements\n */\nexport default function BpmnAutoResizeProvider(eventBus, modeling) {\n  AutoResizeProvider.call(this, eventBus);\n\n  this._modeling = modeling;\n}\n\ninherits(BpmnAutoResizeProvider, AutoResizeProvider);\n\nBpmnAutoResizeProvider.$inject = [\"eventBus\", \"modeling\"];\n\n/**\n * Check if the given target can be expanded\n *\n * @param  {djs.model.Shape} target\n *\n * @return {boolean}\n */\nBpmnAutoResizeProvider.prototype.canResize = function (elements, target) {\n  if (\n    !is(target, \"bpmn:Participant\") &&\n    !is(target, \"bpmn:Lane\") &&\n    !is(target, \"bpmn:Loop\") &&\n    !is(target, \"bpmn:Conditional\")\n  ) {\n    return false;\n  }\n\n  let canResize = true;\n\n  forEach(elements, function (element) {\n    if (is(element, \"bpmn:Lane\") || element.labelTarget) {\n      canResize = false;\n      return;\n    }\n  });\n\n  return canResize;\n};\n","import BpmnAutoResize from \"./BpmnAutoResize\";\nimport BpmnAutoResizeProvider from \"./BpmnAutoResizeProvider\";\n\nexport default {\n  __init__: [\"bpmnAutoResize\", \"bpmnAutoResizeProvider\"],\n  bpmnAutoResize: [\"type\", BpmnAutoResize],\n  bpmnAutoResizeProvider: [\"type\", BpmnAutoResizeProvider],\n};\n","import { getBusinessObject, is } from \"../../util/ModelUtil\";\n\nimport { forEach, isArray, isUndefined, omit, reduce } from \"min-dash\";\n\nfunction copyProperties(source, target, properties) {\n  if (!isArray(properties)) {\n    properties = [properties];\n  }\n\n  forEach(properties, function (property) {\n    if (!isUndefined(source[property])) {\n      target[property] = source[property];\n    }\n  });\n}\n\nfunction removeProperties(element, properties) {\n  if (!isArray(properties)) {\n    properties = [properties];\n  }\n\n  forEach(properties, function (property) {\n    if (element[property]) {\n      delete element[property];\n    }\n  });\n}\n\nlet LOW_PRIORITY = 750;\n\nexport default function BpmnCopyPaste(bpmnFactory, eventBus, moddleCopy) {\n  eventBus.on(\"copyPaste.copyElement\", LOW_PRIORITY, function (context) {\n    let descriptor = context.descriptor,\n      element = context.element;\n\n    let businessObject = (descriptor.oldBusinessObject = getBusinessObject(\n      element\n    ));\n\n    descriptor.type = element.type;\n\n    copyProperties(businessObject, descriptor, \"name\");\n\n    descriptor.di = {};\n\n    // fill and stroke will be set to DI\n    copyProperties(businessObject.di, descriptor.di, [\"fill\", \"stroke\"]);\n\n    copyProperties(businessObject.di, descriptor, \"isExpanded\");\n\n    if (isLabel(descriptor)) {\n      return descriptor;\n    }\n\n    // default sequence flow\n    if (businessObject.default) {\n      descriptor.default = businessObject.default.id;\n    }\n  });\n\n  eventBus.on(\"moddleCopy.canCopyProperty\", function (context) {\n    let parent = context.parent,\n      property = context.property,\n      propertyName = context.propertyName,\n      bpmnProcess;\n\n    if (\n      propertyName === \"processRef\" &&\n      is(parent, \"bpmn:Participant\") &&\n      is(property, \"bpmn:Process-action\")\n    ) {\n      bpmnProcess = bpmnFactory.create(\"bpmn:Process-action\");\n\n      // return copy of process\n      return moddleCopy.copyElement(property, bpmnProcess);\n    }\n  });\n\n  let references;\n\n  function resolveReferences(descriptor, cache) {\n    let businessObject = getBusinessObject(descriptor);\n\n    // default sequence flows\n    if (descriptor.default) {\n      // relationship cannot be resolved immediately\n      references[descriptor.default] = {\n        element: businessObject,\n        property: \"default\",\n      };\n    }\n\n    // boundary events\n    if (descriptor.host) {\n      // relationship can be resolved immediately\n      getBusinessObject(descriptor).attachedToRef = getBusinessObject(\n        cache[descriptor.host]\n      );\n    }\n\n    references = omit(\n      references,\n      reduce(\n        references,\n        function (array, reference, key) {\n          let element = reference.element,\n            property = reference.property;\n\n          if (key === descriptor.id) {\n            element[property] = businessObject;\n\n            array.push(descriptor.id);\n          }\n\n          return array;\n        },\n        []\n      )\n    );\n  }\n\n  eventBus.on(\"copyPaste.pasteElements\", function () {\n    references = {};\n  });\n\n  eventBus.on(\"copyPaste.pasteElement\", function (context) {\n    let cache = context.cache,\n      descriptor = context.descriptor,\n      oldBusinessObject = descriptor.oldBusinessObject,\n      newBusinessObject;\n\n    // do NOT copy business object if external label\n    if (isLabel(descriptor)) {\n      descriptor.businessObject = getBusinessObject(\n        cache[descriptor.labelTarget]\n      );\n\n      return;\n    }\n\n    newBusinessObject = bpmnFactory.create(oldBusinessObject.$type);\n\n    descriptor.businessObject = moddleCopy.copyElement(\n      oldBusinessObject,\n      newBusinessObject\n    );\n\n    // resolve references e.g. default sequence flow\n    resolveReferences(descriptor, cache);\n\n    copyProperties(descriptor, newBusinessObject, [\"isExpanded\", \"name\"]);\n\n    removeProperties(descriptor, \"oldBusinessObject\");\n  });\n}\n\nBpmnCopyPaste.$inject = [\"bpmnFactory\", \"eventBus\", \"moddleCopy\"];\n\n// helpers //////////\n\nfunction isLabel(element) {\n  return !!element.labelTarget;\n}\n","import {\n  find,\n  forEach,\n  isArray,\n  isDefined,\n  isObject,\n  matchPattern,\n  reduce,\n  has,\n  sortBy,\n} from \"min-dash\";\n\nlet DISALLOWED_PROPERTIES = [\n  \"artifacts\",\n  \"dataInputAssociations\",\n  \"dataOutputAssociations\",\n  \"default\",\n  \"flowElements\",\n  \"lanes\",\n  \"incoming\",\n  \"outgoing\",\n];\n\n/**\n * @typedef {Function} <moddleCopy.canCopyProperties> listener\n *\n * @param {Object} context\n * @param {Array<string>} context.propertyNames\n * @param {ModdleElement} context.sourceElement\n * @param {ModdleElement} context.targetElement\n *\n * @returns {Array<string>|boolean} - Return properties to be copied or false to disallow\n * copying.\n */\n\n/**\n * @typedef {Function} <moddleCopy.canCopyProperty> listener\n *\n * @param {Object} context\n * @param {ModdleElement} context.parent\n * @param {*} context.property\n * @param {string} context.propertyName\n *\n * @returns {*|boolean} - Return copied property or false to disallow\n * copying.\n */\n\n/**\n * @typedef {Function} <moddleCopy.canSetCopiedProperty> listener\n *\n * @param {Object} context\n * @param {ModdleElement} context.parent\n * @param {*} context.property\n * @param {string} context.propertyName\n *\n * @returns {boolean} - Return false to disallow\n * setting copied property.\n */\n\n/**\n * Utility for copying model properties from source element to target element.\n *\n * @param {EventBus} eventBus\n * @param {BpmnFactory} bpmnFactory\n * @param {BpmnModdle} moddle\n */\nexport default function ModdleCopy(eventBus, bpmnFactory, moddle) {\n  this._bpmnFactory = bpmnFactory;\n  this._eventBus = eventBus;\n  this._moddle = moddle;\n\n  // copy extension elements last\n  eventBus.on(\"moddleCopy.canCopyProperties\", function (context) {\n    let propertyNames = context.propertyNames;\n\n    if (!propertyNames || !propertyNames.length) {\n      return;\n    }\n\n    return sortBy(propertyNames, function (propertyName) {\n      return propertyName === \"assignElements\";\n    });\n  });\n\n  // default check whether property can be copied\n  eventBus.on(\"moddleCopy.canCopyProperty\", function (context) {\n    let parent = context.parent,\n      parentDescriptor = isObject(parent) && parent.$descriptor,\n      propertyName = context.propertyName;\n\n    if (propertyName && DISALLOWED_PROPERTIES.indexOf(propertyName) !== -1) {\n      // disallow copying property\n      return false;\n    }\n\n    if (\n      propertyName &&\n      parentDescriptor &&\n      !find(parentDescriptor.properties, matchPattern({ name: propertyName }))\n    ) {\n      // disallow copying property\n      return false;\n    }\n  });\n\n  // do NOT allow to copy empty extension elements\n  eventBus.on(\"moddleCopy.canSetCopiedProperty\", function (context) {\n    let property = context.property;\n\n    if (\n      is(property, \"bpmn:AssignElements\") &&\n      (!property.values || !property.values.length)\n    ) {\n      // disallow setting copied property\n      return false;\n    }\n  });\n}\n\nModdleCopy.$inject = [\"eventBus\", \"bpmnFactory\", \"moddle\"];\n\n/**\n * Copy model properties of source element to target element.\n *\n * @param {ModdleElement} sourceElement\n * @param {ModdleElement} targetElement\n * @param {Array<string>} [propertyNames]\n *\n * @param {ModdleElement}\n */\nModdleCopy.prototype.copyElement = function (\n  sourceElement,\n  targetElement,\n  propertyNames\n) {\n  let self = this;\n\n  if (propertyNames && !isArray(propertyNames)) {\n    propertyNames = [propertyNames];\n  }\n\n  propertyNames = propertyNames || getPropertyNames(sourceElement.$descriptor);\n\n  let canCopyProperties = this._eventBus.fire(\"moddleCopy.canCopyProperties\", {\n    propertyNames: propertyNames,\n    sourceElement: sourceElement,\n    targetElement: targetElement,\n  });\n\n  if (canCopyProperties === false) {\n    return targetElement;\n  }\n\n  if (isArray(canCopyProperties)) {\n    propertyNames = canCopyProperties;\n  }\n\n  // copy properties\n  forEach(propertyNames, function (propertyName) {\n    let sourceProperty;\n\n    if (has(sourceElement, propertyName)) {\n      sourceProperty = sourceElement.get(propertyName);\n    }\n\n    let copiedProperty = self.copyProperty(\n      sourceProperty,\n      targetElement,\n      propertyName\n    );\n\n    let canSetProperty = self._eventBus.fire(\n      \"moddleCopy.canSetCopiedProperty\",\n      {\n        parent: targetElement,\n        property: copiedProperty,\n        propertyName: propertyName,\n      }\n    );\n\n    if (canSetProperty === false) {\n      return;\n    }\n\n    if (isDefined(copiedProperty)) {\n      targetElement.set(propertyName, copiedProperty);\n    }\n  });\n\n  return targetElement;\n};\n\n/**\n * Copy model property.\n *\n * @param {*} property\n * @param {ModdleElement} parent\n * @param {string} propertyName\n *\n * @returns {*}\n */\nModdleCopy.prototype.copyProperty = function (property, parent, propertyName) {\n  let self = this;\n\n  // allow others to copy property\n  let copiedProperty = this._eventBus.fire(\"moddleCopy.canCopyProperty\", {\n    parent: parent,\n    property: property,\n    propertyName: propertyName,\n  });\n\n  // return if copying is NOT allowed\n  if (copiedProperty === false) {\n    return;\n  }\n\n  if (copiedProperty) {\n    if (\n      isObject(copiedProperty) &&\n      copiedProperty.$type &&\n      !copiedProperty.$parent\n    ) {\n      copiedProperty.$parent = parent;\n    }\n\n    return copiedProperty;\n  }\n\n  let propertyDescriptor = this._moddle.getPropertyDescriptor(\n    parent,\n    propertyName\n  );\n\n  // do NOT copy Ids and references\n  if (propertyDescriptor.isId || propertyDescriptor.isReference) {\n    return;\n  }\n\n  // copy arrays\n  if (isArray(property)) {\n    return reduce(\n      property,\n      function (childProperties, childProperty) {\n        // recursion\n        copiedProperty = self.copyProperty(childProperty, parent, propertyName);\n\n        // copying might NOT be allowed\n        if (copiedProperty) {\n          copiedProperty.$parent = parent;\n\n          return childProperties.concat(copiedProperty);\n        }\n\n        return childProperties;\n      },\n      []\n    );\n  }\n\n  // copy model elements\n  if (isObject(property) && property.$type) {\n    if (this._moddle.getElementDescriptor(property).isGeneric) {\n      return;\n    }\n\n    copiedProperty = self._bpmnFactory.create(property.$type);\n\n    copiedProperty.$parent = parent;\n\n    // recursion\n    copiedProperty = self.copyElement(property, copiedProperty);\n\n    return copiedProperty;\n  }\n\n  // copy primitive properties\n  return property;\n};\n\n// helpers //////////\n\nexport function getPropertyNames(descriptor, keepDefaultProperties) {\n  return reduce(\n    descriptor.properties,\n    function (properties, property) {\n      if (keepDefaultProperties && property.default) {\n        return properties;\n      }\n\n      return properties.concat(property.name);\n    },\n    []\n  );\n}\n\nfunction is(element, type) {\n  return (\n    element &&\n    typeof element.$instanceOf === \"function\" &&\n    element.$instanceOf(type)\n  );\n}\n","import CopyPasteModule from \"diagram-js/lib/features/copy-paste\";\n\nimport BpmnCopyPaste from \"./BpmnCopyPaste\";\nimport ModdleCopy from \"./ModdleCopy\";\n\nexport default {\n  __depends__: [CopyPasteModule],\n  __init__: [\"bpmnCopyPaste\", \"moddleCopy\"],\n  bpmnCopyPaste: [\"type\", BpmnCopyPaste],\n  moddleCopy: [\"type\", ModdleCopy],\n};\n","import {\n  pick,\n  assign,\n  filter,\n  forEach,\n  isArray,\n  isUndefined,\n  has,\n} from \"min-dash\";\n\nimport { is, getBusinessObject } from \"../../util/ModelUtil\";\n\nimport { isAny } from \"../modeling/util/ModelingUtil\";\n\nimport { isExpanded, isEventLoop } from \"../../util/DiUtil\";\n\nimport { getPropertyNames } from \"../copy-paste/ModdleCopy\";\n\nfunction copyProperties(source, target, properties) {\n  if (!isArray(properties)) {\n    properties = [properties];\n  }\n\n  forEach(properties, function (property) {\n    if (!isUndefined(source[property])) {\n      target[property] = source[property];\n    }\n  });\n}\n\nlet CUSTOM_PROPERTIES = [\n  \"cancelActivity\",\n  \"instantiate\",\n  \"eventGatewayType\",\n  \"triggeredByEvent\",\n  \"isInterrupting\",\n];\n\nfunction toggeling(element, target) {\n  let oldCollapsed =\n    element && has(element, \"collapsed\")\n      ? element.collapsed\n      : !isExpanded(element);\n\n  let targetCollapsed;\n\n  if (target && (has(target, \"collapsed\") || has(target, \"isExpanded\"))) {\n    // property is explicitly set so use it\n    targetCollapsed = has(target, \"collapsed\")\n      ? target.collapsed\n      : !target.isExpanded;\n  } else {\n    // keep old state\n    targetCollapsed = oldCollapsed;\n  }\n\n  if (oldCollapsed !== targetCollapsed) {\n    element.collapsed = oldCollapsed;\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * This module takes care of replacing BPMN elements\n */\nexport default function BpmnReplace(\n  bpmnFactory,\n  elementFactory,\n  moddleCopy,\n  modeling,\n  replace,\n  selection\n) {\n  /**\n   * Prepares a new business object for the replacement element\n   * and triggers the replace operation.\n   *\n   * @param  {djs.model.Base} element\n   * @param  {Object} target\n   * @param  {Object} [hints]\n   *\n   * @return {djs.model.Base} the newly created element\n   */\n  function replaceElement(element, target, hints) {\n    hints = hints || {};\n\n    let type = target.type,\n      oldBusinessObject = element.businessObject;\n\n    if (isLoop(oldBusinessObject)) {\n      if (type === \"bpmn:Loop\") {\n        if (toggeling(element, target)) {\n          // expanding or collapsing process\n          modeling.toggleCollapse(element);\n\n          return element;\n        }\n      }\n    }\n\n    let newBusinessObject = bpmnFactory.create(type);\n\n    let newElement = {\n      type: type,\n      businessObject: newBusinessObject,\n    };\n\n    let elementProps = getPropertyNames(oldBusinessObject.$descriptor),\n      newElementProps = getPropertyNames(newBusinessObject.$descriptor, true),\n      copyProps = intersection(elementProps, newElementProps);\n\n    // initialize special properties defined in target definition\n    assign(newBusinessObject, pick(target, CUSTOM_PROPERTIES));\n\n    let properties = filter(copyProps, function (propertyName) {\n      // copying event definitions, unless we replace\n      if (propertyName === \"eventDefinitions\") {\n        return hasEventDefinition(element, target.eventDefinitionType);\n      }\n\n      // retain loop characteristics if the target element\n      // is not an event sub process\n      if (propertyName === \"loopCharacteristics\") {\n        return !isEventLoop(newBusinessObject);\n      }\n\n      // so the applied properties from 'target' don't get lost\n      if (newBusinessObject.hasOwnProperty(propertyName)) {\n        return false;\n      }\n\n      if (propertyName === \"processRef\" && target.isExpanded === false) {\n        return false;\n      }\n\n      if (propertyName === \"triggeredByEvent\") {\n        return false;\n      }\n\n      return true;\n    });\n\n    newBusinessObject = moddleCopy.copyElement(\n      oldBusinessObject,\n      newBusinessObject,\n      properties\n    );\n\n    // initialize custom BPMN extensions\n    if (target.eventDefinitionType) {\n      // only initialize with new eventDefinition\n      // if we did not set an event definition yet,\n      // i.e. because we copied it\n      if (!hasEventDefinition(newBusinessObject, target.eventDefinitionType)) {\n        newElement.eventDefinitionType = target.eventDefinitionType;\n      }\n    }\n\n    if (is(oldBusinessObject, \"bpmn:Activity\")) {\n      if (isLoop(oldBusinessObject)) {\n        // no toggeling, so keep old state\n        newElement.isExpanded = isExpanded(oldBusinessObject);\n      }\n\n      // else if property is explicitly set, use it\n      else if (target && has(target, \"isExpanded\")) {\n        newElement.isExpanded = target.isExpanded;\n      }\n\n      // TODO: need also to respect min/max Size\n      // copy size, from an expanded loop to an expanded alternative loop\n      // except bpmn:Task, because Task is always expanded\n      if (\n        isExpanded(oldBusinessObject) &&\n        !is(oldBusinessObject, \"bpmn:Task\") &&\n        newElement.isExpanded\n      ) {\n        newElement.width = element.width;\n        newElement.height = element.height;\n      }\n    }\n\n    // remove children if not expanding sub process\n    if (isLoop(oldBusinessObject) && !isLoop(newBusinessObject)) {\n      hints.moveChildren = false;\n    }\n\n    // transform collapsed/expanded pools\n    if (is(oldBusinessObject, \"bpmn:Participant\")) {\n      // create expanded pool\n      if (target.isExpanded === true) {\n        newBusinessObject.processRef = bpmnFactory.create(\"bpmn:Process-action\");\n      } else {\n        // remove children when transforming to collapsed pool\n        hints.moveChildren = false;\n      }\n\n      // apply same width and default height\n      newElement.width = element.width;\n      newElement.height = elementFactory._getDefaultSize(\n        newBusinessObject\n      ).height;\n    }\n\n    newBusinessObject.name = oldBusinessObject.name;\n\n    // retain default flow's reference between inclusive <-> exclusive gateways and activities\n    if (\n      isAny(oldBusinessObject, [\n        \"bpmn:ExclusiveGateway\",\n        \"bpmn:InclusiveGateway\",\n        \"bpmn:Activity\",\n      ]) &&\n      isAny(newBusinessObject, [\n        \"bpmn:ExclusiveGateway\",\n        \"bpmn:InclusiveGateway\",\n        \"bpmn:Activity\",\n      ])\n    ) {\n      newBusinessObject.default = oldBusinessObject.default;\n    }\n\n    if (\n      target.host &&\n      !is(oldBusinessObject, \"bpmn:BoundaryEvent\") &&\n      is(newBusinessObject, \"bpmn:BoundaryEvent\")\n    ) {\n      newElement.host = target.host;\n    }\n\n    newElement.di = {};\n\n    // fill and stroke will be set to DI\n    copyProperties(oldBusinessObject.di, newElement.di, [\"fill\", \"stroke\"]);\n\n    newElement = replace.replaceElement(element, newElement, hints);\n\n    if (hints.select !== false) {\n      selection.select(newElement);\n    }\n\n    return newElement;\n  }\n\n  this.replaceElement = replaceElement;\n}\n\nBpmnReplace.$inject = [\n  \"bpmnFactory\",\n  \"elementFactory\",\n  \"moddleCopy\",\n  \"modeling\",\n  \"replace\",\n  \"selection\",\n];\n\nfunction isLoop(bo) {\n  return is(bo, \"bpmn:Loop\");\n}\n\nfunction hasEventDefinition(element, type) {\n  let bo = getBusinessObject(element);\n\n  return (\n    type &&\n    bo.get(\"eventDefinitions\").some(function (definition) {\n      return is(definition, type);\n    })\n  );\n}\n\n/**\n * Compute intersection between two arrays.\n */\nfunction intersection(a1, a2) {\n  return a1.filter(function (el) {\n    return a2.indexOf(el) !== -1;\n  });\n}\n","import CopyPasteModule from \"../copy-paste\";\nimport ReplaceModule from \"diagram-js/lib/features/replace\";\nimport SelectionModule from \"diagram-js/lib/features/selection\";\n\nimport BpmnReplace from \"./BpmnReplace\";\n\nexport default {\n  __depends__: [CopyPasteModule, ReplaceModule, SelectionModule],\n  bpmnReplace: [\"type\", BpmnReplace],\n};\n","import { getBusinessObject } from \"../../../util/ModelUtil\";\n\nimport { isExpanded } from \"../../../util/DiUtil\";\n\n/**\n * Returns true, if an element is from a different type\n * than a target definition. Takes into account the type,\n * event definition type and triggeredByEvent property.\n *\n * @param {djs.model.Base} element\n *\n * @return {Boolean}\n */\nexport function isDifferentType(element) {\n  return function (entry) {\n    let target = entry.target;\n\n    let businessObject = getBusinessObject(element),\n      eventDefinition =\n        businessObject.eventDefinitions && businessObject.eventDefinitions[0];\n\n    let isTypeEqual = businessObject.$type === target.type;\n\n    let isEventDefinitionEqual =\n      (eventDefinition && eventDefinition.$type) === target.eventDefinitionType;\n\n    let isTriggeredByEventEqual =\n      businessObject.triggeredByEvent === target.triggeredByEvent;\n\n    let isExpandedEqual =\n      target.isExpanded === undefined ||\n      target.isExpanded === isExpanded(businessObject);\n\n    return (\n      !isTypeEqual ||\n      !isEventDefinitionEqual ||\n      !isTriggeredByEventEqual ||\n      !isExpandedEqual\n    );\n  };\n}\n","export let START_EVENT = [\n  {\n    label: \"Start Event\",\n    actionName: \"replace-with-none-start\",\n    className: \"bpmn-icon-start-event-none\",\n    target: {\n      type: \"bpmn:StartEvent\",\n    },\n  },\n  {\n    label: \"Intermediate Throw Event\",\n    actionName: \"replace-with-none-intermediate-throwing\",\n    className: \"bpmn-icon-intermediate-event-none\",\n    target: {\n      type: \"bpmn:IntermediateThrowEvent\",\n    },\n  },\n  {\n    label: \"End Event\",\n    actionName: \"replace-with-none-end\",\n    className: \"bpmn-icon-end-event-none\",\n    target: {\n      type: \"bpmn:EndEvent\",\n    },\n  },\n  {\n    label: \"Message Start Event\",\n    actionName: \"replace-with-message-start\",\n    className: \"bpmn-icon-start-event-message\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:MessageEventDefinition\",\n    },\n  },\n  {\n    label: \"Timer Start Event\",\n    actionName: \"replace-with-timer-start\",\n    className: \"bpmn-icon-start-event-timer\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:TimerEventDefinition\",\n    },\n  },\n  {\n    label: \"Conditional Start Event\",\n    actionName: \"replace-with-conditional-start\",\n    className: \"bpmn-icon-start-event-condition\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:ConditionalEventDefinition\",\n    },\n  },\n  {\n    label: \"Signal Start Event\",\n    actionName: \"replace-with-signal-start\",\n    className: \"bpmn-icon-start-event-signal\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:SignalEventDefinition\",\n    },\n  },\n];\n\nexport let INTERMEDIATE_EVENT = [\n  {\n    label: \"Start Event\",\n    actionName: \"replace-with-none-start\",\n    className: \"bpmn-icon-start-event-none\",\n    target: {\n      type: \"bpmn:StartEvent\",\n    },\n  },\n  {\n    label: \"Intermediate Throw Event\",\n    actionName: \"replace-with-none-intermediate-throw\",\n    className: \"bpmn-icon-intermediate-event-none\",\n    target: {\n      type: \"bpmn:IntermediateThrowEvent\",\n    },\n  },\n  {\n    label: \"End Event\",\n    actionName: \"replace-with-none-end\",\n    className: \"bpmn-icon-end-event-none\",\n    target: {\n      type: \"bpmn:EndEvent\",\n    },\n  },\n  {\n    label: \"Message Intermediate Catch Event\",\n    actionName: \"replace-with-message-intermediate-catch\",\n    className: \"bpmn-icon-intermediate-event-catch-message\",\n    target: {\n      type: \"bpmn:IntermediateCatchEvent\",\n      eventDefinitionType: \"bpmn:MessageEventDefinition\",\n    },\n  },\n  {\n    label: \"Message Intermediate Throw Event\",\n    actionName: \"replace-with-message-intermediate-throw\",\n    className: \"bpmn-icon-intermediate-event-throw-message\",\n    target: {\n      type: \"bpmn:IntermediateThrowEvent\",\n      eventDefinitionType: \"bpmn:MessageEventDefinition\",\n    },\n  },\n  {\n    label: \"Timer Intermediate Catch Event\",\n    actionName: \"replace-with-timer-intermediate-catch\",\n    className: \"bpmn-icon-intermediate-event-catch-timer\",\n    target: {\n      type: \"bpmn:IntermediateCatchEvent\",\n      eventDefinitionType: \"bpmn:TimerEventDefinition\",\n    },\n  },\n  {\n    label: \"Escalation Intermediate Throw Event\",\n    actionName: \"replace-with-escalation-intermediate-throw\",\n    className: \"bpmn-icon-intermediate-event-throw-escalation\",\n    target: {\n      type: \"bpmn:IntermediateThrowEvent\",\n      eventDefinitionType: \"bpmn:EscalationEventDefinition\",\n    },\n  },\n  {\n    label: \"Conditional Intermediate Catch Event\",\n    actionName: \"replace-with-conditional-intermediate-catch\",\n    className: \"bpmn-icon-intermediate-event-catch-condition\",\n    target: {\n      type: \"bpmn:IntermediateCatchEvent\",\n      eventDefinitionType: \"bpmn:ConditionalEventDefinition\",\n    },\n  },\n  {\n    label: \"Link Intermediate Catch Event\",\n    actionName: \"replace-with-link-intermediate-catch\",\n    className: \"bpmn-icon-intermediate-event-catch-link\",\n    target: {\n      type: \"bpmn:IntermediateCatchEvent\",\n      eventDefinitionType: \"bpmn:LinkEventDefinition\",\n    },\n  },\n  {\n    label: \"Link Intermediate Throw Event\",\n    actionName: \"replace-with-link-intermediate-throw\",\n    className: \"bpmn-icon-intermediate-event-throw-link\",\n    target: {\n      type: \"bpmn:IntermediateThrowEvent\",\n      eventDefinitionType: \"bpmn:LinkEventDefinition\",\n    },\n  },\n  {\n    label: \"Compensation Intermediate Throw Event\",\n    actionName: \"replace-with-compensation-intermediate-throw\",\n    className: \"bpmn-icon-intermediate-event-throw-compensation\",\n    target: {\n      type: \"bpmn:IntermediateThrowEvent\",\n      eventDefinitionType: \"bpmn:CompensateEventDefinition\",\n    },\n  },\n  {\n    label: \"Signal Intermediate Catch Event\",\n    actionName: \"replace-with-signal-intermediate-catch\",\n    className: \"bpmn-icon-intermediate-event-catch-signal\",\n    target: {\n      type: \"bpmn:IntermediateCatchEvent\",\n      eventDefinitionType: \"bpmn:SignalEventDefinition\",\n    },\n  },\n  {\n    label: \"Signal Intermediate Throw Event\",\n    actionName: \"replace-with-signal-intermediate-throw\",\n    className: \"bpmn-icon-intermediate-event-throw-signal\",\n    target: {\n      type: \"bpmn:IntermediateThrowEvent\",\n      eventDefinitionType: \"bpmn:SignalEventDefinition\",\n    },\n  },\n];\n\nexport let END_EVENT = [\n  {\n    label: \"Start Event\",\n    actionName: \"replace-with-none-start\",\n    className: \"bpmn-icon-start-event-none\",\n    target: {\n      type: \"bpmn:StartEvent\",\n    },\n  },\n  {\n    label: \"Intermediate Throw Event\",\n    actionName: \"replace-with-none-intermediate-throw\",\n    className: \"bpmn-icon-intermediate-event-none\",\n    target: {\n      type: \"bpmn:IntermediateThrowEvent\",\n    },\n  },\n  {\n    label: \"End Event\",\n    actionName: \"replace-with-none-end\",\n    className: \"bpmn-icon-end-event-none\",\n    target: {\n      type: \"bpmn:EndEvent\",\n    },\n  },\n  {\n    label: \"Message End Event\",\n    actionName: \"replace-with-message-end\",\n    className: \"bpmn-icon-end-event-message\",\n    target: {\n      type: \"bpmn:EndEvent\",\n      eventDefinitionType: \"bpmn:MessageEventDefinition\",\n    },\n  },\n  {\n    label: \"Escalation End Event\",\n    actionName: \"replace-with-escalation-end\",\n    className: \"bpmn-icon-end-event-escalation\",\n    target: {\n      type: \"bpmn:EndEvent\",\n      eventDefinitionType: \"bpmn:EscalationEventDefinition\",\n    },\n  },\n  {\n    label: \"Error End Event\",\n    actionName: \"replace-with-error-end\",\n    className: \"bpmn-icon-end-event-error\",\n    target: {\n      type: \"bpmn:EndEvent\",\n      eventDefinitionType: \"bpmn:ErrorEventDefinition\",\n    },\n  },\n  {\n    label: \"Cancel End Event\",\n    actionName: \"replace-with-cancel-end\",\n    className: \"bpmn-icon-end-event-cancel\",\n    target: {\n      type: \"bpmn:EndEvent\",\n      eventDefinitionType: \"bpmn:CancelEventDefinition\",\n    },\n  },\n  {\n    label: \"Compensation End Event\",\n    actionName: \"replace-with-compensation-end\",\n    className: \"bpmn-icon-end-event-compensation\",\n    target: {\n      type: \"bpmn:EndEvent\",\n      eventDefinitionType: \"bpmn:CompensateEventDefinition\",\n    },\n  },\n  {\n    label: \"Signal End Event\",\n    actionName: \"replace-with-signal-end\",\n    className: \"bpmn-icon-end-event-signal\",\n    target: {\n      type: \"bpmn:EndEvent\",\n      eventDefinitionType: \"bpmn:SignalEventDefinition\",\n    },\n  },\n  {\n    label: \"Terminate End Event\",\n    actionName: \"replace-with-terminate-end\",\n    className: \"bpmn-icon-end-event-terminate\",\n    target: {\n      type: \"bpmn:EndEvent\",\n      eventDefinitionType: \"bpmn:TerminateEventDefinition\",\n    },\n  },\n];\n\nexport let GATEWAY = [\n  {\n    label: \"Exclusive Gateway\",\n    actionName: \"replace-with-exclusive-gateway\",\n    className: \"bpmn-icon-gateway-xor\",\n    target: {\n      type: \"bpmn:ExclusiveGateway\",\n    },\n  },\n  {\n    label: \"Parallel Gateway\",\n    actionName: \"replace-with-parallel-gateway\",\n    className: \"bpmn-icon-gateway-parallel\",\n    target: {\n      type: \"bpmn:ParallelGateway\",\n    },\n  },\n  {\n    label: \"Inclusive Gateway\",\n    actionName: \"replace-with-inclusive-gateway\",\n    className: \"bpmn-icon-gateway-or\",\n    target: {\n      type: \"bpmn:InclusiveGateway\",\n    },\n  },\n  {\n    label: \"Complex Gateway\",\n    actionName: \"replace-with-complex-gateway\",\n    className: \"bpmn-icon-gateway-complex\",\n    target: {\n      type: \"bpmn:ComplexGateway\",\n    },\n  },\n  {\n    label: \"Event based Gateway\",\n    actionName: \"replace-with-event-based-gateway\",\n    className: \"bpmn-icon-gateway-eventbased\",\n    target: {\n      type: \"bpmn:EventBasedGateway\",\n      instantiate: false,\n      eventGatewayType: \"Exclusive\",\n    },\n  },\n\n  // Gateways deactivated until https://github.com/bpmn-io/bpmn-js/issues/194\n  // {\n  //   label: 'Event based instantiating Gateway',\n  //   actionName: 'replace-with-exclusive-event-based-gateway',\n  //   className: 'bpmn-icon-exclusive-event-based',\n  //   target: {\n  //     type: 'bpmn:EventBasedGateway'\n  //   },\n  //   options: {\n  //     businessObject: { instantiate: true, eventGatewayType: 'Exclusive' }\n  //   }\n  // },\n  // {\n  //   label: 'Parallel Event based instantiating Gateway',\n  //   actionName: 'replace-with-parallel-event-based-instantiate-gateway',\n  //   className: 'bpmn-icon-parallel-event-based-instantiate-gateway',\n  //   target: {\n  //     type: 'bpmn:EventBasedGateway'\n  //   },\n  //   options: {\n  //     businessObject: { instantiate: true, eventGatewayType: 'Parallel' }\n  //   }\n  // }\n];\n\nexport let LOOP_EXPANDED = [\n  {\n    label: \"Transaction\",\n    actionName: \"replace-with-transaction\",\n    className: \"bpmn-icon-transaction\",\n    target: {\n      type: \"bpmn:Transaction\",\n      isExpanded: true,\n    },\n  },\n  {\n    label: \"Event Sub Process\",\n    actionName: \"replace-with-event-loop\",\n    className: \"bpmn-icon-event-loop-expanded\",\n    target: {\n      type: \"bpmn:Loop\",\n      triggeredByEvent: true,\n      isExpanded: true,\n    },\n  },\n  {\n    label: \"Sub Process (collapsed)\",\n    actionName: \"replace-with-collapsed-loop\",\n    className: \"bpmn-icon-loop-collapsed\",\n    target: {\n      type: \"bpmn:Loop\",\n      isExpanded: false,\n    },\n  },\n];\n\nexport let TRANSACTION = [\n  {\n    label: \"Sub Process\",\n    actionName: \"replace-with-loop\",\n    className: \"bpmn-icon-loop-expanded\",\n    target: {\n      type: \"bpmn:Loop\",\n      isExpanded: true,\n    },\n  },\n  {\n    label: \"Event Sub Process\",\n    actionName: \"replace-with-event-loop\",\n    className: \"bpmn-icon-event-loop-expanded\",\n    target: {\n      type: \"bpmn:Loop\",\n      triggeredByEvent: true,\n      isExpanded: true,\n    },\n  },\n];\n\nexport let EVENT_SUB_PROCESS = [\n  {\n    label: \"Sub Process\",\n    actionName: \"replace-with-loop\",\n    className: \"bpmn-icon-loop-expanded\",\n    target: {\n      type: \"bpmn:Loop\",\n      isExpanded: true,\n    },\n  },\n  {\n    label: \"Transaction\",\n    actionName: \"replace-with-transaction\",\n    className: \"bpmn-icon-transaction\",\n    target: {\n      type: \"bpmn:Transaction\",\n      isExpanded: true,\n    },\n  },\n];\n\nexport let TASK = [\n  {\n    label: \"Task\",\n    actionName: \"replace-with-task\",\n    className: \"bpmn-icon-task\",\n    target: {\n      type: \"bpmn:Task\",\n    },\n  },\n  {\n    label: \"Send Task\",\n    actionName: \"replace-with-send-task\",\n    className: \"bpmn-icon-send\",\n    target: {\n      type: \"bpmn:SendTask\",\n    },\n  },\n  {\n    label: \"Receive Task\",\n    actionName: \"replace-with-receive-task\",\n    className: \"bpmn-icon-receive\",\n    target: {\n      type: \"bpmn:ReceiveTask\",\n    },\n  },\n  {\n    label: \"User Task\",\n    actionName: \"replace-with-user-task\",\n    className: \"bpmn-icon-user\",\n    target: {\n      type: \"bpmn:UserTask\",\n    },\n  },\n  {\n    label: \"Manual Task\",\n    actionName: \"replace-with-manual-task\",\n    className: \"bpmn-icon-manual\",\n    target: {\n      type: \"bpmn:ManualTask\",\n    },\n  },\n  {\n    label: \"Business Rule Task\",\n    actionName: \"replace-with-rule-task\",\n    className: \"bpmn-icon-business-rule\",\n    target: {\n      type: \"bpmn:BusinessRuleTask\",\n    },\n  },\n  {\n    label: \"Service Task\",\n    actionName: \"replace-with-service-task\",\n    className: \"bpmn-icon-service\",\n    target: {\n      type: \"bpmn:ServiceTask\",\n    },\n  },\n  {\n    label: \"Script Task\",\n    actionName: \"replace-with-script-task\",\n    className: \"bpmn-icon-script\",\n    target: {\n      type: \"bpmn:ScriptTask\",\n    },\n  },\n  {\n    label: \"Call Activity\",\n    actionName: \"replace-with-call-activity\",\n    className: \"bpmn-icon-call-activity\",\n    target: {\n      type: \"bpmn:CallActivity\",\n    },\n  },\n  {\n    label: \"Sub Process (collapsed)\",\n    actionName: \"replace-with-collapsed-loop\",\n    className: \"bpmn-icon-loop-collapsed\",\n    target: {\n      type: \"bpmn:Loop\",\n      isExpanded: false,\n    },\n  },\n  {\n    label: \"Sub Process (expanded)\",\n    actionName: \"replace-with-expanded-loop\",\n    className: \"bpmn-icon-loop-expanded\",\n    target: {\n      type: \"bpmn:Loop\",\n      isExpanded: true,\n    },\n  },\n];\n\nexport let BOUNDARY_EVENT = [\n  {\n    label: \"Message Boundary Event\",\n    actionName: \"replace-with-message-boundary\",\n    className: \"bpmn-icon-intermediate-event-catch-message\",\n    target: {\n      type: \"bpmn:BoundaryEvent\",\n      eventDefinitionType: \"bpmn:MessageEventDefinition\",\n    },\n  },\n  {\n    label: \"Timer Boundary Event\",\n    actionName: \"replace-with-timer-boundary\",\n    className: \"bpmn-icon-intermediate-event-catch-timer\",\n    target: {\n      type: \"bpmn:BoundaryEvent\",\n      eventDefinitionType: \"bpmn:TimerEventDefinition\",\n    },\n  },\n  {\n    label: \"Escalation Boundary Event\",\n    actionName: \"replace-with-escalation-boundary\",\n    className: \"bpmn-icon-intermediate-event-catch-escalation\",\n    target: {\n      type: \"bpmn:BoundaryEvent\",\n      eventDefinitionType: \"bpmn:EscalationEventDefinition\",\n    },\n  },\n  {\n    label: \"Conditional Boundary Event\",\n    actionName: \"replace-with-conditional-boundary\",\n    className: \"bpmn-icon-intermediate-event-catch-condition\",\n    target: {\n      type: \"bpmn:BoundaryEvent\",\n      eventDefinitionType: \"bpmn:ConditionalEventDefinition\",\n    },\n  },\n  {\n    label: \"Error Boundary Event\",\n    actionName: \"replace-with-error-boundary\",\n    className: \"bpmn-icon-intermediate-event-catch-error\",\n    target: {\n      type: \"bpmn:BoundaryEvent\",\n      eventDefinitionType: \"bpmn:ErrorEventDefinition\",\n    },\n  },\n  {\n    label: \"Cancel Boundary Event\",\n    actionName: \"replace-with-cancel-boundary\",\n    className: \"bpmn-icon-intermediate-event-catch-cancel\",\n    target: {\n      type: \"bpmn:BoundaryEvent\",\n      eventDefinitionType: \"bpmn:CancelEventDefinition\",\n    },\n  },\n  {\n    label: \"Signal Boundary Event\",\n    actionName: \"replace-with-signal-boundary\",\n    className: \"bpmn-icon-intermediate-event-catch-signal\",\n    target: {\n      type: \"bpmn:BoundaryEvent\",\n      eventDefinitionType: \"bpmn:SignalEventDefinition\",\n    },\n  },\n  {\n    label: \"Compensation Boundary Event\",\n    actionName: \"replace-with-compensation-boundary\",\n    className: \"bpmn-icon-intermediate-event-catch-compensation\",\n    target: {\n      type: \"bpmn:BoundaryEvent\",\n      eventDefinitionType: \"bpmn:CompensateEventDefinition\",\n    },\n  },\n  {\n    label: \"Message Boundary Event (non-interrupting)\",\n    actionName: \"replace-with-non-interrupting-message-boundary\",\n    className: \"bpmn-icon-intermediate-event-catch-non-interrupting-message\",\n    target: {\n      type: \"bpmn:BoundaryEvent\",\n      eventDefinitionType: \"bpmn:MessageEventDefinition\",\n      cancelActivity: false,\n    },\n  },\n  {\n    label: \"Timer Boundary Event (non-interrupting)\",\n    actionName: \"replace-with-non-interrupting-timer-boundary\",\n    className: \"bpmn-icon-intermediate-event-catch-non-interrupting-timer\",\n    target: {\n      type: \"bpmn:BoundaryEvent\",\n      eventDefinitionType: \"bpmn:TimerEventDefinition\",\n      cancelActivity: false,\n    },\n  },\n  {\n    label: \"Escalation Boundary Event (non-interrupting)\",\n    actionName: \"replace-with-non-interrupting-escalation-boundary\",\n    className: \"bpmn-icon-intermediate-event-catch-non-interrupting-escalation\",\n    target: {\n      type: \"bpmn:BoundaryEvent\",\n      eventDefinitionType: \"bpmn:EscalationEventDefinition\",\n      cancelActivity: false,\n    },\n  },\n  {\n    label: \"Conditional Boundary Event (non-interrupting)\",\n    actionName: \"replace-with-non-interrupting-conditional-boundary\",\n    className: \"bpmn-icon-intermediate-event-catch-non-interrupting-condition\",\n    target: {\n      type: \"bpmn:BoundaryEvent\",\n      eventDefinitionType: \"bpmn:ConditionalEventDefinition\",\n      cancelActivity: false,\n    },\n  },\n  {\n    label: \"Signal Boundary Event (non-interrupting)\",\n    actionName: \"replace-with-non-interrupting-signal-boundary\",\n    className: \"bpmn-icon-intermediate-event-catch-non-interrupting-signal\",\n    target: {\n      type: \"bpmn:BoundaryEvent\",\n      eventDefinitionType: \"bpmn:SignalEventDefinition\",\n      cancelActivity: false,\n    },\n  },\n];\n\nexport let EVENT_SUB_PROCESS_START_EVENT = [\n  {\n    label: \"Message Start Event\",\n    actionName: \"replace-with-message-start\",\n    className: \"bpmn-icon-start-event-message\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:MessageEventDefinition\",\n    },\n  },\n  {\n    label: \"Timer Start Event\",\n    actionName: \"replace-with-timer-start\",\n    className: \"bpmn-icon-start-event-timer\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:TimerEventDefinition\",\n    },\n  },\n  {\n    label: \"Conditional Start Event\",\n    actionName: \"replace-with-conditional-start\",\n    className: \"bpmn-icon-start-event-condition\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:ConditionalEventDefinition\",\n    },\n  },\n  {\n    label: \"Signal Start Event\",\n    actionName: \"replace-with-signal-start\",\n    className: \"bpmn-icon-start-event-signal\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:SignalEventDefinition\",\n    },\n  },\n  {\n    label: \"Error Start Event\",\n    actionName: \"replace-with-error-start\",\n    className: \"bpmn-icon-start-event-error\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:ErrorEventDefinition\",\n    },\n  },\n  {\n    label: \"Escalation Start Event\",\n    actionName: \"replace-with-escalation-start\",\n    className: \"bpmn-icon-start-event-escalation\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:EscalationEventDefinition\",\n    },\n  },\n  {\n    label: \"Compensation Start Event\",\n    actionName: \"replace-with-compensation-start\",\n    className: \"bpmn-icon-start-event-compensation\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:CompensateEventDefinition\",\n    },\n  },\n  {\n    label: \"Message Start Event (non-interrupting)\",\n    actionName: \"replace-with-non-interrupting-message-start\",\n    className: \"bpmn-icon-start-event-non-interrupting-message\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:MessageEventDefinition\",\n      isInterrupting: false,\n    },\n  },\n  {\n    label: \"Timer Start Event (non-interrupting)\",\n    actionName: \"replace-with-non-interrupting-timer-start\",\n    className: \"bpmn-icon-start-event-non-interrupting-timer\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:TimerEventDefinition\",\n      isInterrupting: false,\n    },\n  },\n  {\n    label: \"Conditional Start Event (non-interrupting)\",\n    actionName: \"replace-with-non-interrupting-conditional-start\",\n    className: \"bpmn-icon-start-event-non-interrupting-condition\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:ConditionalEventDefinition\",\n      isInterrupting: false,\n    },\n  },\n  {\n    label: \"Signal Start Event (non-interrupting)\",\n    actionName: \"replace-with-non-interrupting-signal-start\",\n    className: \"bpmn-icon-start-event-non-interrupting-signal\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:SignalEventDefinition\",\n      isInterrupting: false,\n    },\n  },\n  {\n    label: \"Escalation Start Event (non-interrupting)\",\n    actionName: \"replace-with-non-interrupting-escalation-start\",\n    className: \"bpmn-icon-start-event-non-interrupting-escalation\",\n    target: {\n      type: \"bpmn:StartEvent\",\n      eventDefinitionType: \"bpmn:EscalationEventDefinition\",\n      isInterrupting: false,\n    },\n  },\n];\n\nexport let SEQUENCE_FLOW = [\n  {\n    label: \"Sequence Flow\",\n    actionName: \"replace-with-sequence-flow\",\n    className: \"bpmn-icon-connection\",\n  },\n  {\n    label: \"Default Flow\",\n    actionName: \"replace-with-default-flow\",\n    className: \"bpmn-icon-default-flow\",\n  },\n  {\n    label: \"Conditional Flow\",\n    actionName: \"replace-with-conditional-flow\",\n    className: \"bpmn-icon-conditional-flow\",\n  },\n];\n\nexport let PARTICIPANT = [\n  {\n    label: \"Expanded Pool\",\n    actionName: \"replace-with-expanded-pool\",\n    className: \"bpmn-icon-participant\",\n    target: {\n      type: \"bpmn:Participant\",\n      isExpanded: true,\n    },\n  },\n  {\n    label: \"Collapsed Pool\",\n    actionName: \"replace-with-collapsed-pool\",\n\n    // TODO(@janstuemmel): maybe design new icon\n    className: \"bpmn-icon-lane\",\n    target: {\n      type: \"bpmn:Participant\",\n      isExpanded: false,\n    },\n  },\n];\n","import { getBusinessObject, is } from \"../../util/ModelUtil\";\n\nimport { isEventLoop, isExpanded } from \"../../util/DiUtil\";\n\nimport { isDifferentType } from \"./util/TypeUtil\";\n\nimport { forEach, filter } from \"min-dash\";\n\nimport * as replaceOptions from \"../replace/ReplaceOptions\";\n\n/**\n * This module is an element agnostic replace menu provider for the popup menu.\n */\nexport default function ReplaceMenuProvider(\n  popupMenu,\n  modeling,\n  moddle,\n  bpmnReplace,\n  rules,\n  translate\n) {\n  this._popupMenu = popupMenu;\n  this._modeling = modeling;\n  this._moddle = moddle;\n  this._bpmnReplace = bpmnReplace;\n  this._rules = rules;\n  this._translate = translate;\n\n  this.register();\n}\n\nReplaceMenuProvider.$inject = [\n  \"popupMenu\",\n  \"modeling\",\n  \"moddle\",\n  \"bpmnReplace\",\n  \"rules\",\n  \"translate\",\n];\n\n/**\n * Register replace menu provider in the popup menu\n */\nReplaceMenuProvider.prototype.register = function () {\n  this._popupMenu.registerProvider(\"bpmn-replace\", this);\n};\n\n/**\n * Get all entries from replaceOptions for the given element and apply filters\n * on them. Get for example only elements, which are different from the current one.\n *\n * @param {djs.model.Base} element\n *\n * @return {Array<Object>} a list of menu entry items\n */\nReplaceMenuProvider.prototype.getEntries = function (element) {\n  let businessObject = element.businessObject;\n\n  let rules = this._rules;\n\n  let entries;\n\n  if (!rules.allowed(\"shape.replace\", { element: element })) {\n    return [];\n  }\n\n  let differentType = isDifferentType(element);\n\n  // start events outside event sub processes\n  if (\n    is(businessObject, \"bpmn:StartEvent\") &&\n    !isEventLoop(businessObject.$parent)\n  ) {\n    entries = filter(replaceOptions.START_EVENT, differentType);\n\n    return this._createEntries(element, entries);\n  }\n\n  // expanded/collapsed pools\n  if (is(businessObject, \"bpmn:Participant\")) {\n    entries = filter(replaceOptions.PARTICIPANT, function (entry) {\n      return isExpanded(businessObject) !== entry.target.isExpanded;\n    });\n\n    return this._createEntries(element, entries);\n  }\n\n  // start events inside event sub processes\n  if (\n    is(businessObject, \"bpmn:StartEvent\") &&\n    isEventLoop(businessObject.$parent)\n  ) {\n    entries = filter(replaceOptions.EVENT_SUB_PROCESS_START_EVENT, function (\n      entry\n    ) {\n      let target = entry.target;\n\n      let isInterrupting = target.isInterrupting !== false;\n\n      let isInterruptingEqual =\n        getBusinessObject(element).isInterrupting === isInterrupting;\n\n      // filters elements which types and event definition are equal but have have different interrupting types\n      return (\n        differentType(entry) || (!differentType(entry) && !isInterruptingEqual)\n      );\n    });\n\n    return this._createEntries(element, entries);\n  }\n\n  // end events\n  if (is(businessObject, \"bpmn:EndEvent\")) {\n    entries = filter(replaceOptions.END_EVENT, function (entry) {\n      let target = entry.target;\n\n      // hide cancel end events outside transactions\n      if (\n        target.eventDefinitionType === \"bpmn:CancelEventDefinition\" &&\n        !is(businessObject.$parent, \"bpmn:Transaction\")\n      ) {\n        return false;\n      }\n\n      return differentType(entry);\n    });\n\n    return this._createEntries(element, entries);\n  }\n\n  // boundary events\n  if (is(businessObject, \"bpmn:BoundaryEvent\")) {\n    entries = filter(replaceOptions.BOUNDARY_EVENT, function (entry) {\n      let target = entry.target;\n\n      if (\n        target.eventDefinition === \"bpmn:CancelEventDefinition\" &&\n        !is(businessObject.attachedToRef, \"bpmn:Transaction\")\n      ) {\n        return false;\n      }\n      let cancelActivity = target.cancelActivity !== false;\n\n      let isCancelActivityEqual =\n        businessObject.cancelActivity === cancelActivity;\n\n      return (\n        differentType(entry) ||\n        (!differentType(entry) && !isCancelActivityEqual)\n      );\n    });\n\n    return this._createEntries(element, entries);\n  }\n\n  // intermediate events\n  if (\n    is(businessObject, \"bpmn:IntermediateCatchEvent\") ||\n    is(businessObject, \"bpmn:IntermediateThrowEvent\")\n  ) {\n    entries = filter(replaceOptions.INTERMEDIATE_EVENT, differentType);\n\n    return this._createEntries(element, entries);\n  }\n\n  // gateways\n  if (is(businessObject, \"bpmn:Gateway\")) {\n    entries = filter(replaceOptions.GATEWAY, differentType);\n\n    return this._createEntries(element, entries);\n  }\n\n  // transactions\n  if (is(businessObject, \"bpmn:Transaction\")) {\n    entries = filter(replaceOptions.TRANSACTION, differentType);\n\n    return this._createEntries(element, entries);\n  }\n\n  // expanded event sub processes\n  if (isEventLoop(businessObject) && isExpanded(businessObject)) {\n    entries = filter(replaceOptions.EVENT_SUB_PROCESS, differentType);\n\n    return this._createEntries(element, entries);\n  }\n\n  // expanded sub processes\n  if (is(businessObject, \"bpmn:Loop\") && isExpanded(businessObject)) {\n    entries = filter(replaceOptions.LOOP_EXPANDED, differentType);\n\n    return this._createEntries(element, entries);\n  }\n\n  // collapsed ad hoc sub processes\n  if (\n    is(businessObject, \"bpmn:AdHocSubProcess\") &&\n    !isExpanded(businessObject)\n  ) {\n    entries = filter(replaceOptions.TASK, function (entry) {\n      let target = entry.target;\n\n      let isTargetLoop = target.type === \"bpmn:Loop\";\n\n      let isTargetExpanded = target.isExpanded === true;\n\n      return (\n        isDifferentType(element, target) &&\n        (!isTargetLoop || isTargetExpanded)\n      );\n    });\n\n    return this._createEntries(element, entries);\n  }\n\n  // sequence flows\n  if (is(businessObject, \"bpmn:SequenceFlow\")) {\n    return this._createSequenceFlowEntries(\n      element,\n      replaceOptions.SEQUENCE_FLOW\n    );\n  }\n\n  // flow nodes\n  if (is(businessObject, \"bpmn:FlowNode\")) {\n    entries = filter(replaceOptions.TASK, differentType);\n\n    // collapsed SubProcess can not be replaced with itself\n    if (is(businessObject, \"bpmn:Loop\") && !isExpanded(businessObject)) {\n      entries = filter(entries, function (entry) {\n        return entry.label !== \"Sub Process (collapsed)\";\n      });\n    }\n\n    return this._createEntries(element, entries);\n  }\n\n  return [];\n};\n\n/**\n * Get a list of header items for the given element. This includes buttons\n * for multi instance markers and for the ad hoc marker.\n *\n * @param {djs.model.Base} element\n *\n * @return {Array<Object>} a list of menu entry items\n */\nReplaceMenuProvider.prototype.getHeaderEntries = function (element) {\n  let headerEntries = [];\n\n  if (is(element, \"bpmn:Activity\") && !isEventLoop(element)) {\n    headerEntries = headerEntries.concat(this._getLoopEntries(element));\n  }\n\n  if (\n    is(element, \"bpmn:Loop\") &&\n    !is(element, \"bpmn:Transaction\") &&\n    !isEventLoop(element)\n  ) {\n    headerEntries.push(this._getAdHocEntry(element));\n  }\n\n  return headerEntries;\n};\n\n/**\n * Creates an array of menu entry objects for a given element and filters the replaceOptions\n * according to a filter function.\n *\n * @param  {djs.model.Base} element\n * @param  {Object} replaceOptions\n *\n * @return {Array<Object>} a list of menu items\n */\nReplaceMenuProvider.prototype._createEntries = function (\n  element,\n  replaceOptions\n) {\n  let menuEntries = [];\n\n  let self = this;\n\n  forEach(replaceOptions, function (definition) {\n    let entry = self._createMenuEntry(definition, element);\n\n    menuEntries.push(entry);\n  });\n\n  return menuEntries;\n};\n\n/**\n * Creates an array of menu entry objects for a given sequence flow.\n *\n * @param  {djs.model.Base} element\n * @param  {Object} replaceOptions\n\n * @return {Array<Object>} a list of menu items\n */\nReplaceMenuProvider.prototype._createSequenceFlowEntries = function (\n  element,\n  replaceOptions\n) {\n  let businessObject = getBusinessObject(element);\n\n  let menuEntries = [];\n\n  let modeling = this._modeling,\n    moddle = this._moddle;\n\n  let self = this;\n\n  forEach(replaceOptions, function (entry) {\n    switch (entry.actionName) {\n      case \"replace-with-default-flow\":\n        if (\n          businessObject.sourceRef.default !== businessObject &&\n          (is(businessObject.sourceRef, \"bpmn:ExclusiveGateway\") ||\n            is(businessObject.sourceRef, \"bpmn:InclusiveGateway\") ||\n            is(businessObject.sourceRef, \"bpmn:ComplexGateway\") ||\n            is(businessObject.sourceRef, \"bpmn:Activity\"))\n        ) {\n          menuEntries.push(\n            self._createMenuEntry(entry, element, function () {\n              modeling.updateProperties(element.source, {\n                default: businessObject,\n              });\n            })\n          );\n        }\n        break;\n      case \"replace-with-conditional-flow\":\n        if (\n          !businessObject.conditionExpression &&\n          is(businessObject.sourceRef, \"bpmn:Activity\")\n        ) {\n          menuEntries.push(\n            self._createMenuEntry(entry, element, function () {\n              let conditionExpression = moddle.create(\"bpmn:FormalExpression\", {\n                body: \"\",\n              });\n\n              modeling.updateProperties(element, {\n                conditionExpression: conditionExpression,\n              });\n            })\n          );\n        }\n        break;\n      default:\n        // default flows\n        if (\n          is(businessObject.sourceRef, \"bpmn:Activity\") &&\n          businessObject.conditionExpression\n        ) {\n          return menuEntries.push(\n            self._createMenuEntry(entry, element, function () {\n              modeling.updateProperties(element, {\n                conditionExpression: undefined,\n              });\n            })\n          );\n        }\n\n        // conditional flows\n        if (\n          (is(businessObject.sourceRef, \"bpmn:ExclusiveGateway\") ||\n            is(businessObject.sourceRef, \"bpmn:InclusiveGateway\") ||\n            is(businessObject.sourceRef, \"bpmn:ComplexGateway\") ||\n            is(businessObject.sourceRef, \"bpmn:Activity\")) &&\n          businessObject.sourceRef.default === businessObject\n        ) {\n          return menuEntries.push(\n            self._createMenuEntry(entry, element, function () {\n              modeling.updateProperties(element.source, { default: undefined });\n            })\n          );\n        }\n    }\n  });\n\n  return menuEntries;\n};\n\n/**\n * Creates and returns a single menu entry item.\n *\n * @param  {Object} definition a single replace options definition object\n * @param  {djs.model.Base} element\n * @param  {Function} [action] an action callback function which gets called when\n *                             the menu entry is being triggered.\n *\n * @return {Object} menu entry item\n */\nReplaceMenuProvider.prototype._createMenuEntry = function (\n  definition,\n  element,\n  action\n) {\n  let translate = this._translate;\n  let replaceElement = this._bpmnReplace.replaceElement;\n\n  let replaceAction = function () {\n    return replaceElement(element, definition.target);\n  };\n\n  action = action || replaceAction;\n\n  let menuEntry = {\n    label: translate(definition.label),\n    className: definition.className,\n    id: definition.actionName,\n    action: action,\n  };\n\n  return menuEntry;\n};\n\n/**\n * Get a list of menu items containing buttons for multi instance markers\n *\n * @param  {djs.model.Base} element\n *\n * @return {Array<Object>} a list of menu items\n */\nReplaceMenuProvider.prototype._getLoopEntries = function (element) {\n  let self = this;\n  let translate = this._translate;\n\n  function toggleLoopEntry(event, entry) {\n    let loopCharacteristics;\n\n    if (entry.active) {\n      loopCharacteristics = undefined;\n    } else {\n      loopCharacteristics = self._moddle.create(\n        entry.options.loopCharacteristics\n      );\n\n      if (entry.options.isSequential) {\n        loopCharacteristics.isSequential = entry.options.isSequential;\n      }\n    }\n    self._modeling.updateProperties(element, {\n      loopCharacteristics: loopCharacteristics,\n    });\n  }\n\n  let businessObject = getBusinessObject(element),\n    loopCharacteristics = businessObject.loopCharacteristics;\n\n  let isSequential, isLoop, isParallel;\n\n  if (loopCharacteristics) {\n    isSequential = loopCharacteristics.isSequential;\n    isLoop = loopCharacteristics.isSequential === undefined;\n    isParallel =\n      loopCharacteristics.isSequential !== undefined &&\n      !loopCharacteristics.isSequential;\n  }\n\n  let loopEntries = [\n    {\n      id: \"toggle-parallel-mi\",\n      className: \"bpmn-icon-parallel-mi-marker\",\n      title: translate(\"Parallel Multi Instance\"),\n      active: isParallel,\n      action: toggleLoopEntry,\n      options: {\n        loopCharacteristics: \"bpmn:MultiInstanceLoopCharacteristics\",\n        isSequential: false,\n      },\n    },\n    {\n      id: \"toggle-sequential-mi\",\n      className: \"bpmn-icon-sequential-mi-marker\",\n      title: translate(\"Sequential Multi Instance\"),\n      active: isSequential,\n      action: toggleLoopEntry,\n      options: {\n        loopCharacteristics: \"bpmn:MultiInstanceLoopCharacteristics\",\n        isSequential: true,\n      },\n    },\n    {\n      id: \"toggle-loop\",\n      className: \"bpmn-icon-loop-marker\",\n      title: translate(\"Loop\"),\n      active: isLoop,\n      action: toggleLoopEntry,\n      options: {\n        loopCharacteristics: \"bpmn:StandardLoopCharacteristics\",\n      },\n    },\n  ];\n  return loopEntries;\n};\n\n/**\n * Get the menu items containing a button for the ad hoc marker\n *\n * @param  {djs.model.Base} element\n *\n * @return {Object} a menu item\n */\nReplaceMenuProvider.prototype._getAdHocEntry = function (element) {\n  let translate = this._translate;\n  let businessObject = getBusinessObject(element);\n\n  let isAdHoc = is(businessObject, \"bpmn:AdHocSubProcess\");\n\n  let replaceElement = this._bpmnReplace.replaceElement;\n\n  let adHocEntry = {\n    id: \"toggle-adhoc\",\n    className: \"bpmn-icon-ad-hoc-marker\",\n    title: translate(\"Ad-hoc\"),\n    active: isAdHoc,\n    action: function (event, entry) {\n      if (isAdHoc) {\n        return replaceElement(\n          element,\n          { type: \"bpmn:Loop\" },\n          {\n            autoResize: false,\n            layoutConnection: false,\n          }\n        );\n      } else {\n        return replaceElement(\n          element,\n          { type: \"bpmn:AdHocSubProcess\" },\n          {\n            autoResize: false,\n            layoutConnection: false,\n          }\n        );\n      }\n    },\n  };\n\n  return adHocEntry;\n};\n","import PopupMenuModule from \"diagram-js/lib/features/popup-menu\";\nimport ReplaceModule from \"../replace\";\n\nimport ReplaceMenuProvider from \"./ReplaceMenuProvider\";\n\nexport default {\n  __depends__: [PopupMenuModule, ReplaceModule],\n  __init__: [\"replaceMenuProvider\"],\n  replaceMenuProvider: [\"type\", ReplaceMenuProvider],\n};\n","import { is } from \"../../../util/ModelUtil\";\n\nimport { getParent } from \"./ModelingUtil\";\n\nimport { asTRBL } from \"diagram-js/lib/layout/LayoutUtil\";\n\nimport {\n  substractTRBL,\n  resizeTRBL,\n} from \"diagram-js/lib/features/resize/ResizeUtil\";\n\nlet abs = Math.abs;\n\nfunction getTRBLResize(oldBounds, newBounds) {\n  return substractTRBL(asTRBL(newBounds), asTRBL(oldBounds));\n}\n\nlet LANE_PARENTS = [\"bpmn:Participant\", \"bpmn:Process-action\", \"bpmn:Loop\"];\n\nexport let LANE_INDENTATION = 30;\n\n/**\n * Collect all lane shapes in the given paren\n *\n * @param  {djs.model.Shape} shape\n * @param  {Array<djs.model.Base>} [collectedShapes]\n *\n * @return {Array<djs.model.Base>}\n */\nexport function collectLanes(shape, collectedShapes) {\n  collectedShapes = collectedShapes || [];\n\n  shape.children.filter(function (s) {\n    if (is(s, \"bpmn:Lane\")) {\n      collectLanes(s, collectedShapes);\n      collectedShapes.push(s);\n      return s;\n    }\n    return s\n  });\n\n  return collectedShapes;\n}\n\n/**\n * Return the lane children of the given element.\n *\n * @param {djs.model.Shape} shape\n *\n * @return {Array<djs.model.Shape>}\n */\nexport function getChildLanes(shape) {\n  return shape.children.filter(function (c) {\n    return is(c, \"bpmn:Lane\");\n  });\n}\n\n/**\n * Return the root element containing the given lane shape\n *\n * @param {djs.model.Shape} shape\n *\n * @return {djs.model.Shape}\n */\nexport function getLanesRoot(shape) {\n  return getParent(shape, LANE_PARENTS) || shape;\n}\n\n/**\n * Compute the required resize operations for lanes\n * adjacent to the given shape, assuming it will be\n * resized to the given new bounds.\n *\n * @param {djs.model.Shape} shape\n * @param {Bounds} newBounds\n *\n * @return {Array<Object>}\n */\nexport function computeLanesResize(shape, newBounds) {\n  let rootElement = getLanesRoot(shape);\n\n  let initialShapes = is(rootElement, \"bpmn:Process\") ? [] : [rootElement];\n\n  let allLanes = collectLanes(rootElement, initialShapes),\n    shapeTrbl = asTRBL(shape),\n    shapeNewTrbl = asTRBL(newBounds),\n    trblResize = getTRBLResize(shape, newBounds),\n    resizeNeeded = [];\n\n  allLanes.forEach(function (other) {\n    if (other === shape) {\n      return;\n    }\n\n    let topResize = 0,\n      rightResize = trblResize.right,\n      bottomResize = 0,\n      leftResize = trblResize.left;\n\n    let otherTrbl = asTRBL(other);\n\n    if (trblResize.top) {\n      if (abs(otherTrbl.bottom - shapeTrbl.top) < 10) {\n        bottomResize = shapeNewTrbl.top - otherTrbl.bottom;\n      }\n\n      if (abs(otherTrbl.top - shapeTrbl.top) < 5) {\n        topResize = shapeNewTrbl.top - otherTrbl.top;\n      }\n    }\n\n    if (trblResize.bottom) {\n      if (abs(otherTrbl.top - shapeTrbl.bottom) < 10) {\n        topResize = shapeNewTrbl.bottom - otherTrbl.top;\n      }\n\n      if (abs(otherTrbl.bottom - shapeTrbl.bottom) < 5) {\n        bottomResize = shapeNewTrbl.bottom - otherTrbl.bottom;\n      }\n    }\n\n    if (topResize || rightResize || bottomResize || leftResize) {\n      resizeNeeded.push({\n        shape: other,\n        newBounds: resizeTRBL(other, {\n          top: topResize,\n          right: rightResize,\n          bottom: bottomResize,\n          left: leftResize,\n        }),\n      });\n    }\n  });\n\n  return resizeNeeded;\n}\n","import { assign, forEach, isArray } from \"min-dash\";\n\nimport { is } from \"../../util/ModelUtil\";\n\nimport { isExpanded, isEventLoop } from \"../../util/DiUtil\";\n\nimport { isAny } from \"../modeling/util/ModelingUtil\";\n\nimport { getChildLanes } from \"../modeling/util/LaneUtil\";\n\nimport { hasPrimaryModifier } from \"diagram-js/lib/util/Mouse\";\n\n/**\n * A provider for BPMN 2.0 elements context pad\n */\nexport default function ContextPadProvider(\n  config,\n  injector,\n  eventBus,\n  contextPad,\n  modeling,\n  elementFactory,\n  connect,\n  create,\n  popupMenu,\n  canvas,\n  rules,\n  translate\n) {\n  config = config || {};\n\n  contextPad.registerProvider(this);\n\n  this._contextPad = contextPad;\n\n  this._modeling = modeling;\n\n  this._elementFactory = elementFactory;\n  this._connect = connect;\n  this._create = create;\n  this._popupMenu = popupMenu;\n  this._canvas = canvas;\n  this._rules = rules;\n  this._translate = translate;\n\n  if (config.autoPlace !== false) {\n    this._autoPlace = injector.get(\"autoPlace\", false);\n  }\n\n  eventBus.on(\"create.end\", 250, function (event) {\n    let context = event.context,\n      shape = context.shape;\n\n    if (!hasPrimaryModifier(event) || !contextPad.isOpen(shape)) {\n      return;\n    }\n\n    let entries = contextPad.getEntries(shape);\n\n    if (entries.replace) {\n      entries.replace.action.click(event, shape);\n    }\n  });\n}\n\nContextPadProvider.$inject = [\n  \"config.contextPad\",\n  \"injector\",\n  \"eventBus\",\n  \"contextPad\",\n  \"modeling\",\n  \"elementFactory\",\n  \"connect\",\n  \"create\",\n  \"popupMenu\",\n  \"canvas\",\n  \"rules\",\n  \"translate\",\n];\n\nContextPadProvider.prototype.getContextPadEntries = function (element) {\n  let contextPad = this._contextPad,\n    modeling = this._modeling,\n    elementFactory = this._elementFactory,\n    connect = this._connect,\n    create = this._create,\n    popupMenu = this._popupMenu,\n    canvas = this._canvas,\n    rules = this._rules,\n    autoPlace = this._autoPlace,\n    translate = this._translate;\n\n  let actions = {};\n\n  if (element.type === \"label\") {\n    return actions;\n  }\n\n  let businessObject = element.businessObject;\n\n  function startConnect(event, element) {\n    connect.start(event, element);\n  }\n\n  function removeElement(e) {\n    modeling.removeElements([element]);\n  }\n\n  function getReplaceMenuPosition(element) {\n    let Y_OFFSET = 5;\n\n    let diagramContainer = canvas.getContainer(),\n      pad = contextPad.getPad(element).html;\n\n    let diagramRect = diagramContainer.getBoundingClientRect(),\n      padRect = pad.getBoundingClientRect();\n\n    let top = padRect.top - diagramRect.top;\n    let left = padRect.left - diagramRect.left;\n\n    let pos = {\n      x: left,\n      y: top + padRect.height + Y_OFFSET,\n    };\n\n    return pos;\n  }\n\n  /**\n   * Create an append action\n   *\n   * @param {String} type\n   * @param {String} className\n   * @param {String} [title]\n   * @param {Object} [options]\n   *\n   * @return {Object} descriptor\n   */\n  function appendAction(type, className, title, options) {\n    if (typeof title !== \"string\") {\n      options = title;\n      title = translate(\"Append {type}\", { type: type.replace(/^bpmn:/, \"\") });\n    }\n\n    function appendStart(event, element) {\n      let shape = elementFactory.createShape(assign({ type: type }, options));\n      create.start(event, shape, {\n        source: element,\n      });\n    }\n\n    let append = autoPlace\n      ? function (event, element) {\n          let shape = elementFactory.createShape(\n            assign({ type: type }, options)\n          );\n\n          autoPlace.append(element, shape);\n        }\n      : appendStart;\n\n    return {\n      group: \"model\",\n      className: className,\n      title: title,\n      action: {\n        dragstart: appendStart,\n        click: append,\n      },\n    };\n  }\n\n  function splitLaneHandler(count) {\n    return function (event, element) {\n      // actual split\n      modeling.splitLane(element, count);\n\n      // refresh context pad after split to\n      // get rid of split icons\n      contextPad.open(element, true);\n    };\n  }\n\n  if (\n    isAny(businessObject, [\"bpmn:Lane\", \"bpmn:Participant\"]) &&\n    isExpanded(businessObject)\n  ) {\n    let childLanes = getChildLanes(element);\n\n    assign(actions, {\n      \"lane-insert-above\": {\n        group: \"lane-insert-above\",\n        className: \"bpmn-icon-lane-insert-above\",\n        title: translate(\"Add Lane above\"),\n        action: {\n          click: function (event, element) {\n            modeling.addLane(element, \"top\");\n          },\n        },\n      },\n    });\n\n    if (childLanes.length < 2) {\n      if (element.height >= 120) {\n        assign(actions, {\n          \"lane-divide-two\": {\n            group: \"lane-divide\",\n            className: \"bpmn-icon-lane-divide-two\",\n            title: translate(\"Divide into two Lanes\"),\n            action: {\n              click: splitLaneHandler(2),\n            },\n          },\n        });\n      }\n\n      if (element.height >= 180) {\n        assign(actions, {\n          \"lane-divide-three\": {\n            group: \"lane-divide\",\n            className: \"bpmn-icon-lane-divide-three\",\n            title: translate(\"Divide into three Lanes\"),\n            action: {\n              click: splitLaneHandler(3),\n            },\n          },\n        });\n      }\n    }\n\n    assign(actions, {\n      \"lane-insert-below\": {\n        group: \"lane-insert-below\",\n        className: \"bpmn-icon-lane-insert-below\",\n        title: translate(\"Add Lane below\"),\n        action: {\n          click: function (event, element) {\n            modeling.addLane(element, \"bottom\");\n          },\n        },\n      },\n    });\n  }\n\n  if (is(businessObject, \"bpmn:FlowNode\")) {\n    if (is(businessObject, \"bpmn:EventBasedGateway\")) {\n      assign(actions, {\n        \"append.receive-task\": appendAction(\n          \"bpmn:ReceiveTask\",\n          \"bpmn-icon-receive-task\",\n          translate(\"Append ReceiveTask\")\n        ),\n        \"append.message-intermediate-event\": appendAction(\n          \"bpmn:IntermediateCatchEvent\",\n          \"bpmn-icon-intermediate-event-catch-message\",\n          translate(\"Append MessageIntermediateCatchEvent\"),\n          { eventDefinitionType: \"bpmn:MessageEventDefinition\" }\n        ),\n        \"append.timer-intermediate-event\": appendAction(\n          \"bpmn:IntermediateCatchEvent\",\n          \"bpmn-icon-intermediate-event-catch-timer\",\n          translate(\"Append TimerIntermediateCatchEvent\"),\n          { eventDefinitionType: \"bpmn:TimerEventDefinition\" }\n        ),\n        \"append.condition-intermediate-event\": appendAction(\n          \"bpmn:IntermediateCatchEvent\",\n          \"bpmn-icon-intermediate-event-catch-condition\",\n          translate(\"Append ConditionIntermediateCatchEvent\"),\n          { eventDefinitionType: \"bpmn:ConditionalEventDefinition\" }\n        ),\n        \"append.signal-intermediate-event\": appendAction(\n          \"bpmn:IntermediateCatchEvent\",\n          \"bpmn-icon-intermediate-event-catch-signal\",\n          translate(\"Append SignalIntermediateCatchEvent\"),\n          { eventDefinitionType: \"bpmn:SignalEventDefinition\" }\n        ),\n      });\n    } else if (\n      isEventType(\n        businessObject,\n        \"bpmn:BoundaryEvent\",\n        \"bpmn:CompensateEventDefinition\"\n      )\n    ) {\n      assign(actions, {\n        \"append.compensation-activity\": appendAction(\n          \"bpmn:Task\",\n          \"bpmn-icon-task\",\n          translate(\"Append compensation activity\"),\n          {\n            isForCompensation: true,\n          }\n        ),\n      });\n    } else if (\n      !is(businessObject, \"bpmn:EndEvent\") &&\n      !businessObject.isForCompensation &&\n      !isEventType(\n        businessObject,\n        \"bpmn:IntermediateThrowEvent\",\n        \"bpmn:LinkEventDefinition\"\n      ) &&\n      !isEventLoop(businessObject)\n    ) {\n      assign(actions, {\n        \"append.end-event\": appendAction(\n          \"bpmn:EndEvent\",\n          \"bpmn-icon-end-event-none\",\n          translate(\"Append EndEvent\")\n        ),\n        \"append.gateway\": appendAction(\n          \"bpmn:ExclusiveGateway\",\n          \"bpmn-icon-gateway-none\",\n          translate(\"Append Gateway\")\n        ),\n        \"append.append-task\": appendAction(\n          \"bpmn:Task\",\n          \"bpmn-icon-task\",\n          translate(\"Append Task\")\n        ),\n        \"append.intermediate-event\": appendAction(\n          \"bpmn:IntermediateThrowEvent\",\n          \"bpmn-icon-intermediate-event-none\",\n          translate(\"Append Intermediate/Boundary Event\")\n        ),\n      });\n    }\n  }\n\n  if (!popupMenu.isEmpty(element, \"bpmn-replace\")) {\n    // Replace menu entry\n    assign(actions, {\n      replace: {\n        group: \"edit\",\n        className: \"bpmn-icon-screw-wrench\",\n        title: translate(\"Change type\"),\n        action: {\n          click: function (event, element) {\n            let position = assign(getReplaceMenuPosition(element), {\n              cursor: { x: event.x, y: event.y },\n            });\n\n            popupMenu.open(element, \"bpmn-replace\", position);\n          },\n        },\n      },\n    });\n  }\n\n  if (\n    isAny(businessObject, [\n      \"bpmn:FlowNode\",\n      \"bpmn:InteractionNode\",\n      \"bpmn:DataObjectReference\",\n      \"bpmn:DataStoreReference\",\n    ])\n  ) {\n    assign(actions, {\n      \"append.text-annotation\": appendAction(\n        \"bpmn:TextAnnotation\",\n        \"bpmn-icon-text-annotation\"\n      ),\n\n      connect: {\n        group: \"connect\",\n        className: \"bpmn-icon-connection-multi\",\n        title: translate(\n          \"Connect using \" +\n            (businessObject.isForCompensation\n              ? \"\"\n              : \"Sequence/MessageFlow or \") +\n            \"Association\"\n        ),\n        action: {\n          click: startConnect,\n          dragstart: startConnect,\n        },\n      },\n    });\n  }\n\n  if (\n    isAny(businessObject, [\n      \"bpmn:DataObjectReference\",\n      \"bpmn:DataStoreReference\",\n    ])\n  ) {\n    assign(actions, {\n      connect: {\n        group: \"connect\",\n        className: \"bpmn-icon-connection-multi\",\n        title: translate(\"Connect using DataInputAssociation\"),\n        action: {\n          click: startConnect,\n          dragstart: startConnect,\n        },\n      },\n    });\n  }\n\n  // delete element entry, only show if allowed by rules\n  let deleteAllowed = rules.allowed(\"elements.delete\", { elements: [element] });\n\n  if (isArray(deleteAllowed)) {\n    // was the element returned as a deletion candidate?\n    deleteAllowed = deleteAllowed[0] === element;\n  }\n\n  if (deleteAllowed) {\n    assign(actions, {\n      delete: {\n        group: \"edit\",\n        className: \"bpmn-icon-trash\",\n        title: translate(\"Remove\"),\n        action: {\n          click: removeElement,\n        },\n      },\n    });\n  }\n\n  return actions;\n};\n\n// helpers /////////\n\nfunction isEventType(eventBo, type, definition) {\n  let isType = eventBo.$instanceOf(type);\n  let isDefinition = false;\n\n  let definitions = eventBo.eventDefinitions || [];\n  forEach(definitions, function (def) {\n    if (def.$type === definition) {\n      isDefinition = true;\n    }\n  });\n\n  return isType && isDefinition;\n}\n","import DirectEditingModule from \"diagram-js-direct-editing\";\nimport ContextPadModule from \"diagram-js/lib/features/context-pad\";\nimport SelectionModule from \"diagram-js/lib/features/selection\";\nimport ConnectModule from \"diagram-js/lib/features/connect\";\nimport CreateModule from \"diagram-js/lib/features/create\";\nimport PopupMenuModule from \"../popup-menu\";\n\nimport ContextPadProvider from \"./ContextPadProvider\";\n\nexport default {\n  __depends__: [\n    DirectEditingModule,\n    ContextPadModule,\n    SelectionModule,\n    ConnectModule,\n    CreateModule,\n    PopupMenuModule,\n  ],\n  __init__: [\"contextPadProvider\"],\n  contextPadProvider: [\"type\", ContextPadProvider],\n};\n","import { filter } from \"min-dash\";\n\nimport { isAny } from \"../modeling/util/ModelingUtil\";\n\n/**\n * Registers element exclude filters for elements that\n * currently do not support distribution.\n */\nexport default function BpmnDistributeElements(distributeElements) {\n  distributeElements.registerFilter(function (elements) {\n    return filter(elements, function (element) {\n      let cannotDistribute = isAny(element, [\n        \"bpmn:Association\",\n        \"bpmn:BoundaryEvent\",\n        \"bpmn:DataInputAssociation\",\n        \"bpmn:DataOutputAssociation\",\n        \"bpmn:Lane\",\n        \"bpmn:MessageFlow\",\n        \"bpmn:Participant\",\n        \"bpmn:SequenceFlow\",\n        \"bpmn:TextAnnotation\",\n      ]);\n\n      return !(element.labelTarget || cannotDistribute);\n    });\n  });\n}\n\nBpmnDistributeElements.$inject = [\"distributeElements\"];\n","import DistributeElementsModule from \"diagram-js/lib/features/distribute-elements\";\n\nimport BpmnDistributeElements from \"./BpmnDistributeElements\";\n\nexport default {\n  __depends__: [DistributeElementsModule],\n  __init__: [\"bpmnDistributeElements\"],\n  bpmnDistributeElements: [\"type\", BpmnDistributeElements],\n};\n","import inherits from \"inherits\";\n\nimport EditorActions from \"diagram-js/lib/features/editor-actions/EditorActions\";\n\nimport { filter } from \"min-dash\";\n\nimport { is } from \"../../util/ModelUtil\";\n\nimport { getBBox } from \"diagram-js/lib/util/Elements\";\n\n/**\n * Registers and executes BPMN specific editor actions.\n *\n * @param {Injector} injector\n */\nexport default function BpmnEditorActions(injector) {\n  injector.invoke(EditorActions, this);\n}\n\ninherits(BpmnEditorActions, EditorActions);\n\nBpmnEditorActions.$inject = [\"injector\"];\n\n/**\n * Register default actions.\n *\n * @param {Injector} injector\n */\nBpmnEditorActions.prototype._registerDefaultActions = function (injector) {\n  // (0) invoke super method\n\n  EditorActions.prototype._registerDefaultActions.call(this, injector);\n\n  // (1) retrieve optional components to integrate with\n\n  let canvas = injector.get(\"canvas\", false);\n  let elementRegistry = injector.get(\"elementRegistry\", false);\n  let selection = injector.get(\"selection\", false);\n  let spaceTool = injector.get(\"spaceTool\", false);\n  let lassoTool = injector.get(\"lassoTool\", false);\n  let handTool = injector.get(\"handTool\", false);\n  let globalConnect = injector.get(\"globalConnect\", false);\n  let distributeElements = injector.get(\"distributeElements\", false);\n  let alignElements = injector.get(\"alignElements\", false);\n  let directEditing = injector.get(\"directEditing\", false);\n  let searchPad = injector.get(\"searchPad\", false);\n  let modeling = injector.get(\"modeling\", false);\n\n  // (2) check components and register actions\n\n  if (canvas && elementRegistry && selection) {\n    this._registerAction(\"selectElements\", function () {\n      // select all elements except for the invisible\n      // root element\n      let rootElement = canvas.getRootElement();\n\n      let elements = elementRegistry.filter(function (element) {\n        return element !== rootElement;\n      });\n\n      selection.select(elements);\n\n      return elements;\n    });\n  }\n\n  if (spaceTool) {\n    this._registerAction(\"spaceTool\", function () {\n      spaceTool.toggle();\n    });\n  }\n\n  if (lassoTool) {\n    this._registerAction(\"lassoTool\", function () {\n      lassoTool.toggle();\n    });\n  }\n\n  if (handTool) {\n    this._registerAction(\"handTool\", function () {\n      handTool.toggle();\n    });\n  }\n\n  if (globalConnect) {\n    this._registerAction(\"globalConnectTool\", function () {\n      globalConnect.toggle();\n    });\n  }\n\n  if (selection && distributeElements) {\n    this._registerAction(\"distributeElements\", function (opts) {\n      let currentSelection = selection.get(),\n        type = opts.type;\n\n      if (currentSelection.length) {\n        distributeElements.trigger(currentSelection, type);\n      }\n    });\n  }\n\n  if (selection && alignElements) {\n    this._registerAction(\"alignElements\", function (opts) {\n      let currentSelection = selection.get(),\n        aligneableElements = [],\n        type = opts.type;\n\n      if (currentSelection.length) {\n        aligneableElements = filter(currentSelection, function (element) {\n          return !is(element, \"bpmn:Lane\");\n        });\n\n        alignElements.trigger(aligneableElements, type);\n      }\n    });\n  }\n\n  if (selection && modeling) {\n    this._registerAction(\"setColor\", function (opts) {\n      let currentSelection = selection.get();\n\n      if (currentSelection.length) {\n        modeling.setColor(currentSelection, opts);\n      }\n    });\n  }\n\n  if (selection && directEditing) {\n    this._registerAction(\"directEditing\", function () {\n      let currentSelection = selection.get();\n\n      if (currentSelection.length) {\n        directEditing.activate(currentSelection[0]);\n      }\n    });\n  }\n\n  if (searchPad) {\n    this._registerAction(\"find\", function () {\n      searchPad.toggle();\n    });\n  }\n\n  if (canvas && modeling) {\n    this._registerAction(\"moveToOrigin\", function () {\n      let rootElement = canvas.getRootElement(),\n        boundingBox,\n        elements;\n\n      if (is(rootElement, \"bpmn:Collaboration\")) {\n        elements = elementRegistry.filter(function (element) {\n          return is(element.parent, \"bpmn:Collaboration\");\n        });\n      } else {\n        elements = elementRegistry.filter(function (element) {\n          return (\n            element !== rootElement && !is(element.parent, \"bpmn:Loop\")\n          );\n        });\n      }\n\n      boundingBox = getBBox(elements);\n\n      modeling.moveElements(\n        elements,\n        { x: -boundingBox.x, y: -boundingBox.y },\n        rootElement\n      );\n    });\n  }\n};\n","import EditorActionsModule from \"diagram-js/lib/features/editor-actions\";\n\nimport BpmnEditorActions from \"./BpmnEditorActions\";\n\nexport default {\n  __depends__: [EditorActionsModule],\n  editorActions: [\"type\", BpmnEditorActions],\n};\n","import { isAny } from \"../modeling/util/ModelingUtil\";\r\n\r\nexport default function BpmnGridSnapping(eventBus) {\r\n  eventBus.on([\"create.init\", \"shape.move.init\"], function (event) {\r\n    let context = event.context,\r\n      shape = event.shape;\r\n\r\n    if (\r\n      isAny(shape, [\r\n        \"bpmn:Participant\",\r\n        \"bpmn:Loop\",\r\n        \"bpmn:Conditional\",\r\n        \"bpmn:TextAnnotation\",\r\n      ])\r\n    ) {\r\n      if (!context.gridSnappingContext) {\r\n        context.gridSnappingContext = {};\r\n      }\r\n\r\n      context.gridSnappingContext.snapLocation = \"top-left\";\r\n    }\r\n  });\r\n}\r\n\r\nBpmnGridSnapping.$inject = [\"eventBus\"];\r\n","import { getNewShapePosition } from \"../../auto-place/AutoPlaceUtil\";\r\n\r\nimport { getMid } from \"diagram-js/lib/layout/LayoutUtil\";\r\nimport { is } from \"../../../util/ModelUtil\";\r\n\r\nexport default function AutoPlaceBehavior(eventBus, gridSnapping) {\r\n  eventBus.on(\"autoPlace\", function (context) {\r\n    let source = context.source,\r\n      sourceMid = getMid(source),\r\n      shape = context.shape;\r\n\r\n    let position = getNewShapePosition(source, shape);\r\n\r\n    [\"x\", \"y\"].forEach(function (axis) {\r\n      let options = {};\r\n\r\n      // do not snap if x/y equal\r\n      if (position[axis] === sourceMid[axis]) {\r\n        return;\r\n      }\r\n\r\n      if (position[axis] > sourceMid[axis]) {\r\n        options.min = position[axis];\r\n      } else {\r\n        options.max = position[axis];\r\n      }\r\n\r\n      if (is(shape, \"bpmn:TextAnnotation\")) {\r\n        if (isHorizontal(axis)) {\r\n          options.offset = -shape.width / 2;\r\n        } else {\r\n          options.offset = -shape.height / 2;\r\n        }\r\n      }\r\n\r\n      position[axis] = gridSnapping.snapValue(position[axis], options);\r\n    });\r\n\r\n    // must be returned to be considered by auto place\r\n    return position;\r\n  });\r\n}\r\n\r\nAutoPlaceBehavior.$inject = [\"eventBus\", \"gridSnapping\"];\r\n\r\n// helpers //////////\r\n\r\nfunction isHorizontal(axis) {\r\n  return axis === \"x\";\r\n}\r\n","import { is } from \"../../../util/ModelUtil\";\r\n\r\nlet HIGHER_PRIORITY = 1750;\r\n\r\nexport default function CreateParticipantBehavior(\r\n  canvas,\r\n  eventBus,\r\n  gridSnapping\r\n) {\r\n  eventBus.on([\"create.start\", \"shape.move.start\"], HIGHER_PRIORITY, function (\r\n    event\r\n  ) {\r\n    let context = event.context,\r\n      shape = context.shape,\r\n      rootElement = canvas.getRootElement();\r\n\r\n    if (\r\n      !is(shape, \"bpmn:Participant\") ||\r\n      !is(rootElement, \"bpmn:Process-action\") ||\r\n      !rootElement.children.length\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    let createConstraints = context.createConstraints;\r\n\r\n    if (!createConstraints) {\r\n      return;\r\n    }\r\n\r\n    shape.width = gridSnapping.snapValue(shape.width, { min: shape.width });\r\n    shape.height = gridSnapping.snapValue(shape.height, { min: shape.height });\r\n  });\r\n}\r\n\r\nCreateParticipantBehavior.$inject = [\"canvas\", \"eventBus\", \"gridSnapping\"];\r\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { pointsAligned } from \"diagram-js/lib/util/Geometry\";\n\nimport { assign } from \"min-dash\";\n\nlet HIGH_PRIORITY = 3000;\n\n/**\n * Snaps connections with Manhattan layout.\n */\nexport default function LayoutConnectionBehavior(\n  eventBus,\n  gridSnapping,\n  modeling\n) {\n  CommandInterceptor.call(this, eventBus);\n\n  this._gridSnapping = gridSnapping;\n\n  let self = this;\n\n  this.postExecuted(\n    [\"connection.create\", \"connection.layout\"],\n    HIGH_PRIORITY,\n    function (event) {\n      let context = event.context,\n        connection = context.connection,\n        hints = context.hints || {},\n        waypoints = connection.waypoints;\n\n      if (\n        hints.connectionStart ||\n        hints.connectionEnd ||\n        hints.createElementsBehavior === false\n      ) {\n        return;\n      }\n\n      if (!hasMiddleSegments(waypoints)) {\n        return;\n      }\n\n      modeling.updateWaypoints(connection, self.snapMiddleSegments(waypoints));\n    }\n  );\n}\n\nLayoutConnectionBehavior.$inject = [\"eventBus\", \"gridSnapping\", \"modeling\"];\n\ninherits(LayoutConnectionBehavior, CommandInterceptor);\n\n/**\n * Snap middle segments of a given connection.\n *\n * @param {Array<Point>} waypoints\n *\n * @returns {Array<Point>}\n */\nLayoutConnectionBehavior.prototype.snapMiddleSegments = function (waypoints) {\n  let gridSnapping = this._gridSnapping,\n    snapped;\n\n  waypoints = waypoints.slice();\n\n  for (let i = 1; i < waypoints.length - 2; i++) {\n    snapped = snapSegment(gridSnapping, waypoints[i], waypoints[i + 1]);\n\n    waypoints[i] = snapped[0];\n    waypoints[i + 1] = snapped[1];\n  }\n\n  return waypoints;\n};\n\n// helpers //////////\n\n/**\n * Check whether a connection has a middle segments.\n *\n * @param {Array} waypoints\n *\n * @returns {boolean}\n */\nfunction hasMiddleSegments(waypoints) {\n  return waypoints.length > 3;\n}\n\n/**\n * Check whether an alignment is horizontal.\n *\n * @param {string} aligned\n *\n * @returns {boolean}\n */\nfunction horizontallyAligned(aligned) {\n  return aligned === \"h\";\n}\n\n/**\n * Check whether an alignment is vertical.\n *\n * @param {string} aligned\n *\n * @returns {boolean}\n */\nfunction verticallyAligned(aligned) {\n  return aligned === \"v\";\n}\n\n/**\n * Get middle segments from a given connection.\n *\n * @param {Array} waypoints\n *\n * @returns {Array}\n */\nfunction snapSegment(gridSnapping, segmentStart, segmentEnd) {\n  let aligned = pointsAligned(segmentStart, segmentEnd);\n\n  let snapped = {};\n\n  if (horizontallyAligned(aligned)) {\n    // snap horizontally\n    snapped.y = gridSnapping.snapValue(segmentStart.y);\n  }\n\n  if (verticallyAligned(aligned)) {\n    // snap vertically\n    snapped.x = gridSnapping.snapValue(segmentStart.x);\n  }\n\n  if (\"x\" in snapped || \"y\" in snapped) {\n    segmentStart = assign({}, segmentStart, snapped);\n    segmentEnd = assign({}, segmentEnd, snapped);\n  }\n\n  return [segmentStart, segmentEnd];\n}\n","import AutoPlaceBehavior from \"./AutoPlaceBehavior\";\r\nimport CreateParticipantBehavior from \"./CreateParticipantBehavior\";\r\nimport LayoutConnectionBehavior from \"./LayoutConnectionBehavior\";\r\n\r\nexport default {\r\n  __init__: [\r\n    \"gridSnappingAutoPlaceBehavior\",\r\n    \"gridSnappingCreateParticipantBehavior\",\r\n    \"gridSnappingLayoutConnectionBehavior\",\r\n  ],\r\n  gridSnappingAutoPlaceBehavior: [\"type\", AutoPlaceBehavior],\r\n  gridSnappingCreateParticipantBehavior: [\"type\", CreateParticipantBehavior],\r\n  gridSnappingLayoutConnectionBehavior: [\"type\", LayoutConnectionBehavior],\r\n};\r\n","import BpmnGridSnapping from \"./BpmnGridSnapping\";\r\nimport GridSnappingModule from \"diagram-js/lib/features/grid-snapping\";\r\n\r\nimport GridSnappingBehaviorModule from \"./behavior\";\r\n\r\nexport default {\r\n  __depends__: [GridSnappingModule, GridSnappingBehaviorModule],\r\n  __init__: [\"bpmnGridSnapping\"],\r\n  bpmnGridSnapping: [\"type\", BpmnGridSnapping],\r\n};\r\n","import { is } from \"../../util/ModelUtil\";\n\nimport { isExpanded } from \"../../util/DiUtil\";\n\nlet LABEL_WIDTH = 30,\n  LABEL_HEIGHT = 30;\n\n/**\n * BPMN-specific hit zones and interaction fixes.\n *\n * @param {EventBus} eventBus\n * @param {InteractionEvents} interactionEvents\n */\nexport default function BpmnInteractionEvents(eventBus, interactionEvents) {\n  this._interactionEvents = interactionEvents;\n\n  let self = this;\n\n  eventBus.on(\n    [\"interactionEvents.createHit\", \"interactionEvents.updateHit\"],\n    function (context) {\n      let element = context.element,\n        gfx = context.gfx;\n\n      if (is(element, \"bpmn:Lane\")) {\n        return self.createParticipantHit(element, gfx);\n      } else if (is(element, \"bpmn:Participant\")) {\n        if (isExpanded(element)) {\n          return self.createParticipantHit(element, gfx);\n        } else {\n          return self.createDefaultHit(element, gfx);\n        }\n      } else if (is(element, \"bpmn:Loop\")) {\n        if (isExpanded(element)) {\n          return self.createLoopHit(element, gfx);\n        } else {\n          return self.createDefaultHit(element, gfx);\n        }\n      } else if (is(element, \"bpmn:Conditional\")) {\n        if (isExpanded(element)) {\n          return self.createLoopHit(element, gfx);\n        } else {\n          return self.createDefaultHit(element, gfx);\n        }\n      }\n    }\n  );\n}\n\nBpmnInteractionEvents.$inject = [\"eventBus\", \"interactionEvents\"];\n\nBpmnInteractionEvents.prototype.createDefaultHit = function (element, gfx) {\n  this._interactionEvents.removeHits(gfx);\n\n  this._interactionEvents.createDefaultHit(element, gfx);\n\n  // indicate that we created a hit\n  return true;\n};\n\nBpmnInteractionEvents.prototype.createParticipantHit = function (element, gfx) {\n  // remove existing hits\n  this._interactionEvents.removeHits(gfx);\n\n  // add outline hit\n  this._interactionEvents.createBoxHit(gfx, \"click-stroke\", {\n    width: element.width,\n    height: element.height,\n  });\n\n  // add label hit\n  this._interactionEvents.createBoxHit(gfx, \"all\", {\n    width: LABEL_WIDTH,\n    height: element.height,\n  });\n\n  // indicate that we created a hit\n  return true;\n};\n\nBpmnInteractionEvents.prototype.createLoopHit = function (element, gfx) {\n  // remove existing hits\n  this._interactionEvents.removeHits(gfx);\n\n  // add outline hit\n  this._interactionEvents.createBoxHit(gfx, \"click-stroke\", {\n    width: element.width,\n    height: element.height,\n  });\n\n  // add label hit\n  this._interactionEvents.createBoxHit(gfx, \"all\", {\n    width: element.width,\n    height: LABEL_HEIGHT,\n  });\n\n  // indicate that we created a hit\n  return true;\n};\n","import BpmnInteractionEvents from \"./BpmnInteractionEvents\";\n\nexport default {\n  __init__: [\"bpmnInteractionEvents\"],\n  bpmnInteractionEvents: [\"type\", BpmnInteractionEvents],\n};\n","import inherits from \"inherits\";\n\nimport KeyboardBindings from \"diagram-js/lib/features/keyboard/KeyboardBindings\";\n\n/**\n * BPMN 2.0 specific keyboard bindings.\n *\n * @param {Injector} injector\n */\nexport default function BpmnKeyboardBindings(injector) {\n  injector.invoke(KeyboardBindings, this);\n}\n\ninherits(BpmnKeyboardBindings, KeyboardBindings);\n\nBpmnKeyboardBindings.$inject = [\"injector\"];\n\n/**\n * Register available keyboard bindings.\n *\n * @param {Keyboard} keyboard\n * @param {EditorActions} editorActions\n */\nBpmnKeyboardBindings.prototype.registerBindings = function (\n  keyboard,\n  editorActions\n) {\n  // inherit default bindings\n  KeyboardBindings.prototype.registerBindings.call(\n    this,\n    keyboard,\n    editorActions\n  );\n\n  /**\n   * Add keyboard binding if respective editor action\n   * is registered.\n   *\n   * @param {String} action name\n   * @param {Function} fn that implements the key binding\n   */\n  function addListener(action, fn) {\n    if (editorActions.isRegistered(action)) {\n      keyboard.addListener(fn);\n    }\n  }\n\n  // select all elements\n  // CTRL + A\n  addListener(\"selectElements\", function (context) {\n    let event = context.keyEvent;\n\n    if (keyboard.isKey([\"a\", \"A\"], event) && keyboard.isCmd(event)) {\n      editorActions.trigger(\"selectElements\");\n\n      return true;\n    }\n  });\n\n  // search labels\n  // CTRL + F\n  addListener(\"find\", function (context) {\n    let event = context.keyEvent;\n\n    if (keyboard.isKey([\"f\", \"F\"], event) && keyboard.isCmd(event)) {\n      editorActions.trigger(\"find\");\n\n      return true;\n    }\n  });\n\n  // activate space tool\n  // S\n  addListener(\"spaceTool\", function (context) {\n    let event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([\"s\", \"S\"], event)) {\n      editorActions.trigger(\"spaceTool\");\n\n      return true;\n    }\n  });\n\n  // activate lasso tool\n  // L\n  addListener(\"lassoTool\", function (context) {\n    let event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([\"l\", \"L\"], event)) {\n      editorActions.trigger(\"lassoTool\");\n\n      return true;\n    }\n  });\n\n  // activate hand tool\n  // H\n  addListener(\"handTool\", function (context) {\n    let event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([\"h\", \"H\"], event)) {\n      editorActions.trigger(\"handTool\");\n\n      return true;\n    }\n  });\n\n  // activate global connect tool\n  // C\n  addListener(\"globalConnectTool\", function (context) {\n    let event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([\"c\", \"C\"], event)) {\n      editorActions.trigger(\"globalConnectTool\");\n\n      return true;\n    }\n  });\n\n  // activate direct editing\n  // E\n  addListener(\"directEditing\", function (context) {\n    let event = context.keyEvent;\n\n    if (keyboard.hasModifier(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([\"e\", \"E\"], event)) {\n      editorActions.trigger(\"directEditing\");\n\n      return true;\n    }\n  });\n};\n","import KeyboardModule from \"diagram-js/lib/features/keyboard\";\n\nimport BpmnKeyboardBindings from \"./BpmnKeyboardBindings\";\n\nexport default {\n  __depends__: [KeyboardModule],\n  __init__: [\"keyboardBindings\"],\n  keyboardBindings: [\"type\", BpmnKeyboardBindings],\n};\n","import { add as collectionAdd } from \"diagram-js/lib/util/Collections\";\n\nimport { getBusinessObject } from \"../../../../util/ModelUtil\";\n\n/**\n * Creates a new bpmn:CategoryValue inside a new bpmn:Category\n *\n * @param {ModdleElement} definitions\n * @param {BpmnFactory} bpmnFactory\n *\n * @return {ModdleElement} categoryValue.\n */\nexport function createCategoryValue(definitions, bpmnFactory) {\n  let categoryValue = bpmnFactory.create(\"bpmn:CategoryValue\"),\n    category = bpmnFactory.create(\"bpmn:Category\", {\n      categoryValue: [categoryValue],\n    });\n\n  // add to correct place\n  collectionAdd(definitions.get(\"rootElements\"), category);\n  getBusinessObject(category).$parent = definitions;\n  getBusinessObject(categoryValue).$parent = category;\n\n  return categoryValue;\n}\n","import { assign } from \"min-dash\";\n\nimport { getLabel } from \"./LabelUtil\";\n\nimport { getBusinessObject, is } from \"../../util/ModelUtil\";\n\nimport { createCategoryValue } from \"../modeling/behavior/util/CategoryUtil\";\n\nimport { isAny } from \"../modeling/util/ModelingUtil\";\nimport { isExpanded } from \"../../util/DiUtil\";\n\nimport {\n  getExternalLabelMid,\n  isLabelExternal,\n  hasExternalLabel,\n  isLabel,\n} from \"../../util/LabelUtil\";\n\nexport default function LabelEditingProvider(\n  eventBus,\n  bpmnFactory,\n  canvas,\n  directEditing,\n  modeling,\n  resizeHandles,\n  textRenderer\n) {\n  this._bpmnFactory = bpmnFactory;\n  this._canvas = canvas;\n  this._modeling = modeling;\n  this._textRenderer = textRenderer;\n\n  directEditing.registerProvider(this);\n\n  // listen to dblclick on non-root elements\n  eventBus.on(\"element.dblclick\", function (event) {\n    activateDirectEdit(event.element, true);\n  });\n\n  // complete on followup canvas operation\n  eventBus.on(\n    [\n      \"autoPlace.start\",\n      \"canvas.viewbox.changing\",\n      \"drag.init\",\n      \"element.mousedown\",\n      \"popupMenu.open\",\n    ],\n    function (event) {\n      if (directEditing.isActive()) {\n        directEditing.complete();\n      }\n    }\n  );\n\n  // cancel on command stack changes\n  eventBus.on([\"commandStack.changed\"], function (e) {\n    if (directEditing.isActive()) {\n      directEditing.cancel();\n    }\n  });\n\n  eventBus.on(\"directEditing.activate\", function (event) {\n    resizeHandles.removeResizers();\n  });\n\n  eventBus.on(\"create.end\", 500, function (event) {\n    let context = event.context,\n      element = context.shape,\n      canExecute = event.context.canExecute,\n      isTouch = event.isTouch;\n\n    // TODO(nikku): we need to find a way to support the\n    // direct editing on mobile devices; right now this will\n    // break for desworkflowediting on mobile devices\n    // as it breaks the user interaction workflow\n\n    // TODO(nre): we should temporarily focus the edited element\n    // here and release the focused viewport after the direct edit\n    // operation is finished\n    if (isTouch) {\n      return;\n    }\n\n    if (!canExecute) {\n      return;\n    }\n\n    if (context.hints && context.hints.createElementsBehavior === false) {\n      return;\n    }\n\n    activateDirectEdit(element);\n  });\n\n  eventBus.on(\"autoPlace.end\", 500, function (event) {\n    activateDirectEdit(event.shape);\n  });\n\n  function activateDirectEdit(element, force) {\n    if (\n      force ||\n      isAny(element, [\"bpmn:Task\", \"bpmn:TextAnnotation\", \"bpmn:Group\"]) ||\n      isCollapsedLoop(element)\n    ) {\n      directEditing.activate(element);\n    }\n  }\n}\n\nLabelEditingProvider.$inject = [\n  \"eventBus\",\n  \"bpmnFactory\",\n  \"canvas\",\n  \"directEditing\",\n  \"modeling\",\n  \"resizeHandles\",\n  \"textRenderer\",\n];\n\n/**\n * Activate direct editing for activities and text annotations.\n *\n * @param  {djs.model.Base} element\n *\n * @return {Object} an object with properties bounds (position and size), text and options\n */\nLabelEditingProvider.prototype.activate = function (element) {\n  // text\n  let text = getLabel(element);\n\n  if (text === undefined) {\n    return;\n  }\n\n  let context = {\n    text: text,\n  };\n\n  // bounds\n  let bounds = this.getEditingBBox(element);\n\n  assign(context, bounds);\n\n  let options = {};\n\n  // tasks\n  if (\n    isAny(element, [\n      \"bpmn:Task\",\n      \"bpmn:Participant\",\n      \"bpmn:Lane\",\n      \"bpmn:CallActivity\",\n    ]) ||\n    isCollapsedLoop(element)\n  ) {\n    assign(options, {\n      centerVertically: true,\n    });\n  }\n\n  // external labels\n  if (isLabelExternal(element)) {\n    assign(options, {\n      autoResize: true,\n    });\n  }\n\n  // text annotations\n  if (is(element, \"bpmn:TextAnnotation\")) {\n    assign(options, {\n      resizable: true,\n      autoResize: true,\n    });\n  }\n\n  assign(context, {\n    options: options,\n  });\n\n  return context;\n};\n\n/**\n * Get the editing bounding box based on the element's size and position\n *\n * @param  {djs.model.Base} element\n *\n * @return {Object} an object containing information about position\n *                  and size (fixed or minimum and/or maximum)\n */\nLabelEditingProvider.prototype.getEditingBBox = function (element) {\n  let canvas = this._canvas;\n\n  let target = element.label || element;\n\n  let bbox = canvas.getAbsoluteBBox(target);\n\n  let mid = {\n    x: bbox.x + bbox.width / 2,\n    y: bbox.y + bbox.height / 2,\n  };\n\n  // default position\n  let bounds = { x: bbox.x, y: bbox.y };\n\n  let zoom = canvas.zoom();\n\n  let defaultStyle = this._textRenderer.getDefaultStyle(),\n    externalStyle = this._textRenderer.getExternalStyle();\n\n  // take zoom into account\n  let externalFontSize = externalStyle.fontSize * zoom,\n    externalLineHeight = externalStyle.lineHeight,\n    defaultFontSize = defaultStyle.fontSize * zoom,\n    defaultLineHeight = defaultStyle.lineHeight;\n\n  let style = {\n    fontFamily: this._textRenderer.getDefaultStyle().fontFamily,\n    fontWeight: this._textRenderer.getDefaultStyle().fontWeight,\n  };\n\n  // adjust for expanded pools AND lanes\n  if (is(element, \"bpmn:Lane\") || isExpandedPool(element)) {\n    assign(bounds, {\n      width: bbox.height,\n      height: 30 * zoom,\n      x: bbox.x - bbox.height / 2 + 15 * zoom,\n      y: mid.y - (30 * zoom) / 2,\n    });\n\n    assign(style, {\n      fontSize: defaultFontSize + \"px\",\n      lineHeight: defaultLineHeight,\n      paddingTop: 7 * zoom + \"px\",\n      paddingBottom: 7 * zoom + \"px\",\n      paddingLeft: 5 * zoom + \"px\",\n      paddingRight: 5 * zoom + \"px\",\n      transform: \"rotate(-90deg)\",\n    });\n  }\n\n  // internal labels for tasks and collapsed call activities,\n  // sub processes and participants\n  if (\n    isAny(element, [\"bpmn:Task\", \"bpmn:CallActivity\"]) ||\n    isCollapsedPool(element) ||\n    isCollapsedLoop(element)\n  ) {\n    assign(bounds, {\n      width: bbox.width,\n      height: bbox.height,\n    });\n\n    assign(style, {\n      fontSize: defaultFontSize + \"px\",\n      lineHeight: defaultLineHeight,\n      paddingTop: 7 * zoom + \"px\",\n      paddingBottom: 7 * zoom + \"px\",\n      paddingLeft: 5 * zoom + \"px\",\n      paddingRight: 5 * zoom + \"px\",\n    });\n  }\n\n  // internal labels for expanded sub processes\n  if (isExpandedLoop(element)) {\n    assign(bounds, {\n      width: bbox.width,\n      x: bbox.x,\n    });\n\n    assign(style, {\n      fontSize: defaultFontSize + \"px\",\n      lineHeight: defaultLineHeight,\n      paddingTop: 7 * zoom + \"px\",\n      paddingBottom: 7 * zoom + \"px\",\n      paddingLeft: 5 * zoom + \"px\",\n      paddingRight: 5 * zoom + \"px\",\n    });\n  }\n\n  let width = 90 * zoom,\n    paddingTop = 7 * zoom,\n    paddingBottom = 4 * zoom;\n\n  // external labels for events, data elements, gateways, groups and connections\n  if (target.labelTarget) {\n    assign(bounds, {\n      width: width,\n      height: bbox.height + paddingTop + paddingBottom,\n      x: mid.x - width / 2,\n      y: bbox.y - paddingTop,\n    });\n\n    assign(style, {\n      fontSize: externalFontSize + \"px\",\n      lineHeight: externalLineHeight,\n      paddingTop: paddingTop + \"px\",\n      paddingBottom: paddingBottom + \"px\",\n    });\n  }\n\n  // external label not yet created\n  if (\n    isLabelExternal(target) &&\n    !hasExternalLabel(target) &&\n    !isLabel(target)\n  ) {\n    let externalLabelMid = getExternalLabelMid(element);\n\n    let absoluteBBox = canvas.getAbsoluteBBox({\n      x: externalLabelMid.x,\n      y: externalLabelMid.y,\n      width: 0,\n      height: 0,\n    });\n\n    let height = externalFontSize + paddingTop + paddingBottom;\n\n    assign(bounds, {\n      width: width,\n      height: height,\n      x: absoluteBBox.x - width / 2,\n      y: absoluteBBox.y - height / 2,\n    });\n\n    assign(style, {\n      fontSize: externalFontSize + \"px\",\n      lineHeight: externalLineHeight,\n      paddingTop: paddingTop + \"px\",\n      paddingBottom: paddingBottom + \"px\",\n    });\n  }\n\n  // text annotations\n  if (is(element, \"bpmn:TextAnnotation\")) {\n    assign(bounds, {\n      width: bbox.width,\n      height: bbox.height,\n      minWidth: 30 * zoom,\n      minHeight: 10 * zoom,\n    });\n\n    assign(style, {\n      textAlign: \"left\",\n      paddingTop: 5 * zoom + \"px\",\n      paddingBottom: 7 * zoom + \"px\",\n      paddingLeft: 7 * zoom + \"px\",\n      paddingRight: 5 * zoom + \"px\",\n      fontSize: defaultFontSize + \"px\",\n      lineHeight: defaultLineHeight,\n    });\n  }\n\n  return { bounds: bounds, style: style };\n};\n\nLabelEditingProvider.prototype.update = function (\n  element,\n  newLabel,\n  activeContextText,\n  bounds\n) {\n  let newBounds, bbox;\n\n  if (is(element, \"bpmn:TextAnnotation\")) {\n    bbox = this._canvas.getAbsoluteBBox(element);\n\n    newBounds = {\n      x: element.x,\n      y: element.y,\n      width: (element.width / bbox.width) * bounds.width,\n      height: (element.height / bbox.height) * bounds.height,\n    };\n  }\n\n  if (is(element, \"bpmn:Group\")) {\n    let businessObject = getBusinessObject(element);\n\n    // initialize categoryValue if not existing\n    if (!businessObject.categoryValueRef) {\n      let rootElement = this._canvas.getRootElement(),\n        definitions = getBusinessObject(rootElement).$parent;\n\n      let categoryValue = createCategoryValue(definitions, this._bpmnFactory);\n\n      getBusinessObject(element).categoryValueRef = categoryValue;\n    }\n  }\n\n  if (isEmptyText(newLabel)) {\n    newLabel = null;\n  }\n\n  this._modeling.updateLabel(element, newLabel, newBounds);\n};\n\n// helpers //////////////////////\n\nfunction isCollapsedLoop(element) {\n  return (\n    (is(element, \"bpmn:Loop\") && !isExpanded(element)) ||\n    (is(element, \"bpmn:Conditional\") && !isExpanded(element))\n  );\n}\n\nfunction isExpandedLoop(element) {\n  return (\n    (is(element, \"bpmn:Loop\") && isExpanded(element)) ||\n    (is(element, \"bpmn:Conditional\") && isExpanded(element))\n  );\n}\n\nfunction isCollapsedPool(element) {\n  return is(element, \"bpmn:Participant\") && !isExpanded(element);\n}\n\nfunction isExpandedPool(element) {\n  return is(element, \"bpmn:Participant\") && isExpanded(element);\n}\n\nfunction isEmptyText(label) {\n  return !label || !label.trim();\n}\n","import {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  remove as svgRemove,\n} from \"tiny-svg\";\n\nimport { getBusinessObject, is } from \"../../util/ModelUtil\";\n\nimport { translate } from \"diagram-js/lib/util/SvgTransformUtil\";\n\nlet MARKER_HIDDEN = \"djs-element-hidden\",\n  MARKER_LABEL_HIDDEN = \"djs-label-hidden\";\n\nexport default function LabelEditingPreview(\n  eventBus,\n  canvas,\n  elementRegistry,\n  pathMap\n) {\n  let self = this;\n\n  let defaultLayer = canvas.getDefaultLayer();\n\n  let element, absoluteElementBBox, gfx;\n\n  eventBus.on(\"directEditing.activate\", function (context) {\n    let activeProvider = context.active;\n\n    element = activeProvider.element.label || activeProvider.element;\n\n    // text annotation\n    if (is(element, \"bpmn:TextAnnotation\")) {\n      absoluteElementBBox = canvas.getAbsoluteBBox(element);\n\n      gfx = svgCreate(\"g\");\n\n      let textPathData = pathMap.getScaledPath(\"TEXT_ANNOTATION\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.0,\n          my: 0.0,\n        },\n      });\n\n      let path = (self.path = svgCreate(\"path\"));\n\n      svgAttr(path, {\n        d: textPathData,\n        strokeWidth: 2,\n        stroke: getStrokeColor(element),\n      });\n\n      svgAppend(gfx, path);\n\n      svgAppend(defaultLayer, gfx);\n\n      translate(gfx, element.x, element.y);\n    }\n\n    if (is(element, \"bpmn:TextAnnotation\") || element.labelTarget) {\n      canvas.addMarker(element, MARKER_HIDDEN);\n    } else if (\n      is(element, \"bpmn:Task\") ||\n      is(element, \"bpmn:CallActivity\") ||\n      is(element, \"bpmn:Loop\") ||\n      is(element, \"bpmn:Conditional\") ||\n      is(element, \"bpmn:Participant\")\n    ) {\n      canvas.addMarker(element, MARKER_LABEL_HIDDEN);\n    }\n  });\n\n  eventBus.on(\"directEditing.resize\", function (context) {\n    // text annotation\n    if (is(element, \"bpmn:TextAnnotation\")) {\n      let height = context.height,\n        dy = context.dy;\n\n      let newElementHeight = Math.max(\n        (element.height / absoluteElementBBox.height) * (height + dy),\n        0\n      );\n\n      let textPathData = pathMap.getScaledPath(\"TEXT_ANNOTATION\", {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: newElementHeight,\n        position: {\n          mx: 0.0,\n          my: 0.0,\n        },\n      });\n\n      svgAttr(self.path, {\n        d: textPathData,\n      });\n    }\n  });\n\n  eventBus.on([\"directEditing.complete\", \"directEditing.cancel\"], function (\n    context\n  ) {\n    let activeProvider = context.active;\n\n    if (activeProvider) {\n      canvas.removeMarker(\n        activeProvider.element.label || activeProvider.element,\n        MARKER_HIDDEN\n      );\n      canvas.removeMarker(element, MARKER_LABEL_HIDDEN);\n    }\n\n    element = undefined;\n    absoluteElementBBox = undefined;\n\n    if (gfx) {\n      svgRemove(gfx);\n\n      gfx = undefined;\n    }\n  });\n}\n\nLabelEditingPreview.$inject = [\n  \"eventBus\",\n  \"canvas\",\n  \"elementRegistry\",\n  \"pathMap\",\n];\n\n// helpers ///////////////////\n\nfunction getStrokeColor(element, defaultColor) {\n  let bo = getBusinessObject(element);\n\n  return bo.di.get(\"stroke\") || defaultColor || \"black\";\n}\n","import ChangeSupportModule from \"diagram-js/lib/features/change-support\";\nimport ResizeModule from \"diagram-js/lib/features/resize\";\nimport DirectEditingModule from \"diagram-js-direct-editing\";\n\nimport LabelEditingProvider from \"./LabelEditingProvider\";\nimport LabelEditingPreview from \"./LabelEditingPreview\";\n\nexport default {\n  __depends__: [ChangeSupportModule, ResizeModule, DirectEditingModule],\n  __init__: [\"labelEditingProvider\", \"labelEditingPreview\"],\n  labelEditingProvider: [\"type\", LabelEditingProvider],\n  labelEditingPreview: [\"type\", LabelEditingPreview],\n};\n","import inherits from \"inherits\";\n\nimport {\n  getOrientation,\n  getMid,\n  asTRBL,\n} from \"diagram-js/lib/layout/LayoutUtil\";\n\nimport { substract } from \"diagram-js/lib/util/Math\";\n\nimport { hasExternalLabel } from \"../../../util/LabelUtil\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nlet ALIGNMENTS = [\"top\", \"bottom\", \"left\", \"right\"];\n\nlet ELEMENT_LABEL_DISTANCE = 10;\n\n/**\n * A component that makes sure that external labels are added\n * together with respective elements and properly updated (DI wise)\n * during move.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function AdaptiveLabelPositioningBehavior(eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  this.postExecuted(\n    [\"connection.create\", \"connection.layout\", \"connection.updateWaypoints\"],\n    function (event) {\n      let context = event.context,\n        connection = context.connection,\n        source = connection.source,\n        target = connection.target,\n        hints = context.hints || {};\n\n      if (hints.createElementsBehavior !== false) {\n        checkLabelAdjustment(source);\n        checkLabelAdjustment(target);\n      }\n    }\n  );\n\n  this.postExecuted([\"label.create\"], function (event) {\n    let context = event.context,\n      shape = context.shape,\n      hints = context.hints || {};\n\n    if (hints.createElementsBehavior !== false) {\n      checkLabelAdjustment(shape.labelTarget);\n    }\n  });\n\n  this.postExecuted([\"elements.create\"], function (event) {\n    let context = event.context,\n      elements = context.elements,\n      hints = context.hints || {};\n\n    if (hints.createElementsBehavior !== false) {\n      elements.forEach(function (element) {\n        checkLabelAdjustment(element);\n      });\n    }\n  });\n\n  function checkLabelAdjustment(element) {\n    // skip non-existing labels\n    if (!hasExternalLabel(element)) {\n      return;\n    }\n\n    let optimalPosition = getOptimalPosition(element);\n\n    // no optimal position found\n    if (!optimalPosition) {\n      return;\n    }\n\n    adjustLabelPosition(element, optimalPosition);\n  }\n\n  function adjustLabelPosition(element, orientation) {\n    let elementMid = getMid(element),\n      label = element.label,\n      labelMid = getMid(label);\n\n    // ignore labels that are being created\n    if (!label.parent) {\n      return;\n    }\n\n    let elementTrbl = asTRBL(element);\n\n    let newLabelMid;\n\n    switch (orientation) {\n      case \"top\":\n        newLabelMid = {\n          x: elementMid.x,\n          y: elementTrbl.top - ELEMENT_LABEL_DISTANCE - label.height / 2,\n        };\n\n        break;\n\n      case \"left\":\n        newLabelMid = {\n          x: elementTrbl.left - ELEMENT_LABEL_DISTANCE - label.width / 2,\n          y: elementMid.y,\n        };\n\n        break;\n\n      case \"bottom\":\n        newLabelMid = {\n          x: elementMid.x,\n          y: elementTrbl.bottom + ELEMENT_LABEL_DISTANCE + label.height / 2,\n        };\n\n        break;\n\n      case \"right\":\n        newLabelMid = {\n          x: elementTrbl.right + ELEMENT_LABEL_DISTANCE + label.width / 2,\n          y: elementMid.y,\n        };\n\n        break;\n      default:\n        break;\n    }\n\n    let delta = substract(newLabelMid, labelMid);\n\n    modeling.moveShape(label, delta);\n  }\n}\n\ninherits(AdaptiveLabelPositioningBehavior, CommandInterceptor);\n\nAdaptiveLabelPositioningBehavior.$inject = [\"eventBus\", \"modeling\"];\n\n// helpers //////////////////////\n\n/**\n * Return alignments which are taken by a boundary's host element\n *\n * @param {Shape} element\n *\n * @return {Array<String>}\n */\nfunction getTakenHostAlignments(element) {\n  let hostElement = element.host,\n    elementMid = getMid(element),\n    hostOrientation = getOrientation(elementMid, hostElement);\n\n  let freeAlignments;\n\n  // check whether there is a multi-orientation, e.g. 'top-left'\n  if (hostOrientation.indexOf(\"-\") >= 0) {\n    freeAlignments = hostOrientation.split(\"-\");\n  } else {\n    freeAlignments = [hostOrientation];\n  }\n\n  let takenAlignments = ALIGNMENTS.filter(function (alignment) {\n    return freeAlignments.indexOf(alignment) === -1;\n  });\n\n  return takenAlignments;\n}\n\n/**\n * Return alignments which are taken by related connections\n *\n * @param {Shape} element\n *\n * @return {Array<String>}\n */\nfunction getTakenConnectionAlignments(element) {\n  let elementMid = getMid(element);\n\n  let takenAlignments = []\n    .concat(\n      element.incoming.map(function (c) {\n        return c.waypoints[c.waypoints.length - 2];\n      }),\n      element.outgoing.map(function (c) {\n        return c.waypoints[1];\n      })\n    )\n    .map(function (point) {\n      return getApproximateOrientation(elementMid, point);\n    });\n\n  return takenAlignments;\n}\n\n/**\n * Return the optimal label position around an element\n * or _undefined_, if none was found.\n *\n * @param  {Shape} element\n *\n * @return {String} positioning identifier\n */\nfunction getOptimalPosition(element) {\n  let labelMid = getMid(element.label);\n\n  let elementMid = getMid(element);\n\n  let labelOrientation = getApproximateOrientation(elementMid, labelMid);\n\n  if (!isAligned(labelOrientation)) {\n    return;\n  }\n\n  let takenAlignments = getTakenConnectionAlignments(element);\n\n  if (element.host) {\n    let takenHostAlignments = getTakenHostAlignments(element);\n\n    takenAlignments = takenAlignments.concat(takenHostAlignments);\n  }\n\n  let freeAlignments = ALIGNMENTS.filter(function (alignment) {\n    return takenAlignments.indexOf(alignment) === -1;\n  });\n\n  // NOTHING TO DO; label already aligned a.O.K.\n  if (freeAlignments.indexOf(labelOrientation) !== -1) {\n    return;\n  }\n\n  return freeAlignments[0];\n}\n\nfunction getApproximateOrientation(p0, p1) {\n  return getOrientation(p1, p0, 5);\n}\n\nfunction isAligned(orientation) {\n  return ALIGNMENTS.indexOf(orientation) !== -1;\n}\n","import inherits from \"inherits\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nexport default function AppendBehavior(eventBus, elementFactory, bpmnRules) {\n  CommandInterceptor.call(this, eventBus);\n\n  // assign correct shape position unless already set\n\n  this.preExecute(\n    \"shape.append\",\n    function (context) {\n      let source = context.source,\n        shape = context.shape;\n\n      if (!context.position) {\n        if (is(shape, \"bpmn:TextAnnotation\")) {\n          context.position = {\n            x: source.x + source.width / 2 + 75,\n            y: source.y - 50 - shape.height / 2,\n          };\n        } else {\n          context.position = {\n            x: source.x + source.width + 80 + shape.width / 2,\n            y: source.y + source.height / 2,\n          };\n        }\n      }\n    },\n    true\n  );\n}\n\ninherits(AppendBehavior, CommandInterceptor);\n\nAppendBehavior.$inject = [\"eventBus\", \"elementFactory\", \"bpmnRules\"];\n","import inherits from \"inherits\";\r\n\r\nimport { is } from \"../../../util/ModelUtil\";\r\n\r\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\r\n\r\nimport { filter, forEach } from \"min-dash\";\r\n\r\nexport default function AssociationBehavior(injector, modeling) {\r\n  injector.invoke(CommandInterceptor, this);\r\n\r\n  this.postExecute(\r\n    \"shape.move\",\r\n    function (context) {\r\n      let newParent = context.newParent,\r\n        shape = context.shape;\r\n\r\n      let associations = filter(\r\n        shape.incoming.concat(shape.outgoing),\r\n        function (connection) {\r\n          return is(connection, \"bpmn:Association\");\r\n        }\r\n      );\r\n\r\n      forEach(associations, function (association) {\r\n        modeling.moveConnection(association, { x: 0, y: 0 }, newParent);\r\n      });\r\n    },\r\n    true\r\n  );\r\n}\r\n\r\ninherits(AssociationBehavior, CommandInterceptor);\r\n\r\nAssociationBehavior.$inject = [\"injector\", \"modeling\"];\r\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { getBusinessObject } from \"../../../util/ModelUtil\";\n\nimport { isAny } from \"../util/ModelingUtil\";\n\nimport { isLabel } from \"../../../util/LabelUtil\";\n\nlet LOW_PRIORITY = 500;\n\n/**\n * Replace intermediate event with boundary event when creating or moving results in attached event.\n */\nexport default function AttachEventBehavior(bpmnReplace, injector) {\n  injector.invoke(CommandInterceptor, this);\n\n  this._bpmnReplace = bpmnReplace;\n\n  let self = this;\n\n  this.postExecuted(\n    \"elements.create\",\n    LOW_PRIORITY,\n    function (context) {\n      let elements = context.elements;\n\n      elements = elements.filter(function (shape) {\n        let host = shape.host;\n\n        return shouldReplace(shape, host);\n      });\n\n      if (elements.length !== 1) {\n        return;\n      }\n\n      elements\n        .map(function (element) {\n          return elements.indexOf(element);\n        })\n        .forEach(function (index) {\n          let host = elements[index];\n\n          context.elements[index] = self.replaceShape(elements[index], host);\n        });\n    },\n    true\n  );\n\n  this.preExecute(\n    \"elements.move\",\n    LOW_PRIORITY,\n    function (context) {\n      let shapes = context.shapes,\n        host = context.newHost;\n\n      if (shapes.length !== 1) {\n        return;\n      }\n\n      let shape = shapes[0];\n\n      if (shouldReplace(shape, host)) {\n        context.shapes = [self.replaceShape(shape, host)];\n      }\n    },\n    true\n  );\n}\n\nAttachEventBehavior.$inject = [\"bpmnReplace\", \"injector\"];\n\ninherits(AttachEventBehavior, CommandInterceptor);\n\nAttachEventBehavior.prototype.replaceShape = function (shape, host) {\n  let eventDefinition = getEventDefinition(shape);\n\n  let boundaryEvent = {\n    type: \"bpmn:BoundaryEvent\",\n    host: host,\n  };\n\n  if (eventDefinition) {\n    boundaryEvent.eventDefinitionType = eventDefinition.$type;\n  }\n\n  return this._bpmnReplace.replaceElement(shape, boundaryEvent, {\n    layoutConnection: false,\n  });\n};\n\n// helpers //////////\n\nfunction getEventDefinition(element) {\n  let businessObject = getBusinessObject(element),\n    eventDefinitions = businessObject.eventDefinitions;\n\n  return eventDefinitions && eventDefinitions[0];\n}\n\nfunction shouldReplace(shape, host) {\n  return (\n    !isLabel(shape) &&\n    isAny(shape, [\n      \"bpmn:IntermediateThrowEvent\",\n      \"bpmn:IntermediateCatchEvent\",\n    ]) &&\n    !!host\n  );\n}\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\nimport { filter, forEach } from \"min-dash\";\n\n/**\n * BPMN specific boundary event behavior\n */\nexport default function BoundaryEventBehavior(eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  function getBoundaryEvents(element) {\n    return filter(element.attachers, function (attacher) {\n      return is(attacher, \"bpmn:BoundaryEvent\");\n    });\n  }\n\n  // remove after connecting to event-based gateway\n  this.postExecute(\"connection.create\", function (event) {\n    let source = event.context.source,\n      target = event.context.target,\n      boundaryEvents = getBoundaryEvents(target);\n\n    if (\n      is(source, \"bpmn:EventBasedGateway\") &&\n      is(target, \"bpmn:ReceiveTask\") &&\n      boundaryEvents.length > 0\n    ) {\n      modeling.removeElements(boundaryEvents);\n    }\n  });\n\n  // remove after replacing connected gateway with event-based gateway\n  this.postExecute(\"connection.reconnect\", function (event) {\n    let oldSource = event.context.oldSource,\n      newSource = event.context.newSource;\n\n    if (\n      is(oldSource, \"bpmn:Gateway\") &&\n      is(newSource, \"bpmn:EventBasedGateway\")\n    ) {\n      forEach(newSource.outgoing, function (connection) {\n        let target = connection.target,\n          attachedboundaryEvents = getBoundaryEvents(target);\n\n        if (\n          is(target, \"bpmn:ReceiveTask\") &&\n          attachedboundaryEvents.length > 0\n        ) {\n          modeling.removeElements(attachedboundaryEvents);\n        }\n      });\n    }\n  });\n}\n\nBoundaryEventBehavior.$inject = [\"eventBus\", \"modeling\"];\n\ninherits(BoundaryEventBehavior, CommandInterceptor);\n","import inherits from \"inherits\";\r\n\r\nimport { find, isArray, matchPattern, some } from \"min-dash\";\r\n\r\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\r\n\r\nimport {\r\n  add as collectionAdd,\r\n  remove as collectionRemove,\r\n} from \"diagram-js/lib/util/Collections\";\r\n\r\nimport { getBusinessObject, is } from \"../../../util/ModelUtil\";\r\n\r\nimport { isAny } from \"../util/ModelingUtil\";\r\n\r\nimport { hasEventDefinition } from \"../../../util/DiUtil\";\r\n\r\nconst LOW_PRIORITY = 500;\r\n\r\n/**\r\n * Add referenced root elements (error, escalation, message, signal) if they don't exist.\r\n * Copy referenced root elements on copy & paste.\r\n */\r\nexport default function RootElementReferenceBehavior(\r\n  bpmnjs,\r\n  eventBus,\r\n  injector,\r\n  moddleCopy,\r\n  bpmnFactory\r\n) {\r\n  injector.invoke(CommandInterceptor, this);\r\n\r\n  function canHaveRootElementReference(element) {\r\n    return (\r\n      isAny(element, [\"bpmn:ReceiveTask\", \"bpmn:SendTask\"]) ||\r\n      hasAnyEventDefinition(element, [\r\n        \"bpmn:ErrorEventDefinition\",\r\n        \"bpmn:EscalationEventDefinition\",\r\n        \"bpmn:MessageEventDefinition\",\r\n        \"bpmn:SignalEventDefinition\",\r\n      ])\r\n    );\r\n  }\r\n\r\n  function hasRootElement(rootElement) {\r\n    let definitions = bpmnjs.getDefinitions(),\r\n      rootElements = definitions.get(\"rootElements\");\r\n\r\n    return !!find(rootElements, matchPattern({ id: rootElement.id }));\r\n  }\r\n\r\n  function getRootElementReferencePropertyName(eventDefinition) {\r\n    if (is(eventDefinition, \"bpmn:ErrorEventDefinition\")) {\r\n      return \"errorRef\";\r\n    } else if (is(eventDefinition, \"bpmn:EscalationEventDefinition\")) {\r\n      return \"escalationRef\";\r\n    } else if (is(eventDefinition, \"bpmn:MessageEventDefinition\")) {\r\n      return \"messageRef\";\r\n    } else if (is(eventDefinition, \"bpmn:SignalEventDefinition\")) {\r\n      return \"signalRef\";\r\n    }\r\n  }\r\n\r\n  function getRootElement(businessObject) {\r\n    if (isAny(businessObject, [\"bpmn:ReceiveTask\", \"bpmn:SendTask\"])) {\r\n      return businessObject.get(\"messageRef\");\r\n    }\r\n\r\n    let eventDefinitions = businessObject.get(\"eventDefinitions\"),\r\n      eventDefinition = eventDefinitions[0];\r\n\r\n    return eventDefinition.get(\r\n      getRootElementReferencePropertyName(eventDefinition)\r\n    );\r\n  }\r\n\r\n  function setRootElement(businessObject, rootElement) {\r\n    if (isAny(businessObject, [\"bpmn:ReceiveTask\", \"bpmn:SendTask\"])) {\r\n      return businessObject.set(\"messageRef\", rootElement);\r\n    }\r\n\r\n    let eventDefinitions = businessObject.get(\"eventDefinitions\"),\r\n      eventDefinition = eventDefinitions[0];\r\n\r\n    return eventDefinition.set(\r\n      getRootElementReferencePropertyName(eventDefinition),\r\n      rootElement\r\n    );\r\n  }\r\n\r\n  // create shape\r\n  this.executed(\r\n    \"shape.create\",\r\n    function (context) {\r\n      let shape = context.shape;\r\n\r\n      if (!canHaveRootElementReference(shape)) {\r\n        return;\r\n      }\r\n\r\n      let businessObject = getBusinessObject(shape),\r\n        rootElement = getRootElement(businessObject),\r\n        rootElements;\r\n\r\n      if (rootElement && !hasRootElement(rootElement)) {\r\n        rootElements = bpmnjs.getDefinitions().get(\"rootElements\");\r\n\r\n        // add root element\r\n        collectionAdd(rootElements, rootElement);\r\n\r\n        context.addedRootElement = rootElement;\r\n      }\r\n    },\r\n    true\r\n  );\r\n\r\n  this.reverted(\r\n    \"shape.create\",\r\n    function (context) {\r\n      let addedRootElement = context.addedRootElement;\r\n\r\n      if (!addedRootElement) {\r\n        return;\r\n      }\r\n\r\n      let rootElements = bpmnjs.getDefinitions().get(\"rootElements\");\r\n\r\n      // remove root element\r\n      collectionRemove(rootElements, addedRootElement);\r\n    },\r\n    true\r\n  );\r\n\r\n  eventBus.on(\"copyPaste.copyElement\", function (context) {\r\n    let descriptor = context.descriptor,\r\n      element = context.element;\r\n\r\n    if (!canHaveRootElementReference(element)) {\r\n      return;\r\n    }\r\n\r\n    let businessObject = getBusinessObject(element),\r\n      rootElement = getRootElement(businessObject);\r\n\r\n    if (rootElement) {\r\n      descriptor.referencedRootElement = rootElement;\r\n    }\r\n  });\r\n\r\n  eventBus.on(\"copyPaste.pasteElement\", LOW_PRIORITY, function (context) {\r\n    let descriptor = context.descriptor,\r\n      businessObject = descriptor.businessObject;\r\n\r\n    if (!canHaveRootElementReference(businessObject)) {\r\n      return;\r\n    }\r\n\r\n    let referencedRootElement = descriptor.referencedRootElement;\r\n\r\n    if (!referencedRootElement) {\r\n      return;\r\n    }\r\n\r\n    if (!hasRootElement(referencedRootElement)) {\r\n      referencedRootElement = moddleCopy.copyElement(\r\n        referencedRootElement,\r\n        bpmnFactory.create(referencedRootElement.$type)\r\n      );\r\n    }\r\n\r\n    setRootElement(businessObject, referencedRootElement);\r\n  });\r\n}\r\n\r\nRootElementReferenceBehavior.$inject = [\r\n  \"bpmnjs\",\r\n  \"eventBus\",\r\n  \"injector\",\r\n  \"moddleCopy\",\r\n  \"bpmnFactory\",\r\n];\r\n\r\ninherits(RootElementReferenceBehavior, CommandInterceptor);\r\n\r\n// helpers //////////\r\n\r\nfunction hasAnyEventDefinition(element, types) {\r\n  if (!isArray(types)) {\r\n    types = [types];\r\n  }\r\n\r\n  return some(types, function (type) {\r\n    return hasEventDefinition(element, type);\r\n  });\r\n}\r\n","import inherits from \"inherits\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { getParent } from \"../util/ModelingUtil\";\n\nexport default function CreateBehavior(injector) {\n  injector.invoke(CommandInterceptor, this);\n\n  this.preExecute(\"shape.create\", 1500, function (event) {\n    let context = event.context,\n      parent = context.parent,\n      shape = context.shape;\n\n    if (is(parent, \"bpmn:Lane\") && !is(shape, \"bpmn:Lane\")) {\n      context.parent = getParent(parent, \"bpmn:Participant\");\n    }\n  });\n}\n\nCreateBehavior.$inject = [\"injector\"];\n\ninherits(CreateBehavior, CommandInterceptor);\n","import { getLanesRoot } from \"../util/LaneUtil\";\r\n\r\nimport { is } from \"../../../util/ModelUtil\";\r\n\r\nimport { isAny } from \"../util/ModelingUtil\";\r\n\r\nlet HIGH_PRIORITY = 1500;\r\nlet HIGHEST_PRIORITY = 2000;\r\n\r\n/**\r\n * Correct hover targets in certain situations to improve diagram interaction.\r\n *\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function FixHoverBehavior(elementRegistry, eventBus, canvas) {\r\n  eventBus.on(\r\n    [\r\n      \"create.hover\",\r\n      \"create.move\",\r\n      \"create.end\",\r\n      \"shape.move.hover\",\r\n      \"shape.move.move\",\r\n      \"shape.move.end\",\r\n    ],\r\n    HIGH_PRIORITY,\r\n    function (event) {\r\n      let context = event.context,\r\n        shape = context.shape || event.shape,\r\n        hover = event.hover;\r\n\r\n      // ensure elements are not dropped onto a bpmn:Lane but onto\r\n      // the underlying bpmn:Participant\r\n      if (\r\n        is(hover, \"bpmn:Lane\") &&\r\n        !isAny(shape, [\"bpmn:Lane\", \"bpmn:Participant\"])\r\n      ) {\r\n        event.hover = getLanesRoot(hover);\r\n        event.hoverGfx = elementRegistry.getGraphics(event.hover);\r\n      }\r\n\r\n      let rootElement = canvas.getRootElement();\r\n\r\n      // ensure bpmn:Group and label elements are dropped\r\n      // always onto the root\r\n      if (\r\n        hover !== rootElement &&\r\n        (shape.labelTarget || is(shape, \"bpmn:Group\"))\r\n      ) {\r\n        event.hover = rootElement;\r\n        event.hoverGfx = elementRegistry.getGraphics(event.hover);\r\n      }\r\n    }\r\n  );\r\n\r\n  eventBus.on(\r\n    [\r\n      \"connect.hover\",\r\n      \"connect.out\",\r\n      \"connect.end\",\r\n      \"connect.cleanup\",\r\n      \"global-connect.hover\",\r\n      \"global-connect.out\",\r\n      \"global-connect.end\",\r\n      \"global-connect.cleanup\",\r\n    ],\r\n    HIGH_PRIORITY,\r\n    function (event) {\r\n      let hover = event.hover;\r\n\r\n      // ensure connections start/end on bpmn:Participant,\r\n      // not the underlying bpmn:Lane\r\n      if (is(hover, \"bpmn:Lane\")) {\r\n        event.hover = getLanesRoot(hover) || hover;\r\n        event.hoverGfx = elementRegistry.getGraphics(event.hover);\r\n      }\r\n    }\r\n  );\r\n\r\n  eventBus.on([\"bendpoint.move.hover\"], HIGH_PRIORITY, function (event) {\r\n    let context = event.context,\r\n      hover = event.hover,\r\n      type = context.type;\r\n\r\n    // ensure reconnect start/end on bpmn:Participant,\r\n    // not the underlying bpmn:Lane\r\n    if (is(hover, \"bpmn:Lane\") && /reconnect/.test(type)) {\r\n      event.hover = getLanesRoot(hover) || hover;\r\n      event.hoverGfx = elementRegistry.getGraphics(event.hover);\r\n    }\r\n  });\r\n\r\n  eventBus.on([\"connect.start\"], HIGH_PRIORITY, function (event) {\r\n    let context = event.context,\r\n      start = context.start;\r\n\r\n    // ensure connect start on bpmn:Participant,\r\n    // not the underlying bpmn:Lane\r\n    if (is(start, \"bpmn:Lane\")) {\r\n      context.start = getLanesRoot(start) || start;\r\n    }\r\n  });\r\n\r\n  // allow movement of participants from lanes\r\n  eventBus.on(\"shape.move.start\", HIGHEST_PRIORITY, function (event) {\r\n    let shape = event.shape;\r\n\r\n    if (is(shape, \"bpmn:Lane\")) {\r\n      event.shape = getLanesRoot(shape) || shape;\r\n    }\r\n  });\r\n}\r\n\r\nFixHoverBehavior.$inject = [\"elementRegistry\", \"eventBus\", \"canvas\"];\r\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\n/**\n * BPMN specific create data object behavior\n */\nexport default function CreateDataObjectBehavior(\n  eventBus,\n  bpmnFactory,\n  moddle\n) {\n  CommandInterceptor.call(this, eventBus);\n\n  this.preExecute(\"shape.create\", function (event) {\n    let context = event.context,\n      shape = context.shape;\n\n    if (is(shape, \"bpmn:DataObjectReference\") && shape.type !== \"label\") {\n      // create a DataObject every time a DataObjectReference is created\n      let dataObject = bpmnFactory.create(\"bpmn:DataObject\");\n\n      // set the reference to the DataObject\n      shape.businessObject.dataObjectRef = dataObject;\n    }\n  });\n}\n\nCreateDataObjectBehavior.$inject = [\"eventBus\", \"bpmnFactory\", \"moddle\"];\n\ninherits(CreateDataObjectBehavior, CommandInterceptor);\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\nimport { isLabel } from \"../../../util/LabelUtil\";\n\nimport { getBBox } from \"diagram-js/lib/util/Elements\";\n\nimport { assign, find } from \"min-dash\";\n\nimport { asTRBL } from \"diagram-js/lib/layout/LayoutUtil\";\n\nlet HORIZONTAL_PARTICIPANT_PADDING = 20,\n  VERTICAL_PARTICIPANT_PADDING = 20;\n\nexport let PARTICIPANT_BORDER_WIDTH = 30;\n\nlet HIGH_PRIORITY = 2000;\n\n/**\n * BPMN-specific behavior for creating participants.\n */\nexport default function CreateParticipantBehavior(canvas, eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  // fit participant\n  eventBus.on([\"create.start\", \"shape.move.start\"], HIGH_PRIORITY, function (\n    event\n  ) {\n    let context = event.context,\n      shape = context.shape,\n      rootElement = canvas.getRootElement();\n\n    if (\n      !is(shape, \"bpmn:Participant\") ||\n      !is(rootElement, \"bpmn:Process-action\") ||\n      !rootElement.children.length\n    ) {\n      return;\n    }\n\n    // ignore connections, groups and labels\n    let children = rootElement.children.filter(function (element) {\n      return (\n        !is(element, \"bpmn:Group\") &&\n        !isLabel(element) &&\n        !isConnection(element)\n      );\n    });\n\n    // ensure for available children to calculate bounds\n    if (!children.length) {\n      return;\n    }\n\n    let childrenBBox = getBBox(children);\n\n    let participantBounds = getParticipantBounds(shape, childrenBBox);\n\n    // assign width and height\n    assign(shape, participantBounds);\n\n    // assign create constraints\n    context.createConstraints = getParticipantCreateConstraints(\n      shape,\n      childrenBBox\n    );\n  });\n\n  // force hovering process when creating first participant\n  eventBus.on(\"create.start\", HIGH_PRIORITY, function (event) {\n    let context = event.context,\n      shape = context.shape,\n      rootElement = canvas.getRootElement(),\n      rootElementGfx = canvas.getGraphics(rootElement);\n\n    function ensureHoveringProcess(event) {\n      event.element = rootElement;\n      event.gfx = rootElementGfx;\n    }\n\n    if (is(shape, \"bpmn:Participant\") && is(rootElement, \"bpmn:Process-action\")) {\n      eventBus.on(\"element.hover\", HIGH_PRIORITY, ensureHoveringProcess);\n\n      eventBus.once(\"create.cleanup\", function () {\n        eventBus.off(\"element.hover\", ensureHoveringProcess);\n      });\n    }\n  });\n\n  function ensureCollaboration(context) {\n    let parent = context.parent,\n      collaboration;\n\n    let rootElement = canvas.getRootElement();\n\n    if (is(rootElement, \"bpmn:Collaboration\")) {\n      collaboration = rootElement;\n    } else {\n      // update root element by making collaboration\n      collaboration = modeling.makeCollaboration();\n\n      // re-use process when creating first participant\n      context.process = parent;\n    }\n\n    context.parent = collaboration;\n  }\n\n  // turn process into collaboration before adding participant\n  this.preExecute(\n    \"shape.create\",\n    function (context) {\n      let parent = context.parent,\n        shape = context.shape;\n\n      if (is(shape, \"bpmn:Participant\") && is(parent, \"bpmn:Process-action\")) {\n        ensureCollaboration(context);\n      }\n    },\n    true\n  );\n\n  this.execute(\n    \"shape.create\",\n    function (context) {\n      let process = context.process,\n        shape = context.shape;\n\n      if (process) {\n        context.oldProcessRef = shape.businessObject.processRef;\n\n        // re-use process when creating first participant\n        shape.businessObject.processRef = process.businessObject;\n      }\n    },\n    true\n  );\n\n  this.revert(\n    \"shape.create\",\n    function (context) {\n      let process = context.process,\n        shape = context.shape;\n\n      if (process) {\n        // re-use process when creating first participant\n        shape.businessObject.processRef = context.oldProcessRef;\n      }\n    },\n    true\n  );\n\n  this.postExecute(\n    \"shape.create\",\n    function (context) {\n      let process = context.process,\n        shape = context.shape;\n\n      if (process) {\n        // move children from process to participant\n        let processChildren = process.children.slice();\n\n        modeling.moveElements(processChildren, { x: 0, y: 0 }, shape);\n      }\n    },\n    true\n  );\n\n  // turn process into collaboration when creating participants\n  this.preExecute(\n    \"elements.create\",\n    HIGH_PRIORITY,\n    function (context) {\n      let elements = context.elements,\n        parent = context.parent,\n        participant;\n\n      let hasParticipants = findParticipant(elements);\n\n      if (hasParticipants && is(parent, \"bpmn:Process-action\")) {\n        ensureCollaboration(context);\n\n        participant = findParticipant(elements);\n\n        context.oldProcessRef = participant.businessObject.processRef;\n\n        // re-use process when creating first participant\n        participant.businessObject.processRef = parent.businessObject;\n      }\n    },\n    true\n  );\n\n  this.revert(\n    \"elements.create\",\n    function (context) {\n      let elements = context.elements,\n        process = context.process,\n        participant;\n\n      if (process) {\n        participant = findParticipant(elements);\n\n        // re-use process when creating first participant\n        participant.businessObject.processRef = context.oldProcessRef;\n      }\n    },\n    true\n  );\n\n  this.postExecute(\n    \"elements.create\",\n    function (context) {\n      let elements = context.elements,\n        process = context.process,\n        participant;\n\n      if (process) {\n        participant = findParticipant(elements);\n\n        // move children from process to first participant\n        let processChildren = process.children.slice();\n\n        modeling.moveElements(processChildren, { x: 0, y: 0 }, participant);\n      }\n    },\n    true\n  );\n}\n\nCreateParticipantBehavior.$inject = [\"canvas\", \"eventBus\", \"modeling\"];\n\ninherits(CreateParticipantBehavior, CommandInterceptor);\n\n// helpers //////////\n\nfunction getParticipantBounds(shape, childrenBBox) {\n  childrenBBox = {\n    width:\n      childrenBBox.width +\n      HORIZONTAL_PARTICIPANT_PADDING * 2 +\n      PARTICIPANT_BORDER_WIDTH,\n    height: childrenBBox.height + VERTICAL_PARTICIPANT_PADDING * 2,\n  };\n\n  let width = Math.max(shape.width, childrenBBox.width),\n    height = Math.max(shape.height, childrenBBox.height);\n\n  return {\n    x: -width / 2,\n    y: -height / 2,\n    width: width,\n    height: height,\n  };\n}\n\nfunction getParticipantCreateConstraints(shape, childrenBBox) {\n  childrenBBox = asTRBL(childrenBBox);\n\n  return {\n    bottom: childrenBBox.top + shape.height / 2 - VERTICAL_PARTICIPANT_PADDING,\n    left: childrenBBox.right - shape.width / 2 + HORIZONTAL_PARTICIPANT_PADDING,\n    top: childrenBBox.bottom - shape.height / 2 + VERTICAL_PARTICIPANT_PADDING,\n    right:\n      childrenBBox.left +\n      shape.width / 2 -\n      HORIZONTAL_PARTICIPANT_PADDING -\n      PARTICIPANT_BORDER_WIDTH,\n  };\n}\n\nfunction isConnection(element) {\n  return !!element.waypoints;\n}\n\nfunction findParticipant(elements) {\n  return find(elements, function (element) {\n    return is(element, \"bpmn:Participant\");\n  });\n}\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport {\n  add as collectionAdd,\n  remove as collectionRemove,\n} from \"diagram-js/lib/util/Collections\";\n\nimport { find } from \"min-dash\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\nlet TARGET_REF_PLACEHOLDER_NAME = \"__targetRef_placeholder\";\n\n/**\n * This behavior makes sure we always set a fake\n * DataInputAssociation#targetRef as demanded by the BPMN 2.0\n * XSD schema.\n *\n * The reference is set to a bpmn:Property{ name: '__targetRef_placeholder' }\n * which is created on the fly and cleaned up afterwards if not needed\n * anymore.\n *\n * @param {EventBus} eventBus\n * @param {BpmnFactory} bpmnFactory\n */\nexport default function DataInputAssociationBehavior(eventBus, bpmnFactory) {\n  CommandInterceptor.call(this, eventBus);\n\n  this.executed(\n    [\n      \"connection.create\",\n      \"connection.delete\",\n      \"connection.move\",\n      \"connection.reconnect\",\n    ],\n    ifDataInputAssociation(fixTargetRef)\n  );\n\n  this.reverted(\n    [\n      \"connection.create\",\n      \"connection.delete\",\n      \"connection.move\",\n      \"connection.reconnect\",\n    ],\n    ifDataInputAssociation(fixTargetRef)\n  );\n\n  function usesTargetRef(element, targetRef, removedConnection) {\n    let inputAssociations = element.get(\"dataInputAssociations\");\n\n    return find(inputAssociations, function (association) {\n      return (\n        association !== removedConnection && association.targetRef === targetRef\n      );\n    });\n  }\n\n  function getTargetRef(element, create) {\n    let properties = element.get(\"properties\");\n\n    let targetRefProp = find(properties, function (p) {\n      return p.name === TARGET_REF_PLACEHOLDER_NAME;\n    });\n\n    if (!targetRefProp && create) {\n      targetRefProp = bpmnFactory.create(\"bpmn:Property\", {\n        name: TARGET_REF_PLACEHOLDER_NAME,\n      });\n\n      collectionAdd(properties, targetRefProp);\n    }\n\n    return targetRefProp;\n  }\n\n  function cleanupTargetRef(element, connection) {\n    let targetRefProp = getTargetRef(element);\n\n    if (!targetRefProp) {\n      return;\n    }\n\n    if (!usesTargetRef(element, targetRefProp, connection)) {\n      collectionRemove(element.get(\"properties\"), targetRefProp);\n    }\n  }\n\n  /**\n   * Make sure targetRef is set to a valid property or\n   * `null` if the connection is detached.\n   *\n   * @param {Event} event\n   */\n  function fixTargetRef(event) {\n    let context = event.context,\n      connection = context.connection,\n      connectionBo = connection.businessObject,\n      target = connection.target,\n      targetBo = target && target.businessObject,\n      newTarget = context.newTarget,\n      newTargetBo = newTarget && newTarget.businessObject,\n      oldTarget = context.oldTarget || context.target,\n      oldTargetBo = oldTarget && oldTarget.businessObject;\n\n    let dataAssociation = connection.businessObject,\n      targetRefProp;\n\n    if (oldTargetBo && oldTargetBo !== targetBo) {\n      cleanupTargetRef(oldTargetBo, connectionBo);\n    }\n\n    if (newTargetBo && newTargetBo !== targetBo) {\n      cleanupTargetRef(newTargetBo, connectionBo);\n    }\n\n    if (targetBo) {\n      targetRefProp = getTargetRef(targetBo, true);\n      dataAssociation.targetRef = targetRefProp;\n    } else {\n      dataAssociation.targetRef = null;\n    }\n  }\n}\n\nDataInputAssociationBehavior.$inject = [\"eventBus\", \"bpmnFactory\"];\n\ninherits(DataInputAssociationBehavior, CommandInterceptor);\n\n/**\n * Only call the given function when the event\n * touches a bpmn:DataInputAssociation.\n *\n * @param {Function} fn\n * @return {Function}\n */\nfunction ifDataInputAssociation(fn) {\n  return function (event) {\n    let context = event.context,\n      connection = context.connection;\n\n    if (is(connection, \"bpmn:DataInputAssociation\")) {\n      return fn(event);\n    }\n  };\n}\n","export default function UpdateSemanticParentHandler(bpmnUpdater) {\r\n  this._bpmnUpdater = bpmnUpdater;\r\n}\r\n\r\nUpdateSemanticParentHandler.$inject = [\"bpmnUpdater\"];\r\n\r\nUpdateSemanticParentHandler.prototype.execute = function (context) {\r\n  let dataStoreBo = context.dataStoreBo,\r\n    newSemanticParent = context.newSemanticParent,\r\n    newDiParent = context.newDiParent;\r\n\r\n  context.oldSemanticParent = dataStoreBo.$parent;\r\n  context.oldDiParent = dataStoreBo.di.$parent;\r\n\r\n  // update semantic parent\r\n  this._bpmnUpdater.updateSemanticParent(dataStoreBo, newSemanticParent);\r\n\r\n  // update DI parent\r\n  this._bpmnUpdater.updateDiParent(dataStoreBo.di, newDiParent);\r\n};\r\n\r\nUpdateSemanticParentHandler.prototype.revert = function (context) {\r\n  let dataStoreBo = context.dataStoreBo,\r\n    oldSemanticParent = context.oldSemanticParent,\r\n    oldDiParent = context.oldDiParent;\r\n\r\n  // update semantic parent\r\n  this._bpmnUpdater.updateSemanticParent(dataStoreBo, oldSemanticParent);\r\n\r\n  // update DI parent\r\n  this._bpmnUpdater.updateDiParent(dataStoreBo.di, oldDiParent);\r\n};\r\n","import inherits from \"inherits\";\r\n\r\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\r\n\r\nimport { is } from \"../../../util/ModelUtil\";\r\n\r\nimport { isAny } from \"../util/ModelingUtil\";\r\n\r\nimport UpdateSemanticParentHandler from \"../cmd/UpdateSemanticParentHandler\";\r\n\r\n/**\r\n * BPMN specific data store behavior\r\n */\r\nexport default function DataStoreBehavior(\r\n  canvas,\r\n  commandStack,\r\n  elementRegistry,\r\n  eventBus\r\n) {\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n  commandStack.registerHandler(\r\n    \"dataStore.updateContainment\",\r\n    UpdateSemanticParentHandler\r\n  );\r\n\r\n  function getFirstParticipant() {\r\n    return elementRegistry.filter(function (element) {\r\n      return is(element, \"bpmn:Participant\");\r\n    })[0];\r\n  }\r\n\r\n  function getDataStores(element) {\r\n    return element.children.filter(function (child) {\r\n      return is(child, \"bpmn:DataStoreReference\") && !child.labelTarget;\r\n    });\r\n  }\r\n\r\n  function updateDataStoreParent(dataStore, newDataStoreParent) {\r\n    let dataStoreBo = dataStore.businessObject || dataStore;\r\n\r\n    newDataStoreParent = newDataStoreParent || getFirstParticipant();\r\n\r\n    if (newDataStoreParent) {\r\n      let newDataStoreParentBo =\r\n        newDataStoreParent.businessObject || newDataStoreParent;\r\n\r\n      commandStack.execute(\"dataStore.updateContainment\", {\r\n        dataStoreBo: dataStoreBo,\r\n        newSemanticParent:\r\n          newDataStoreParentBo.processRef || newDataStoreParentBo,\r\n        newDiParent: newDataStoreParentBo.di,\r\n      });\r\n    }\r\n  }\r\n\r\n  // disable auto-resize for data stores\r\n  this.preExecute(\"shape.create\", function (event) {\r\n    let context = event.context,\r\n      shape = context.shape;\r\n\r\n    if (is(shape, \"bpmn:DataStoreReference\") && shape.type !== \"label\") {\r\n      if (!context.hints) {\r\n        context.hints = {};\r\n      }\r\n\r\n      // prevent auto resizing\r\n      context.hints.autoResize = false;\r\n    }\r\n  });\r\n\r\n  // disable auto-resize for data stores\r\n  this.preExecute(\"elements.move\", function (event) {\r\n    let context = event.context,\r\n      shapes = context.shapes;\r\n\r\n    let dataStoreReferences = shapes.filter(function (shape) {\r\n      return is(shape, \"bpmn:DataStoreReference\");\r\n    });\r\n\r\n    if (dataStoreReferences.length) {\r\n      if (!context.hints) {\r\n        context.hints = {};\r\n      }\r\n\r\n      // prevent auto resizing for data store references\r\n      context.hints.autoResize = shapes.filter(function (shape) {\r\n        return !is(shape, \"bpmn:DataStoreReference\");\r\n      });\r\n    }\r\n  });\r\n\r\n  // update parent on data store created\r\n  this.postExecute(\"shape.create\", function (event) {\r\n    let context = event.context,\r\n      shape = context.shape,\r\n      parent = shape.parent;\r\n\r\n    if (\r\n      is(shape, \"bpmn:DataStoreReference\") &&\r\n      shape.type !== \"label\" &&\r\n      is(parent, \"bpmn:Collaboration\")\r\n    ) {\r\n      updateDataStoreParent(shape);\r\n    }\r\n  });\r\n\r\n  // update parent on data store moved\r\n  this.postExecute(\"shape.move\", function (event) {\r\n    let context = event.context,\r\n      shape = context.shape,\r\n      oldParent = context.oldParent,\r\n      parent = shape.parent;\r\n\r\n    if (is(oldParent, \"bpmn:Collaboration\")) {\r\n      // do nothing if not necessary\r\n      return;\r\n    }\r\n\r\n    if (\r\n      is(shape, \"bpmn:DataStoreReference\") &&\r\n      shape.type !== \"label\" &&\r\n      is(parent, \"bpmn:Collaboration\")\r\n    ) {\r\n      let participant = is(oldParent, \"bpmn:Participant\")\r\n        ? oldParent\r\n        : getAncestor(oldParent, \"bpmn:Participant\");\r\n\r\n      updateDataStoreParent(shape, participant);\r\n    }\r\n  });\r\n\r\n  // update data store parents on participant or loop deleted\r\n  this.postExecute(\"shape.delete\", function (event) {\r\n    let context = event.context,\r\n      shape = context.shape,\r\n      rootElement = canvas.getRootElement();\r\n\r\n    if (\r\n      isAny(shape, [\"bpmn:Participant\", \"bpmn:Loop\", \"bpmn:Conditional\"]) &&\r\n      is(rootElement, \"bpmn:Collaboration\")\r\n    ) {\r\n      getDataStores(rootElement)\r\n        .filter(function (dataStore) {\r\n          return isDescendant(dataStore, shape);\r\n        })\r\n        .forEach(function (dataStore) {\r\n          updateDataStoreParent(dataStore);\r\n        });\r\n    }\r\n  });\r\n\r\n  // update data store parents on collaboration -> process\r\n  this.postExecute(\"canvas.updateRoot\", function (event) {\r\n    let context = event.context,\r\n      oldRoot = context.oldRoot,\r\n      newRoot = context.newRoot;\r\n\r\n    let dataStores = getDataStores(oldRoot);\r\n\r\n    dataStores.forEach(function (dataStore) {\r\n      if (is(newRoot, \"bpmn:Process-action\")) {\r\n        updateDataStoreParent(dataStore, newRoot);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nDataStoreBehavior.$inject = [\r\n  \"canvas\",\r\n  \"commandStack\",\r\n  \"elementRegistry\",\r\n  \"eventBus\",\r\n];\r\n\r\ninherits(DataStoreBehavior, CommandInterceptor);\r\n\r\n// helpers //////////\r\n\r\nfunction isDescendant(descendant, ancestor) {\r\n  let descendantBo = descendant.businessObject || descendant,\r\n    ancestorBo = ancestor.businessObject || ancestor;\r\n\r\n  while (descendantBo.$parent) {\r\n    if (descendantBo.$parent === ancestorBo.processRef || ancestorBo) {\r\n      return true;\r\n    }\r\n\r\n    descendantBo = descendantBo.$parent;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction getAncestor(element, type) {\r\n  while (element.parent) {\r\n    if (is(element.parent, type)) {\r\n      return element.parent;\r\n    }\r\n\r\n    element = element.parent;\r\n  }\r\n}\r\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\nimport { getChildLanes } from \"../util/LaneUtil\";\n\nimport { eachElement } from \"diagram-js/lib/util/Elements\";\n\nlet LOW_PRIORITY = 500;\n\n/**\n * BPMN specific delete lane behavior\n */\nexport default function DeleteLaneBehavior(eventBus, modeling, spaceTool) {\n  CommandInterceptor.call(this, eventBus);\n\n  function compensateLaneDelete(shape, oldParent) {\n    let siblings = getChildLanes(oldParent);\n\n    let topAffected = [];\n    let bottomAffected = [];\n\n    eachElement(siblings, function (element) {\n      if (element.y > shape.y) {\n        bottomAffected.push(element);\n      } else {\n        topAffected.push(element);\n      }\n\n      return element.children;\n    });\n\n    if (!siblings.length) {\n      return;\n    }\n\n    let offset;\n\n    if (bottomAffected.length && topAffected.length) {\n      offset = shape.height / 2;\n    } else {\n      offset = shape.height;\n    }\n\n    let topAdjustments, bottomAdjustments;\n\n    if (topAffected.length) {\n      topAdjustments = spaceTool.calculateAdjustments(\n        topAffected,\n        \"y\",\n        offset,\n        shape.y - 10\n      );\n\n      spaceTool.makeSpace(\n        topAdjustments.movingShapes,\n        topAdjustments.resizingShapes,\n        { x: 0, y: offset },\n        \"s\"\n      );\n    }\n\n    if (bottomAffected.length) {\n      bottomAdjustments = spaceTool.calculateAdjustments(\n        bottomAffected,\n        \"y\",\n        -offset,\n        shape.y + shape.height + 10\n      );\n\n      spaceTool.makeSpace(\n        bottomAdjustments.movingShapes,\n        bottomAdjustments.resizingShapes,\n        { x: 0, y: -offset },\n        \"n\"\n      );\n    }\n  }\n\n  /**\n   * Adjust sizes of other lanes after lane deletion\n   */\n  this.postExecuted(\"shape.delete\", LOW_PRIORITY, function (event) {\n    let context = event.context,\n      hints = context.hints,\n      shape = context.shape,\n      oldParent = context.oldParent;\n\n    // only compensate lane deletes\n    if (!is(shape, \"bpmn:Lane\")) {\n      return;\n    }\n\n    // compensate root deletes only\n    if (hints && hints.nested) {\n      return;\n    }\n\n    compensateLaneDelete(shape, oldParent);\n  });\n}\n\nDeleteLaneBehavior.$inject = [\"eventBus\", \"modeling\", \"spaceTool\"];\n\ninherits(DeleteLaneBehavior, CommandInterceptor);\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { getBusinessObject, is } from \"../../../util/ModelUtil\";\n\nimport { isLabel } from \"../../../util/LabelUtil\";\n\nconst LOW_PRIORITY = 500;\n\n/**\n * Replace boundary event with intermediate event when creating or moving results in detached event.\n */\nexport default function DetachEventBehavior(bpmnReplace, injector) {\n  injector.invoke(CommandInterceptor, this);\n\n  this._bpmnReplace = bpmnReplace;\n\n  let self = this;\n\n  this.postExecuted(\n    \"elements.create\",\n    LOW_PRIORITY,\n    function (context) {\n      let elements = context.elements;\n\n      elements\n        .filter(function (shape) {\n          let host = shape.host;\n\n          return shouldReplace(shape, host);\n        })\n        .map(function (shape) {\n          return elements.indexOf(shape);\n        })\n        .forEach(function (index) {\n          context.elements[index] = self.replaceShape(elements[index]);\n        });\n    },\n    true\n  );\n\n  this.preExecute(\n    \"elements.move\",\n    LOW_PRIORITY,\n    function (context) {\n      let shapes = context.shapes,\n        newHost = context.newHost;\n\n      shapes.forEach(function (shape, index) {\n        let host = shape.host;\n\n        if (shouldReplace(shape, includes(shapes, host) ? host : newHost)) {\n          shapes[index] = self.replaceShape(shape);\n        }\n      });\n    },\n    true\n  );\n}\n\nDetachEventBehavior.$inject = [\"bpmnReplace\", \"injector\"];\n\ninherits(DetachEventBehavior, CommandInterceptor);\n\nDetachEventBehavior.prototype.replaceShape = function (shape) {\n  let eventDefinition = getEventDefinition(shape),\n    intermediateEvent;\n\n  if (eventDefinition) {\n    intermediateEvent = {\n      type: \"bpmn:IntermediateCatchEvent\",\n      eventDefinitionType: eventDefinition.$type,\n    };\n  } else {\n    intermediateEvent = {\n      type: \"bpmn:IntermediateThrowEvent\",\n    };\n  }\n\n  return this._bpmnReplace.replaceElement(shape, intermediateEvent, {\n    layoutConnection: false,\n  });\n};\n\n// helpers //////////\n\nfunction getEventDefinition(element) {\n  let businessObject = getBusinessObject(element),\n    eventDefinitions = businessObject.eventDefinitions;\n\n  return eventDefinitions && eventDefinitions[0];\n}\n\nfunction shouldReplace(shape, host) {\n  return !isLabel(shape) && is(shape, \"bpmn:BoundaryEvent\") && !host;\n}\n\nfunction includes(array, item) {\n  return array.indexOf(item) !== -1;\n}\n","import inherits from \"inherits\";\n\nimport { assign, filter, find, isNumber } from \"min-dash\";\n\nimport { getMid } from \"diagram-js/lib/layout/LayoutUtil\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { getApproxIntersection } from \"diagram-js/lib/util/LineIntersection\";\n\nexport default function DropOnFlowBehavior(eventBus, bpmnRules, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Reconnect start / end of a connection after\n   * dropping an element on a flow.\n   */\n\n  function insertShape(shape, targetFlow, positionOrBounds) {\n    let waypoints = targetFlow.waypoints,\n      waypointsBefore,\n      waypointsAfter,\n      dockingPoint,\n      // source,\n      // target,\n      incomingConnection,\n      outgoingConnection,\n      oldOutgoing = shape.outgoing.slice(),\n      oldIncoming = shape.incoming.slice();\n\n    let mid;\n\n    if (isNumber(positionOrBounds.width)) {\n      mid = getMid(positionOrBounds);\n    } else {\n      mid = positionOrBounds;\n    }\n\n    let intersection = getApproxIntersection(waypoints, mid);\n\n    if (intersection) {\n      waypointsBefore = waypoints.slice(0, intersection.index);\n      waypointsAfter = waypoints.slice(\n        intersection.index + (intersection.bendpoint ? 1 : 0)\n      );\n\n      // due to inaccuracy intersection might have been found\n      if (!waypointsBefore.length || !waypointsAfter.length) {\n        return;\n      }\n\n      dockingPoint = intersection.bendpoint\n        ? waypoints[intersection.index]\n        : mid;\n\n      // if last waypointBefore is inside shape's bounds, ignore docking point\n      if (\n        !isPointInsideBBox(shape, waypointsBefore[waypointsBefore.length - 1])\n      ) {\n        waypointsBefore.push(copy(dockingPoint));\n      }\n\n      // if first waypointAfter is inside shape's bounds, ignore docking point\n      if (!isPointInsideBBox(shape, waypointsAfter[0])) {\n        waypointsAfter.unshift(copy(dockingPoint));\n      }\n    }\n\n    // source = targetFlow.source;\n    // target = targetFlow.target;\n\n    // if (bpmnRules.canConnect(source, shape, targetFlow)) {\n    //   // reconnect source -> inserted shape\n    //   modeling.reconnectEnd(targetFlow, shape, waypointsBefore || mid);\n\n    //   incomingConnection = targetFlow;\n    // }\n\n    // if (bpmnRules.canConnect(shape, target, targetFlow)) {\n    //   if (!incomingConnection) {\n    //     // reconnect inserted shape -> end\n    //     modeling.reconnectStart(targetFlow, shape, waypointsAfter || mid);\n\n    //     outgoingConnection = targetFlow;\n    //   } else {\n    //     outgoingConnection = modeling.connect(shape, target, {\n    //       type: targetFlow.type,\n    //       waypoints: waypointsAfter,\n    //     });\n    //   }\n    // }\n\n    let duplicateConnections = [].concat(\n      (incomingConnection &&\n        filter(oldIncoming, function (connection) {\n          return connection.source === incomingConnection.source;\n        })) ||\n        [],\n\n      (outgoingConnection &&\n        filter(oldOutgoing, function (connection) {\n          return connection.target === outgoingConnection.target;\n        })) ||\n        []\n    );\n\n    if (duplicateConnections.length) {\n      modeling.removeElements(duplicateConnections);\n    }\n  }\n\n  this.preExecute(\n    \"elements.move\",\n    function (context) {\n      let newParent = context.newParent,\n        shapes = context.shapes,\n        delta = context.delta,\n        shape = shapes[0];\n\n      if (!shape || !newParent) {\n        return;\n      }\n\n      // if the new parent is a connection,\n      // change it to the new parent's parent\n      if (newParent && newParent.waypoints) {\n        context.newParent = newParent = newParent.parent;\n      }\n\n      let shapeMid = getMid(shape);\n      let newShapeMid = {\n        x: shapeMid.x + delta.x,\n        y: shapeMid.y + delta.y,\n      };\n\n      // find a connection which intersects with the\n      // element's mid point\n      let connection = find(newParent.children, function (element) {\n        let canInsert = bpmnRules.canInsert(shapes, element);\n\n        return (\n          canInsert && getApproxIntersection(element.waypoints, newShapeMid)\n        );\n      });\n\n      if (connection) {\n        context.targetFlow = connection;\n        context.position = newShapeMid;\n      }\n    },\n    true\n  );\n\n  this.postExecuted(\n    \"elements.move\",\n    function (context) {\n      let shapes = context.shapes,\n        targetFlow = context.targetFlow,\n        position = context.position;\n\n      if (targetFlow) {\n        insertShape(shapes[0], targetFlow, position);\n      }\n    },\n    true\n  );\n\n  this.preExecute(\n    \"shape.create\",\n    function (context) {\n      let parent = context.parent,\n        shape = context.shape;\n\n      if (bpmnRules.canInsert(shape, parent)) {\n        context.targetFlow = parent;\n        context.parent = parent.parent;\n      }\n    },\n    true\n  );\n\n  this.postExecuted(\n    \"shape.create\",\n    function (context) {\n      let shape = context.shape,\n        targetFlow = context.targetFlow,\n        positionOrBounds = context.position;\n\n      if (targetFlow) {\n        insertShape(shape, targetFlow, positionOrBounds);\n      }\n    },\n    true\n  );\n}\n\ninherits(DropOnFlowBehavior, CommandInterceptor);\n\nDropOnFlowBehavior.$inject = [\"eventBus\", \"bpmnRules\", \"modeling\"];\n\n// helpers /////////////////////\n\nfunction isPointInsideBBox(bbox, point) {\n  let x = point.x,\n    y = point.y;\n\n  return (\n    x >= bbox.x &&\n    x <= bbox.x + bbox.width &&\n    y >= bbox.y &&\n    y <= bbox.y + bbox.height\n  );\n}\n\nfunction copy(obj) {\n  return assign({}, obj);\n}\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\nexport default function EventBasedGatewayBehavior(eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Remove existing sequence flows of event-based target before connecting\n   * from event-based gateway.\n   */\n  this.preExecuted(\"connection.create\", function (event) {\n    let context = event.context,\n      source = context.source,\n      target = context.target,\n      existingIncomingConnections = target.incoming.slice();\n\n    if (context.hints && context.hints.createElementsBehavior === false) {\n      return;\n    }\n\n    if (is(source, \"bpmn:EventBasedGateway\") && target.incoming.length) {\n      existingIncomingConnections\n        .filter(isSequenceFlow)\n        .forEach(function (sequenceFlow) {\n          modeling.removeConnection(sequenceFlow);\n        });\n    }\n  });\n\n  /**\n   *  After replacing shape with event-based gateway, remove incoming sequence\n   *  flows of event-based targets which do not belong to event-based gateway\n   *  source.\n   */\n  this.preExecuted(\"shape.replace\", function (event) {\n    let newShape = event.context.newShape,\n      newShapeTargets,\n      newShapeTargetsIncomingSequenceFlows;\n\n    if (!is(newShape, \"bpmn:EventBasedGateway\")) {\n      return;\n    }\n\n    newShapeTargets = newShape.outgoing\n      .filter(isSequenceFlow)\n      .map(function (sequenceFlow) {\n        return sequenceFlow.target;\n      });\n\n    newShapeTargetsIncomingSequenceFlows = newShapeTargets.reduce(function (\n      sequenceFlows,\n      target\n    ) {\n      let incomingSequenceFlows = target.incoming.filter(isSequenceFlow);\n\n      return sequenceFlows.concat(incomingSequenceFlows);\n    },\n    []);\n\n    newShapeTargetsIncomingSequenceFlows.forEach(function (sequenceFlow) {\n      if (sequenceFlow.source !== newShape) {\n        modeling.removeConnection(sequenceFlow);\n      }\n    });\n  });\n}\n\nEventBasedGatewayBehavior.$inject = [\"eventBus\", \"modeling\"];\n\ninherits(EventBasedGatewayBehavior, CommandInterceptor);\n\n// helpers //////////////////////\n\nfunction isSequenceFlow(connection) {\n  return is(connection, \"bpmn:SequenceFlow\");\n}\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport {\n  add as collectionAdd,\n  remove as collectionRemove,\n} from \"diagram-js/lib/util/Collections\";\n\nimport { getBusinessObject, is } from \"../../../util/ModelUtil\";\n\nimport { createCategoryValue } from \"./util/CategoryUtil\";\n\nlet HIGH_PRIORITY = 2000;\n\n/**\n * BPMN specific Group behavior\n */\nexport default function GroupBehavior(\n  bpmnFactory,\n  canvas,\n  elementRegistry,\n  eventBus,\n  injector,\n  moddleCopy\n) {\n  injector.invoke(CommandInterceptor, this);\n\n  /**\n   * Gets process definitions\n   *\n   * @return {ModdleElement} definitions\n   */\n  function getDefinitions() {\n    let rootElement = canvas.getRootElement(),\n      businessObject = getBusinessObject(rootElement);\n\n    return businessObject.$parent;\n  }\n\n  /**\n   * Removes a referenced category value for a given group shape\n   *\n   * @param {djs.model.Shape} shape\n   */\n  function removeReferencedCategoryValue(shape) {\n    let businessObject = getBusinessObject(shape),\n      categoryValue = businessObject.categoryValueRef;\n\n    if (!categoryValue) {\n      return;\n    }\n\n    let category = categoryValue.$parent;\n\n    if (!categoryValue) {\n      return;\n    }\n\n    collectionRemove(category.categoryValue, categoryValue);\n\n    // cleanup category if it is empty\n    if (category && !category.categoryValue.length) {\n      removeCategory(category);\n    }\n  }\n\n  /**\n   * Removes a given category from the definitions\n   *\n   * @param {ModdleElement} category\n   */\n  function removeCategory(category) {\n    let definitions = getDefinitions();\n\n    collectionRemove(definitions.get(\"rootElements\"), category);\n  }\n\n  /**\n   * Returns all group element in the current registry\n   *\n   * @return {Array<djs.model.shape>} a list of group shapes\n   */\n  function getGroupElements() {\n    return elementRegistry.filter(function (e) {\n      return is(e, \"bpmn:Group\");\n    });\n  }\n\n  /**\n   * Returns true if given categoryValue is referenced in one of the given elements\n   *\n   * @param {Array<djs.model.shape>} elements\n   * @param {ModdleElement} categoryValue\n   * @return {Boolean}\n   */\n  function isReferenced(elements, categoryValue) {\n    return elements.some(function (e) {\n      let businessObject = getBusinessObject(e);\n\n      return (\n        businessObject.categoryValueRef &&\n        businessObject.categoryValueRef === categoryValue\n      );\n    });\n  }\n\n  /**\n   * remove referenced category + value when group was deleted\n   */\n  this.executed(\"shape.delete\", function (event) {\n    let context = event.context,\n      shape = context.shape;\n\n    if (is(shape, \"bpmn:Group\")) {\n      let businessObject = getBusinessObject(shape),\n        categoryValueRef = businessObject.categoryValueRef,\n        groupElements = getGroupElements();\n\n      if (!isReferenced(groupElements, categoryValueRef)) {\n        removeReferencedCategoryValue(shape);\n      }\n    }\n  });\n\n  /**\n   * re-attach removed category\n   */\n  this.reverted(\"shape.delete\", function (event) {\n    let context = event.context,\n      shape = context.shape;\n\n    if (is(shape, \"bpmn:Group\")) {\n      let businessObject = getBusinessObject(shape),\n        categoryValueRef = businessObject.categoryValueRef,\n        definitions = getDefinitions(),\n        category = categoryValueRef ? categoryValueRef.$parent : null;\n\n      collectionAdd(category.get(\"categoryValue\"), categoryValueRef);\n      collectionAdd(definitions.get(\"rootElements\"), category);\n    }\n  });\n\n  /**\n   * create new category + value when group was created\n   */\n  this.execute(\"shape.create\", function (event) {\n    let context = event.context,\n      shape = context.shape,\n      businessObject = getBusinessObject(shape);\n\n    if (is(businessObject, \"bpmn:Group\") && !businessObject.categoryValueRef) {\n      let definitions = getDefinitions(),\n        categoryValue = createCategoryValue(definitions, bpmnFactory);\n\n      // link the reference to the Group\n      businessObject.categoryValueRef = categoryValue;\n    }\n  });\n\n  this.revert(\"shape.create\", function (event) {\n    let context = event.context,\n      shape = context.shape;\n\n    if (is(shape, \"bpmn:Group\")) {\n      removeReferencedCategoryValue(shape);\n\n      delete getBusinessObject(shape).categoryValueRef;\n    }\n  });\n\n  // copy bpmn:CategoryValue when copying element\n  eventBus.on(\"moddleCopy.canCopyProperty\", HIGH_PRIORITY, function (context) {\n    let property = context.property,\n      categoryValue;\n\n    if (is(property, \"bpmn:CategoryValue\")) {\n      categoryValue = createCategoryValue(getDefinitions(), bpmnFactory);\n\n      // return copy of category\n      return moddleCopy.copyElement(property, categoryValue);\n    }\n  });\n}\n\nGroupBehavior.$inject = [\n  \"bpmnFactory\",\n  \"canvas\",\n  \"elementRegistry\",\n  \"eventBus\",\n  \"injector\",\n  \"moddleCopy\",\n];\n\ninherits(GroupBehavior, CommandInterceptor);\n","/**\n * Returns the intersection between two line segments a and b.\n *\n * @param {Point} l1s\n * @param {Point} l1e\n * @param {Point} l2s\n * @param {Point} l2e\n *\n * @return {Point}\n */\nexport default function lineIntersect(l1s, l1e, l2s, l2e) {\n  // if the lines intersect, the result contains the x and y of the\n  // intersection (treating the lines as infinite) and booleans for\n  // whether line segment 1 or line segment 2 contain the point\n  let denominator, a, b, c, numerator;\n\n  denominator =\n    (l2e.y - l2s.y) * (l1e.x - l1s.x) - (l2e.x - l2s.x) * (l1e.y - l1s.y);\n\n  if (denominator === 0) {\n    return null;\n  }\n\n  a = l1s.y - l2s.y;\n  b = l1s.x - l2s.x;\n  numerator = (l2e.x - l2s.x) * a - (l2e.y - l2s.y) * b;\n\n  c = numerator / denominator;\n\n  // if we cast these lines infinitely in\n  // both directions, they intersect here\n  return {\n    x: Math.round(l1s.x + c * (l1e.x - l1s.x)),\n    y: Math.round(l1s.y + c * (l1e.y - l1s.y)),\n  };\n}\n","import { getMid } from \"diagram-js/lib/layout/LayoutUtil\";\n\nimport lineIntersect from \"./util/LineIntersect\";\n\n/**\n * Fix broken dockings after DI imports.\n *\n * @param {EventBus} eventBus\n */\nexport default function ImportDockingFix(eventBus) {\n  function adjustDocking(startPoint, nextPoint, elementMid) {\n    let elementTop = {\n      x: elementMid.x,\n      y: elementMid.y - 50,\n    };\n\n    let elementLeft = {\n      x: elementMid.x - 50,\n      y: elementMid.y,\n    };\n\n    let verticalIntersect = lineIntersect(\n        startPoint,\n        nextPoint,\n        elementMid,\n        elementTop\n      ),\n      horizontalIntersect = lineIntersect(\n        startPoint,\n        nextPoint,\n        elementMid,\n        elementLeft\n      );\n\n    // original is horizontal or vertical center cross intersection\n    let centerIntersect;\n\n    if (verticalIntersect && horizontalIntersect) {\n      if (\n        getDistance(verticalIntersect, elementMid) >\n        getDistance(horizontalIntersect, elementMid)\n      ) {\n        centerIntersect = horizontalIntersect;\n      } else {\n        centerIntersect = verticalIntersect;\n      }\n    } else {\n      centerIntersect = verticalIntersect || horizontalIntersect;\n    }\n\n    startPoint.original = centerIntersect;\n  }\n\n  function fixDockings(connection) {\n    let waypoints = connection.waypoints;\n\n    adjustDocking(waypoints[0], waypoints[1], getMid(connection.source));\n\n    adjustDocking(\n      waypoints[waypoints.length - 1],\n      waypoints[waypoints.length - 2],\n      getMid(connection.target)\n    );\n  }\n\n  eventBus.on(\"bpmnElement.added\", function (e) {\n    let element = e.element;\n\n    if (element.waypoints) {\n      fixDockings(element);\n    }\n  });\n}\n\nImportDockingFix.$inject = [\"eventBus\"];\n\n// helpers //////////////////////\n\nfunction getDistance(p1, p2) {\n  return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));\n}\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { getBusinessObject } from \"../../../util/ModelUtil\";\n\nimport { isAny } from \"../util/ModelingUtil\";\n\n/**\n * A component that makes sure that each created or updated\n * Pool and Lane is assigned an isHorizontal property set to true.\n *\n * @param {EventBus} eventBus\n */\nexport default function IsHorizontalFix(eventBus) {\n  CommandInterceptor.call(this, eventBus);\n\n  let elementTypesToUpdate = [\"bpmn:Participant\", \"bpmn:Lane\"];\n\n  this.executed([\"shape.move\", \"shape.create\", \"shape.resize\"], function (\n    event\n  ) {\n    let bo = getBusinessObject(event.context.shape);\n\n    if (isAny(bo, elementTypesToUpdate) && !bo.di.get(\"isHorizontal\")) {\n      // set attribute directly to avoid modeling#updateProperty side effects\n      bo.di.set(\"isHorizontal\", true);\n    }\n  });\n}\n\nIsHorizontalFix.$inject = [\"eventBus\"];\n\ninherits(IsHorizontalFix, CommandInterceptor);\n","/**\n * Returns the length of a vector\n *\n * @param {Vector}\n * @return {Float}\n */\nexport function vectorLength(v) {\n  return Math.sqrt(Math.pow(v.x, 2) + Math.pow(v.y, 2));\n}\n\n/**\n * Calculates the angle between a line a the yAxis\n *\n * @param {Array}\n * @return {Float}\n */\nexport function getAngle(line) {\n  // return value is between 0, 180 and -180, -0\n  // @janstuemmel: maybe replace return a/b with b/a\n  return Math.atan((line[1].y - line[0].y) / (line[1].x - line[0].x));\n}\n\n/**\n * Rotates a vector by a given angle\n *\n * @param {Vector}\n * @param {Float} Angle in radians\n * @return {Vector}\n */\nexport function rotateVector(vector, angle) {\n  return !angle\n    ? vector\n    : {\n        x: Math.cos(angle) * vector.x - Math.sin(angle) * vector.y,\n        y: Math.sin(angle) * vector.x + Math.cos(angle) * vector.y,\n      };\n}\n\n/**\n * Solves a 2D equation system\n * a + r*b = c, where a,b,c are 2D vectors\n *\n * @param {Vector}\n * @param {Vector}\n * @param {Vector}\n * @return {Float}\n */\nfunction solveLambaSystem(a, b, c) {\n  // the 2d system\n  let system = [\n    { n: a[0] - c[0], lambda: b[0] },\n    { n: a[1] - c[1], lambda: b[1] },\n  ];\n\n  // solve\n  let n = system[0].n * b[0] + system[1].n * b[1],\n    l = system[0].lambda * b[0] + system[1].lambda * b[1];\n\n  return -n / l;\n}\n\n/**\n * Position of perpendicular foot\n *\n * @param {Point}\n * @param [ {Point}, {Point} ] line defined through two points\n * @return {Point} the perpendicular foot position\n */\nexport function perpendicularFoot(point, line) {\n  let a = line[0],\n    b = line[1];\n\n  // relative position of b from a\n  let bd = { x: b.x - a.x, y: b.y - a.y };\n\n  // solve equation system to the parametrized vectors param real value\n  let r = solveLambaSystem([a.x, a.y], [bd.x, bd.y], [point.x, point.y]);\n\n  return { x: a.x + r * bd.x, y: a.y + r * bd.y };\n}\n\n/**\n * Calculates the distance between a point and a line\n *\n * @param {Point}\n * @param [ {Point}, {Point} ] line defined through two points\n * @return {Float} distance\n */\nexport function getDistancePointLine(point, line) {\n  let pfPoint = perpendicularFoot(point, line);\n\n  // distance vector\n  let connectionVector = {\n    x: pfPoint.x - point.x,\n    y: pfPoint.y - point.y,\n  };\n\n  return vectorLength(connectionVector);\n}\n\n/**\n * Calculates the distance between two points\n *\n * @param {Point}\n * @param {Point}\n * @return {Float} distance\n */\nexport function getDistancePointPoint(point1, point2) {\n  return vectorLength({\n    x: point1.x - point2.x,\n    y: point1.y - point2.y,\n  });\n}\n","let sqrt = Math.sqrt,\n  min = Math.min,\n  max = Math.max,\n  abs = Math.abs;\n\n/**\n * Calculate the square (power to two) of a number.\n *\n * @param {Number} n\n *\n * @return {Number}\n */\nfunction sq(n) {\n  return Math.pow(n, 2);\n}\n\n/**\n * Get distance between two points.\n *\n * @param {Point} p1\n * @param {Point} p2\n *\n * @return {Number}\n */\nfunction getDistance(p1, p2) {\n  return sqrt(sq(p1.x - p2.x) + sq(p1.y - p2.y));\n}\n\n/**\n * Return the attachment of the given point on the specified line.\n *\n * The attachment is either a bendpoint (attached to the given point)\n * or segment (attached to a location on a line segment) attachment:\n *\n * ```javascript\n * let pointAttachment = {\n *   type: 'bendpoint',\n *   bendpointIndex: 3,\n *   position: { x: 10, y: 10 } // the attach point on the line\n * };\n *\n * let segmentAttachment = {\n *   type: 'segment',\n *   segmentIndex: 2,\n *   relativeLocation: 0.31, // attach point location between 0 (at start) and 1 (at end)\n *   position: { x: 10, y: 10 } // the attach point on the line\n * };\n * ```\n *\n * @param {Point} point\n * @param {Array<Point>} line\n *\n * @return {Object} attachment\n */\nexport function getAttachment(point, line) {\n  let idx = 0,\n    segmentStart,\n    segmentEnd,\n    segmentStartDistance,\n    segmentEndDistance,\n    attachmentPosition,\n    minDistance,\n    intersections,\n    attachment,\n    attachmentDistance,\n    closestAttachmentDistance,\n    closestAttachment;\n\n  for (idx = 0; idx < line.length - 1; idx++) {\n    segmentStart = line[idx];\n    segmentEnd = line[idx + 1];\n\n    if (pointsEqual(segmentStart, segmentEnd)) {\n      intersections = [segmentStart];\n    } else {\n      segmentStartDistance = getDistance(point, segmentStart);\n      segmentEndDistance = getDistance(point, segmentEnd);\n\n      minDistance = min(segmentStartDistance, segmentEndDistance);\n\n      intersections = getCircleSegmentIntersections(\n        segmentStart,\n        segmentEnd,\n        point,\n        minDistance\n      );\n    }\n\n    if (intersections.length < 1) {\n      throw new Error(\"expected between [1, 2] circle -> line intersections\");\n    }\n\n    // one intersection -> bendpoint attachment\n    if (intersections.length === 1) {\n      attachment = {\n        type: \"bendpoint\",\n        position: intersections[0],\n        segmentIndex: idx,\n        bendpointIndex: pointsEqual(segmentStart, intersections[0])\n          ? idx\n          : idx + 1,\n      };\n    }\n\n    // two intersections -> segment attachment\n    if (intersections.length === 2) {\n      attachmentPosition = mid(intersections[0], intersections[1]);\n\n      attachment = {\n        type: \"segment\",\n        position: attachmentPosition,\n        segmentIndex: idx,\n        relativeLocation:\n          getDistance(segmentStart, attachmentPosition) /\n          getDistance(segmentStart, segmentEnd),\n      };\n    }\n\n    attachmentDistance = getDistance(attachment.position, point);\n\n    if (!closestAttachment || closestAttachmentDistance > attachmentDistance) {\n      closestAttachment = attachment;\n      closestAttachmentDistance = attachmentDistance;\n    }\n  }\n\n  return closestAttachment;\n}\n\n/**\n * Gets the intersection between a circle and a line segment.\n *\n * @param {Point} s1 segment start\n * @param {Point} s2 segment end\n * @param {Point} cc circle center\n * @param {Number} cr circle radius\n *\n * @return {Array<Point>} intersections\n */\nfunction getCircleSegmentIntersections(s1, s2, cc, cr) {\n  let baX = s2.x - s1.x;\n  let baY = s2.y - s1.y;\n  let caX = cc.x - s1.x;\n  let caY = cc.y - s1.y;\n\n  let a = baX * baX + baY * baY;\n  let bBy2 = baX * caX + baY * caY;\n  let c = caX * caX + caY * caY - cr * cr;\n\n  let pBy2 = bBy2 / a;\n  let q = c / a;\n\n  let disc = pBy2 * pBy2 - q;\n\n  // check against negative value to work around\n  // negative, very close to zero results (-4e-15)\n  // being produced in some environments\n  if (disc < 0 && disc > -0.000001) {\n    disc = 0;\n  }\n\n  if (disc < 0) {\n    return [];\n  }\n\n  // if disc == 0 ... dealt with later\n  let tmpSqrt = sqrt(disc);\n  let abScalingFactor1 = -pBy2 + tmpSqrt;\n  let abScalingFactor2 = -pBy2 - tmpSqrt;\n\n  let i1 = {\n    x: s1.x - baX * abScalingFactor1,\n    y: s1.y - baY * abScalingFactor1,\n  };\n\n  if (disc === 0) {\n    // abScalingFactor1 == abScalingFactor2\n    return [i1];\n  }\n\n  let i2 = {\n    x: s1.x - baX * abScalingFactor2,\n    y: s1.y - baY * abScalingFactor2,\n  };\n\n  // return only points on line segment\n  return [i1, i2].filter(function (p) {\n    return isPointInSegment(p, s1, s2);\n  });\n}\n\nfunction isPointInSegment(p, segmentStart, segmentEnd) {\n  return (\n    fenced(p.x, segmentStart.x, segmentEnd.x) &&\n    fenced(p.y, segmentStart.y, segmentEnd.y)\n  );\n}\n\nfunction fenced(n, rangeStart, rangeEnd) {\n  // use matching threshold to work around\n  // precision errors in intersection computation\n\n  return (\n    n >= min(rangeStart, rangeEnd) - EQUAL_THRESHOLD &&\n    n <= max(rangeStart, rangeEnd) + EQUAL_THRESHOLD\n  );\n}\n\n/**\n * Calculate mid of two points.\n *\n * @param {Point} p1\n * @param {Point} p2\n *\n * @return {Point}\n */\nfunction mid(p1, p2) {\n  return {\n    x: (p1.x + p2.x) / 2,\n    y: (p1.y + p2.y) / 2,\n  };\n}\n\nlet EQUAL_THRESHOLD = 0.1;\n\nfunction pointsEqual(p1, p2) {\n  return (\n    abs(p1.x - p2.x) <= EQUAL_THRESHOLD && abs(p1.y - p2.y) <= EQUAL_THRESHOLD\n  );\n}\n","import { getDistancePointPoint, rotateVector, getAngle } from \"./GeometricUtil\";\n\nimport { getAttachment } from \"./LineAttachmentUtil\";\n\nimport { roundPoint } from \"diagram-js/lib/layout/LayoutUtil\";\n\nexport function findNewLabelLineStartIndex(\n  oldWaypoints,\n  newWaypoints,\n  attachment,\n  hints\n) {\n  let index = attachment.segmentIndex;\n\n  let offset = newWaypoints.length - oldWaypoints.length;\n\n  // segmentMove happened\n  if (hints.segmentMove) {\n    let oldSegmentStartIndex = hints.segmentMove.segmentStartIndex,\n      newSegmentStartIndex = hints.segmentMove.newSegmentStartIndex;\n\n    // if label was on moved segment return new segment index\n    if (index === oldSegmentStartIndex) {\n      return newSegmentStartIndex;\n    }\n\n    // label is after new segment index\n    if (index >= newSegmentStartIndex) {\n      return index + offset < newSegmentStartIndex\n        ? newSegmentStartIndex\n        : index + offset;\n    }\n\n    // if label is before new segment index\n    return index;\n  }\n\n  // bendpointMove happened\n  if (hints.bendpointMove) {\n    let insert = hints.bendpointMove.insert,\n      bendpointIndex = hints.bendpointMove.bendpointIndex,\n      newIndex;\n\n    // waypoints length didnt change\n    if (offset === 0) {\n      return index;\n    }\n\n    // label behind new/removed bendpoint\n    if (index >= bendpointIndex) {\n      newIndex = insert ? index + 1 : index - 1;\n    }\n\n    // label before new/removed bendpoint\n    if (index < bendpointIndex) {\n      newIndex = index;\n\n      // decide label should take right or left segment\n      if (\n        insert &&\n        attachment.type !== \"bendpoint\" &&\n        bendpointIndex - 1 === index\n      ) {\n        let rel = relativePositionMidWaypoint(newWaypoints, bendpointIndex);\n\n        if (rel < attachment.relativeLocation) {\n          newIndex++;\n        }\n      }\n    }\n\n    return newIndex;\n  }\n\n  // start/end changed\n  if (offset === 0) {\n    return index;\n  }\n\n  if (hints.connectionStart) {\n    return index === 0 ? 0 : null;\n  }\n\n  if (hints.connectionEnd) {\n    return index === oldWaypoints.length - 2 ? newWaypoints.length - 2 : null;\n  }\n\n  // if nothing fits, return null\n  return null;\n}\n\n/**\n * Calculate the required adjustment (move delta) for the given label\n * after the connection waypoints got updated.\n *\n * @param {djs.model.Label} label\n * @param {Array<Point>} newWaypoints\n * @param {Array<Point>} oldWaypoints\n * @param {Object} hints\n *\n * @return {Point} delta\n */\nexport function getLabelAdjustment(label, newWaypoints, oldWaypoints, hints) {\n  let x = 0,\n    y = 0;\n\n  let labelPosition = getLabelMid(label);\n\n  // get closest attachment\n  let attachment = getAttachment(labelPosition, oldWaypoints),\n    oldLabelLineIndex = attachment.segmentIndex,\n    newLabelLineIndex = findNewLabelLineStartIndex(\n      oldWaypoints,\n      newWaypoints,\n      attachment,\n      hints\n    );\n\n  if (newLabelLineIndex === null) {\n    return { x: x, y: y };\n  }\n\n  // should never happen\n  // TODO(@janstuemmel): throw an error here when connectionSegmentMove is refactored\n  if (newLabelLineIndex < 0 || newLabelLineIndex > newWaypoints.length - 2) {\n    return { x: x, y: y };\n  }\n\n  let oldLabelLine = getLine(oldWaypoints, oldLabelLineIndex),\n    newLabelLine = getLine(newWaypoints, newLabelLineIndex),\n    oldFoot = attachment.position;\n\n  let relativeFootPosition = getRelativeFootPosition(oldLabelLine, oldFoot),\n    angleDelta = getAngleDelta(oldLabelLine, newLabelLine);\n\n  // special rule if label on bendpoint\n  if (attachment.type === \"bendpoint\") {\n    let offset = newWaypoints.length - oldWaypoints.length,\n      oldBendpointIndex = attachment.bendpointIndex,\n      oldBendpoint = oldWaypoints[oldBendpointIndex];\n\n    // bendpoint position hasn't changed, return same position\n    if (newWaypoints.indexOf(oldBendpoint) !== -1) {\n      return { x: x, y: y };\n    }\n\n    // new bendpoint and old bendpoint have same index, then just return the offset\n    if (offset === 0) {\n      let newBendpoint = newWaypoints[oldBendpointIndex];\n\n      return {\n        x: newBendpoint.x - attachment.position.x,\n        y: newBendpoint.y - attachment.position.y,\n      };\n    }\n\n    // if bendpoints get removed\n    if (\n      offset < 0 &&\n      oldBendpointIndex !== 0 &&\n      oldBendpointIndex < oldWaypoints.length - 1\n    ) {\n      relativeFootPosition = relativePositionMidWaypoint(\n        oldWaypoints,\n        oldBendpointIndex\n      );\n    }\n  }\n\n  let newFoot = {\n    x:\n      (newLabelLine[1].x - newLabelLine[0].x) * relativeFootPosition +\n      newLabelLine[0].x,\n    y:\n      (newLabelLine[1].y - newLabelLine[0].y) * relativeFootPosition +\n      newLabelLine[0].y,\n  };\n\n  // the rotated vector to label\n  let newLabelVector = rotateVector(\n    {\n      x: labelPosition.x - oldFoot.x,\n      y: labelPosition.y - oldFoot.y,\n    },\n    angleDelta\n  );\n\n  // the new relative position\n  x = newFoot.x + newLabelVector.x - labelPosition.x;\n  y = newFoot.y + newLabelVector.y - labelPosition.y;\n\n  return roundPoint({\n    x: x,\n    y: y,\n  });\n}\n\n// HELPERS //////////////////////\n\nfunction relativePositionMidWaypoint(waypoints, idx) {\n  let distanceSegment1 = getDistancePointPoint(\n      waypoints[idx - 1],\n      waypoints[idx]\n    ),\n    distanceSegment2 = getDistancePointPoint(\n      waypoints[idx],\n      waypoints[idx + 1]\n    );\n\n  let relativePosition =\n    distanceSegment1 / (distanceSegment1 + distanceSegment2);\n\n  return relativePosition;\n}\n\nfunction getLabelMid(label) {\n  return {\n    x: label.x + label.width / 2,\n    y: label.y + label.height / 2,\n  };\n}\n\nfunction getAngleDelta(l1, l2) {\n  let a1 = getAngle(l1),\n    a2 = getAngle(l2);\n  return a2 - a1;\n}\n\nfunction getLine(waypoints, idx) {\n  return [waypoints[idx], waypoints[idx + 1]];\n}\n\nfunction getRelativeFootPosition(line, foot) {\n  let length = getDistancePointPoint(line[0], line[1]),\n    lengthToFoot = getDistancePointPoint(line[0], foot);\n\n  return length === 0 ? 0 : lengthToFoot / length;\n}\n","import { assign } from \"min-dash\";\n\nimport inherits from \"inherits\";\n\nimport { is, getBusinessObject } from \"../../../util/ModelUtil\";\n\nimport {\n  isLabelExternal,\n  getExternalLabelMid,\n  hasExternalLabel,\n  isLabel,\n} from \"../../../util/LabelUtil\";\n\nimport { getLabel } from \"../../label-editing/LabelUtil\";\n\nimport { getLabelAdjustment } from \"./util/LabelLayoutUtil\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { getNewAttachPoint } from \"diagram-js/lib/util/AttachUtil\";\n\nimport { getMid, roundPoint } from \"diagram-js/lib/layout/LayoutUtil\";\n\nimport { delta } from \"diagram-js/lib/util/PositionUtil\";\n\nimport { sortBy } from \"min-dash\";\n\nimport { getDistancePointLine, perpendicularFoot } from \"./util/GeometricUtil\";\n\nlet DEFAULT_LABEL_DIMENSIONS = {\n  width: 90,\n  height: 20,\n};\n\nlet NAME_PROPERTY = \"name\";\nlet TEXT_PROPERTY = \"text\";\n\n/**\n * A component that makes sure that external labels are added\n * together with respective elements and properly updated (DI wise)\n * during move.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n * @param {BpmnFactory} bpmnFactory\n * @param {TextRenderer} textRenderer\n */\nexport default function LabelBehavior(\n  eventBus,\n  modeling,\n  bpmnFactory,\n  textRenderer\n) {\n  CommandInterceptor.call(this, eventBus);\n\n  // update label if name property was updated\n  this.postExecute(\"element.updateProperties\", function (e) {\n    let context = e.context,\n      element = context.element,\n      properties = context.properties;\n\n    if (NAME_PROPERTY in properties) {\n      modeling.updateLabel(element, properties[NAME_PROPERTY]);\n    }\n\n    if (TEXT_PROPERTY in properties && is(element, \"bpmn:TextAnnotation\")) {\n      let newBounds = textRenderer.getTextAnnotationBounds(\n        {\n          x: element.x,\n          y: element.y,\n          width: element.width,\n          height: element.height,\n        },\n        properties[TEXT_PROPERTY] || \"\"\n      );\n\n      modeling.updateLabel(element, properties.text, newBounds);\n    }\n  });\n\n  // create label shape after shape/connection was created\n  this.postExecute([\"shape.create\", \"connection.create\"], function (e) {\n    let context = e.context,\n      hints = context.hints || {};\n\n    if (hints.createElementsBehavior === false) {\n      return;\n    }\n\n    let element = context.shape || context.connection,\n      businessObject = element.businessObject;\n\n    if (isLabel(element) || !isLabelExternal(element)) {\n      return;\n    }\n\n    // only create label if attribute available\n    if (!getLabel(element)) {\n      return;\n    }\n\n    let labelCenter = getExternalLabelMid(element);\n\n    // we don't care about x and y\n    let labelDimensions = textRenderer.getExternalLabelBounds(\n      DEFAULT_LABEL_DIMENSIONS,\n      getLabel(element)\n    );\n\n    modeling.createLabel(element, labelCenter, {\n      id: businessObject.id + \"_label\",\n      businessObject: businessObject,\n      width: labelDimensions.width,\n      height: labelDimensions.height,\n    });\n  });\n\n  // update label after label shape was deleted\n  this.postExecute(\"shape.delete\", function (event) {\n    let context = event.context,\n      labelTarget = context.labelTarget,\n      hints = context.hints || {};\n\n    // check if label\n    if (labelTarget && hints.unsetLabel !== false) {\n      modeling.updateLabel(labelTarget, null, null, { removeShape: false });\n    }\n  });\n\n  // update di information on label creation\n  this.postExecute([\"label.create\"], function (event) {\n    let context = event.context,\n      element = context.shape,\n      businessObject,\n      di;\n\n    // we want to trigger on real labels only\n    if (!element.labelTarget) {\n      return;\n    }\n\n    // we want to trigger on BPMN elements only\n    if (!is(element.labelTarget || element, \"bpmn:BaseElement\")) {\n      return;\n    }\n\n    businessObject = element.businessObject;\n    di = businessObject.di;\n\n    if (!di.label) {\n      di.label = bpmnFactory.create(\"bpmndi:BPMNLabel\", {\n        bounds: bpmnFactory.create(\"dc:Bounds\"),\n      });\n    }\n\n    assign(di.label.bounds, {\n      x: element.x,\n      y: element.y,\n      width: element.width,\n      height: element.height,\n    });\n  });\n\n  function getVisibleLabelAdjustment(event) {\n    let context = event.context,\n      connection = context.connection,\n      label = connection.label,\n      hints = assign({}, context.hints),\n      newWaypoints = context.newWaypoints || connection.waypoints,\n      oldWaypoints = context.oldWaypoints;\n\n    if (typeof hints.startChanged === \"undefined\") {\n      hints.startChanged = !!hints.connectionStart;\n    }\n\n    if (typeof hints.endChanged === \"undefined\") {\n      hints.endChanged = !!hints.connectionEnd;\n    }\n\n    return getLabelAdjustment(label, newWaypoints, oldWaypoints, hints);\n  }\n\n  this.postExecute(\n    [\"connection.layout\", \"connection.updateWaypoints\"],\n    function (event) {\n      let context = event.context,\n        hints = context.hints || {};\n\n      if (hints.labelBehavior === false) {\n        return;\n      }\n\n      let connection = context.connection,\n        label = connection.label,\n        labelAdjustment;\n\n      // handle missing label as well as the case\n      // that the label parent does not exist (yet),\n      // because it is being pasted / created via multi element create\n      //\n      // Cf. https://github.com/bpmn-io/bpmn-js/pull/1227\n      if (!label || !label.parent) {\n        return;\n      }\n\n      labelAdjustment = getVisibleLabelAdjustment(event);\n\n      modeling.moveShape(label, labelAdjustment);\n    }\n  );\n\n  // keep label position on shape replace\n  this.postExecute([\"shape.replace\"], function (event) {\n    let context = event.context,\n      newShape = context.newShape,\n      oldShape = context.oldShape;\n\n    let businessObject = getBusinessObject(newShape);\n\n    if (\n      businessObject &&\n      isLabelExternal(businessObject) &&\n      oldShape.label &&\n      newShape.label\n    ) {\n      newShape.label.x = oldShape.label.x;\n      newShape.label.y = oldShape.label.y;\n    }\n  });\n\n  // move external label after resizing\n  this.postExecute(\"shape.resize\", function (event) {\n    let context = event.context,\n      shape = context.shape,\n      newBounds = context.newBounds,\n      oldBounds = context.oldBounds;\n\n    if (hasExternalLabel(shape)) {\n      let label = shape.label,\n        labelMid = getMid(label),\n        edges = asEdges(oldBounds);\n\n      // get nearest border point to label as reference point\n      let referencePoint = getReferencePoint(labelMid, edges);\n\n      let delta = getReferencePointDelta(referencePoint, oldBounds, newBounds);\n\n      modeling.moveShape(label, delta);\n    }\n  });\n}\n\ninherits(LabelBehavior, CommandInterceptor);\n\nLabelBehavior.$inject = [\"eventBus\", \"modeling\", \"bpmnFactory\", \"textRenderer\"];\n\n// helpers //////////////////////\n\n/**\n * Calculates a reference point delta relative to a new position\n * of a certain element's bounds\n *\n * @param {Point} point\n * @param {Bounds} oldBounds\n * @param {Bounds} newBounds\n *\n * @return {Delta} delta\n */\nexport function getReferencePointDelta(referencePoint, oldBounds, newBounds) {\n  let newReferencePoint = getNewAttachPoint(\n    referencePoint,\n    oldBounds,\n    newBounds\n  );\n\n  return roundPoint(delta(newReferencePoint, referencePoint));\n}\n\n/**\n * Generates the nearest point (reference point) for a given point\n * onto given set of lines\n *\n * @param {Array<Point, Point>} lines\n * @param {Point} point\n *\n * @param {Point}\n */\nexport function getReferencePoint(point, lines) {\n  if (!lines.length) {\n    return;\n  }\n\n  let nearestLine = getNearestLine(point, lines);\n\n  return perpendicularFoot(point, nearestLine);\n}\n\n/**\n * Convert the given bounds to a lines array containing all edges\n *\n * @param {Bounds|Point} bounds\n *\n * @return Array<Point>\n */\nexport function asEdges(bounds) {\n  return [\n    [\n      // top\n      {\n        x: bounds.x,\n        y: bounds.y,\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y,\n      },\n    ],\n    [\n      // right\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y,\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y + (bounds.height || 0),\n      },\n    ],\n    [\n      // bottom\n      {\n        x: bounds.x,\n        y: bounds.y + (bounds.height || 0),\n      },\n      {\n        x: bounds.x + (bounds.width || 0),\n        y: bounds.y + (bounds.height || 0),\n      },\n    ],\n    [\n      // left\n      {\n        x: bounds.x,\n        y: bounds.y,\n      },\n      {\n        x: bounds.x,\n        y: bounds.y + (bounds.height || 0),\n      },\n    ],\n  ];\n}\n\n/**\n * Returns the nearest line for a given point by distance\n * @param {Point} point\n * @param Array<Point> lines\n *\n * @return Array<Point>\n */\nfunction getNearestLine(point, lines) {\n  let distances = lines.map(function (l) {\n    return {\n      line: l,\n      distance: getDistancePointLine(point, l),\n    };\n  });\n\n  let sorted = sortBy(distances, \"distance\");\n\n  return sorted[0].line;\n}\n","import { is } from \"../../../util/ModelUtil\";\n\nlet COLLAB_ERR_MSG = \"flow elements must be children of pools/participants\",\n  PROCESS_ERR_MSG =\n    \"participants cannot be pasted onto a non-empty process diagram\";\n\nexport default function ModelingFeedback(eventBus, tooltips, translate) {\n  function showError(position, message, timeout) {\n    tooltips.add({\n      position: {\n        x: position.x + 5,\n        y: position.y + 5,\n      },\n      type: \"error\",\n      timeout: timeout || 2000,\n      html: \"<div>\" + message + \"</div>\",\n    });\n  }\n\n  eventBus.on([\"shape.move.rejected\", \"create.rejected\"], function (event) {\n    let context = event.context,\n      shape = context.shape,\n      target = context.target;\n\n    if (is(target, \"bpmn:Collaboration\") && is(shape, \"bpmn:FlowNode\")) {\n      showError(event, translate(COLLAB_ERR_MSG));\n    }\n  });\n\n  eventBus.on([\"elements.paste.rejected\"], function (event) {\n    let context = event.context,\n      position = context.position,\n      target = context.target;\n\n    if (is(target, \"bpmn:Collaboration\")) {\n      showError(position, translate(COLLAB_ERR_MSG));\n    }\n\n    if (is(target, \"bpmn:Process-action\")) {\n      showError(position, translate(PROCESS_ERR_MSG), 3000);\n    }\n  });\n}\n\nModelingFeedback.$inject = [\"eventBus\", \"tooltips\", \"translate\"];\n","import { forEach, find, matchPattern } from \"min-dash\";\n\nimport inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\nexport default function ReplaceConnectionBehavior(\n  eventBus,\n  modeling,\n  bpmnRules,\n  injector\n) {\n  CommandInterceptor.call(this, eventBus);\n\n  let dragging = injector.get(\"dragging\", false);\n\n  function fixConnection(connection) {\n    let source = connection.source,\n      target = connection.target,\n      parent = connection.parent;\n\n    // do not do anything if connection\n    // is already deleted (may happen due to other\n    // behaviors plugged-in before)\n    if (!parent) {\n      return;\n    }\n\n    let replacementType, remove;\n\n    /**\n     * Check if incoming or outgoing connections\n     * can stay or could be substituted with an\n     * appropriate replacement.\n     *\n     * This holds true for SequenceFlow <> MessageFlow.\n     */\n\n    if (is(connection, \"bpmn:SequenceFlow\")) {\n      if (!bpmnRules.canConnectSequenceFlow(source, target)) {\n        remove = true;\n      }\n\n      if (bpmnRules.canConnectMessageFlow(source, target)) {\n        replacementType = \"bpmn:MessageFlow\";\n      }\n    }\n\n    // transform message flows into sequence flows, if possible\n\n    if (is(connection, \"bpmn:MessageFlow\")) {\n      if (!bpmnRules.canConnectMessageFlow(source, target)) {\n        remove = true;\n      }\n\n      if (bpmnRules.canConnectSequenceFlow(source, target)) {\n        replacementType = \"bpmn:SequenceFlow\";\n      }\n    }\n\n    if (\n      is(connection, \"bpmn:Association\") &&\n      !bpmnRules.canConnectAssociation(source, target)\n    ) {\n      remove = true;\n    }\n\n    // remove invalid connection,\n    // unless it has been removed already\n    if (remove) {\n      modeling.removeConnection(connection);\n    }\n\n    // replace SequenceFlow <> MessageFlow\n\n    if (replacementType) {\n      modeling.connect(source, target, {\n        type: replacementType,\n        waypoints: connection.waypoints.slice(),\n      });\n    }\n  }\n\n  function replaceReconnectedConnection(event) {\n    let context = event.context,\n      connection = context.connection,\n      source = context.newSource || connection.source,\n      target = context.newTarget || connection.target,\n      allowed,\n      replacement;\n\n    allowed = bpmnRules.canConnect(source, target);\n\n    if (!allowed || allowed.type === connection.type) {\n      return;\n    }\n\n    replacement = modeling.connect(source, target, {\n      type: allowed.type,\n      waypoints: connection.waypoints.slice(),\n    });\n\n    // remove old connection\n    modeling.removeConnection(connection);\n\n    // replace connection in context to reconnect end/start\n    context.connection = replacement;\n\n    if (dragging) {\n      cleanDraggingSelection(connection, replacement);\n    }\n  }\n\n  // monkey-patch selection saved in dragging in order to re-select it when operation is finished\n  function cleanDraggingSelection(oldConnection, newConnection) {\n    let context = dragging.context(),\n      previousSelection = context && context.payload.previousSelection,\n      index;\n\n    // do nothing if not dragging or no selection was present\n    if (!previousSelection || !previousSelection.length) {\n      return;\n    }\n\n    index = previousSelection.indexOf(oldConnection);\n\n    if (index === -1) {\n      return;\n    }\n\n    previousSelection.splice(index, 1, newConnection);\n  }\n\n  // lifecycle hooks\n\n  this.postExecuted(\n    \"elements.move\",\n    function (context) {\n      let closure = context.closure,\n        allConnections = closure.allConnections;\n\n      forEach(allConnections, fixConnection);\n    },\n    true\n  );\n\n  this.preExecute(\"connection.reconnect\", replaceReconnectedConnection);\n\n  this.postExecuted(\"element.updateProperties\", function (event) {\n    let context = event.context,\n      properties = context.properties,\n      element = context.element,\n      businessObject = element.businessObject,\n      connection;\n\n    // remove condition on change to default\n    if (properties.default) {\n      connection = find(\n        element.outgoing,\n        matchPattern({ id: element.businessObject.default.id })\n      );\n\n      if (connection) {\n        modeling.updateProperties(connection, {\n          conditionExpression: undefined,\n        });\n      }\n    }\n\n    // remove default from source on change to conditional\n    if (\n      properties.conditionExpression &&\n      businessObject.sourceRef.default === businessObject\n    ) {\n      modeling.updateProperties(element.source, { default: undefined });\n    }\n  });\n}\n\ninherits(ReplaceConnectionBehavior, CommandInterceptor);\n\nReplaceConnectionBehavior.$inject = [\n  \"eventBus\",\n  \"modeling\",\n  \"bpmnRules\",\n  \"injector\",\n];\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\n/**\n * BPMN specific remove behavior\n */\nexport default function RemoveParticipantBehavior(eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * morph collaboration diagram into process diagram\n   * after the last participant has been removed\n   */\n\n  this.preExecute(\n    \"shape.delete\",\n    function (context) {\n      let shape = context.shape,\n        parent = shape.parent;\n\n      // activate the behavior if the shape to be removed\n      // is a participant\n      if (is(shape, \"bpmn:Participant\")) {\n        context.collaborationRoot = parent;\n      }\n    },\n    true\n  );\n\n  this.postExecute(\n    \"shape.delete\",\n    function (context) {\n      let collaborationRoot = context.collaborationRoot;\n\n      if (\n        collaborationRoot &&\n        !collaborationRoot.businessObject.participants.length\n      ) {\n        // replace empty collaboration with process diagram\n        modeling.makeProcess();\n      }\n    },\n    true\n  );\n}\n\nRemoveParticipantBehavior.$inject = [\"eventBus\", \"modeling\"];\n\ninherits(RemoveParticipantBehavior, CommandInterceptor);\n","import inherits from \"inherits\";\n\nimport { forEach } from \"min-dash\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { isEventLoop } from \"../../../util/DiUtil\";\n\n/**\n * BPMN-specific replace behavior.\n */\nexport default function ReplaceElementBehaviour(\n  bpmnReplace,\n  bpmnRules,\n  elementRegistry,\n  injector,\n  modeling,\n  selection\n) {\n  injector.invoke(CommandInterceptor, this);\n\n  this._bpmnReplace = bpmnReplace;\n  this._elementRegistry = elementRegistry;\n  this._selection = selection;\n\n  // replace elements on move\n  this.postExecuted(\n    [\"elements.move\"],\n    500,\n    function (event) {\n      let context = event.context,\n        target = context.newParent,\n        newHost = context.newHost,\n        elements = [];\n\n      forEach(context.closure.topLevel, function (topLevelElements) {\n        if (isEventLoop(topLevelElements)) {\n          elements = elements.concat(topLevelElements.children);\n        } else {\n          elements = elements.concat(topLevelElements);\n        }\n      });\n\n      // set target to host if attaching\n      if (elements.length === 1 && newHost) {\n        target = newHost;\n      }\n\n      let canReplace = bpmnRules.canReplace(elements, target);\n\n      if (canReplace) {\n        this.replaceElements(elements, canReplace.replacements, newHost);\n      }\n    },\n    this\n  );\n\n  // update attachments on host replace\n  this.postExecute(\n    [\"shape.replace\"],\n    1500,\n    function (e) {\n      let context = e.context,\n        oldShape = context.oldShape,\n        newShape = context.newShape,\n        attachers = oldShape.attachers,\n        canReplace;\n\n      if (attachers && attachers.length) {\n        canReplace = bpmnRules.canReplace(attachers, newShape);\n\n        this.replaceElements(attachers, canReplace.replacements);\n      }\n    },\n    this\n  );\n\n  // keep ID on shape replace\n  this.postExecuted([\"shape.replace\"], 1500, function (e) {\n    let context = e.context,\n      oldShape = context.oldShape,\n      newShape = context.newShape;\n\n    modeling.unclaimId(oldShape.businessObject.id, oldShape.businessObject);\n    modeling.updateProperties(newShape, { id: oldShape.id });\n  });\n}\n\ninherits(ReplaceElementBehaviour, CommandInterceptor);\n\nReplaceElementBehaviour.prototype.replaceElements = function (\n  elements,\n  newElements\n) {\n  let elementRegistry = this._elementRegistry,\n    bpmnReplace = this._bpmnReplace,\n    selection = this._selection;\n\n  forEach(newElements, function (replacement) {\n    let newElement = {\n      type: replacement.newElementType,\n    };\n\n    let oldElement = elementRegistry.get(replacement.oldElementId);\n\n    let idx = elements.indexOf(oldElement);\n\n    elements[idx] = bpmnReplace.replaceElement(oldElement, newElement, {\n      select: false,\n    });\n  });\n\n  if (newElements) {\n    selection.select(elements);\n  }\n};\n\nReplaceElementBehaviour.$inject = [\n  \"bpmnReplace\",\n  \"bpmnRules\",\n  \"elementRegistry\",\n  \"injector\",\n  \"modeling\",\n  \"selection\",\n];\n","import { is } from \"../../../../util/ModelUtil\";\r\n\r\nimport { asTRBL } from \"diagram-js/lib/layout/LayoutUtil\";\r\n\r\nimport { collectLanes, getLanesRoot } from \"../../../modeling/util/LaneUtil\";\r\n\r\nlet abs = Math.abs,\r\n  min = Math.min,\r\n  max = Math.max;\r\n\r\nfunction addToTrbl(trbl, attr, value, choice) {\r\n  let current = trbl[attr];\r\n\r\n  // make sure to set the value if it does not exist\r\n  // or apply the correct value by comparing against\r\n  // choice(value, currentValue)\r\n  trbl[attr] = current === undefined ? value : choice(value, current);\r\n}\r\n\r\nfunction addMin(trbl, attr, value) {\r\n  return addToTrbl(trbl, attr, value, min);\r\n}\r\n\r\nfunction addMax(trbl, attr, value) {\r\n  return addToTrbl(trbl, attr, value, max);\r\n}\r\n\r\nlet LANE_MIN_HEIGHT = 60,\r\n  LANE_MIN_WIDTH = 300,\r\n  LANE_RIGHT_PADDING = 20,\r\n  LANE_LEFT_PADDING = 50,\r\n  LANE_TOP_PADDING = 20,\r\n  LANE_BOTTOM_PADDING = 20;\r\n\r\nexport function getParticipantResizeConstraints(\r\n  laneShape,\r\n  resizeDirection,\r\n  balanced\r\n) {\r\n  let lanesRoot = getLanesRoot(laneShape);\r\n\r\n  let isFirst = true,\r\n    isLast = true;\r\n\r\n  // max top/bottom size for lanes\r\n  let allLanes = collectLanes(lanesRoot, [lanesRoot]);\r\n\r\n  let laneTrbl = asTRBL(laneShape);\r\n\r\n  let maxTrbl = {},\r\n    minTrbl = {};\r\n\r\n  if (/e/.test(resizeDirection)) {\r\n    minTrbl.right = laneTrbl.left + LANE_MIN_WIDTH;\r\n  } else if (/w/.test(resizeDirection)) {\r\n    minTrbl.left = laneTrbl.right - LANE_MIN_WIDTH;\r\n  }\r\n\r\n  allLanes.forEach(function (other) {\r\n    let otherTrbl = asTRBL(other);\r\n\r\n    if (/n/.test(resizeDirection)) {\r\n      if (otherTrbl.top < laneTrbl.top - 10) {\r\n        isFirst = false;\r\n      }\r\n\r\n      // max top size (based on next element)\r\n      if (balanced && abs(laneTrbl.top - otherTrbl.bottom) < 10) {\r\n        addMax(maxTrbl, \"top\", otherTrbl.top + LANE_MIN_HEIGHT);\r\n      }\r\n\r\n      // min top size (based on self or nested element)\r\n      if (abs(laneTrbl.top - otherTrbl.top) < 5) {\r\n        addMin(minTrbl, \"top\", otherTrbl.bottom - LANE_MIN_HEIGHT);\r\n      }\r\n    }\r\n\r\n    if (/s/.test(resizeDirection)) {\r\n      if (otherTrbl.bottom > laneTrbl.bottom + 10) {\r\n        isLast = false;\r\n      }\r\n\r\n      // max bottom size (based on previous element)\r\n      if (balanced && abs(laneTrbl.bottom - otherTrbl.top) < 10) {\r\n        addMin(maxTrbl, \"bottom\", otherTrbl.bottom - LANE_MIN_HEIGHT);\r\n      }\r\n\r\n      // min bottom size (based on self or nested element)\r\n      if (abs(laneTrbl.bottom - otherTrbl.bottom) < 5) {\r\n        addMax(minTrbl, \"bottom\", otherTrbl.top + LANE_MIN_HEIGHT);\r\n      }\r\n    }\r\n  });\r\n\r\n  // max top/bottom/left/right size based on flow nodes\r\n  let flowElements = lanesRoot.children.filter(function (s) {\r\n    return (\r\n      !s.hidden &&\r\n      !s.waypoints &&\r\n      (is(s, \"bpmn:FlowElement\") || is(s, \"bpmn:Artifact\"))\r\n    );\r\n  });\r\n\r\n  flowElements.forEach(function (flowElement) {\r\n    let flowElementTrbl = asTRBL(flowElement);\r\n\r\n    if (isFirst && /n/.test(resizeDirection)) {\r\n      addMin(minTrbl, \"top\", flowElementTrbl.top - LANE_TOP_PADDING);\r\n    }\r\n\r\n    if (/e/.test(resizeDirection)) {\r\n      addMax(minTrbl, \"right\", flowElementTrbl.right + LANE_RIGHT_PADDING);\r\n    }\r\n\r\n    if (isLast && /s/.test(resizeDirection)) {\r\n      addMax(minTrbl, \"bottom\", flowElementTrbl.bottom + LANE_BOTTOM_PADDING);\r\n    }\r\n\r\n    if (/w/.test(resizeDirection)) {\r\n      addMin(minTrbl, \"left\", flowElementTrbl.left - LANE_LEFT_PADDING);\r\n    }\r\n  });\r\n\r\n  return {\r\n    min: minTrbl,\r\n    max: maxTrbl,\r\n  };\r\n}\r\n","import { is } from \"../../../util/ModelUtil\";\r\n\r\nimport { isExpanded } from \"../../../util/DiUtil\";\r\n\r\nimport { getParticipantResizeConstraints } from \"./util/ResizeUtil\";\r\n\r\nconst HIGH_PRIORITY = 1500;\r\n\r\nexport const PARTICIPANT_MIN_DIMENSIONS = { width: 300, height: 150 };\r\n\r\nexport const SUB_PROCESS_MIN_DIMENSIONS = { width: 140, height: 120 };\r\n\r\nexport const TEXT_ANNOTATION_MIN_DIMENSIONS = { width: 50, height: 30 };\r\n\r\n/**\r\n * Set minimum bounds/resize constraints on resize.\r\n *\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function ResizeBehavior(eventBus) {\r\n  eventBus.on(\"resize.start\", HIGH_PRIORITY, function (event) {\r\n    let context = event.context,\r\n      shape = context.shape,\r\n      direction = context.direction,\r\n      balanced = context.balanced;\r\n\r\n    if (is(shape, \"bpmn:Lane\") || is(shape, \"bpmn:Participant\")) {\r\n      context.resizeConstraints = getParticipantResizeConstraints(\r\n        shape,\r\n        direction,\r\n        balanced\r\n      );\r\n    }\r\n\r\n    if (is(shape, \"bpmn:Participant\")) {\r\n      context.minDimensions = PARTICIPANT_MIN_DIMENSIONS;\r\n    }\r\n\r\n    if (is(shape, \"bpmn:Loop\") && isExpanded(shape)) {\r\n      context.minDimensions = SUB_PROCESS_MIN_DIMENSIONS;\r\n    }\r\n\r\n    if (is(shape, \"bpmn:Conditional\") && isExpanded(shape)) {\r\n      context.minDimensions = SUB_PROCESS_MIN_DIMENSIONS;\r\n    }\r\n\r\n    if (is(shape, \"bpmn:TextAnnotation\")) {\r\n      context.minDimensions = TEXT_ANNOTATION_MIN_DIMENSIONS;\r\n    }\r\n  });\r\n}\r\n\r\nResizeBehavior.$inject = [\"eventBus\"];\r\n","import { is } from \"../../../util/ModelUtil\";\n\nimport { roundBounds } from \"diagram-js/lib/layout/LayoutUtil\";\n\nimport { hasPrimaryModifier } from \"diagram-js/lib/util/Mouse\";\n\nconst SLIGHTLY_HIGHER_PRIORITY = 1001;\n\n/**\n * Invoke {@link Modeling#resizeLane} instead of\n * {@link Modeling#resizeShape} when resizing a Lane\n * or Participant shape.\n */\nexport default function ResizeLaneBehavior(eventBus, modeling) {\n  eventBus.on(\"resize.start\", SLIGHTLY_HIGHER_PRIORITY + 500, function (event) {\n    let context = event.context,\n      shape = context.shape;\n\n    if (is(shape, \"bpmn:Lane\") || is(shape, \"bpmn:Participant\")) {\n      // should we resize the opposite lane(s) in\n      // order to compensate for the resize operation?\n      context.balanced = !hasPrimaryModifier(event);\n    }\n  });\n\n  /**\n   * Intercept resize end and call resize lane function instead.\n   */\n  eventBus.on(\"resize.end\", SLIGHTLY_HIGHER_PRIORITY, function (event) {\n    let context = event.context,\n      shape = context.shape,\n      canExecute = context.canExecute,\n      newBounds = context.newBounds;\n\n    if (is(shape, \"bpmn:Lane\") || is(shape, \"bpmn:Participant\")) {\n      if (canExecute) {\n        // ensure we have actual pixel values for new bounds\n        // (important when zoom level was > 1 during move)\n        newBounds = roundBounds(newBounds);\n\n        // perform the actual resize\n        modeling.resizeLane(shape, newBounds, context.balanced);\n      }\n\n      // stop propagation\n      return false;\n    }\n  });\n}\n\nResizeLaneBehavior.$inject = [\"eventBus\", \"modeling\"];\n","import inherits from \"inherits\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport lineIntersect from \"./util/LineIntersect\";\n\nexport default function RemoveElementBehavior(eventBus, bpmnRules, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Combine sequence flows when deleting an element\n   * if there is one incoming and one outgoing\n   * sequence flow\n   */\n  this.preExecute(\"shape.delete\", function (e) {\n    let shape = e.context.shape;\n\n    // only handle [a] -> [shape] -> [b] patterns\n    if (shape.incoming.length !== 1 || shape.outgoing.length !== 1) {\n      return;\n    }\n\n    let inConnection = shape.incoming[0],\n      outConnection = shape.outgoing[0];\n\n    // only handle sequence flows\n    if (\n      !is(inConnection, \"bpmn:SequenceFlow\") ||\n      !is(outConnection, \"bpmn:SequenceFlow\")\n    ) {\n      return;\n    }\n\n    if (\n      bpmnRules.canConnect(\n        inConnection.source,\n        outConnection.target,\n        inConnection\n      )\n    ) {\n      // compute new, combined waypoints\n      let newWaypoints = getNewWaypoints(\n        inConnection.waypoints,\n        outConnection.waypoints\n      );\n\n      modeling.reconnectEnd(inConnection, outConnection.target, newWaypoints);\n    }\n  });\n}\n\ninherits(RemoveElementBehavior, CommandInterceptor);\n\nRemoveElementBehavior.$inject = [\"eventBus\", \"bpmnRules\", \"modeling\"];\n\n// helpers //////////////////////\n\nfunction getDocking(point) {\n  return point.original || point;\n}\n\nfunction getNewWaypoints(inWaypoints, outWaypoints) {\n  let intersection = lineIntersect(\n    getDocking(inWaypoints[inWaypoints.length - 2]),\n    getDocking(inWaypoints[inWaypoints.length - 1]),\n    getDocking(outWaypoints[1]),\n    getDocking(outWaypoints[0])\n  );\n\n  if (intersection) {\n    return [].concat(\n      inWaypoints.slice(0, inWaypoints.length - 1),\n      [intersection],\n      outWaypoints.slice(1)\n    );\n  } else {\n    return [\n      getDocking(inWaypoints[0]),\n      getDocking(outWaypoints[outWaypoints.length - 1]),\n    ];\n  }\n}\n","import { forEach } from \"min-dash\";\r\n\r\nimport { is } from \"../../../util/ModelUtil\";\r\n\r\nimport { isExpanded } from \"../../../util/DiUtil\";\r\n\r\nimport {\r\n  PARTICIPANT_MIN_DIMENSIONS,\r\n  SUB_PROCESS_MIN_DIMENSIONS,\r\n  TEXT_ANNOTATION_MIN_DIMENSIONS,\r\n} from \"./ResizeBehavior\";\r\n\r\nexport default function SpaceToolBehavior(eventBus) {\r\n  eventBus.on(\"spaceTool.getMinDimensions\", function (context) {\r\n    let shapes = context.shapes,\r\n      minDimensions = {};\r\n\r\n    forEach(shapes, function (shape) {\r\n      let id = shape.id;\r\n\r\n      if (is(shape, \"bpmn:Participant\")) {\r\n        minDimensions[id] = PARTICIPANT_MIN_DIMENSIONS;\r\n      }\r\n\r\n      if (is(shape, \"bpmn:Loop\") && isExpanded(shape)) {\r\n        minDimensions[id] = SUB_PROCESS_MIN_DIMENSIONS;\r\n      }\r\n\r\n      if (is(shape, \"bpmn:Conditional\") && isExpanded(shape)) {\r\n        context.minDimensions = SUB_PROCESS_MIN_DIMENSIONS;\r\n      }\r\n      if (is(shape, \"bpmn:TextAnnotation\")) {\r\n        minDimensions[id] = TEXT_ANNOTATION_MIN_DIMENSIONS;\r\n      }\r\n    });\r\n\r\n    return minDimensions;\r\n  });\r\n}\r\n\r\nSpaceToolBehavior.$inject = [\"eventBus\"];\r\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { is } from \"../../../util/ModelUtil\";\nimport { isExpanded } from \"../../../util/DiUtil.js\";\n\n/**\n * Add start event replacing element with expanded sub process.\n *\n * @param {Injector} injector\n * @param {Modeling} modeling\n */\nexport default function SubProcessStartEventBehavior(injector, modeling) {\n  injector.invoke(CommandInterceptor, this);\n\n  this.postExecuted(\"shape.replace\", function (event) {\n    let oldShape = event.context.oldShape,\n      newShape = event.context.newShape;\n\n    if (\n      !is(newShape, \"bpmn:Loop\") ||\n      !is(newShape, \"bpmn:Conditional\") ||\n      !is(oldShape, \"bpmn:Task\") ||\n      !isExpanded(newShape)\n    ) {\n      return;\n    }\n\n    let position = getStartEventPosition(newShape);\n\n    modeling.createShape({ type: \"bpmn:StartEvent\" }, position, newShape);\n  });\n}\n\nSubProcessStartEventBehavior.$inject = [\"injector\", \"modeling\"];\n\ninherits(SubProcessStartEventBehavior, CommandInterceptor);\n\n// helpers //////////\n\nfunction getStartEventPosition(shape) {\n  return {\n    x: shape.x + shape.width / 6,\n    y: shape.y + shape.height / 2,\n  };\n}\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { getBusinessObject, is } from \"../../../util/ModelUtil\";\n\nimport { computeChildrenBBox } from \"diagram-js/lib/features/resize/ResizeUtil\";\n\nconst LOW_PRIORITY = 500;\n\nexport default function ToggleElementCollapseBehaviour(\n  eventBus,\n  elementFactory,\n  modeling,\n  resize\n) {\n  CommandInterceptor.call(this, eventBus);\n\n  function hideEmptyLabels(children) {\n    if (children.length) {\n      children.forEach(function (child) {\n        if (child.type === \"label\" && !child.businessObject.name) {\n          child.hidden = true;\n        }\n      });\n    }\n  }\n\n  function expandedBounds(shape, defaultSize) {\n    let children = shape.children,\n      newBounds = defaultSize,\n      visibleElements,\n      visibleBBox;\n\n    visibleElements = filterVisible(children).concat([shape]);\n\n    visibleBBox = computeChildrenBBox(visibleElements);\n\n    if (visibleBBox) {\n      // center to visibleBBox with max(defaultSize, childrenBounds)\n      newBounds.width = Math.max(visibleBBox.width, newBounds.width);\n      newBounds.height = Math.max(visibleBBox.height, newBounds.height);\n\n      newBounds.x = visibleBBox.x + (visibleBBox.width - newBounds.width) / 2;\n      newBounds.y = visibleBBox.y + (visibleBBox.height - newBounds.height) / 2;\n    } else {\n      // center to collapsed shape with defaultSize\n      newBounds.x = shape.x + (shape.width - newBounds.width) / 2;\n      newBounds.y = shape.y + (shape.height - newBounds.height) / 2;\n    }\n\n    return newBounds;\n  }\n\n  function collapsedBounds(shape, defaultSize) {\n    return {\n      x: shape.x + (shape.width - defaultSize.width) / 2,\n      y: shape.y + (shape.height - defaultSize.height) / 2,\n      width: defaultSize.width,\n      height: defaultSize.height,\n    };\n  }\n\n  this.executed([\"shape.toggleCollapse\"], LOW_PRIORITY, function (e) {\n    let context = e.context,\n      shape = context.shape;\n\n    if (!is(shape, \"bpmn:Loop\")) {\n      return;\n    }\n\n    if (!shape.collapsed) {\n      // all children got made visible through djs, hide empty labels\n      hideEmptyLabels(shape.children);\n\n      // remove collapsed marker\n      getBusinessObject(shape).di.isExpanded = true;\n    } else {\n      // place collapsed marker\n      getBusinessObject(shape).di.isExpanded = false;\n    }\n  });\n\n  this.reverted([\"shape.toggleCollapse\"], LOW_PRIORITY, function (e) {\n    let context = e.context;\n    let shape = context.shape;\n\n    // revert removing/placing collapsed marker\n    if (!shape.collapsed) {\n      getBusinessObject(shape).di.isExpanded = true;\n    } else {\n      getBusinessObject(shape).di.isExpanded = false;\n    }\n  });\n\n  this.postExecuted([\"shape.toggleCollapse\"], LOW_PRIORITY, function (e) {\n    let shape = e.context.shape,\n      defaultSize = elementFactory._getDefaultSize(shape),\n      newBounds;\n\n    if (shape.collapsed) {\n      // resize to default size of collapsed shapes\n      newBounds = collapsedBounds(shape, defaultSize);\n    } else {\n      // resize to bounds of max(visible children, defaultSize)\n      newBounds = expandedBounds(shape, defaultSize);\n    }\n\n    modeling.resizeShape(shape, newBounds, null, {\n      autoResize: shape.collapsed ? false : \"nwse\",\n    });\n  });\n}\n\ninherits(ToggleElementCollapseBehaviour, CommandInterceptor);\n\nToggleElementCollapseBehaviour.$inject = [\n  \"eventBus\",\n  \"elementFactory\",\n  \"modeling\",\n];\n\n// helpers //////////////////////\n\nfunction filterVisible(elements) {\n  return elements.filter(function (e) {\n    return !e.hidden;\n  });\n}\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { is } from \"../../../util/ModelUtil\";\nimport { isExpanded } from \"../../../util/DiUtil\";\nimport { isLabel } from \"../../../util/LabelUtil\";\n\n/**\n * Unclaims model IDs on element deletion.\n *\n * @param {Canvas} canvas\n * @param {Injector} injector\n * @param {Moddle} moddle\n * @param {Modeling} modeling\n */\nexport default function UnclaimIdBehavior(canvas, injector, moddle, modeling) {\n  injector.invoke(CommandInterceptor, this);\n\n  this.preExecute(\"shape.delete\", function (event) {\n    let context = event.context,\n      shape = context.shape,\n      shapeBo = shape.businessObject;\n\n    if (isLabel(shape)) {\n      return;\n    }\n\n    if (is(shape, \"bpmn:Participant\") && isExpanded(shape)) {\n      moddle.ids.unclaim(shapeBo.processRef.id);\n    }\n\n    modeling.unclaimId(shapeBo.id, shapeBo);\n  });\n\n  this.preExecute(\"connection.delete\", function (event) {\n    let context = event.context,\n      connection = context.connection,\n      connectionBo = connection.businessObject;\n\n    modeling.unclaimId(connectionBo.id, connectionBo);\n  });\n\n  this.preExecute(\"canvas.updateRoot\", function () {\n    let rootElement = canvas.getRootElement(),\n      rootElementBo = rootElement.businessObject;\n\n    moddle.ids.unclaim(rootElementBo.id);\n  });\n}\n\ninherits(UnclaimIdBehavior, CommandInterceptor);\n\nUnclaimIdBehavior.$inject = [\"canvas\", \"injector\", \"moddle\", \"modeling\"];\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\nconst LOW_PRIORITY = 500,\n  HIGH_PRIORITY = 5000;\n\n/**\n * BPMN specific delete lane behavior\n */\nexport default function UpdateFlowNodeRefsBehavior(\n  eventBus,\n  modeling,\n  translate\n) {\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Ok, this is it:\n   *\n   * We have to update the Lane#flowNodeRefs _and_\n   * FlowNode#lanes with every FlowNode move/resize and\n   * Lane move/resize.\n   *\n   * We want to group that stuff to recompute containments\n   * as efficient as possible.\n   *\n   * Yea!\n   */\n\n  // the update context\n  let context;\n\n  function initContext() {\n    context = context || new UpdateContext();\n    context.enter();\n\n    return context;\n  }\n\n  function getContext() {\n    if (!context) {\n      throw new Error(translate(\"out of bounds release\"));\n    }\n\n    return context;\n  }\n\n  function releaseContext() {\n    if (!context) {\n      throw new Error(translate(\"out of bounds release\"));\n    }\n\n    let triggerUpdate = context.leave();\n\n    if (triggerUpdate) {\n      modeling.updateLaneRefs(context.flowNodes, context.lanes);\n\n      context = null;\n    }\n\n    return triggerUpdate;\n  }\n\n  let laneRefUpdateEvents = [\n    \"spaceTool\",\n    \"lane.add\",\n    \"lane.resize\",\n    \"lane.split\",\n    \"elements.create\",\n    \"elements.delete\",\n    \"elements.move\",\n    \"shape.create\",\n    \"shape.delete\",\n    \"shape.move\",\n    \"shape.resize\",\n  ];\n\n  // listen to a lot of stuff to group lane updates\n\n  this.preExecute(laneRefUpdateEvents, HIGH_PRIORITY, function (event) {\n    initContext();\n  });\n\n  this.postExecuted(laneRefUpdateEvents, LOW_PRIORITY, function (event) {\n    releaseContext();\n  });\n\n  // Mark flow nodes + lanes that need an update\n\n  this.preExecute(\n    [\"shape.create\", \"shape.move\", \"shape.delete\", \"shape.resize\"],\n    function (event) {\n      let context = event.context,\n        shape = context.shape;\n\n      let updateContext = getContext();\n\n      // no need to update labels\n      if (shape.labelTarget) {\n        return;\n      }\n\n      if (is(shape, \"bpmn:Lane\")) {\n        updateContext.addLane(shape);\n      }\n\n      if (is(shape, \"bpmn:FlowNode\")) {\n        updateContext.addFlowNode(shape);\n      }\n    }\n  );\n}\n\nUpdateFlowNodeRefsBehavior.$inject = [\"eventBus\", \"modeling\", \"translate\"];\n\ninherits(UpdateFlowNodeRefsBehavior, CommandInterceptor);\n\nfunction UpdateContext() {\n  this.flowNodes = [];\n  this.lanes = [];\n\n  this.counter = 0;\n\n  this.addLane = function (lane) {\n    this.lanes.push(lane);\n  };\n\n  this.addFlowNode = function (flowNode) {\n    this.flowNodes.push(flowNode);\n  };\n\n  this.enter = function () {\n    this.counter++;\n  };\n\n  this.leave = function () {\n    this.counter--;\n\n    return !this.counter;\n  };\n}\n","import inherits from \"inherits\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport { getBusinessObject, is } from \"../../../util/ModelUtil\";\n\n/**\n * A behavior that unsets the Default property of\n * sequence flow source on element delete, if the\n * removed element is the Gateway or Task's default flow.\n *\n * @param {EventBus} eventBus\n * @param {Modeling} modeling\n */\nexport default function DeleteSequenceFlowBehavior(eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  this.preExecute(\"connection.delete\", function (event) {\n    let context = event.context,\n      connection = context.connection,\n      source = connection.source;\n\n    if (isDefaultFlow(connection, source)) {\n      modeling.updateProperties(source, {\n        default: null,\n      });\n    }\n  });\n}\n\ninherits(DeleteSequenceFlowBehavior, CommandInterceptor);\n\nDeleteSequenceFlowBehavior.$inject = [\"eventBus\", \"modeling\"];\n\n// helpers //////////////////////\n\nfunction isDefaultFlow(connection, source) {\n  if (!is(connection, \"bpmn:SequenceFlow\")) {\n    return false;\n  }\n\n  let sourceBo = getBusinessObject(source),\n    sequenceFlow = getBusinessObject(connection);\n\n  return sourceBo.get(\"default\") === sequenceFlow;\n}\n","import AdaptiveLabelPositioningBehavior from \"./AdaptiveLabelPositioningBehavior\";\nimport AppendBehavior from \"./AppendBehavior\";\nimport AssociationBehavior from \"./AssociationBehavior\";\nimport AttachEventBehavior from \"./AttachEventBehavior\";\nimport BoundaryEventBehavior from \"./BoundaryEventBehavior\";\nimport RootElementReferenceBehavior from \"./RootElementReferenceBehavior\";\nimport CreateBehavior from \"./CreateBehavior\";\nimport FixHoverBehavior from \"./FixHoverBehavior\";\nimport CreateDataObjectBehavior from \"./CreateDataObjectBehavior\";\nimport CreateParticipantBehavior from \"./CreateParticipantBehavior\";\nimport DataInputAssociationBehavior from \"./DataInputAssociationBehavior\";\nimport DataStoreBehavior from \"./DataStoreBehavior\";\nimport DeleteLaneBehavior from \"./DeleteLaneBehavior\";\nimport DetachEventBehavior from \"./DetachEventBehavior\";\nimport DropOnFlowBehavior from \"./DropOnFlowBehavior\";\nimport EventBasedGatewayBehavior from \"./EventBasedGatewayBehavior\";\nimport GroupBehavior from \"./GroupBehavior\";\nimport ImportDockingFix from \"./ImportDockingFix\";\nimport IsHorizontalFix from \"./IsHorizontalFix\";\nimport LabelBehavior from \"./LabelBehavior\";\nimport ModelingFeedback from \"./ModelingFeedback\";\nimport ReplaceConnectionBehavior from \"./ReplaceConnectionBehavior\";\nimport RemoveParticipantBehavior from \"./RemoveParticipantBehavior\";\nimport ReplaceElementBehaviour from \"./ReplaceElementBehaviour\";\nimport ResizeBehavior from \"./ResizeBehavior\";\nimport ResizeLaneBehavior from \"./ResizeLaneBehavior\";\nimport RemoveElementBehavior from \"./RemoveElementBehavior\";\nimport SpaceToolBehavior from \"./SpaceToolBehavior\";\nimport SubProcessStartEventBehavior from \"./SubProcessStartEventBehavior\";\nimport ToggleElementCollapseBehaviour from \"./ToggleElementCollapseBehaviour\";\nimport UnclaimIdBehavior from \"./UnclaimIdBehavior\";\nimport UpdateFlowNodeRefsBehavior from \"./UpdateFlowNodeRefsBehavior\";\nimport UnsetDefaultFlowBehavior from \"./UnsetDefaultFlowBehavior\";\n\nexport default {\n  __init__: [\n    \"adaptiveLabelPositioningBehavior\",\n    \"appendBehavior\",\n    \"associationBehavior\",\n    \"attachEventBehavior\",\n    \"boundaryEventBehavior\",\n    \"rootElementReferenceBehavior\",\n    \"createBehavior\",\n    \"fixHoverBehavior\",\n    \"createDataObjectBehavior\",\n    \"createParticipantBehavior\",\n    \"dataStoreBehavior\",\n    \"dataInputAssociationBehavior\",\n    \"deleteLaneBehavior\",\n    \"detachEventBehavior\",\n    \"dropOnFlowBehavior\",\n    \"eventBasedGatewayBehavior\",\n    \"groupBehavior\",\n    \"importDockingFix\",\n    \"isHorizontalFix\",\n    \"labelBehavior\",\n    \"modelingFeedback\",\n    \"removeElementBehavior\",\n    \"removeParticipantBehavior\",\n    \"replaceConnectionBehavior\",\n    \"replaceElementBehaviour\",\n    \"resizeBehavior\",\n    \"resizeLaneBehavior\",\n    \"toggleElementCollapseBehaviour\",\n    \"spaceToolBehavior\",\n    \"subProcessStartEventBehavior\",\n    \"unclaimIdBehavior\",\n    \"unsetDefaultFlowBehavior\",\n    \"updateFlowNodeRefsBehavior\",\n  ],\n  adaptiveLabelPositioningBehavior: [\"type\", AdaptiveLabelPositioningBehavior],\n  appendBehavior: [\"type\", AppendBehavior],\n  associationBehavior: [\"type\", AssociationBehavior],\n  attachEventBehavior: [\"type\", AttachEventBehavior],\n  boundaryEventBehavior: [\"type\", BoundaryEventBehavior],\n  rootElementReferenceBehavior: [\"type\", RootElementReferenceBehavior],\n  createBehavior: [\"type\", CreateBehavior],\n  fixHoverBehavior: [\"type\", FixHoverBehavior],\n  createDataObjectBehavior: [\"type\", CreateDataObjectBehavior],\n  createParticipantBehavior: [\"type\", CreateParticipantBehavior],\n  dataInputAssociationBehavior: [\"type\", DataInputAssociationBehavior],\n  dataStoreBehavior: [\"type\", DataStoreBehavior],\n  deleteLaneBehavior: [\"type\", DeleteLaneBehavior],\n  detachEventBehavior: [\"type\", DetachEventBehavior],\n  dropOnFlowBehavior: [\"type\", DropOnFlowBehavior],\n  eventBasedGatewayBehavior: [\"type\", EventBasedGatewayBehavior],\n  groupBehavior: [\"type\", GroupBehavior],\n  importDockingFix: [\"type\", ImportDockingFix],\n  isHorizontalFix: [\"type\", IsHorizontalFix],\n  labelBehavior: [\"type\", LabelBehavior],\n  modelingFeedback: [\"type\", ModelingFeedback],\n  replaceConnectionBehavior: [\"type\", ReplaceConnectionBehavior],\n  removeParticipantBehavior: [\"type\", RemoveParticipantBehavior],\n  replaceElementBehaviour: [\"type\", ReplaceElementBehaviour],\n  resizeBehavior: [\"type\", ResizeBehavior],\n  resizeLaneBehavior: [\"type\", ResizeLaneBehavior],\n  removeElementBehavior: [\"type\", RemoveElementBehavior],\n  toggleElementCollapseBehaviour: [\"type\", ToggleElementCollapseBehaviour],\n  spaceToolBehavior: [\"type\", SpaceToolBehavior],\n  subProcessStartEventBehavior: [\"type\", SubProcessStartEventBehavior],\n  unclaimIdBehavior: [\"type\", UnclaimIdBehavior],\n  updateFlowNodeRefsBehavior: [\"type\", UpdateFlowNodeRefsBehavior],\n  unsetDefaultFlowBehavior: [\"type\", UnsetDefaultFlowBehavior],\n};\n","import { getOrientation } from \"diagram-js/lib/layout/LayoutUtil\";\r\n\r\nexport function getBoundaryAttachment(position, targetBounds) {\r\n  let orientation = getOrientation(position, targetBounds, -15);\r\n\r\n  if (orientation !== \"intersect\") {\r\n    return orientation;\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\n","import { every, find, forEach, some } from \"min-dash\";\n\nimport inherits from \"inherits\";\n\nimport { is, getBusinessObject } from \"../../util/ModelUtil\";\n\nimport { getParent, isAny } from \"../modeling/util/ModelingUtil\";\n\nimport { isLabel } from \"../../util/LabelUtil\";\n\nimport {\n  isExpanded,\n  isEventLoop,\n  isInterrupting,\n  hasErrorEventDefinition,\n  hasEscalationEventDefinition,\n  hasCompensateEventDefinition,\n} from \"../../util/DiUtil\";\n\nimport RuleProvider from \"diagram-js/lib/features/rules/RuleProvider\";\n\nimport { getBoundaryAttachment as isBoundaryAttachment } from \"../snapping/BpmnSnappingUtil\";\n\n/**\n * BPMN specific modeling rule\n */\nexport default function BpmnRules(eventBus) {\n  RuleProvider.call(this, eventBus);\n}\n\ninherits(BpmnRules, RuleProvider);\n\nBpmnRules.$inject = [\"eventBus\"];\n\nBpmnRules.prototype.init = function () {\n  this.addRule(\"connection.start\", function (context) {\n    let source = context.source;\n\n    return canStartConnection(source);\n  });\n\n  this.addRule(\"connection.create\", function (context) {\n    let source = context.source,\n      target = context.target,\n      hints = context.hints || {},\n      targetParent = hints.targetParent,\n      targetAttach = hints.targetAttach;\n\n    // don't allow incoming connections on\n    // newly created boundary events\n    // to boundary events\n    if (targetAttach) {\n      return false;\n    }\n\n    // temporarily set target parent for scoping\n    // checks to work\n    if (targetParent) {\n      target.parent = targetParent;\n    }\n\n    try {\n      return canConnect(source, target);\n    } finally {\n      // unset temporary target parent\n      if (targetParent) {\n        target.parent = null;\n      }\n    }\n  });\n\n  this.addRule(\"connection.reconnect\", function (context) {\n    let connection = context.connection,\n      source = context.source,\n      target = context.target;\n\n    return canConnect(source, target, connection);\n  });\n\n  this.addRule(\"connection.updateWaypoints\", function (context) {\n    return {\n      type: context.connection.type,\n    };\n  });\n\n  this.addRule(\"shape.resize\", function (context) {\n    let shape = context.shape,\n      newBounds = context.newBounds;\n\n    return canResize(shape, newBounds);\n  });\n\n  this.addRule(\"elements.create\", function (context) {\n    let elements = context.elements,\n      position = context.position,\n      target = context.target;\n\n    return every(elements, function (element) {\n      if (isConnection(element)) {\n        return canConnect(element.source, element.target, element);\n      }\n\n      if (element.host) {\n        return canAttach(element, element.host, null, position);\n      }\n\n      return canCreate(element, target, null, position);\n    });\n  });\n\n  this.addRule(\"elements.move\", function (context) {\n    let target = context.target,\n      shapes = context.shapes,\n      position = context.position;\n\n    return (\n      canAttach(shapes, target, null, position) ||\n      canReplace(shapes, target, position) ||\n      canMove(shapes, target, position) ||\n      canInsert(shapes, target, position)\n    );\n  });\n\n  this.addRule(\"shape.create\", function (context) {\n    return canCreate(\n      context.shape,\n      context.target,\n      context.source,\n      context.position\n    );\n  });\n\n  this.addRule(\"shape.attach\", function (context) {\n    return canAttach(context.shape, context.target, null, context.position);\n  });\n\n  this.addRule(\"element.copy\", function (context) {\n    let element = context.element,\n      elements = context.elements;\n\n    return canCopy(elements, element);\n  });\n};\n\nBpmnRules.prototype.canConnectMessageFlow = canConnectMessageFlow;\n\nBpmnRules.prototype.canConnectSequenceFlow = canConnectSequenceFlow;\n\nBpmnRules.prototype.canConnectDataAssociation = canConnectDataAssociation;\n\nBpmnRules.prototype.canConnectAssociation = canConnectAssociation;\n\nBpmnRules.prototype.canMove = canMove;\n\nBpmnRules.prototype.canAttach = canAttach;\n\nBpmnRules.prototype.canReplace = canReplace;\n\nBpmnRules.prototype.canDrop = canDrop;\n\nBpmnRules.prototype.canInsert = canInsert;\n\nBpmnRules.prototype.canCreate = canCreate;\n\nBpmnRules.prototype.canConnect = canConnect;\n\nBpmnRules.prototype.canResize = canResize;\n\nBpmnRules.prototype.canCopy = canCopy;\n\n/**\n * Utility functions for rule checking\n */\n\n/**\n * Checks if given element can be used for starting connection.\n *\n * @param  {Element} source\n * @return {Boolean}\n */\nfunction canStartConnection(element) {\n  if (nonExistingOrLabel(element)) {\n    return null;\n  }\n\n  return isAny(element, [\n    \"bpmn:FlowNode\",\n    \"bpmn:InteractionNode\",\n    \"bpmn:DataObjectReference\",\n    \"bpmn:DataStoreReference\",\n  ]);\n}\n\nfunction nonExistingOrLabel(element) {\n  return !element || isLabel(element);\n}\n\nfunction isSame(a, b) {\n  return a === b;\n}\n\nfunction getOrganizationalParent(element) {\n  do {\n    if (is(element, \"bpmn:Process-action\")) {\n      return getBusinessObject(element);\n    }\n\n    if (is(element, \"bpmn:Participant\")) {\n      return (\n        getBusinessObject(element).processRef || getBusinessObject(element)\n      );\n    }\n  } while ((element = element.parent));\n}\n\nfunction isTextAnnotation(element) {\n  return is(element, \"bpmn:TextAnnotation\");\n}\n\nfunction isGroup(element) {\n  return is(element, \"bpmn:Group\") && !element.labelTarget;\n}\n\nfunction isCompensationBoundary(element) {\n  return (\n    is(element, \"bpmn:BoundaryEvent\") &&\n    hasEventDefinition(element, \"bpmn:CompensateEventDefinition\")\n  );\n}\n\nfunction isForCompensation(e) {\n  return getBusinessObject(e).isForCompensation;\n}\n\nfunction isSameOrganization(a, b) {\n  let parentA = getOrganizationalParent(a),\n    parentB = getOrganizationalParent(b);\n\n  return parentA === parentB;\n}\n\nfunction isMessageFlowSource(element) {\n  return (\n    is(element, \"bpmn:InteractionNode\") &&\n    (!is(element, \"bpmn:Event\") ||\n      (is(element, \"bpmn:ThrowEvent\") &&\n        hasEventDefinitionOrNone(element, \"bpmn:MessageEventDefinition\")))\n  );\n}\n\nfunction isMessageFlowTarget(element) {\n  return (\n    is(element, \"bpmn:InteractionNode\") &&\n    !isForCompensation(element) &&\n    (!is(element, \"bpmn:Event\") ||\n      (is(element, \"bpmn:CatchEvent\") &&\n        hasEventDefinitionOrNone(element, \"bpmn:MessageEventDefinition\")))\n  );\n}\n\nfunction getScopeParent(element) {\n  let parent = element;\n\n  while ((parent = parent.parent)) {\n    if (is(parent, \"bpmn:FlowElementsContainer\")) {\n      return getBusinessObject(parent);\n    }\n\n    if (is(parent, \"bpmn:Participant\")) {\n      return getBusinessObject(parent).processRef;\n    }\n  }\n\n  return null;\n}\n\nfunction isSameScope(a, b) {\n  let scopeParentA = getScopeParent(a),\n    scopeParentB = getScopeParent(b);\n\n  return scopeParentA === scopeParentB;\n}\n\nfunction hasEventDefinition(element, eventDefinition) {\n  let bo = getBusinessObject(element);\n\n  return !!find(bo.eventDefinitions || [], function (definition) {\n    return is(definition, eventDefinition);\n  });\n}\n\nfunction hasEventDefinitionOrNone(element, eventDefinition) {\n  let bo = getBusinessObject(element);\n\n  return (bo.eventDefinitions || []).every(function (definition) {\n    return is(definition, eventDefinition);\n  });\n}\n\nfunction isSequenceFlowSource(element) {\n  return (\n    is(element, \"bpmn:FlowNode\") &&\n    !is(element, \"bpmn:EndEvent\") &&\n    !isEventLoop(element) &&\n    !(\n      is(element, \"bpmn:IntermediateThrowEvent\") &&\n      hasEventDefinition(element, \"bpmn:LinkEventDefinition\")\n    ) &&\n    !isCompensationBoundary(element) &&\n    !isForCompensation(element)\n  );\n}\n\nfunction isSequenceFlowTarget(element) {\n  return (\n    is(element, \"bpmn:FlowNode\") &&\n    !is(element, \"bpmn:StartEvent\") &&\n    !is(element, \"bpmn:BoundaryEvent\") &&\n    !isEventLoop(element) &&\n    !(\n      is(element, \"bpmn:IntermediateCatchEvent\") &&\n      hasEventDefinition(element, \"bpmn:LinkEventDefinition\")\n    ) &&\n    !isForCompensation(element)\n  );\n}\n\nfunction isEventBasedTarget(element) {\n  return (\n    is(element, \"bpmn:ReceiveTask\") ||\n    (is(element, \"bpmn:IntermediateCatchEvent\") &&\n      (hasEventDefinition(element, \"bpmn:MessageEventDefinition\") ||\n        hasEventDefinition(element, \"bpmn:TimerEventDefinition\") ||\n        hasEventDefinition(element, \"bpmn:ConditionalEventDefinition\") ||\n        hasEventDefinition(element, \"bpmn:SignalEventDefinition\")))\n  );\n}\n\nfunction isConnection(element) {\n  return element.waypoints;\n}\n\nfunction getParents(element) {\n  let parents = [];\n\n  while (element) {\n    element = element.parent;\n\n    if (element) {\n      parents.push(element);\n    }\n  }\n\n  return parents;\n}\n\nfunction isParent(possibleParent, element) {\n  let allParents = getParents(element);\n  return allParents.indexOf(possibleParent) !== -1;\n}\n\nfunction canConnect(source, target, connection) {\n  if (nonExistingOrLabel(source) || nonExistingOrLabel(target)) {\n    return null;\n  }\n\n  if (!is(connection, \"bpmn:DataAssociation\")) {\n    if (canConnectMessageFlow(source, target)) {\n      return { type: \"bpmn:MessageFlow\" };\n    }\n\n    if (canConnectSequenceFlow(source, target)) {\n      return { type: \"bpmn:SequenceFlow\" };\n    }\n  }\n\n  let connectDataAssociation = canConnectDataAssociation(source, target);\n\n  if (connectDataAssociation) {\n    return connectDataAssociation;\n  }\n\n  if (isCompensationBoundary(source) && isForCompensation(target)) {\n    return {\n      type: \"bpmn:Association\",\n      associationDirection: \"One\",\n    };\n  }\n\n  if (canConnectAssociation(source, target)) {\n    return {\n      type: \"bpmn:Association\",\n    };\n  }\n\n  return false;\n}\n\n/**\n * Can an element be dropped into the target element\n *\n * @return {Boolean}\n */\nfunction canDrop(element, target, position) {\n  // can move labels and groups everywhere\n  if (isLabel(element) || isGroup(element)) {\n    return true;\n  }\n\n  // disallow to create elements on collapsed pools\n  if (is(target, \"bpmn:Participant\") && !isExpanded(target)) {\n    return false;\n  }\n\n  // allow to create new participants on\n  // existing collaboration and process diagrams\n  if (is(element, \"bpmn:Participant\")) {\n    return is(target, \"bpmn:Process-action\") || is(target, \"bpmn:Collaboration\");\n  }\n\n  // allow moving DataInput / DataOutput within its original container only\n  if (isAny(element, [\"bpmn:DataInput\", \"bpmn:DataOutput\"])) {\n    if (element.parent) {\n      return target === element.parent;\n    }\n  }\n\n  // allow creating lanes on participants and other lanes only\n  if (is(element, \"bpmn:Lane\")) {\n    return is(target, \"bpmn:Participant\") || is(target, \"bpmn:Lane\");\n  }\n\n  // disallow dropping boundary events which cannot replace with intermediate event\n  if (is(element, \"bpmn:BoundaryEvent\") && !isDroppableBoundaryEvent(element)) {\n    return false;\n  }\n\n  // drop flow elements onto flow element containers\n  // and participants\n  if (\n    is(element, \"bpmn:FlowElement\") &&\n    !is(element, \"bpmn:DataStoreReference\")\n  ) {\n    if (is(target, \"bpmn:FlowElementsContainer\")) {\n      return isExpanded(target);\n    }\n\n    return isAny(target, [\"bpmn:Participant\", \"bpmn:Lane\"]);\n  }\n\n  // account for the fact that data associations are always\n  // rendered and moved to top (Process or Collaboration level)\n  //\n  // artifacts may be placed wherever, too\n  if (\n    isAny(element, [\n      \"bpmn:Artifact\",\n      \"bpmn:DataAssociation\",\n      \"bpmn:DataStoreReference\",\n    ])\n  ) {\n    return isAny(target, [\n      \"bpmn:Collaboration\",\n      \"bpmn:Lane\",\n      \"bpmn:Participant\",\n      \"bpmn:Process-action\",\n      \"bpmn:Loop\",\n      \"bpmn:Conditional\",\n    ]);\n  }\n\n  if (is(element, \"bpmn:MessageFlow\")) {\n    return (\n      is(target, \"bpmn:Collaboration\") ||\n      element.source.parent === target ||\n      element.target.parent === target\n    );\n  }\n\n  return false;\n}\n\nfunction isDroppableBoundaryEvent(event) {\n  return (\n    getBusinessObject(event).cancelActivity &&\n    (hasNoEventDefinition(event) ||\n      hasCommonBoundaryIntermediateEventDefinition(event))\n  );\n}\n\nfunction isBoundaryEvent(element) {\n  return !isLabel(element) && is(element, \"bpmn:BoundaryEvent\");\n}\n\nfunction isLane(element) {\n  return is(element, \"bpmn:Lane\");\n}\n\n/**\n * We treat IntermediateThrowEvents as boundary events during create,\n * this must be reflected in the rules.\n */\nfunction isBoundaryCandidate(element) {\n  if (isBoundaryEvent(element)) {\n    return true;\n  }\n\n  if (\n    is(element, \"bpmn:IntermediateThrowEvent\") &&\n    hasNoEventDefinition(element)\n  ) {\n    return true;\n  }\n\n  return (\n    is(element, \"bpmn:IntermediateCatchEvent\") &&\n    hasCommonBoundaryIntermediateEventDefinition(element)\n  );\n}\n\nfunction hasNoEventDefinition(element) {\n  let bo = getBusinessObject(element);\n\n  return bo && !(bo.eventDefinitions && bo.eventDefinitions.length);\n}\n\nfunction hasCommonBoundaryIntermediateEventDefinition(element) {\n  return hasOneOfEventDefinitions(element, [\n    \"bpmn:MessageEventDefinition\",\n    \"bpmn:TimerEventDefinition\",\n    \"bpmn:SignalEventDefinition\",\n    \"bpmn:ConditionalEventDefinition\",\n  ]);\n}\n\nfunction hasOneOfEventDefinitions(element, eventDefinitions) {\n  return eventDefinitions.some(function (definition) {\n    return hasEventDefinition(element, definition);\n  });\n}\n\nfunction isReceiveTaskAfterEventBasedGateway(element) {\n  return (\n    is(element, \"bpmn:ReceiveTask\") &&\n    find(element.incoming, function (incoming) {\n      return is(incoming.source, \"bpmn:EventBasedGateway\");\n    })\n  );\n}\n\nfunction canAttach(elements, target, source, position) {\n  if (!Array.isArray(elements)) {\n    elements = [elements];\n  }\n\n  // only (re-)attach one element at a time\n  if (elements.length !== 1) {\n    return false;\n  }\n\n  let element = elements[0];\n\n  // do not attach labels\n  if (isLabel(element)) {\n    return false;\n  }\n\n  // only handle boundary events\n  if (!isBoundaryCandidate(element)) {\n    return false;\n  }\n\n  // disallow drop on event sub processes\n  if (isEventLoop(target)) {\n    return false;\n  }\n\n  // only allow drop on non compensation activities\n  if (!is(target, \"bpmn:Activity\") || isForCompensation(target)) {\n    return false;\n  }\n\n  // only attach to loop border\n  if (position && !isBoundaryAttachment(position, target)) {\n    return false;\n  }\n\n  // do not attach on receive tasks after event based gateways\n  if (isReceiveTaskAfterEventBasedGateway(target)) {\n    return false;\n  }\n\n  return \"attach\";\n}\n\n/**\n * Defines how to replace elements for a given target.\n *\n * Returns an array containing all elements which will be replaced.\n *\n * @example\n *\n *  [{ id: 'IntermediateEvent_2',\n *     type: 'bpmn:StartEvent'\n *   },\n *   { id: 'IntermediateEvent_5',\n *     type: 'bpmn:EndEvent'\n *   }]\n *\n * @param  {Array} elements\n * @param  {Object} target\n *\n * @return {Object} an object containing all elements which have to be replaced\n */\nfunction canReplace(elements, target, position) {\n  if (!target) {\n    return false;\n  }\n\n  let canExecute = {\n    replacements: [],\n  };\n\n  forEach(elements, function (element) {\n    if (!isEventLoop(target)) {\n      if (\n        is(element, \"bpmn:StartEvent\") &&\n        element.type !== \"label\" &&\n        canDrop(element, target)\n      ) {\n        // replace a non-interrupting start event by a blank interrupting start event\n        // when the target is not an event sub process\n        if (!isInterrupting(element)) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: \"bpmn:StartEvent\",\n          });\n        }\n\n        // replace an error/escalation/compensate start event by a blank interrupting start event\n        // when the target is not an event sub process\n        if (\n          hasErrorEventDefinition(element) ||\n          hasEscalationEventDefinition(element) ||\n          hasCompensateEventDefinition(element)\n        ) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: \"bpmn:StartEvent\",\n          });\n        }\n      }\n    }\n\n    if (!is(target, \"bpmn:Transaction\")) {\n      if (\n        hasEventDefinition(element, \"bpmn:CancelEventDefinition\") &&\n        element.type !== \"label\"\n      ) {\n        if (is(element, \"bpmn:EndEvent\") && canDrop(element, target)) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: \"bpmn:EndEvent\",\n          });\n        }\n\n        if (\n          is(element, \"bpmn:BoundaryEvent\") &&\n          canAttach(element, target, null, position)\n        ) {\n          canExecute.replacements.push({\n            oldElementId: element.id,\n            newElementType: \"bpmn:BoundaryEvent\",\n          });\n        }\n      }\n    }\n  });\n\n  return canExecute.replacements.length ? canExecute : false;\n}\n\nfunction canMove(elements, target) {\n  // do not move selection containing lanes\n  if (some(elements, isLane)) {\n    return false;\n  }\n\n  // allow default move check to start move operation\n  if (!target) {\n    return true;\n  }\n\n  return elements.every(function (element) {\n    return canDrop(element, target);\n  });\n}\n\nfunction canCreate(shape, target, source, position) {\n  if (!target) {\n    return false;\n  }\n\n  if (isLabel(shape) || isGroup(shape)) {\n    return true;\n  }\n\n  if (isSame(source, target)) {\n    return false;\n  }\n\n  // ensure we do not drop the element\n  // into source\n  if (source && isParent(source, target)) {\n    return false;\n  }\n\n  return canDrop(shape, target, position) || canInsert(shape, target, position);\n}\n\nfunction canResize(shape, newBounds) {\n  if (is(shape, \"bpmn:Loop\")) {\n    return (\n      isExpanded(shape) &&\n      (!newBounds || (newBounds.width >= 100 && newBounds.height >= 80))\n    );\n  }\n\n  if (is(shape, \"bpmn:Conditional\")) {\n    return (\n      isExpanded(shape) &&\n      (!newBounds || (newBounds.width >= 100 && newBounds.height >= 80))\n    );\n  }\n\n  if (is(shape, \"bpmn:Lane\")) {\n    return !newBounds || (newBounds.width >= 130 && newBounds.height >= 60);\n  }\n\n  if (is(shape, \"bpmn:Participant\")) {\n    return !newBounds || (newBounds.width >= 250 && newBounds.height >= 50);\n  }\n\n  if (isTextAnnotation(shape)) {\n    return true;\n  }\n\n  if (isGroup(shape)) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Check, whether one side of the relationship\n * is a text annotation.\n */\nfunction isOneTextAnnotation(source, target) {\n  let sourceTextAnnotation = isTextAnnotation(source),\n    targetTextAnnotation = isTextAnnotation(target);\n\n  return (\n    (sourceTextAnnotation || targetTextAnnotation) &&\n    sourceTextAnnotation !== targetTextAnnotation\n  );\n}\n\nfunction canConnectAssociation(source, target) {\n  // do not connect connections\n  if (isConnection(source) || isConnection(target)) {\n    return false;\n  }\n\n  // compensation boundary events are exception\n  if (isCompensationBoundary(source) && isForCompensation(target)) {\n    return true;\n  }\n\n  // don't connect parent <-> child\n  if (isParent(target, source) || isParent(source, target)) {\n    return false;\n  }\n\n  // allow connection of associations between <!TextAnnotation> and <TextAnnotation>\n  if (isOneTextAnnotation(source, target)) {\n    return true;\n  }\n\n  // can connect associations where we can connect\n  // data associations, too (!)\n  return !!canConnectDataAssociation(source, target);\n}\n\nfunction canConnectMessageFlow(source, target) {\n  // during connect user might move mouse out of canvas\n  // https://github.com/bpmn-io/bpmn-js/issues/1033\n  if (getRootElement(source) && !getRootElement(target)) {\n    return false;\n  }\n\n  return (\n    isMessageFlowSource(source) &&\n    isMessageFlowTarget(target) &&\n    !isSameOrganization(source, target)\n  );\n}\n\nfunction canConnectSequenceFlow(source, target) {\n  if (\n    isEventBasedTarget(target) &&\n    target.incoming.length > 0 &&\n    areOutgoingEventBasedGatewayConnections(target.incoming) &&\n    !is(source, \"bpmn:EventBasedGateway\")\n  ) {\n    return false;\n  }\n\n  return (\n    isSequenceFlowSource(source) &&\n    isSequenceFlowTarget(target) &&\n    isSameScope(source, target) &&\n    !(is(source, \"bpmn:EventBasedGateway\") && !isEventBasedTarget(target))\n  );\n}\n\nfunction canConnectDataAssociation(source, target) {\n  if (\n    isAny(source, [\"bpmn:DataObjectReference\", \"bpmn:DataStoreReference\"]) &&\n    isAny(target, [\"bpmn:Activity\", \"bpmn:ThrowEvent\"])\n  ) {\n    return { type: \"bpmn:DataInputAssociation\" };\n  }\n\n  if (\n    isAny(target, [\"bpmn:DataObjectReference\", \"bpmn:DataStoreReference\"]) &&\n    isAny(source, [\"bpmn:Activity\", \"bpmn:CatchEvent\"])\n  ) {\n    return { type: \"bpmn:DataOutputAssociation\" };\n  }\n\n  return false;\n}\n\nfunction canInsert(shape, flow, position) {\n  if (!flow) {\n    return false;\n  }\n\n  if (Array.isArray(shape)) {\n    if (shape.length !== 1) {\n      return false;\n    }\n\n    shape = shape[0];\n  }\n\n  if (flow.source === shape || flow.target === shape) {\n    return false;\n  }\n\n  // return true if we can drop on the\n  // underlying flow parent\n  //\n  // at this point we are not really able to talk\n  // about connection rules (yet)\n\n  return (\n    isAny(flow, [\"bpmn:SequenceFlow\", \"bpmn:MessageFlow\"]) &&\n    !isLabel(flow) &&\n    is(shape, \"bpmn:FlowNode\") &&\n    !is(shape, \"bpmn:BoundaryEvent\") &&\n    canDrop(shape, flow.parent, position)\n  );\n}\n\nfunction includes(elements, element) {\n  return elements && element && elements.indexOf(element) !== -1;\n}\n\nfunction canCopy(elements, element) {\n  if (isLabel(element)) {\n    return true;\n  }\n\n  if (is(element, \"bpmn:Lane\") && !includes(elements, element.parent)) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction isOutgoingEventBasedGatewayConnection(connection) {\n  if (connection && connection.source) {\n    return is(connection.source, \"bpmn:EventBasedGateway\");\n  }\n}\n\nfunction areOutgoingEventBasedGatewayConnections(connections) {\n  connections = connections || [];\n\n  return connections.some(isOutgoingEventBasedGatewayConnection);\n}\n\nfunction getRootElement(element) {\n  return (\n    getParent(element, \"bpmn:Process-action\") ||\n    getParent(element, \"bpmn:Collaboration\")\n  );\n}\n","import RulesModule from \"diagram-js/lib/features/rules\";\n\nimport BpmnRules from \"./BpmnRules\";\n\nexport default {\n  __depends__: [RulesModule],\n  __init__: [\"bpmnRules\"],\n  bpmnRules: [\"type\", BpmnRules],\n};\n","import { getDi } from \"../../draw/BpmnRenderUtil\";\nimport { getBusinessObject } from \"../../util/ModelUtil\";\n\nimport { filter, map } from \"min-dash\";\n\nimport { selfAndAllChildren } from \"diagram-js/lib/util/Elements\";\n\nlet HIGH_PRIORITY = 2000;\n\nexport default function BpmnDiOrdering(eventBus, canvas) {\n  eventBus.on(\"saveXML.start\", HIGH_PRIORITY, orderDi);\n\n  function orderDi() {\n    let root = canvas.getRootElement(),\n      rootDi = getBusinessObject(root).di,\n      elements,\n      diElements;\n\n    elements = selfAndAllChildren([root], false);\n\n    // only bpmndi:Shape and bpmndi:Edge can be direct children of bpmndi:Plane\n    elements = filter(elements, function (element) {\n      return element !== root && !element.labelTarget;\n    });\n\n    diElements = map(elements, getDi);\n\n    rootDi.set(\"planeElement\", diElements);\n  }\n}\n\nBpmnDiOrdering.$inject = [\"eventBus\", \"canvas\"];\n","import BpmnDiOrdering from \"../di-ordering/BpmnDiOrdering\";\n\nexport default {\n  __init__: [\"bpmnDiOrdering\"],\n  bpmnDiOrdering: [\"type\", BpmnDiOrdering],\n};\n","import inherits from \"inherits\";\n\nimport OrderingProvider from \"diagram-js/lib/features/ordering/OrderingProvider\";\n\nimport { isAny } from \"../modeling/util/ModelingUtil\";\n\nimport { findIndex, find } from \"min-dash\";\n\n/**\n * a simple ordering provider that makes sure:\n *\n * (0) labels and groups are rendered always on top\n * (1) elements are ordered by a {level} property\n */\nexport default function BpmnOrderingProvider(eventBus, canvas, translate) {\n  OrderingProvider.call(this, eventBus);\n\n  let orders = [\n    { type: \"bpmn:Loop\", order: { level: 6 } },\n    {\n      type: \"bpmn:SequenceFlow\",\n      order: {\n        level: 3,\n        containers: [\"bpmn:Participant\", \"bpmn:FlowElementsContainer\"],\n      },\n    },\n\n    // handle DataAssociation(s) like message flows and render them always on top\n    {\n      type: \"bpmn:DataAssociation\",\n      order: {\n        level: 9,\n        containers: [\"bpmn:Collaboration\", \"bpmn:Process-action\"],\n      },\n    },\n    {\n      type: \"bpmn:MessageFlow\",\n      order: {\n        level: 9,\n        containers: [\"bpmn:Collaboration\"],\n      },\n    },\n    {\n      type: \"bpmn:Association\",\n      order: {\n        level: 6,\n        containers: [\n          \"bpmn:Participant\",\n          \"bpmn:FlowElementsContainer\",\n          \"bpmn:Collaboration\",\n        ],\n      },\n    },\n    { type: \"bpmn:BoundaryEvent\", order: { level: 8 } },\n    {\n      type: \"bpmn:Group\",\n      order: {\n        level: 10,\n        containers: [\"bpmn:Collaboration\", \"bpmn:Process-action\"],\n      },\n    },\n    { type: \"bpmn:FlowElement\", order: { level: 5 } },\n    { type: \"bpmn:Participant\", order: { level: -2 } },\n    { type: \"bpmn:Lane\", order: { level: -1 } },\n  ];\n\n  function computeOrder(element) {\n    if (element.labelTarget) {\n      return { level: 10 };\n    }\n\n    let entry = find(orders, function (o) {\n      return isAny(element, [o.type]);\n    });\n\n    return (entry && entry.order) || { level: 1 };\n  }\n\n  function getOrder(element) {\n    let order = element.order;\n\n    if (!order) {\n      element.order = order = computeOrder(element);\n    }\n\n    return order;\n  }\n\n  function findActualParent(element, newParent, containers) {\n    let actualParent = newParent;\n\n    while (actualParent) {\n      if (isAny(actualParent, containers)) {\n        break;\n      }\n\n      actualParent = actualParent.parent;\n    }\n\n    if (!actualParent) {\n      throw new Error(\n        translate(\"no parent for {element} in {parent}\", {\n          element: element.id,\n          parent: newParent.id,\n        })\n      );\n    }\n\n    return actualParent;\n  }\n\n  this.getOrdering = function (element, newParent) {\n    // render labels always on top\n    if (element.labelTarget) {\n      return {\n        parent: canvas.getRootElement(),\n        index: -1,\n      };\n    }\n\n    let elementOrder = getOrder(element);\n\n    if (elementOrder.containers) {\n      newParent = findActualParent(element, newParent, elementOrder.containers);\n    }\n\n    let currentIndex = newParent.children.indexOf(element);\n\n    let insertIndex = findIndex(newParent.children, function (child) {\n      // do not compare with labels, they are created\n      // in the wrong order (right after elements) during import and\n      // mess up the positioning.\n      if (!element.labelTarget && child.labelTarget) {\n        return false;\n      }\n\n      return elementOrder.level < getOrder(child).level;\n    });\n\n    // if the element is already in the child list at\n    // a smaller index, we need to adjust the insert index.\n    // this takes into account that the element is being removed\n    // before being re-inserted\n    if (insertIndex !== -1) {\n      if (currentIndex !== -1 && currentIndex < insertIndex) {\n        insertIndex -= 1;\n      }\n    }\n\n    return {\n      index: insertIndex,\n      parent: newParent,\n    };\n  };\n}\n\nBpmnOrderingProvider.$inject = [\"eventBus\", \"canvas\", \"translate\"];\n\ninherits(BpmnOrderingProvider, OrderingProvider);\n","import translate from \"diagram-js/lib/i18n/translate\";\n\nimport BpmnOrderingProvider from \"./BpmnOrderingProvider\";\n\nexport default {\n  __depends__: [translate],\n  __init__: [\"bpmnOrderingProvider\"],\n  bpmnOrderingProvider: [\"type\", BpmnOrderingProvider],\n};\n","import { map, assign, pick } from \"min-dash\";\n\nimport { isAny } from \"./util/ModelingUtil\";\n\nimport { is } from \"../../util/ModelUtil\";\n\nexport default function BpmnFactory(moddle) {\n  this._model = moddle;\n}\n\nBpmnFactory.$inject = [\"moddle\"];\n\nBpmnFactory.prototype._needsId = function (element) {\n  return isAny(element, [\n    \"bpmn:RootElement\",\n    \"bpmn:FlowElement\",\n    \"bpmn:MessageFlow\",\n    \"bpmn:DataAssociation\",\n    \"bpmn:Artifact\",\n    \"bpmn:Participant\",\n    \"bpmn:Lane\",\n    \"bpmn:LaneSet\",\n    \"bpmn:Process-action\",\n    \"bpmn:Collaboration\",\n    \"bpmndi:BPMNShape\",\n    \"bpmndi:BPMNEdge\",\n    \"bpmndi:BPMNDiagram\",\n    \"bpmndi:BPMNPlane\",\n    \"bpmn:Property\",\n    \"bpmn:CategoryValue\",\n  ]);\n};\n\nBpmnFactory.prototype._ensureId = function (element) {\n  // generate semantic ids for elements\n  // bpmn:SequenceFlow -> SequenceFlow_ID\n  let prefix;\n\n  if (is(element, \"bpmn:Mapper\")) {\n    prefix = \"Mapper\";\n  } else if (is(element, \"bpmn:Query\")) {\n    prefix = \"Query\";\n  } else if (is(element, \"bpmn:Function\")) {\n    prefix = \"Function\";\n  } else if (is(element, \"bpmn:Loop\")) {\n    prefix = \"Loop\";\n  } else if (is(element, \"bpmn:Conditional\")) {\n    prefix = \"Condition\";\n  }else if (is(element, \"bpmn:Activity\")) {\n    prefix = \"Activity\";\n  } else if (is(element, \"bpmn:Event\")) {\n    prefix = \"Event\";\n  } else if (is(element, \"bpmn:Gateway\")) {\n    prefix = \"Gateway\";\n  } else if (isAny(element, [\"bpmn:SequenceFlow\", \"bpmn:MessageFlow\"])) {\n    prefix = \"Flow\";\n  } else {\n    prefix = (element.$type || \"\").replace(/^[^:]*:/g, \"\");\n  }\n\n  prefix += \"_\";\n\n  if (!element.id && this._needsId(element)) {\n    element.id = this._model.ids.nextPrefixed(prefix, element);\n  }\n};\n\nBpmnFactory.prototype.create = function (type, attrs) {\n  let element = this._model.create(type, attrs || {});\n\n  this._ensureId(element);\n\n  return element;\n};\n\nBpmnFactory.prototype.createDiLabel = function () {\n  return this.create(\"bpmndi:BPMNLabel\", {\n    bounds: this.createDiBounds(),\n  });\n};\n\nBpmnFactory.prototype.createDiShape = function (semantic, bounds, attrs) {\n  return this.create(\n    \"bpmndi:BPMNShape\",\n    assign(\n      {\n        bpmnElement: semantic,\n        bounds: this.createDiBounds(bounds),\n      },\n      attrs\n    )\n  );\n};\n\nBpmnFactory.prototype.createDiBounds = function (bounds) {\n  return this.create(\"dc:Bounds\", bounds);\n};\n\nBpmnFactory.prototype.createDiWaypoints = function (waypoints) {\n  let self = this;\n\n  return map(waypoints, function (pos) {\n    return self.createDiWaypoint(pos);\n  });\n};\n\nBpmnFactory.prototype.createDiWaypoint = function (point) {\n  return this.create(\"dc:Point\", pick(point, [\"x\", \"y\"]));\n};\n\nBpmnFactory.prototype.createDiEdge = function (semantic, waypoints, attrs) {\n  return this.create(\n    \"bpmndi:BPMNEdge\",\n    assign(\n      {\n        bpmnElement: semantic,\n      },\n      attrs\n    )\n  );\n};\n\nBpmnFactory.prototype.createDiPlane = function (semantic) {\n  return this.create(\"bpmndi:BPMNPlane\", {\n    bpmnElement: semantic,\n  });\n};\n","import { assign, forEach } from \"min-dash\";\n\nimport inherits from \"inherits\";\n\nimport {\n  remove as collectionRemove,\n  add as collectionAdd,\n} from \"diagram-js/lib/util/Collections\";\n\nimport { Label } from \"diagram-js/lib/model\";\n\nimport { getBusinessObject, is } from \"../../util/ModelUtil\";\n\nimport { isAny } from \"./util/ModelingUtil\";\n\nimport CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\n/**\n * A handler responsible for updating the underlying BPMN 2.0 XML + DI\n * once changes on the diagram happen\n */\nexport default function BpmnUpdater(\n  eventBus,\n  bpmnFactory,\n  connectionDocking,\n  translate\n) {\n  CommandInterceptor.call(this, eventBus);\n\n  this._bpmnFactory = bpmnFactory;\n  this._translate = translate;\n\n  let self = this;\n\n  // connection cropping //////////////////////\n\n  // crop connection ends during create/update\n  function cropConnection(e) {\n    let context = e.context,\n      hints = context.hints || {},\n      connection;\n\n    if (!context.cropped && hints.createElementsBehavior !== false) {\n      connection = context.connection;\n      connection.waypoints = connectionDocking.getCroppedWaypoints(connection);\n      context.cropped = true;\n    }\n  }\n\n  this.executed([\"connection.layout\", \"connection.create\"], cropConnection);\n\n  this.reverted([\"connection.layout\"], function (e) {\n    delete e.context.cropped;\n  });\n\n  // BPMN + DI update //////////////////////\n\n  // update parent\n  function updateParent(e) {\n    let context = e.context;\n\n    self.updateParent(context.shape || context.connection, context.oldParent);\n  }\n\n  function reverseUpdateParent(e) {\n    let context = e.context;\n\n    let element = context.shape || context.connection,\n      // oldParent is the (old) new parent, because we are undoing\n      oldParent = context.parent || context.newParent;\n\n    self.updateParent(element, oldParent);\n  }\n\n  this.executed(\n    [\n      \"shape.move\",\n      \"shape.create\",\n      \"shape.delete\",\n      \"connection.create\",\n      \"connection.move\",\n      \"connection.delete\",\n    ],\n    ifBpmn(updateParent)\n  );\n\n  this.reverted(\n    [\n      \"shape.move\",\n      \"shape.create\",\n      \"shape.delete\",\n      \"connection.create\",\n      \"connection.move\",\n      \"connection.delete\",\n    ],\n    ifBpmn(reverseUpdateParent)\n  );\n\n  /*\n   * ## Updating Parent\n   *\n   * When morphing a Process into a Collaboration or vice-versa,\n   * make sure that both the *semantic* and *di* parent of each element\n   * is updated.\n   *\n   */\n  function updateRoot(event) {\n    let context = event.context,\n      oldRoot = context.oldRoot,\n      children = oldRoot.children;\n\n    forEach(children, function (child) {\n      if (is(child, \"bpmn:BaseElement\")) {\n        self.updateParent(child);\n      }\n    });\n  }\n\n  this.executed([\"canvas.updateRoot\"], updateRoot);\n  this.reverted([\"canvas.updateRoot\"], updateRoot);\n\n  // update bounds\n  function updateBounds(e) {\n    let shape = e.context.shape;\n\n    if (!is(shape, \"bpmn:BaseElement\")) {\n      return;\n    }\n\n    self.updateBounds(shape);\n  }\n\n  this.executed(\n    [\"shape.move\", \"shape.create\", \"shape.resize\"],\n    ifBpmn(function (event) {\n      // exclude labels because they're handled separately during shape.changed\n      if (event.context.shape.type === \"label\") {\n        return;\n      }\n\n      updateBounds(event);\n    })\n  );\n\n  this.reverted(\n    [\"shape.move\", \"shape.create\", \"shape.resize\"],\n    ifBpmn(function (event) {\n      // exclude labels because they're handled separately during shape.changed\n      if (event.context.shape.type === \"label\") {\n        return;\n      }\n\n      updateBounds(event);\n    })\n  );\n\n  // Handle labels separately. This is necessary, because the label bounds have to be updated\n  // every time its shape changes, not only on move, create and resize.\n  eventBus.on(\"shape.changed\", function (event) {\n    if (event.element.type === \"label\") {\n      updateBounds({ context: { shape: event.element } });\n    }\n  });\n\n  // attach / detach connection\n  function updateConnection(e) {\n    self.updateConnection(e.context);\n  }\n\n  this.executed(\n    [\n      \"connection.create\",\n      \"connection.move\",\n      \"connection.delete\",\n      \"connection.reconnect\",\n    ],\n    ifBpmn(updateConnection)\n  );\n\n  this.reverted(\n    [\n      \"connection.create\",\n      \"connection.move\",\n      \"connection.delete\",\n      \"connection.reconnect\",\n    ],\n    ifBpmn(updateConnection)\n  );\n\n  // update waypoints\n  function updateConnectionWaypoints(e) {\n    self.updateConnectionWaypoints(e.context.connection);\n  }\n\n  this.executed(\n    [\"connection.layout\", \"connection.move\", \"connection.updateWaypoints\"],\n    ifBpmn(updateConnectionWaypoints)\n  );\n\n  this.reverted(\n    [\"connection.layout\", \"connection.move\", \"connection.updateWaypoints\"],\n    ifBpmn(updateConnectionWaypoints)\n  );\n\n  // update conditional/default flows\n  this.executed(\n    \"connection.reconnect\",\n    ifBpmn(function (event) {\n      let context = event.context,\n        connection = context.connection,\n        oldSource = context.oldSource,\n        newSource = context.newSource,\n        connectionBo = getBusinessObject(connection),\n        oldSourceBo = getBusinessObject(oldSource),\n        newSourceBo = getBusinessObject(newSource);\n\n      // remove condition from connection on reconnect to new source\n      // if new source can NOT have condional sequence flow\n      if (\n        connectionBo.conditionExpression &&\n        !isAny(newSourceBo, [\n          \"bpmn:Activity\",\n          \"bpmn:ExclusiveGateway\",\n          \"bpmn:InclusiveGateway\",\n        ])\n      ) {\n        context.oldConditionExpression = connectionBo.conditionExpression;\n\n        delete connectionBo.conditionExpression;\n      }\n\n      // remove default from old source flow on reconnect to new source\n      // if source changed\n      if (oldSource !== newSource && oldSourceBo.default === connectionBo) {\n        context.oldDefault = oldSourceBo.default;\n\n        delete oldSourceBo.default;\n      }\n    })\n  );\n\n  this.reverted(\n    \"connection.reconnect\",\n    ifBpmn(function (event) {\n      let context = event.context,\n        connection = context.connection,\n        oldSource = context.oldSource,\n        newSource = context.newSource,\n        connectionBo = getBusinessObject(connection),\n        oldSourceBo = getBusinessObject(oldSource),\n        newSourceBo = getBusinessObject(newSource);\n\n      // add condition to connection on revert reconnect to new source\n      if (context.oldConditionExpression) {\n        connectionBo.conditionExpression = context.oldConditionExpression;\n      }\n\n      // add default to old source on revert reconnect to new source\n      if (context.oldDefault) {\n        oldSourceBo.default = context.oldDefault;\n\n        delete newSourceBo.default;\n      }\n    })\n  );\n\n  // update attachments\n  function updateAttachment(e) {\n    self.updateAttachment(e.context);\n  }\n\n  this.executed([\"element.updateAttachment\"], ifBpmn(updateAttachment));\n  this.reverted([\"element.updateAttachment\"], ifBpmn(updateAttachment));\n}\n\ninherits(BpmnUpdater, CommandInterceptor);\n\nBpmnUpdater.$inject = [\n  \"eventBus\",\n  \"bpmnFactory\",\n  \"connectionDocking\",\n  \"translate\",\n];\n\n// implementation //////////////////////\n\nBpmnUpdater.prototype.updateAttachment = function (context) {\n  let shape = context.shape,\n    businessObject = shape.businessObject,\n    host = shape.host;\n\n  businessObject.attachedToRef = host && host.businessObject;\n};\n\nBpmnUpdater.prototype.updateParent = function (element, oldParent) {\n  // do not update BPMN 2.0 label parent\n  if (element instanceof Label) {\n    return;\n  }\n\n  // data stores in collaborations are handled separately by DataStoreBehavior\n  if (\n    is(element, \"bpmn:DataStoreReference\") &&\n    element.parent &&\n    is(element.parent, \"bpmn:Collaboration\")\n  ) {\n    return;\n  }\n\n  let parentShape = element.parent;\n\n  let businessObject = element.businessObject,\n    parentBusinessObject = parentShape && parentShape.businessObject,\n    parentDi = parentBusinessObject && parentBusinessObject.di;\n\n  if (is(element, \"bpmn:FlowNode\")) {\n    this.updateFlowNodeRefs(\n      businessObject,\n      parentBusinessObject,\n      oldParent && oldParent.businessObject\n    );\n  }\n\n  if (is(element, \"bpmn:DataOutputAssociation\")) {\n    if (element.source) {\n      parentBusinessObject = element.source.businessObject;\n    } else {\n      parentBusinessObject = null;\n    }\n  }\n\n  if (is(element, \"bpmn:DataInputAssociation\")) {\n    if (element.target) {\n      parentBusinessObject = element.target.businessObject;\n    } else {\n      parentBusinessObject = null;\n    }\n  }\n\n  this.updateSemanticParent(businessObject, parentBusinessObject);\n\n  if (is(element, \"bpmn:DataObjectReference\") && businessObject.dataObjectRef) {\n    this.updateSemanticParent(\n      businessObject.dataObjectRef,\n      parentBusinessObject\n    );\n  }\n\n  this.updateDiParent(businessObject.di, parentDi);\n};\n\nBpmnUpdater.prototype.updateBounds = function (shape) {\n  let di = shape.businessObject.di;\n\n  let target = shape instanceof Label ? this._getLabel(di) : di;\n\n  let bounds = target.bounds;\n\n  if (!bounds) {\n    bounds = this._bpmnFactory.createDiBounds();\n    target.set(\"bounds\", bounds);\n  }\n\n  assign(bounds, {\n    x: shape.x,\n    y: shape.y,\n    width: shape.width,\n    height: shape.height,\n  });\n};\n\nBpmnUpdater.prototype.updateFlowNodeRefs = function (\n  businessObject,\n  newContainment,\n  oldContainment\n) {\n  if (oldContainment === newContainment) {\n    return;\n  }\n\n  let oldRefs, newRefs;\n\n  if (is(oldContainment, \"bpmn:Lane\")) {\n    oldRefs = oldContainment.get(\"flowNodeRef\");\n    collectionRemove(oldRefs, businessObject);\n  }\n\n  if (is(newContainment, \"bpmn:Lane\")) {\n    newRefs = newContainment.get(\"flowNodeRef\");\n    collectionAdd(newRefs, businessObject);\n  }\n};\n\n// update existing sourceElement and targetElement di information\nBpmnUpdater.prototype.updateDiConnection = function (di, newSource, newTarget) {\n  if (di.sourceElement && di.sourceElement.bpmnElement !== newSource) {\n    di.sourceElement = newSource && newSource.di;\n  }\n\n  if (di.targetElement && di.targetElement.bpmnElement !== newTarget) {\n    di.targetElement = newTarget && newTarget.di;\n  }\n};\n\nBpmnUpdater.prototype.updateDiParent = function (di, parentDi) {\n  if (parentDi && !is(parentDi, \"bpmndi:BPMNPlane\")) {\n    parentDi = parentDi.$parent;\n  }\n\n  if (di.$parent === parentDi) {\n    return;\n  }\n\n  let planeElements = (parentDi || di.$parent).get(\"planeElement\");\n\n  if (parentDi) {\n    planeElements.push(di);\n    di.$parent = parentDi;\n  } else {\n    collectionRemove(planeElements, di);\n    di.$parent = null;\n  }\n};\n\nfunction getDefinitions(element) {\n  while (element && !is(element, \"bpmn:Process-actions\")) {\n    element = element.$parent;\n  }\n\n  return element;\n}\n\nBpmnUpdater.prototype.getLaneSet = function (container) {\n  let laneSet, laneSets;\n\n  // bpmn:Lane\n  if (is(container, \"bpmn:Lane\")) {\n    laneSet = container.childLaneSet;\n\n    if (!laneSet) {\n      laneSet = this._bpmnFactory.create(\"bpmn:LaneSet\");\n      container.childLaneSet = laneSet;\n      laneSet.$parent = container;\n    }\n\n    return laneSet;\n  }\n\n  // bpmn:Participant\n  if (is(container, \"bpmn:Participant\")) {\n    container = container.processRef;\n  }\n\n  // bpmn:FlowElementsContainer\n  laneSets = container.get(\"laneSets\");\n  laneSet = laneSets[0];\n\n  if (!laneSet) {\n    laneSet = this._bpmnFactory.create(\"bpmn:LaneSet\");\n    laneSet.$parent = container;\n    laneSets.push(laneSet);\n  }\n\n  return laneSet;\n};\n\nBpmnUpdater.prototype.updateSemanticParent = function (\n  businessObject,\n  newParent,\n  visualParent\n) {\n  let containment,\n    translate = this._translate;\n\n  if (businessObject.$parent === newParent) {\n    return;\n  }\n\n  if (\n    is(businessObject, \"bpmn:DataInput\") ||\n    is(businessObject, \"bpmn:DataOutput\")\n  ) {\n    if (is(newParent, \"bpmn:Participant\") && \"processRef\" in newParent) {\n      newParent = newParent.processRef;\n    }\n\n    // already in correct ioSpecification\n    if (\n      \"ioSpecification\" in newParent &&\n      newParent.ioSpecification === businessObject.$parent\n    ) {\n      return;\n    }\n  }\n\n  if (is(businessObject, \"bpmn:Lane\")) {\n    if (newParent) {\n      newParent = this.getLaneSet(newParent);\n    }\n\n    containment = \"lanes\";\n  } else if (is(businessObject, \"bpmn:FlowElement\")) {\n    if (newParent) {\n      if (is(newParent, \"bpmn:Participant\")) {\n        newParent = newParent.processRef;\n      } else if (is(newParent, \"bpmn:Lane\")) {\n        do {\n          // unwrap Lane -> LaneSet -> (Lane | FlowElementsContainer)\n          newParent = newParent.$parent.$parent;\n        } while (is(newParent, \"bpmn:Lane\"));\n      }\n    }\n\n    containment = \"flowElements\";\n  } else if (is(businessObject, \"bpmn:Artifact\")) {\n    while (\n      newParent &&\n      !is(newParent, \"bpmn:Process-action\") &&\n      !is(newParent, \"bpmn:Loop\") &&\n      !is(newParent, \"bpmn:Conditional\") &&\n      !is(newParent, \"bpmn:Collaboration\")\n    ) {\n      if (is(newParent, \"bpmn:Participant\")) {\n        newParent = newParent.processRef;\n        break;\n      } else {\n        newParent = newParent.$parent;\n      }\n    }\n\n    containment = \"artifacts\";\n  } else if (is(businessObject, \"bpmn:MessageFlow\")) {\n    containment = \"messageFlows\";\n  } else if (is(businessObject, \"bpmn:Participant\")) {\n    containment = \"participants\";\n\n    // make sure the participants process is properly attached / detached\n    // from the XML document\n\n    let process = businessObject.processRef,\n      definitions;\n\n    if (process) {\n      definitions = getDefinitions(businessObject.$parent || newParent);\n\n      if (businessObject.$parent) {\n        collectionRemove(definitions.get(\"rootElements\"), process);\n        process.$parent = null;\n      }\n\n      if (newParent) {\n        collectionAdd(definitions.get(\"rootElements\"), process);\n        process.$parent = definitions;\n      }\n    }\n  } else if (is(businessObject, \"bpmn:DataOutputAssociation\")) {\n    containment = \"dataOutputAssociations\";\n  } else if (is(businessObject, \"bpmn:DataInputAssociation\")) {\n    containment = \"dataInputAssociations\";\n  }\n\n  if (!containment) {\n    throw new Error(\n      translate(\"no parent for {element} in {parent}\", {\n        element: businessObject.id,\n        parent: newParent.id,\n      })\n    );\n  }\n\n  let children;\n\n  if (businessObject.$parent) {\n    // remove from old parent\n    children = businessObject.$parent.get(containment);\n    collectionRemove(children, businessObject);\n  }\n\n  if (!newParent) {\n    businessObject.$parent = null;\n  } else {\n    // add to new parent\n    children = newParent.get(containment);\n    children.push(businessObject);\n    businessObject.$parent = newParent;\n  }\n\n  if (visualParent) {\n    let diChildren = visualParent.get(containment);\n\n    collectionRemove(children, businessObject);\n\n    if (newParent) {\n      if (!diChildren) {\n        diChildren = [];\n        newParent.set(containment, diChildren);\n      }\n\n      diChildren.push(businessObject);\n    }\n  }\n};\n\nBpmnUpdater.prototype.updateConnectionWaypoints = function (connection) {\n  connection.businessObject.di.set(\n    \"waypoint\",\n    this._bpmnFactory.createDiWaypoints(connection.waypoints)\n  );\n};\n\nBpmnUpdater.prototype.updateConnection = function (context) {\n  let connection = context.connection,\n    businessObject = getBusinessObject(connection),\n    newSource = getBusinessObject(connection.source),\n    newTarget = getBusinessObject(connection.target),\n    visualParent;\n\n  if (!is(businessObject, \"bpmn:DataAssociation\")) {\n    let inverseSet = is(businessObject, \"bpmn:SequenceFlow\");\n\n    if (businessObject.sourceRef !== newSource) {\n      if (inverseSet) {\n        collectionRemove(\n          businessObject.sourceRef && businessObject.sourceRef.get(\"outgoing\"),\n          businessObject\n        );\n\n        if (newSource && newSource.get(\"outgoing\")) {\n          newSource.get(\"outgoing\").push(businessObject);\n        }\n      }\n\n      businessObject.sourceRef = newSource;\n    }\n\n    if (businessObject.targetRef !== newTarget) {\n      if (inverseSet) {\n        collectionRemove(\n          businessObject.targetRef && businessObject.targetRef.get(\"incoming\"),\n          businessObject\n        );\n\n        if (newTarget && newTarget.get(\"incoming\")) {\n          newTarget.get(\"incoming\").push(businessObject);\n        }\n      }\n\n      businessObject.targetRef = newTarget;\n    }\n  } else if (is(businessObject, \"bpmn:DataInputAssociation\")) {\n    // handle obnoxious isMsome sourceRef\n    businessObject.get(\"sourceRef\")[0] = newSource;\n\n    visualParent = context.parent || context.newParent || newTarget;\n\n    this.updateSemanticParent(businessObject, newTarget, visualParent);\n  } else if (is(businessObject, \"bpmn:DataOutputAssociation\")) {\n    visualParent = context.parent || context.newParent || newSource;\n\n    this.updateSemanticParent(businessObject, newSource, visualParent);\n\n    // targetRef = new target\n    businessObject.targetRef = newTarget;\n  }\n\n  this.updateConnectionWaypoints(connection);\n\n  this.updateDiConnection(businessObject.di, newSource, newTarget);\n};\n\n// helpers //////////////////////\n\nBpmnUpdater.prototype._getLabel = function (di) {\n  if (!di.label) {\n    di.label = this._bpmnFactory.createDiLabel();\n  }\n\n  return di.label;\n};\n\n/**\n * Make sure the event listener is only called\n * if the touched element is a BPMN element.\n *\n * @param  {Function} fn\n * @return {Function} guarded function\n */\nfunction ifBpmn(fn) {\n  return function (event) {\n    let context = event.context,\n      element = context.shape || context.connection;\n\n    if (is(element, \"bpmn:BaseElement\")) {\n      fn(event);\n    }\n  };\n}\n","import { assign, forEach, isObject } from \"min-dash\";\n\nimport inherits from \"inherits\";\n\nimport { is } from \"../../util/ModelUtil\";\n\nimport { isExpanded } from \"../../util/DiUtil\";\n\nimport BaseElementFactory from \"diagram-js/lib/core/ElementFactory\";\n\nimport { DEFAULT_LABEL_SIZE } from \"../../util/LabelUtil\";\n\n/**\n * A bpmn-aware factory for diagram-js shapes\n */\nexport default function ElementFactory(bpmnFactory, moddle, translate) {\n  BaseElementFactory.call(this);\n\n  this._bpmnFactory = bpmnFactory;\n  this._moddle = moddle;\n  this._translate = translate;\n}\n\ninherits(ElementFactory, BaseElementFactory);\n\nElementFactory.$inject = [\"bpmnFactory\", \"moddle\", \"translate\"];\n\nElementFactory.prototype.baseCreate = BaseElementFactory.prototype.create;\n\nElementFactory.prototype.create = function (elementType, attrs) {\n  // no special magic for labels,\n  // we assume their businessObjects have already been created\n  // and wired via attrs\n  if (elementType === \"label\") {\n    return this.baseCreate(\n      elementType,\n      assign({ type: \"label\" }, DEFAULT_LABEL_SIZE, attrs)\n    );\n  }\n\n  return this.createBpmnElement(elementType, attrs);\n};\n\nElementFactory.prototype.createBpmnElement = function (elementType, attrs) {\n  let size,\n    translate = this._translate;\n\n  attrs = attrs || {};\n\n  let businessObject = attrs.businessObject;\n\n  if (!businessObject) {\n    if (!attrs.type) {\n      throw new Error(translate(\"no shape type specified\"));\n    }\n\n    businessObject = this._bpmnFactory.create(attrs.type);\n  }\n\n  if (!businessObject.di) {\n    if (elementType === \"root\") {\n      businessObject.di = this._bpmnFactory.createDiPlane(businessObject, [], {\n        id: businessObject.id + \"_di\",\n      });\n    } else if (elementType === \"connection\") {\n      businessObject.di = this._bpmnFactory.createDiEdge(businessObject, [], {\n        id: businessObject.id + \"_di\",\n      });\n    } else {\n      businessObject.di = this._bpmnFactory.createDiShape(\n        businessObject,\n        {},\n        {\n          id: businessObject.id + \"_di\",\n        }\n      );\n    }\n  }\n\n  if (is(businessObject, \"bpmn:Group\")) {\n    attrs = assign(\n      {\n        isFrame: true,\n      },\n      attrs\n    );\n  }\n\n  if (attrs.di) {\n    assign(businessObject.di, attrs.di);\n\n    delete attrs.di;\n  }\n\n  applyAttributes(businessObject, attrs, [\n    \"processRef\",\n    \"isInterrupting\",\n    \"associationDirection\",\n    \"isForCompensation\",\n  ]);\n\n  if (attrs.isExpanded) {\n    applyAttribute(businessObject.di, attrs, \"isExpanded\");\n  }\n\n  if (is(businessObject, \"bpmn:ExclusiveGateway\")) {\n    businessObject.di.isMarkerVisible = true;\n  }\n\n  if (is(businessObject, \"bpmn:Query\")) {\n    businessObject.di.isMarkerVisible = true;\n  }\n\n  let eventDefinitions, newEventDefinition;\n\n  if (attrs.eventDefinitionType) {\n    eventDefinitions = businessObject.get(\"eventDefinitions\") || [];\n    newEventDefinition = this._bpmnFactory.create(attrs.eventDefinitionType);\n\n    if (attrs.eventDefinitionType === \"bpmn:ConditionalEventDefinition\") {\n      newEventDefinition.condition = this._bpmnFactory.create(\n        \"bpmn:FormalExpression\"\n      );\n    }\n\n    eventDefinitions.push(newEventDefinition);\n\n    newEventDefinition.$parent = businessObject;\n    businessObject.eventDefinitions = eventDefinitions;\n\n    delete attrs.eventDefinitionType;\n  }\n\n  size = this._getDefaultSize(businessObject);\n\n  attrs = assign(\n    {\n      businessObject: businessObject,\n      id: businessObject.id,\n    },\n    size,\n    attrs\n  );\n\n  return this.baseCreate(elementType, attrs);\n};\n\nElementFactory.prototype._getDefaultSize = function (semantic) {\n  if (is(semantic, \"bpmn:Loop\")) {\n    if (isExpanded(semantic)) {\n      return { width: 350, height: 200 };\n    } else {\n      return { width: 100, height: 80 };\n    }\n  }\n\n  if (is(semantic, \"bpmn:Conditional\")) {\n    if (isExpanded(semantic)) {\n      return { width: 350, height: 200 };\n    } else {\n      return { width: 100, height: 80 };\n    }\n  }\n\n  if (is(semantic, \"bpmn:Task\")) {\n    return { width: 100, height: 80 };\n  }\n\n  if (is(semantic, \"bpmn:Gateway\")) {\n    return { width: 50, height: 50 };\n  }\n\n  if (is(semantic, \"bpmn:Event\")) {\n    return { width: 36, height: 36 };\n  }\n\n  if (is(semantic, \"bpmn:Participant\")) {\n    if (isExpanded(semantic)) {\n      return { width: 600, height: 250 };\n    } else {\n      return { width: 400, height: 60 };\n    }\n  }\n\n  if (is(semantic, \"bpmn:Lane\")) {\n    return { width: 400, height: 100 };\n  }\n\n  if (is(semantic, \"bpmn:DataObjectReference\")) {\n    return { width: 36, height: 50 };\n  }\n\n  if (is(semantic, \"bpmn:DataStoreReference\")) {\n    return { width: 50, height: 50 };\n  }\n\n  if (is(semantic, \"bpmn:TextAnnotation\")) {\n    return { width: 100, height: 30 };\n  }\n\n  if (is(semantic, \"bpmn:Group\")) {\n    return { width: 300, height: 300 };\n  }\n\n  return { width: 100, height: 80 };\n};\n\n/**\n * Create participant.\n *\n * @param {boolean|Object} [attrs] attrs\n *\n * @returns {djs.model.Shape}\n */\nElementFactory.prototype.createParticipantShape = function (attrs) {\n  if (!isObject(attrs)) {\n    attrs = { isExpanded: attrs };\n  }\n\n  attrs = assign({ type: \"bpmn:Participant\" }, attrs || {});\n\n  // participants are expanded by default\n  if (attrs.isExpanded !== false) {\n    attrs.processRef = this._bpmnFactory.create(\"bpmn:Process-action\");\n  }\n\n  return this.createShape(attrs);\n};\n\n// helpers //////////////////////\n\n/**\n * Apply attributes from a map to the given element,\n * remove attribute from the map on application.\n *\n * @param {Base} element\n * @param {Object} attrs (in/out map of attributes)\n * @param {Array<String>} attributeNames name of attributes to apply\n */\nfunction applyAttributes(element, attrs, attributeNames) {\n  forEach(attributeNames, function (property) {\n    if (attrs[property] !== undefined) {\n      applyAttribute(element, attrs, property);\n    }\n  });\n}\n\n/**\n * Apply named property to element and drain it from the attrs\n * collection.\n *\n * @param {Base} element\n * @param {Object} attrs (in/out map of attributes)\n * @param {String} attributeName to apply\n */\nfunction applyAttribute(element, attrs, attributeName) {\n  element[attributeName] = attrs[attributeName];\n\n  delete attrs[attributeName];\n}\n","import { reduce, keys, forEach, assign } from \"min-dash\";\n\nimport { getBusinessObject } from \"../../../util/ModelUtil\";\n\nconst DEFAULT_FLOW = \"default\",\n  ID = \"id\",\n  DI = \"di\";\n\nlet NULL_DIMENSIONS = {\n  width: 0,\n  height: 0,\n};\n\n/**\n * A handler that implements a BPMN 2.0 property update.\n *\n * This should be used to set simple properties on elements with\n * an underlying BPMN business object.\n *\n * Use respective diagram-js provided handlers if you would\n * like to perform automated modeling.\n */\nexport default function UpdatePropertiesHandler(\n  elementRegistry,\n  moddle,\n  translate,\n  modeling,\n  textRenderer\n) {\n  this._elementRegistry = elementRegistry;\n  this._moddle = moddle;\n  this._translate = translate;\n  this._modeling = modeling;\n  this._textRenderer = textRenderer;\n}\n\nUpdatePropertiesHandler.$inject = [\n  \"elementRegistry\",\n  \"moddle\",\n  \"translate\",\n  \"modeling\",\n  \"textRenderer\",\n];\n\n// api //////////////////////\n\n/**\n * Updates a BPMN element with a list of new properties\n *\n * @param {Object} context\n * @param {djs.model.Base} context.element the element to update\n * @param {Object} context.properties a list of properties to set on the element's\n *                                    businessObject (the BPMN model element)\n *\n * @return {Array<djs.model.Base>} the updated element\n */\nUpdatePropertiesHandler.prototype.execute = function (context) {\n  let element = context.element,\n    changed = [element],\n    translate = this._translate;\n\n  if (!element) {\n    throw new Error(translate(\"element required\"));\n  }\n\n  let elementRegistry = this._elementRegistry,\n    ids = this._moddle.ids;\n\n  let businessObject = element.businessObject,\n    properties = unwrapBusinessObjects(context.properties),\n    oldProperties =\n      context.oldProperties || getProperties(businessObject, properties);\n\n  if (isIdChange(properties, businessObject)) {\n    ids.unclaim(businessObject[ID]);\n\n    elementRegistry.updateId(element, properties[ID]);\n\n    ids.claim(properties[ID], businessObject);\n  }\n\n  // correctly indicate visual changes on default flow updates\n  if (DEFAULT_FLOW in properties) {\n    if (properties[DEFAULT_FLOW]) {\n      changed.push(elementRegistry.get(properties[DEFAULT_FLOW].id));\n    }\n\n    if (businessObject[DEFAULT_FLOW]) {\n      changed.push(elementRegistry.get(businessObject[DEFAULT_FLOW].id));\n    }\n  }\n\n  // update properties\n  setProperties(businessObject, properties);\n\n  // store old values\n  context.oldProperties = oldProperties;\n  context.changed = changed;\n\n  // indicate changed on objects affected by the update\n  return changed;\n};\n\nUpdatePropertiesHandler.prototype.postExecute = function (context) {\n  let element = context.element,\n    label = element.label;\n\n  let text = label && getBusinessObject(label).name;\n\n  if (!text) {\n    return;\n  }\n\n  // get layouted text bounds and resize external\n  // external label accordingly\n  let newLabelBounds = this._textRenderer.getExternalLabelBounds(label, text);\n\n  this._modeling.resizeShape(label, newLabelBounds, NULL_DIMENSIONS);\n};\n\n/**\n * Reverts the update on a BPMN elements properties.\n *\n * @param  {Object} context\n *\n * @return {djs.model.Base} the updated element\n */\nUpdatePropertiesHandler.prototype.revert = function (context) {\n  let element = context.element,\n    properties = context.properties,\n    oldProperties = context.oldProperties,\n    businessObject = element.businessObject,\n    elementRegistry = this._elementRegistry,\n    ids = this._moddle.ids;\n\n  // update properties\n  setProperties(businessObject, oldProperties);\n\n  if (isIdChange(properties, businessObject)) {\n    ids.unclaim(properties[ID]);\n\n    elementRegistry.updateId(element, oldProperties[ID]);\n\n    ids.claim(oldProperties[ID], businessObject);\n  }\n\n  return context.changed;\n};\n\nfunction isIdChange(properties, businessObject) {\n  return ID in properties && properties[ID] !== businessObject[ID];\n}\n\nfunction getProperties(businessObject, properties) {\n  let propertyNames = keys(properties);\n\n  return reduce(\n    propertyNames,\n    function (result, key) {\n      // handle DI separately\n      if (key !== DI) {\n        result[key] = businessObject.get(key);\n      } else {\n        result[key] = getDiProperties(businessObject.di, keys(properties.di));\n      }\n\n      return result;\n    },\n    {}\n  );\n}\n\nfunction getDiProperties(di, propertyNames) {\n  return reduce(\n    propertyNames,\n    function (result, key) {\n      result[key] = di.get(key);\n\n      return result;\n    },\n    {}\n  );\n}\n\nfunction setProperties(businessObject, properties) {\n  forEach(properties, function (value, key) {\n    if (key !== DI) {\n      businessObject.set(key, value);\n    } else {\n      // only update, if businessObject.di exists\n      if (businessObject.di) {\n        setDiProperties(businessObject.di, value);\n      }\n    }\n  });\n}\n\nfunction setDiProperties(di, properties) {\n  forEach(properties, function (value, key) {\n    di.set(key, value);\n  });\n}\n\nlet referencePropertyNames = [\"default\"];\n\n/**\n * Make sure we unwrap the actual business object\n * behind diagram element that may have been\n * passed as arguments.\n *\n * @param  {Object} properties\n *\n * @return {Object} unwrappedProps\n */\nfunction unwrapBusinessObjects(properties) {\n  let unwrappedProps = assign({}, properties);\n\n  referencePropertyNames.forEach(function (name) {\n    if (name in properties) {\n      unwrappedProps[name] = getBusinessObject(unwrappedProps[name]);\n    }\n  });\n\n  return unwrappedProps;\n}\n","import {\n  add as collectionAdd,\n  remove as collectionRemove,\n} from \"diagram-js/lib/util/Collections\";\n\nexport default function UpdateCanvasRootHandler(canvas, modeling) {\n  this._canvas = canvas;\n  this._modeling = modeling;\n}\n\nUpdateCanvasRootHandler.$inject = [\"canvas\", \"modeling\"];\n\nUpdateCanvasRootHandler.prototype.execute = function (context) {\n  let canvas = this._canvas;\n\n  let newRoot = context.newRoot,\n    newRootBusinessObject = newRoot.businessObject,\n    oldRoot = canvas.getRootElement(),\n    oldRootBusinessObject = oldRoot.businessObject,\n    bpmnDefinitions = oldRootBusinessObject.$parent,\n    diPlane = oldRootBusinessObject.di;\n\n  // (1) replace process old <> new root\n  canvas.setRootElement(newRoot, true);\n\n  // (2) update root elements\n  collectionAdd(bpmnDefinitions.rootElements, newRootBusinessObject);\n  newRootBusinessObject.$parent = bpmnDefinitions;\n\n  collectionRemove(bpmnDefinitions.rootElements, oldRootBusinessObject);\n  oldRootBusinessObject.$parent = null;\n\n  // (3) wire di\n  oldRootBusinessObject.di = null;\n\n  diPlane.bpmnElement = newRootBusinessObject;\n  newRootBusinessObject.di = diPlane;\n\n  context.oldRoot = oldRoot;\n\n  // TODO(nikku): return changed elements?\n  // return [ newRoot, oldRoot ];\n};\n\nUpdateCanvasRootHandler.prototype.revert = function (context) {\n  let canvas = this._canvas;\n\n  let newRoot = context.newRoot,\n    newRootBusinessObject = newRoot.businessObject,\n    oldRoot = context.oldRoot,\n    oldRootBusinessObject = oldRoot.businessObject,\n    bpmnDefinitions = newRootBusinessObject.$parent,\n    diPlane = newRootBusinessObject.di;\n\n  // (1) replace process old <> new root\n  canvas.setRootElement(oldRoot, true);\n\n  // (2) update root elements\n  collectionRemove(bpmnDefinitions.rootElements, newRootBusinessObject);\n  newRootBusinessObject.$parent = null;\n\n  collectionAdd(bpmnDefinitions.rootElements, oldRootBusinessObject);\n  oldRootBusinessObject.$parent = bpmnDefinitions;\n\n  // (3) wire di\n  newRootBusinessObject.di = null;\n\n  diPlane.bpmnElement = oldRootBusinessObject;\n  oldRootBusinessObject.di = diPlane;\n\n  // TODO(nikku): return changed elements?\n  // return [ newRoot, oldRoot ];\n};\n","import { filter } from \"min-dash\";\n\nimport { eachElement } from \"diagram-js/lib/util/Elements\";\n\nimport {\n  getLanesRoot,\n  getChildLanes,\n  LANE_INDENTATION,\n} from \"../util/LaneUtil\";\n\n/**\n * A handler that allows us to add a new lane\n * above or below an existing one.\n *\n * @param {Modeling} modeling\n * @param {SpaceTool} spaceTool\n */\nexport default function AddLaneHandler(modeling, spaceTool) {\n  this._modeling = modeling;\n  this._spaceTool = spaceTool;\n}\n\nAddLaneHandler.$inject = [\"modeling\", \"spaceTool\"];\n\nAddLaneHandler.prototype.preExecute = function (context) {\n  let spaceTool = this._spaceTool,\n    modeling = this._modeling;\n\n  let shape = context.shape,\n    location = context.location;\n\n  let lanesRoot = getLanesRoot(shape);\n\n  let isRoot = lanesRoot === shape,\n    laneParent = isRoot ? shape : shape.parent;\n\n  let existingChildLanes = getChildLanes(laneParent);\n\n  // (0) add a lane if we currently got none and are adding to root\n  if (!existingChildLanes.length) {\n    modeling.createShape(\n      { type: \"bpmn:Lane\" },\n      {\n        x: shape.x + LANE_INDENTATION,\n        y: shape.y,\n        width: shape.width - LANE_INDENTATION,\n        height: shape.height,\n      },\n      laneParent\n    );\n  }\n\n  // (1) collect affected elements to create necessary space\n  let allAffected = [];\n\n  eachElement(lanesRoot, function (element) {\n    allAffected.push(element);\n\n    // handle element labels in the diagram root\n    if (element.label) {\n      allAffected.push(element.label);\n    }\n\n    if (element === shape) {\n      return [];\n    }\n\n    return filter(element.children, function (c) {\n      return c !== shape;\n    });\n  });\n\n  let offset = location === \"top\" ? -120 : 120,\n    lanePosition = location === \"top\" ? shape.y : shape.y + shape.height,\n    spacePos = lanePosition + (location === \"top\" ? 10 : -10),\n    direction = location === \"top\" ? \"n\" : \"s\";\n\n  let adjustments = spaceTool.calculateAdjustments(\n    allAffected,\n    \"y\",\n    offset,\n    spacePos\n  );\n\n  spaceTool.makeSpace(\n    adjustments.movingShapes,\n    adjustments.resizingShapes,\n    { x: 0, y: offset },\n    direction,\n    spacePos\n  );\n\n  // (2) create new lane at open space\n  context.newLane = modeling.createShape(\n    { type: \"bpmn:Lane\" },\n    {\n      x: shape.x + (isRoot ? LANE_INDENTATION : 0),\n      y: lanePosition - (location === \"top\" ? 120 : 0),\n      width: shape.width - (isRoot ? LANE_INDENTATION : 0),\n      height: 120,\n    },\n    laneParent\n  );\n};\n","import { getChildLanes, LANE_INDENTATION } from \"../util/LaneUtil\";\n\n/**\n * A handler that splits a lane into a number of sub-lanes,\n * creating new sub lanes, if necessary.\n *\n * @param {Modeling} modeling\n */\nexport default function SplitLaneHandler(modeling, translate) {\n  this._modeling = modeling;\n  this._translate = translate;\n}\n\nSplitLaneHandler.$inject = [\"modeling\", \"translate\"];\n\nSplitLaneHandler.prototype.preExecute = function (context) {\n  let modeling = this._modeling,\n    translate = this._translate;\n\n  let shape = context.shape,\n    newLanesCount = context.count;\n\n  let childLanes = getChildLanes(shape),\n    existingLanesCount = childLanes.length;\n\n  if (existingLanesCount > newLanesCount) {\n    throw new Error(\n      translate(\"more than {count} child lanes\", { count: newLanesCount })\n    );\n  }\n\n  let newLanesHeight = Math.round(shape.height / newLanesCount);\n\n  // Iterate from top to bottom in child lane order,\n  // resizing existing lanes and creating new ones\n  // so that they split the parent proportionally.\n  //\n  // Due to rounding related errors, the bottom lane\n  // needs to take up all the remaining space.\n  let laneY, laneHeight, laneBounds, newLaneAttrs, idx;\n\n  for (idx = 0; idx < newLanesCount; idx++) {\n    laneY = shape.y + idx * newLanesHeight;\n\n    // if bottom lane\n    if (idx === newLanesCount - 1) {\n      laneHeight = shape.height - newLanesHeight * idx;\n    } else {\n      laneHeight = newLanesHeight;\n    }\n\n    laneBounds = {\n      x: shape.x + LANE_INDENTATION,\n      y: laneY,\n      width: shape.width - LANE_INDENTATION,\n      height: laneHeight,\n    };\n\n    if (idx < existingLanesCount) {\n      // resize existing lane\n      modeling.resizeShape(childLanes[idx], laneBounds);\n    } else {\n      // create a new lane at position\n      newLaneAttrs = {\n        type: \"bpmn:Lane\",\n      };\n\n      modeling.createShape(newLaneAttrs, laneBounds, shape);\n    }\n  }\n};\n","import { is } from \"../../../util/ModelUtil\";\n\nimport { getLanesRoot, computeLanesResize } from \"../util/LaneUtil\";\n\nimport { eachElement } from \"diagram-js/lib/util/Elements\";\n\nimport { asTRBL } from \"diagram-js/lib/layout/LayoutUtil\";\n\nimport { substractTRBL } from \"diagram-js/lib/features/resize/ResizeUtil\";\n\n/**\n * A handler that resizes a lane.\n *\n * @param {Modeling} modeling\n */\nexport default function ResizeLaneHandler(modeling, spaceTool) {\n  this._modeling = modeling;\n  this._spaceTool = spaceTool;\n}\n\nResizeLaneHandler.$inject = [\"modeling\", \"spaceTool\"];\n\nResizeLaneHandler.prototype.preExecute = function (context) {\n  let shape = context.shape,\n    newBounds = context.newBounds,\n    balanced = context.balanced;\n\n  if (balanced !== false) {\n    this.resizeBalanced(shape, newBounds);\n  } else {\n    this.resizeSpace(shape, newBounds);\n  }\n};\n\n/**\n * Resize balanced, adjusting next / previous lane sizes.\n *\n * @param {djs.model.Shape} shape\n * @param {Bounds} newBounds\n */\nResizeLaneHandler.prototype.resizeBalanced = function (shape, newBounds) {\n  let modeling = this._modeling;\n\n  let resizeNeeded = computeLanesResize(shape, newBounds);\n\n  // resize the lane\n  modeling.resizeShape(shape, newBounds);\n\n  // resize other lanes as needed\n  resizeNeeded.forEach(function (r) {\n    modeling.resizeShape(r.shape, r.newBounds);\n  });\n};\n\n/**\n * Resize, making actual space and moving below / above elements.\n *\n * @param {djs.model.Shape} shape\n * @param {Bounds} newBounds\n */\nResizeLaneHandler.prototype.resizeSpace = function (shape, newBounds) {\n  let spaceTool = this._spaceTool;\n\n  let shapeTrbl = asTRBL(shape),\n    newTrbl = asTRBL(newBounds);\n\n  let trblDiff = substractTRBL(newTrbl, shapeTrbl);\n\n  let lanesRoot = getLanesRoot(shape);\n\n  let allAffected = [],\n    allLanes = [];\n\n  eachElement(lanesRoot, function (element) {\n    allAffected.push(element);\n\n    if (is(element, \"bpmn:Lane\") || is(element, \"bpmn:Participant\")) {\n      allLanes.push(element);\n    }\n\n    return element.children;\n  });\n\n  let change, spacePos, direction, offset, adjustments;\n\n  if (trblDiff.bottom || trblDiff.top) {\n    change = trblDiff.bottom || trblDiff.top;\n    spacePos =\n      shape.y +\n      (trblDiff.bottom ? shape.height : 0) +\n      (trblDiff.bottom ? -10 : 10);\n    direction = trblDiff.bottom ? \"s\" : \"n\";\n\n    offset = trblDiff.top > 0 || trblDiff.bottom < 0 ? -change : change;\n\n    adjustments = spaceTool.calculateAdjustments(\n      allAffected,\n      \"y\",\n      offset,\n      spacePos\n    );\n\n    spaceTool.makeSpace(\n      adjustments.movingShapes,\n      adjustments.resizingShapes,\n      { x: 0, y: change },\n      direction\n    );\n  }\n\n  if (trblDiff.left || trblDiff.right) {\n    change = trblDiff.right || trblDiff.left;\n    spacePos =\n      shape.x +\n      (trblDiff.right ? shape.width : 0) +\n      (trblDiff.right ? -10 : 100);\n    direction = trblDiff.right ? \"e\" : \"w\";\n\n    offset = trblDiff.left > 0 || trblDiff.right < 0 ? -change : change;\n\n    adjustments = spaceTool.calculateAdjustments(\n      allLanes,\n      \"x\",\n      offset,\n      spacePos\n    );\n\n    spaceTool.makeSpace(\n      adjustments.movingShapes,\n      adjustments.resizingShapes,\n      { x: change, y: 0 },\n      direction\n    );\n  }\n};\n","import { collectLanes, getLanesRoot } from \"../util/LaneUtil\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\nimport {\n  add as collectionAdd,\n  remove as collectionRemove,\n} from \"diagram-js/lib/util/Collections\";\n\nimport { asTRBL } from \"diagram-js/lib/layout/LayoutUtil\";\n\nconst FLOW_NODE_REFS_ATTR = \"flowNodeRef\",\n  LANES_ATTR = \"lanes\";\n\n/**\n * A handler that updates lane refs on changed elements\n */\nexport default function UpdateFlowNodeRefsHandler(elementRegistry) {\n  this._elementRegistry = elementRegistry;\n}\n\nUpdateFlowNodeRefsHandler.$inject = [\"elementRegistry\"];\n\nUpdateFlowNodeRefsHandler.prototype.computeUpdates = function (\n  flowNodeShapes,\n  laneShapes\n) {\n  let handledNodes = [];\n\n  let updates = [];\n\n  let participantCache = {};\n\n  let allFlowNodeShapes = [];\n\n  function isInLaneShape(element, laneShape) {\n    let laneTrbl = asTRBL(laneShape);\n\n    let elementMid = {\n      x: element.x + element.width / 2,\n      y: element.y + element.height / 2,\n    };\n\n    return (\n      elementMid.x > laneTrbl.left &&\n      elementMid.x < laneTrbl.right &&\n      elementMid.y > laneTrbl.top &&\n      elementMid.y < laneTrbl.bottom\n    );\n  }\n\n  function addFlowNodeShape(flowNodeShape) {\n    if (handledNodes.indexOf(flowNodeShape) === -1) {\n      allFlowNodeShapes.push(flowNodeShape);\n      handledNodes.push(flowNodeShape);\n    }\n  }\n\n  function getAllLaneShapes(flowNodeShape) {\n    let root = getLanesRoot(flowNodeShape);\n\n    if (!participantCache[root.id]) {\n      participantCache[root.id] = collectLanes(root);\n    }\n\n    return participantCache[root.id];\n  }\n\n  function getNewLanes(flowNodeShape) {\n    if (!flowNodeShape.parent) {\n      return [];\n    }\n\n    let allLaneShapes = getAllLaneShapes(flowNodeShape);\n\n    return allLaneShapes\n      .filter(function (l) {\n        return isInLaneShape(flowNodeShape, l);\n      })\n      .map(function (shape) {\n        return shape.businessObject;\n      });\n  }\n\n  laneShapes.forEach(function (laneShape) {\n    let root = getLanesRoot(laneShape);\n\n    if (!root || handledNodes.indexOf(root) !== -1) {\n      return;\n    }\n\n    let children = root.children.filter(function (c) {\n      return is(c, \"bpmn:FlowNode\");\n    });\n\n    children.forEach(addFlowNodeShape);\n\n    handledNodes.push(root);\n  });\n\n  flowNodeShapes.forEach(addFlowNodeShape);\n\n  allFlowNodeShapes.forEach(function (flowNodeShape) {\n    let flowNode = flowNodeShape.businessObject;\n\n    let lanes = flowNode.get(LANES_ATTR),\n      remove = lanes.slice(),\n      add = getNewLanes(flowNodeShape);\n\n    updates.push({ flowNode: flowNode, remove: remove, add: add });\n  });\n\n  laneShapes.forEach(function (laneShape) {\n    let lane = laneShape.businessObject;\n\n    // lane got removed XX-)\n    if (!laneShape.parent) {\n      lane.get(FLOW_NODE_REFS_ATTR).forEach(function (flowNode) {\n        updates.push({ flowNode: flowNode, remove: [lane], add: [] });\n      });\n    }\n  });\n\n  return updates;\n};\n\nUpdateFlowNodeRefsHandler.prototype.execute = function (context) {\n  let updates = context.updates;\n\n  if (!updates) {\n    updates = context.updates = this.computeUpdates(\n      context.flowNodeShapes,\n      context.laneShapes\n    );\n  }\n\n  updates.forEach(function (update) {\n    let flowNode = update.flowNode,\n      lanes = flowNode.get(LANES_ATTR);\n\n    // unwire old\n    update.remove.forEach(function (oldLane) {\n      collectionRemove(lanes, oldLane);\n      collectionRemove(oldLane.get(FLOW_NODE_REFS_ATTR), flowNode);\n    });\n\n    // wire new\n    update.add.forEach(function (newLane) {\n      collectionAdd(lanes, newLane);\n      collectionAdd(newLane.get(FLOW_NODE_REFS_ATTR), flowNode);\n    });\n  });\n\n  // TODO(nikku): return changed elements\n  // return [ ... ];\n};\n\nUpdateFlowNodeRefsHandler.prototype.revert = function (context) {\n  let updates = context.updates;\n\n  updates.forEach(function (update) {\n    let flowNode = update.flowNode,\n      lanes = flowNode.get(LANES_ATTR);\n\n    // unwire new\n    update.add.forEach(function (newLane) {\n      collectionRemove(lanes, newLane);\n      collectionRemove(newLane.get(FLOW_NODE_REFS_ATTR), flowNode);\n    });\n\n    // wire old\n    update.remove.forEach(function (oldLane) {\n      collectionAdd(lanes, oldLane);\n      collectionAdd(oldLane.get(FLOW_NODE_REFS_ATTR), flowNode);\n    });\n  });\n\n  // TODO(nikku): return changed elements\n  // return [ ... ];\n};\n","export default function IdClaimHandler(moddle) {\n  this._moddle = moddle;\n}\n\nIdClaimHandler.$inject = [\"moddle\"];\n\nIdClaimHandler.prototype.execute = function (context) {\n  let ids = this._moddle.ids,\n    id = context.id,\n    element = context.element,\n    claiming = context.claiming;\n\n  if (claiming) {\n    ids.claim(id, element);\n  } else {\n    ids.unclaim(id);\n  }\n};\n\n/**\n * Command revert implementation.\n */\nIdClaimHandler.prototype.revert = function (context) {\n  let ids = this._moddle.ids,\n    id = context.id,\n    element = context.element,\n    claiming = context.claiming;\n\n  if (claiming) {\n    ids.unclaim(id);\n  } else {\n    ids.claim(id, element);\n  }\n};\n","import { assign, forEach } from \"min-dash\";\r\n\r\nlet DEFAULT_COLORS = {\r\n  fill: undefined,\r\n  stroke: undefined,\r\n};\r\n\r\nexport default function SetColorHandler(commandStack) {\r\n  this._commandStack = commandStack;\r\n}\r\n\r\nSetColorHandler.$inject = [\"commandStack\"];\r\n\r\nSetColorHandler.prototype.postExecute = function (context) {\r\n  let elements = context.elements,\r\n    colors = context.colors || DEFAULT_COLORS;\r\n\r\n  let self = this;\r\n\r\n  let di = {};\r\n\r\n  if (\"fill\" in colors) {\r\n    assign(di, { fill: colors.fill });\r\n  }\r\n\r\n  if (\"stroke\" in colors) {\r\n    assign(di, { stroke: colors.stroke });\r\n  }\r\n\r\n  forEach(elements, function (element) {\r\n    self._commandStack.execute(\"element.updateProperties\", {\r\n      element: element,\r\n      properties: {\r\n        di: di,\r\n      },\r\n    });\r\n  });\r\n};\r\n","import { setLabel, getLabel } from \"../LabelUtil\";\n\nimport {\n  getExternalLabelMid,\n  isLabelExternal,\n  hasExternalLabel,\n  isLabel,\n} from \"../../../util/LabelUtil\";\n\nimport { is } from \"../../../util/ModelUtil\";\n\nlet NULL_DIMENSIONS = {\n  width: 0,\n  height: 0,\n};\n\n/**\n * A handler that updates the text of a BPMN element.\n */\nexport default function UpdateLabelHandler(modeling, textRenderer) {\n  /**\n   * Set the label and return the changed elements.\n   *\n   * Element parameter can be label itself or connection (i.e. sequence flow).\n   *\n   * @param {djs.model.Base} element\n   * @param {String} text\n   */\n  function setText(element, text) {\n    // external label if present\n    let label = element.label || element;\n\n    let labelTarget = element.labelTarget || element;\n\n    setLabel(label, text, labelTarget !== label);\n\n    return [label, labelTarget];\n  }\n\n  function preExecute(ctx) {\n    let element = ctx.element,\n      businessObject = element.businessObject,\n      newLabel = ctx.newLabel;\n\n    if (\n      !isLabel(element) &&\n      isLabelExternal(element) &&\n      !hasExternalLabel(element) &&\n      !isEmptyText(newLabel)\n    ) {\n      // create label\n      let paddingTop = 7;\n\n      let labelCenter = getExternalLabelMid(element);\n\n      labelCenter = {\n        x: labelCenter.x,\n        y: labelCenter.y + paddingTop,\n      };\n\n      modeling.createLabel(element, labelCenter, {\n        id: businessObject.id + \"_label\",\n        businessObject: businessObject,\n      });\n    }\n  }\n\n  function execute(ctx) {\n    ctx.oldLabel = getLabel(ctx.element);\n    return setText(ctx.element, ctx.newLabel);\n  }\n\n  function revert(ctx) {\n    return setText(ctx.element, ctx.oldLabel);\n  }\n\n  function postExecute(ctx) {\n    let element = ctx.element,\n      label = element.label || element,\n      newLabel = ctx.newLabel,\n      newBounds = ctx.newBounds,\n      hints = ctx.hints || {};\n\n    if (isLabel(label) && isEmptyText(newLabel)) {\n      if (hints.removeShape !== false) {\n        modeling.removeShape(label, { unsetLabel: false });\n      }\n\n      return;\n    }\n\n    // ignore internal labels for elements except text annotations\n    if (!isLabelExternal(element) && !is(element, \"bpmn:TextAnnotation\")) {\n      return;\n    }\n\n    let text = getLabel(label);\n\n    // resize element based on label _or_ pre-defined bounds\n    if (typeof newBounds === \"undefined\") {\n      newBounds = textRenderer.getExternalLabelBounds(label, text);\n    }\n\n    // setting newBounds to false or _null_ will\n    // disable the postExecute resize operation\n    if (newBounds) {\n      modeling.resizeShape(label, newBounds, NULL_DIMENSIONS);\n    }\n  }\n\n  // API\n\n  this.preExecute = preExecute;\n  this.execute = execute;\n  this.revert = revert;\n  this.postExecute = postExecute;\n}\n\nUpdateLabelHandler.$inject = [\"modeling\", \"textRenderer\"];\n\n// helpers ///////////////////////\n\nfunction isEmptyText(label) {\n  return !label || !label.trim();\n}\n","import inherits from \"inherits\";\n\nimport BaseModeling from \"diagram-js/lib/features/modeling/Modeling\";\n\nimport UpdatePropertiesHandler from \"./cmd/UpdatePropertiesHandler\";\nimport UpdateCanvasRootHandler from \"./cmd/UpdateCanvasRootHandler\";\nimport AddLaneHandler from \"./cmd/AddLaneHandler\";\nimport SplitLaneHandler from \"./cmd/SplitLaneHandler\";\nimport ResizeLaneHandler from \"./cmd/ResizeLaneHandler\";\nimport UpdateFlowNodeRefsHandler from \"./cmd/UpdateFlowNodeRefsHandler\";\nimport IdClaimHandler from \"./cmd/IdClaimHandler\";\nimport SetColorHandler from \"./cmd/SetColorHandler\";\n\nimport UpdateLabelHandler from \"../label-editing/cmd/UpdateLabelHandler\";\n\n/**\n * BPMN 2.0 modeling features activator\n *\n * @param {EventBus} eventBus\n * @param {ElementFactory} elementFactory\n * @param {CommandStack} commandStack\n * @param {BpmnRules} bpmnRules\n */\nexport default function Modeling(\n  eventBus,\n  elementFactory,\n  commandStack,\n  bpmnRules\n) {\n  BaseModeling.call(this, eventBus, elementFactory, commandStack);\n\n  this._bpmnRules = bpmnRules;\n}\n\ninherits(Modeling, BaseModeling);\n\nModeling.$inject = [\"eventBus\", \"elementFactory\", \"commandStack\", \"bpmnRules\"];\n\nModeling.prototype.getHandlers = function () {\n  let handlers = BaseModeling.prototype.getHandlers.call(this);\n\n  handlers[\"element.updateProperties\"] = UpdatePropertiesHandler;\n  handlers[\"canvas.updateRoot\"] = UpdateCanvasRootHandler;\n  handlers[\"lane.add\"] = AddLaneHandler;\n  handlers[\"lane.resize\"] = ResizeLaneHandler;\n  handlers[\"lane.split\"] = SplitLaneHandler;\n  handlers[\"lane.updateRefs\"] = UpdateFlowNodeRefsHandler;\n  handlers[\"id.updateClaim\"] = IdClaimHandler;\n  handlers[\"element.setColor\"] = SetColorHandler;\n  handlers[\"element.updateLabel\"] = UpdateLabelHandler;\n\n  return handlers;\n};\n\nModeling.prototype.updateLabel = function (\n  element,\n  newLabel,\n  newBounds,\n  hints\n) {\n  this._commandStack.execute(\"element.updateLabel\", {\n    element: element,\n    newLabel: newLabel,\n    newBounds: newBounds,\n    hints: hints || {},\n  });\n};\n\nModeling.prototype.connect = function (source, target, attrs, hints) {\n  let bpmnRules = this._bpmnRules;\n\n  if (!attrs) {\n    attrs = bpmnRules.canConnect(source, target);\n  }\n\n  if (!attrs) {\n    return;\n  }\n\n  return this.createConnection(source, target, attrs, source.parent, hints);\n};\n\nModeling.prototype.updateProperties = function (element, properties) {\n  this._commandStack.execute(\"element.updateProperties\", {\n    element: element,\n    properties: properties,\n  });\n};\n\nModeling.prototype.resizeLane = function (laneShape, newBounds, balanced) {\n  this._commandStack.execute(\"lane.resize\", {\n    shape: laneShape,\n    newBounds: newBounds,\n    balanced: balanced,\n  });\n};\n\nModeling.prototype.addLane = function (targetLaneShape, location) {\n  let context = {\n    shape: targetLaneShape,\n    location: location,\n  };\n\n  this._commandStack.execute(\"lane.add\", context);\n\n  return context.newLane;\n};\n\nModeling.prototype.splitLane = function (targetLane, count) {\n  this._commandStack.execute(\"lane.split\", {\n    shape: targetLane,\n    count: count,\n  });\n};\n\n/**\n * Transform the current diagram into a collaboration.\n *\n * @return {djs.model.Root} the new root element\n */\nModeling.prototype.makeCollaboration = function () {\n  let collaborationElement = this._create(\"root\", {\n    type: \"bpmn:Collaboration\",\n  });\n\n  let context = {\n    newRoot: collaborationElement,\n  };\n\n  this._commandStack.execute(\"canvas.updateRoot\", context);\n\n  return collaborationElement;\n};\n\nModeling.prototype.updateLaneRefs = function (flowNodeShapes, laneShapes) {\n  this._commandStack.execute(\"lane.updateRefs\", {\n    flowNodeShapes: flowNodeShapes,\n    laneShapes: laneShapes,\n  });\n};\n\n/**\n * Transform the current diagram into a process.\n *\n * @return {djs.model.Root} the new root element\n */\nModeling.prototype.makeProcess = function () {\n  let processElement = this._create(\"root\", {\n    type: \"bpmn:Process-action\",\n  });\n\n  let context = {\n    newRoot: processElement,\n  };\n\n  this._commandStack.execute(\"canvas.updateRoot\", context);\n};\n\nModeling.prototype.claimId = function (id, moddleElement) {\n  this._commandStack.execute(\"id.updateClaim\", {\n    id: id,\n    element: moddleElement,\n    claiming: true,\n  });\n};\n\nModeling.prototype.unclaimId = function (id, moddleElement) {\n  this._commandStack.execute(\"id.updateClaim\", {\n    id: id,\n    element: moddleElement,\n  });\n};\n\nModeling.prototype.setColor = function (elements, colors) {\n  if (!elements.length) {\n    elements = [elements];\n  }\n\n  this._commandStack.execute(\"element.setColor\", {\n    elements: elements,\n    colors: colors,\n  });\n};\n","import inherits from \"inherits\";\n\nimport { assign } from \"min-dash\";\n\nimport BaseLayouter from \"diagram-js/lib/layout/BaseLayouter\";\n\nimport {\n  repairConnection,\n  withoutRedundantPoints,\n} from \"diagram-js/lib/layout/ManhattanLayout\";\n\nimport { getMid, getOrientation } from \"diagram-js/lib/layout/LayoutUtil\";\n\nimport { isExpanded } from \"../../util/DiUtil\";\n\nimport { is } from \"../../util/ModelUtil\";\n\nlet ATTACH_ORIENTATION_PADDING = -10,\n  BOUNDARY_TO_HOST_THRESHOLD = 40;\n\nlet oppositeOrientationMapping = {\n  top: \"bottom\",\n  \"top-right\": \"bottom-left\",\n  \"top-left\": \"bottom-right\",\n  right: \"left\",\n  bottom: \"top\",\n  \"bottom-right\": \"top-left\",\n  \"bottom-left\": \"top-right\",\n  left: \"right\",\n};\n\nlet orientationDirectionMapping = {\n  top: \"t\",\n  right: \"r\",\n  bottom: \"b\",\n  left: \"l\",\n};\n\nexport default function BpmnLayouter() {}\n\ninherits(BpmnLayouter, BaseLayouter);\n\nBpmnLayouter.prototype.layoutConnection = function (connection, hints) {\n  if (!hints) {\n    hints = {};\n  }\n\n  let source = hints.source || connection.source,\n    target = hints.target || connection.target,\n    waypoints = hints.waypoints || connection.waypoints,\n    connectionStart = hints.connectionStart,\n    connectionEnd = hints.connectionEnd;\n\n  let manhattanOptions, updatedWaypoints;\n\n  if (!connectionStart) {\n    connectionStart = getConnectionDocking(waypoints && waypoints[0], source);\n  }\n\n  if (!connectionEnd) {\n    connectionEnd = getConnectionDocking(\n      waypoints && waypoints[waypoints.length - 1],\n      target\n    );\n  }\n\n  // TODO(nikku): support vertical modeling\n  // and invert preferredLayouts accordingly\n\n  if (\n    is(connection, \"bpmn:Association\") ||\n    is(connection, \"bpmn:DataAssociation\")\n  ) {\n    if (waypoints && !isCompensationAssociation(source, target)) {\n      return [].concat([connectionStart], waypoints.slice(1, -1), [\n        connectionEnd,\n      ]);\n    }\n  }\n\n  if (is(connection, \"bpmn:MessageFlow\")) {\n    manhattanOptions = getMessageFlowManhattanOptions(source, target);\n  } else if (\n    is(connection, \"bpmn:SequenceFlow\") ||\n    isCompensationAssociation(source, target)\n  ) {\n    // layout all connection between flow elements h:h, except for\n    // (1) outgoing of boundary events -> layout based on attach orientation and target orientation\n    // (2) incoming/outgoing of gateways -> v:h for outgoing, h:v for incoming\n    // (3) loops\n    if (source === target) {\n      manhattanOptions = {\n        preferredLayouts: getLoopPreferredLayout(source, connection),\n      };\n    } else if (is(source, \"bpmn:BoundaryEvent\")) {\n      manhattanOptions = {\n        preferredLayouts: getBoundaryEventPreferredLayouts(\n          source,\n          target,\n          connectionEnd\n        ),\n      };\n    } else if (is(source, \"bpmn:Gateway\")) {\n      manhattanOptions = {\n        preferredLayouts: [\"v:h\"],\n      };\n    } else if (is(target, \"bpmn:Gateway\")) {\n      manhattanOptions = {\n        preferredLayouts: [\"h:v\"],\n      };\n    } else {\n      manhattanOptions = {\n        preferredLayouts: [\"h:h\"],\n      };\n    }\n  }\n\n  if (manhattanOptions) {\n    manhattanOptions = assign(manhattanOptions, hints);\n\n    updatedWaypoints = withoutRedundantPoints(\n      repairConnection(\n        source,\n        target,\n        connectionStart,\n        connectionEnd,\n        waypoints,\n        manhattanOptions\n      )\n    );\n  }\n\n  return updatedWaypoints || [connectionStart, connectionEnd];\n};\n\n// helpers //////////\n\nfunction getAttachOrientation(attachedElement) {\n  let hostElement = attachedElement.host;\n\n  return getOrientation(\n    getMid(attachedElement),\n    hostElement,\n    ATTACH_ORIENTATION_PADDING\n  );\n}\n\nfunction getMessageFlowManhattanOptions(source, target) {\n  return {\n    preferredLayouts: [\"straight\", \"v:v\"],\n    preserveDocking: getMessageFlowPreserveDocking(source, target),\n  };\n}\n\nfunction getMessageFlowPreserveDocking(source, target) {\n  // (1) docking element connected to participant has precedence\n  if (is(target, \"bpmn:Participant\")) {\n    return \"source\";\n  }\n\n  if (is(source, \"bpmn:Participant\")) {\n    return \"target\";\n  }\n\n  // (2) docking element connected to expanded sub-process has precedence\n  if (isExpandedLoop(target)) {\n    return \"source\";\n  }\n\n  if (isExpandedLoop(source)) {\n    return \"target\";\n  }\n\n  // (3) docking event has precedence\n  if (is(target, \"bpmn:Event\")) {\n    return \"target\";\n  }\n\n  if (is(source, \"bpmn:Event\")) {\n    return \"source\";\n  }\n\n  return null;\n}\n\nfunction getConnectionDocking(point, shape) {\n  return point ? point.original || point : getMid(shape);\n}\n\nfunction isCompensationAssociation(source, target) {\n  return (\n    is(target, \"bpmn:Activity\") &&\n    is(source, \"bpmn:BoundaryEvent\") &&\n    target.businessObject.isForCompensation\n  );\n}\n\nfunction isExpandedLoop(element) {\n  return is(element, \"bpmn:Loop\") && isExpanded(element);\n}\n\nfunction isSame(a, b) {\n  return a === b;\n}\n\nfunction isAnyOrientation(orientation, orientations) {\n  return orientations.indexOf(orientation) !== -1;\n}\n\nfunction getHorizontalOrientation(orientation) {\n  let matches = /right|left/.exec(orientation);\n\n  return matches && matches[0];\n}\n\nfunction getVerticalOrientation(orientation) {\n  let matches = /top|bottom/.exec(orientation);\n\n  return matches && matches[0];\n}\n\nfunction isOppositeOrientation(a, b) {\n  return oppositeOrientationMapping[a] === b;\n}\n\nfunction isOppositeHorizontalOrientation(a, b) {\n  let horizontalOrientation = getHorizontalOrientation(a);\n\n  let oppositeHorizontalOrientation =\n    oppositeOrientationMapping[horizontalOrientation];\n\n  return b.indexOf(oppositeHorizontalOrientation) !== -1;\n}\n\nfunction isOppositeVerticalOrientation(a, b) {\n  let verticalOrientation = getVerticalOrientation(a);\n\n  let oppositeVerticalOrientation =\n    oppositeOrientationMapping[verticalOrientation];\n\n  return b.indexOf(oppositeVerticalOrientation) !== -1;\n}\n\nfunction isHorizontalOrientation(orientation) {\n  return orientation === \"right\" || orientation === \"left\";\n}\n\nfunction getLoopPreferredLayout(source, connection) {\n  let waypoints = connection.waypoints;\n\n  let orientation =\n    waypoints && waypoints.length && getOrientation(waypoints[0], source);\n\n  if (orientation === \"top\") {\n    return [\"t:r\"];\n  } else if (orientation === \"right\") {\n    return [\"r:b\"];\n  } else if (orientation === \"left\") {\n    return [\"l:t\"];\n  }\n\n  return [\"b:l\"];\n}\n\nfunction getBoundaryEventPreferredLayouts(source, target, end) {\n  let sourceMid = getMid(source),\n    targetMid = getMid(target),\n    attachOrientation = getAttachOrientation(source),\n    sourceLayout,\n    targetLayout;\n\n  let isLoop = isSame(source.host, target);\n\n  let attachedToSide = isAnyOrientation(attachOrientation, [\n    \"top\",\n    \"right\",\n    \"bottom\",\n    \"left\",\n  ]);\n\n  let targetOrientation = getOrientation(targetMid, sourceMid, {\n    x: source.width / 2 + target.width / 2,\n    y: source.height / 2 + target.height / 2,\n  });\n\n  if (isLoop) {\n    return getBoundaryEventLoopLayout(\n      attachOrientation,\n      attachedToSide,\n      source,\n      target,\n      end\n    );\n  }\n\n  // source layout\n  sourceLayout = getBoundaryEventSourceLayout(\n    attachOrientation,\n    targetOrientation,\n    attachedToSide\n  );\n\n  // target layout\n  targetLayout = getBoundaryEventTargetLayout(\n    attachOrientation,\n    targetOrientation,\n    attachedToSide\n  );\n\n  return [sourceLayout + \":\" + targetLayout];\n}\n\nfunction getBoundaryEventLoopLayout(\n  attachOrientation,\n  attachedToSide,\n  source,\n  target,\n  end\n) {\n  let orientation = attachedToSide\n      ? attachOrientation\n      : getVerticalOrientation(attachOrientation),\n    sourceLayout = orientationDirectionMapping[orientation],\n    targetLayout;\n\n  if (attachedToSide) {\n    if (isHorizontalOrientation(attachOrientation)) {\n      targetLayout = shouldConnectToSameSide(\"y\", source, target, end)\n        ? \"h\"\n        : \"b\";\n    } else {\n      targetLayout = shouldConnectToSameSide(\"x\", source, target, end)\n        ? \"v\"\n        : \"l\";\n    }\n  } else {\n    targetLayout = \"v\";\n  }\n\n  return [sourceLayout + \":\" + targetLayout];\n}\n\nfunction shouldConnectToSameSide(axis, source, target, end) {\n  let threshold = BOUNDARY_TO_HOST_THRESHOLD;\n\n  return !(\n    areCloseOnAxis(axis, end, target, threshold) ||\n    areCloseOnAxis(\n      axis,\n      end,\n      {\n        x: target.x + target.width,\n        y: target.y + target.height,\n      },\n      threshold\n    ) ||\n    areCloseOnAxis(axis, end, getMid(source), threshold)\n  );\n}\n\nfunction areCloseOnAxis(axis, a, b, threshold) {\n  return Math.abs(a[axis] - b[axis]) < threshold;\n}\n\nfunction getBoundaryEventSourceLayout(\n  attachOrientation,\n  targetOrientation,\n  attachedToSide\n) {\n  // attached to either top, right, bottom or left side\n  if (attachedToSide) {\n    return orientationDirectionMapping[attachOrientation];\n  }\n\n  // attached to either top-right, top-left, bottom-right or bottom-left corner\n\n  // same vertical or opposite horizontal orientation\n  if (\n    isSame(\n      getVerticalOrientation(attachOrientation),\n      getVerticalOrientation(targetOrientation)\n    ) ||\n    isOppositeOrientation(\n      getHorizontalOrientation(attachOrientation),\n      getHorizontalOrientation(targetOrientation)\n    )\n  ) {\n    return orientationDirectionMapping[\n      getVerticalOrientation(attachOrientation)\n    ];\n  }\n\n  // fallback\n  return orientationDirectionMapping[\n    getHorizontalOrientation(attachOrientation)\n  ];\n}\n\nfunction getBoundaryEventTargetLayout(\n  attachOrientation,\n  targetOrientation,\n  attachedToSide\n) {\n  // attached to either top, right, bottom or left side\n  if (attachedToSide) {\n    if (isHorizontalOrientation(attachOrientation)) {\n      // orientation is right or left\n\n      // opposite horizontal orientation or same orientation\n      if (\n        isOppositeHorizontalOrientation(attachOrientation, targetOrientation) ||\n        isSame(attachOrientation, targetOrientation)\n      ) {\n        return \"h\";\n      }\n\n      // fallback\n      return \"v\";\n    } else {\n      // orientation is top or bottom\n\n      // opposite vertical orientation or same orientation\n      if (\n        isOppositeVerticalOrientation(attachOrientation, targetOrientation) ||\n        isSame(attachOrientation, targetOrientation)\n      ) {\n        return \"v\";\n      }\n\n      // fallback\n      return \"h\";\n    }\n  }\n\n  // attached to either top-right, top-left, bottom-right or bottom-left corner\n\n  // orientation is right, left\n  // or same vertical orientation but also right or left\n  if (\n    isHorizontalOrientation(targetOrientation) ||\n    (isSame(\n      getVerticalOrientation(attachOrientation),\n      getVerticalOrientation(targetOrientation)\n    ) &&\n      getHorizontalOrientation(targetOrientation))\n  ) {\n    return \"h\";\n  } else {\n    return \"v\";\n  }\n}\n","import BehaviorModule from \"./behavior\";\nimport RulesModule from \"../rules\";\nimport DiOrderingModule from \"../di-ordering\";\nimport OrderingModule from \"../ordering\";\nimport ReplaceModule from \"../replace\";\n\nimport CommandModule from \"diagram-js/lib/command\";\nimport TooltipsModule from \"diagram-js/lib/features/tooltips\";\nimport LabelSupportModule from \"diagram-js/lib/features/label-support\";\nimport AttachSupportModule from \"diagram-js/lib/features/attach-support\";\nimport SelectionModule from \"diagram-js/lib/features/selection\";\nimport ChangeSupportModule from \"diagram-js/lib/features/change-support\";\nimport SpaceToolModule from \"diagram-js/lib/features/space-tool\";\n\nimport BpmnFactory from \"./BpmnFactory\";\nimport BpmnUpdater from \"./BpmnUpdater\";\nimport ElementFactory from \"./ElementFactory\";\nimport Modeling from \"./Modeling\";\nimport BpmnLayouter from \"./BpmnLayouter\";\nimport CroppingConnectionDocking from \"diagram-js/lib/layout/CroppingConnectionDocking\";\n\nexport default {\n  __init__: [\"modeling\", \"bpmnUpdater\"],\n  __depends__: [\n    BehaviorModule,\n    RulesModule,\n    DiOrderingModule,\n    OrderingModule,\n    ReplaceModule,\n    CommandModule,\n    TooltipsModule,\n    LabelSupportModule,\n    AttachSupportModule,\n    SelectionModule,\n    ChangeSupportModule,\n    SpaceToolModule,\n  ],\n  bpmnFactory: [\"type\", BpmnFactory],\n  bpmnUpdater: [\"type\", BpmnUpdater],\n  elementFactory: [\"type\", ElementFactory],\n  modeling: [\"type\", Modeling],\n  layouter: [\"type\", BpmnLayouter],\n  connectionDocking: [\"type\", CroppingConnectionDocking],\n};\n","import { assign } from \"min-dash\";\n\n/**\n * A palette provider for BPMN 2.0 elements.\n */\nexport default function PaletteProvider(\n  palette,\n  create,\n  elementFactory,\n  spaceTool,\n  lassoTool,\n  handTool,\n  globalConnect,\n  translate\n) {\n  this._palette = palette;\n  this._create = create;\n  this._elementFactory = elementFactory;\n  this._spaceTool = spaceTool;\n  this._lassoTool = lassoTool;\n  this._handTool = handTool;\n  this._globalConnect = globalConnect;\n  this._translate = translate;\n\n  palette.registerProvider(this);\n}\n\nPaletteProvider.$inject = [\n  \"palette\",\n  \"create\",\n  \"elementFactory\",\n  \"spaceTool\",\n  \"lassoTool\",\n  \"handTool\",\n  \"globalConnect\",\n  \"translate\",\n];\n\nPaletteProvider.prototype.getPaletteEntries = function (element) {\n  let actions = {},\n    create = this._create,\n    elementFactory = this._elementFactory,\n    spaceTool = this._spaceTool,\n    lassoTool = this._lassoTool,\n    handTool = this._handTool,\n    globalConnect = this._globalConnect,\n    translate = this._translate;\n\n  function createAction(type, group, className, title, options) {\n    function createListener(event) {\n      let shape = elementFactory.createShape(assign({ type: type }, options));\n\n      if (options) {\n        shape.businessObject.di.isExpanded = options.isExpanded;\n      }\n\n      create.start(event, shape);\n    }\n\n    let shortType = type.replace(/^bpmn:/, \"\");\n\n    return {\n      group: group,\n      className: className,\n      title: title || translate(\"Create {type}\", { type: shortType }),\n      action: {\n        dragstart: createListener,\n        click: createListener,\n      },\n    };\n  }\n\n  function createLoop(event) {\n    let loop = elementFactory.createShape({\n      type: \"bpmn:Loop\",\n      x: 0,\n      y: 0,\n      isExpanded: true,\n    });\n\n    let startEvent = elementFactory.createShape({\n      type: \"bpmn:StartEvent\",\n      x: 40,\n      y: 82,\n      parent: loop,\n    });\n\n    create.start(event, [loop, startEvent], {\n      hints: {\n        autoSelect: [startEvent],\n      },\n    });\n  }\n\n  function createParticipant(event) {\n    create.start(event, elementFactory.createParticipantShape());\n  }\n\n  assign(actions, {\n    \"hand-tool\": {\n      group: \"tools\",\n      className: \"bpmn-icon-hand-tool\",\n      title: translate(\"Activate the hand tool\"),\n      action: {\n        click: function (event) {\n          handTool.activateHand(event);\n        },\n      },\n    },\n    \"lasso-tool\": {\n      group: \"tools\",\n      className: \"bpmn-icon-lasso-tool\",\n      title: translate(\"Activate the lasso tool\"),\n      action: {\n        click: function (event) {\n          lassoTool.activateSelection(event);\n        },\n      },\n    },\n    \"space-tool\": {\n      group: \"tools\",\n      className: \"bpmn-icon-space-tool\",\n      title: translate(\"Activate the create/remove space tool\"),\n      action: {\n        click: function (event) {\n          spaceTool.activateSelection(event);\n        },\n      },\n    },\n    \"global-connect-tool\": {\n      group: \"tools\",\n      className: \"bpmn-icon-connection-multi\",\n      title: translate(\"Activate the global connect tool\"),\n      action: {\n        click: function (event) {\n          globalConnect.toggle(event);\n        },\n      },\n    },\n    \"tool-separator\": {\n      group: \"tools\",\n      separator: true,\n    },\n    \"create.start-event\": createAction(\n      \"bpmn:StartEvent\",\n      \"event\",\n      \"bpmn-icon-start-event-none\",\n      translate(\"Create StartEvent\")\n    ),\n    \"create.intermediate-event\": createAction(\n      \"bpmn:IntermediateThrowEvent\",\n      \"event\",\n      \"bpmn-icon-intermediate-event-none\",\n      translate(\"Create Intermediate/Boundary Event\")\n    ),\n    \"create.end-event\": createAction(\n      \"bpmn:EndEvent\",\n      \"event\",\n      \"bpmn-icon-end-event-none\",\n      translate(\"Create EndEvent\")\n    ),\n    \"create.exclusive-gateway\": createAction(\n      \"bpmn:ExclusiveGateway\",\n      \"gateway\",\n      \"bpmn-icon-gateway-none\",\n      translate(\"Create Gateway\")\n    ),\n    \"create.task\": createAction(\n      \"bpmn:Task\",\n      \"activity\",\n      \"bpmn-icon-task\",\n      translate(\"Create Task\")\n    ),\n    \"create.data-object\": createAction(\n      \"bpmn:DataObjectReference\",\n      \"data-object\",\n      \"bpmn-icon-data-object\",\n      translate(\"Create DataObjectReference\")\n    ),\n    \"create.data-store\": createAction(\n      \"bpmn:DataStoreReference\",\n      \"data-store\",\n      \"bpmn-icon-data-store\",\n      translate(\"Create DataStoreReference\")\n    ),\n    \"create.loop\": {\n      group: \"activity\",\n      className: \"bpmn-icon-loop-expanded\",\n      title: translate(\"Create Loop\"),\n      action: {\n        dragstart: createLoop,\n        click: createLoop,\n      },\n    },\n    \"create.participant-expanded\": {\n      group: \"collaboration\",\n      className: \"bpmn-icon-participant\",\n      title: translate(\"Create Pool/Participant\"),\n      action: {\n        dragstart: createParticipant,\n        click: createParticipant,\n      },\n    },\n    \"create.group\": createAction(\n      \"bpmn:Group\",\n      \"artifact\",\n      \"bpmn-icon-group\",\n      translate(\"Create Group\")\n    ),\n  });\n\n  return actions;\n};\n","import PaletteModule from \"diagram-js/lib/features/palette\";\nimport CreateModule from \"diagram-js/lib/features/create\";\nimport SpaceToolModule from \"diagram-js/lib/features/space-tool\";\nimport LassoToolModule from \"diagram-js/lib/features/lasso-tool\";\nimport HandToolModule from \"diagram-js/lib/features/hand-tool\";\nimport GlobalConnectModule from \"diagram-js/lib/features/global-connect\";\nimport translate from \"diagram-js/lib/i18n/translate\";\n\nimport PaletteProvider from \"./PaletteProvider\";\n\nexport default {\n  __depends__: [\n    PaletteModule,\n    CreateModule,\n    SpaceToolModule,\n    LassoToolModule,\n    HandToolModule,\n    GlobalConnectModule,\n    translate,\n  ],\n  __init__: [\"paletteProvider\"],\n  paletteProvider: [\"type\", PaletteProvider],\n};\n","import CommandInterceptor from \"diagram-js/lib/command/CommandInterceptor\";\n\nimport inherits from \"inherits\";\n\nimport cssEscape from \"css.escape\";\n\nimport { assign, forEach } from \"min-dash\";\n\nimport { query as domQuery } from \"min-dom\";\n\nimport { attr as svgAttr } from \"tiny-svg\";\n\nlet LOW_PRIORITY = 250;\n\nexport default function BpmnReplacePreview(\n  eventBus,\n  elementRegistry,\n  elementFactory,\n  canvas,\n  previewSupport\n) {\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Replace the visuals of all elements in the context which can be replaced\n   *\n   * @param  {Object} context\n   */\n  function replaceVisual(context) {\n    let replacements = context.canExecute.replacements;\n\n    forEach(replacements, function (replacement) {\n      let id = replacement.oldElementId;\n\n      let newElement = {\n        type: replacement.newElementType,\n      };\n\n      // if the visual of the element is already replaced\n      if (context.visualReplacements[id]) {\n        return;\n      }\n\n      let element = elementRegistry.get(id);\n\n      assign(newElement, { x: element.x, y: element.y });\n\n      // create a temporary shape\n      let tempShape = elementFactory.createShape(newElement);\n\n      canvas.addShape(tempShape, element.parent);\n\n      // select the original SVG element related to the element and hide it\n      let gfx = domQuery(\n        '[data-element-id=\"' + cssEscape(element.id) + '\"]',\n        context.dragGroup\n      );\n\n      if (gfx) {\n        svgAttr(gfx, { display: \"none\" });\n      }\n\n      // clone the gfx of the temporary shape and add it to the drag group\n      let dragger = previewSupport.addDragger(tempShape, context.dragGroup);\n\n      context.visualReplacements[id] = dragger;\n\n      canvas.removeShape(tempShape);\n    });\n  }\n\n  /**\n   * Restore the original visuals of the previously replaced elements\n   *\n   * @param  {Object} context\n   */\n  function restoreVisual(context) {\n    let visualReplacements = context.visualReplacements;\n\n    forEach(visualReplacements, function (dragger, id) {\n      let originalGfx = domQuery(\n        '[data-element-id=\"' + cssEscape(id) + '\"]',\n        context.dragGroup\n      );\n\n      if (originalGfx) {\n        svgAttr(originalGfx, { display: \"inline\" });\n      }\n\n      dragger.remove();\n\n      if (visualReplacements[id]) {\n        delete visualReplacements[id];\n      }\n    });\n  }\n\n  eventBus.on(\"shape.move.move\", LOW_PRIORITY, function (event) {\n    let context = event.context,\n      canExecute = context.canExecute;\n\n    if (!context.visualReplacements) {\n      context.visualReplacements = {};\n    }\n\n    if (canExecute && canExecute.replacements) {\n      replaceVisual(context);\n    } else {\n      restoreVisual(context);\n    }\n  });\n}\n\nBpmnReplacePreview.$inject = [\n  \"eventBus\",\n  \"elementRegistry\",\n  \"elementFactory\",\n  \"canvas\",\n  \"previewSupport\",\n];\n\ninherits(BpmnReplacePreview, CommandInterceptor);\n","import PreviewSupportModule from \"diagram-js/lib/features/preview-support\";\n\nimport BpmnReplacePreview from \"./BpmnReplacePreview\";\n\nexport default {\n  __depends__: [PreviewSupportModule],\n  __init__: [\"bpmnReplacePreview\"],\n  bpmnReplacePreview: [\"type\", BpmnReplacePreview],\n};\n","import { mid, setSnapped } from \"diagram-js/lib/features/snapping/SnapUtil\";\r\n\r\nimport { isCmd } from \"diagram-js/lib/features/keyboard/KeyboardUtil\";\r\n\r\nimport { getOrientation } from \"diagram-js/lib/layout/LayoutUtil\";\r\n\r\nimport { is } from \"../../util/ModelUtil\";\r\n\r\nimport { isAny } from \"../modeling/util/ModelingUtil\";\r\n\r\nimport { some } from \"min-dash\";\r\n\r\nlet HIGHER_PRIORITY = 1250;\r\n\r\nlet BOUNDARY_TO_HOST_THRESHOLD = 40;\r\n\r\nlet TARGET_BOUNDS_PADDING = 20,\r\n  TASK_BOUNDS_PADDING = 10;\r\n\r\nlet TARGET_CENTER_PADDING = 20;\r\n\r\nlet AXES = [\"x\", \"y\"];\r\n\r\nlet abs = Math.abs;\r\n\r\n/**\r\n * Snap during connect.\r\n *\r\n * @param {EventBus} eventBus\r\n */\r\nexport default function BpmnConnectSnapping(eventBus) {\r\n  eventBus.on(\r\n    [\"connect.hover\", \"connect.move\", \"connect.end\"],\r\n    HIGHER_PRIORITY,\r\n    function (event) {\r\n      let context = event.context,\r\n        canExecute = context.canExecute,\r\n        start = context.start,\r\n        hover = context.hover,\r\n        source = context.source,\r\n        target = context.target;\r\n\r\n      // do NOT snap on CMD\r\n      if (event.originalEvent && isCmd(event.originalEvent)) {\r\n        return;\r\n      }\r\n\r\n      if (!context.initialConnectionStart) {\r\n        context.initialConnectionStart = context.connectionStart;\r\n      }\r\n\r\n      // snap hover\r\n      if (canExecute && hover) {\r\n        snapToShape(event, hover, getTargetBoundsPadding(hover));\r\n      }\r\n\r\n      if (\r\n        hover &&\r\n        isAnyType(canExecute, [\r\n          \"bpmn:Association\",\r\n          \"bpmn:DataInputAssociation\",\r\n          \"bpmn:DataOutputAssociation\",\r\n          \"bpmn:SequenceFlow\",\r\n        ])\r\n      ) {\r\n        context.connectionStart = mid(start);\r\n\r\n        // snap hover\r\n        if (isAny(hover, [\"bpmn:Event\", \"bpmn:Gateway\"])) {\r\n          snapToPosition(event, mid(hover));\r\n        }\r\n\r\n        // snap hover\r\n        if (isAny(hover, [\"bpmn:Task\", \"bpmn:Loop\", \"bpmn:Conditional\"])) {\r\n          snapToTargetMid(event, hover);\r\n        }\r\n\r\n        // snap source and target\r\n        if (is(source, \"bpmn:BoundaryEvent\") && target === source.host) {\r\n          snapBoundaryEventLoop(event);\r\n        }\r\n      } else if (isType(canExecute, \"bpmn:MessageFlow\")) {\r\n        if (is(start, \"bpmn:Event\")) {\r\n          // snap start\r\n          context.connectionStart = mid(start);\r\n        }\r\n\r\n        if (is(hover, \"bpmn:Event\")) {\r\n          // snap hover\r\n          snapToPosition(event, mid(hover));\r\n        }\r\n      } else {\r\n        // un-snap source\r\n        context.connectionStart = context.initialConnectionStart;\r\n      }\r\n    }\r\n  );\r\n}\r\n\r\nBpmnConnectSnapping.$inject = [\"eventBus\"];\r\n\r\n// helpers //////////\r\n\r\n// snap to target if event in target\r\nfunction snapToShape(event, target, padding) {\r\n  AXES.forEach(function (axis) {\r\n    let dimensionForAxis = getDimensionForAxis(axis, target);\r\n\r\n    if (event[axis] < target[axis] + padding) {\r\n      setSnapped(event, axis, target[axis] + padding);\r\n    } else if (event[axis] > target[axis] + dimensionForAxis - padding) {\r\n      setSnapped(event, axis, target[axis] + dimensionForAxis - padding);\r\n    }\r\n  });\r\n}\r\n\r\n// snap to target mid if event in target mid\r\nfunction snapToTargetMid(event, target) {\r\n  let targetMid = mid(target);\r\n\r\n  AXES.forEach(function (axis) {\r\n    if (isMid(event, target, axis)) {\r\n      setSnapped(event, axis, targetMid[axis]);\r\n    }\r\n  });\r\n}\r\n\r\n// snap to prevent loop overlapping boundary event\r\nfunction snapBoundaryEventLoop(event) {\r\n  let context = event.context,\r\n    source = context.source,\r\n    target = context.target;\r\n\r\n  if (isReverse(context)) {\r\n    return;\r\n  }\r\n\r\n  let sourceMid = mid(source),\r\n    orientation = getOrientation(sourceMid, target, -10),\r\n    axes = [];\r\n\r\n  if (/top|bottom/.test(orientation)) {\r\n    axes.push(\"x\");\r\n  }\r\n\r\n  if (/left|right/.test(orientation)) {\r\n    axes.push(\"y\");\r\n  }\r\n\r\n  axes.forEach(function (axis) {\r\n    let coordinate = event[axis],\r\n      newCoordinate;\r\n\r\n    if (abs(coordinate - sourceMid[axis]) < BOUNDARY_TO_HOST_THRESHOLD) {\r\n      if (coordinate > sourceMid[axis]) {\r\n        newCoordinate = sourceMid[axis] + BOUNDARY_TO_HOST_THRESHOLD;\r\n      } else {\r\n        newCoordinate = sourceMid[axis] - BOUNDARY_TO_HOST_THRESHOLD;\r\n      }\r\n\r\n      setSnapped(event, axis, newCoordinate);\r\n    }\r\n  });\r\n}\r\n\r\nfunction snapToPosition(event, position) {\r\n  setSnapped(event, \"x\", position.x);\r\n  setSnapped(event, \"y\", position.y);\r\n}\r\n\r\nfunction isType(attrs, type) {\r\n  return attrs && attrs.type === type;\r\n}\r\n\r\nfunction isAnyType(attrs, types) {\r\n  return some(types, function (type) {\r\n    return isType(attrs, type);\r\n  });\r\n}\r\n\r\nfunction getDimensionForAxis(axis, element) {\r\n  return axis === \"x\" ? element.width : element.height;\r\n}\r\n\r\nfunction getTargetBoundsPadding(target) {\r\n  if (is(target, \"bpmn:Task\")) {\r\n    return TASK_BOUNDS_PADDING;\r\n  } else {\r\n    return TARGET_BOUNDS_PADDING;\r\n  }\r\n}\r\n\r\nfunction isMid(event, target, axis) {\r\n  return (\r\n    event[axis] > target[axis] + TARGET_CENTER_PADDING &&\r\n    event[axis] <\r\n      target[axis] + getDimensionForAxis(axis, target) - TARGET_CENTER_PADDING\r\n  );\r\n}\r\n\r\nfunction isReverse(context) {\r\n  let hover = context.hover,\r\n    source = context.source;\r\n\r\n  return hover && source && hover === source;\r\n}\r\n","import inherits from \"inherits\";\n\nimport CreateMoveSnapping from \"diagram-js/lib/features/snapping/CreateMoveSnapping\";\n\nimport {\n  isSnapped,\n  setSnapped,\n  topLeft,\n  bottomRight,\n} from \"diagram-js/lib/features/snapping/SnapUtil\";\n\nimport { isExpanded } from \"../../util/DiUtil\";\n\nimport { is } from \"../../util/ModelUtil\";\n\nimport { asTRBL, getMid } from \"diagram-js/lib/layout/LayoutUtil\";\n\nimport { getBoundaryAttachment } from \"./BpmnSnappingUtil\";\n\nimport { forEach } from \"min-dash\";\n\nlet HIGH_PRIORITY = 1500;\n\n/**\n * Snap during create and move.\n *\n * @param {EventBus} eventBus\n * @param {Injector} injector\n */\nexport default function BpmnCreateMoveSnapping(eventBus, injector) {\n  injector.invoke(CreateMoveSnapping, this);\n\n  // creating first participant\n  eventBus.on(\n    [\"create.move\", \"create.end\"],\n    HIGH_PRIORITY,\n    setSnappedIfConstrained\n  );\n\n  // snap boundary events\n  eventBus.on(\n    [\"create.move\", \"create.end\", \"shape.move.move\", \"shape.move.end\"],\n    HIGH_PRIORITY,\n    function (event) {\n      let context = event.context,\n        canExecute = context.canExecute,\n        target = context.target;\n\n      let canAttach =\n        canExecute && (canExecute === \"attach\" || canExecute.attach);\n\n      if (canAttach && !isSnapped(event)) {\n        snapBoundaryEvent(event, target);\n      }\n    }\n  );\n}\n\ninherits(BpmnCreateMoveSnapping, CreateMoveSnapping);\n\nBpmnCreateMoveSnapping.$inject = [\"eventBus\", \"injector\"];\n\nBpmnCreateMoveSnapping.prototype.initSnap = function (event) {\n  let snapContext = CreateMoveSnapping.prototype.initSnap.call(this, event);\n\n  let shape = event.shape;\n\n  let isMove = !!this._elementRegistry.get(shape.id);\n\n  // snap to docking points\n  forEach(shape.outgoing, function (connection) {\n    let docking = connection.waypoints[0];\n\n    docking = docking.original || docking;\n\n    snapContext.setSnapOrigin(\n      connection.id + \"-docking\",\n      getDockingSnapOrigin(docking, isMove, event)\n    );\n  });\n\n  forEach(shape.incoming, function (connection) {\n    let docking = connection.waypoints[connection.waypoints.length - 1];\n\n    docking = docking.original || docking;\n\n    snapContext.setSnapOrigin(\n      connection.id + \"-docking\",\n      getDockingSnapOrigin(docking, isMove, event)\n    );\n  });\n\n  if (is(shape, \"bpmn:Participant\")) {\n    // snap to borders with higher priority\n    snapContext.setSnapLocations([\"top-left\", \"bottom-right\", \"mid\"]);\n  }\n\n  return snapContext;\n};\n\nBpmnCreateMoveSnapping.prototype.addSnapTargetPoints = function (\n  snapPoints,\n  shape,\n  target\n) {\n  CreateMoveSnapping.prototype.addSnapTargetPoints.call(\n    this,\n    snapPoints,\n    shape,\n    target\n  );\n\n  let snapTargets = this.getSnapTargets(shape, target);\n\n  forEach(snapTargets, function (snapTarget) {\n    // handle TRBL alignment\n    //\n    // * with container elements\n    // * with text annotations\n    if (\n      isContainer(snapTarget) ||\n      areAll([shape, snapTarget], \"bpmn:TextAnnotation\")\n    ) {\n      snapPoints.add(\"top-left\", topLeft(snapTarget));\n      snapPoints.add(\"bottom-right\", bottomRight(snapTarget));\n    }\n  });\n\n  let elementRegistry = this._elementRegistry;\n\n  // snap to docking points if not create mode\n  forEach(shape.incoming, function (connection) {\n    if (elementRegistry.get(shape.id)) {\n      if (!includes(snapTargets, connection.source)) {\n        snapPoints.add(\"mid\", getMid(connection.source));\n      }\n\n      let docking = connection.waypoints[0];\n      snapPoints.add(connection.id + \"-docking\", docking.original || docking);\n    }\n  });\n\n  forEach(shape.outgoing, function (connection) {\n    if (elementRegistry.get(shape.id)) {\n      if (!includes(snapTargets, connection.target)) {\n        snapPoints.add(\"mid\", getMid(connection.target));\n      }\n\n      let docking = connection.waypoints[connection.waypoints.length - 1];\n\n      snapPoints.add(connection.id + \"-docking\", docking.original || docking);\n    }\n  });\n\n  // add sequence flow parents as snap targets\n  if (is(target, \"bpmn:SequenceFlow\")) {\n    snapPoints = this.addSnapTargetPoints(snapPoints, shape, target.parent);\n  }\n\n  return snapPoints;\n};\n\nBpmnCreateMoveSnapping.prototype.getSnapTargets = function (shape, target) {\n  return CreateMoveSnapping.prototype.getSnapTargets\n    .call(this, shape, target)\n    .filter(function (snapTarget) {\n      // do not snap to lanes\n      return !is(snapTarget, \"bpmn:Lane\");\n    });\n};\n\n// helpers //////////\n\nfunction snapBoundaryEvent(event, target) {\n  let targetTRBL = asTRBL(target);\n\n  let direction = getBoundaryAttachment(event, target);\n\n  let context = event.context,\n    shape = context.shape;\n\n  let offset;\n\n  if (shape.parent) {\n    offset = { x: 0, y: 0 };\n  } else {\n    offset = getMid(shape);\n  }\n\n  if (/top/.test(direction)) {\n    setSnapped(event, \"y\", targetTRBL.top - offset.y);\n  } else if (/bottom/.test(direction)) {\n    setSnapped(event, \"y\", targetTRBL.bottom - offset.y);\n  }\n\n  if (/left/.test(direction)) {\n    setSnapped(event, \"x\", targetTRBL.left - offset.x);\n  } else if (/right/.test(direction)) {\n    setSnapped(event, \"x\", targetTRBL.right - offset.x);\n  }\n}\n\nfunction areAll(elements, type) {\n  return elements.every(function (el) {\n    return is(el, type);\n  });\n}\n\nfunction isContainer(element) {\n  if (is(element, \"bpmn:Loop\") && isExpanded(element)) {\n    return true;\n  }\n\n  return is(element, \"bpmn:Participant\");\n}\n\nfunction setSnappedIfConstrained(event) {\n  let context = event.context,\n    createConstraints = context.createConstraints;\n\n  if (!createConstraints) {\n    return;\n  }\n\n  let top = createConstraints.top,\n    right = createConstraints.right,\n    bottom = createConstraints.bottom,\n    left = createConstraints.left;\n\n  if ((left && left >= event.x) || (right && right <= event.x)) {\n    setSnapped(event, \"x\", event.x);\n  }\n\n  if ((top && top >= event.y) || (bottom && bottom <= event.y)) {\n    setSnapped(event, \"y\", event.y);\n  }\n}\n\nfunction includes(array, value) {\n  return array.indexOf(value) !== -1;\n}\n\nfunction getDockingSnapOrigin(docking, isMove, event) {\n  return isMove\n    ? {\n        x: docking.x - event.x,\n        y: docking.y - event.y,\n      }\n    : {\n        x: docking.x,\n        y: docking.y,\n      };\n}\n","import BpmnConnectSnapping from \"./BpmnConnectSnapping\";\nimport BpmnCreateMoveSnapping from \"./BpmnCreateMoveSnapping\";\nimport SnappingModule from \"diagram-js/lib/features/snapping\";\n\nexport default {\n  __depends__: [SnappingModule],\n  __init__: [\"connectSnapping\", \"createMoveSnapping\"],\n  connectSnapping: [\"type\", BpmnConnectSnapping],\n  createMoveSnapping: [\"type\", BpmnCreateMoveSnapping],\n};\n","import { map, filter, sortBy } from \"min-dash\";\n\nimport { getLabel } from \"../label-editing/LabelUtil\";\n\n/**\n * Provides ability to search through BPMN elements\n */\nexport default function BpmnSearchProvider(elementRegistry, searchPad, canvas) {\n  this._elementRegistry = elementRegistry;\n  this._canvas = canvas;\n\n  searchPad.registerProvider(this);\n}\n\nBpmnSearchProvider.$inject = [\"elementRegistry\", \"searchPad\", \"canvas\"];\n\n/**\n * Finds all elements that match given pattern\n *\n * <Result> :\n *  {\n *    primaryTokens: <Array<Token>>,\n *    secondaryTokens: <Array<Token>>,\n *    element: <Element>\n *  }\n *\n * <Token> :\n *  {\n *    normal|matched: <String>\n *  }\n *\n * @param  {String} pattern\n * @return {Array<Result>}\n */\nBpmnSearchProvider.prototype.find = function (pattern) {\n  let rootElement = this._canvas.getRootElement();\n\n  let elements = this._elementRegistry.filter(function (element) {\n    if (element.labelTarget) {\n      return false;\n    }\n    return true;\n  });\n\n  // do not include root element\n  elements = filter(elements, function (element) {\n    return element !== rootElement;\n  });\n\n  elements = map(elements, function (element) {\n    return {\n      primaryTokens: matchAndSplit(getLabel(element), pattern),\n      secondaryTokens: matchAndSplit(element.id, pattern),\n      element: element,\n    };\n  });\n\n  // exclude non-matched elements\n  elements = filter(elements, function (element) {\n    return (\n      hasMatched(element.primaryTokens) || hasMatched(element.secondaryTokens)\n    );\n  });\n\n  elements = sortBy(elements, function (element) {\n    return getLabel(element.element) + element.element.id;\n  });\n\n  return elements;\n};\n\nfunction hasMatched(tokens) {\n  let matched = filter(tokens, function (t) {\n    return !!t.matched;\n  });\n\n  return matched.length > 0;\n}\n\nfunction matchAndSplit(text, pattern) {\n  let tokens = [],\n    originalText = text;\n\n  if (!text) {\n    return tokens;\n  }\n\n  text = text.toLowerCase();\n  pattern = pattern.toLowerCase();\n\n  let i = text.indexOf(pattern);\n\n  if (i > -1) {\n    if (i !== 0) {\n      tokens.push({\n        normal: originalText.substr(0, i),\n      });\n    }\n\n    tokens.push({\n      matched: originalText.substr(i, pattern.length),\n    });\n\n    if (pattern.length + i < text.length) {\n      tokens.push({\n        normal: originalText.substr(pattern.length + i, text.length),\n      });\n    }\n  } else {\n    tokens.push({\n      normal: originalText,\n    });\n  }\n\n  return tokens;\n}\n","import SearchPadModule from \"diagram-js/lib/features/search-pad\";\n\nimport BpmnSearchProvider from \"./BpmnSearchProvider\";\n\nexport default {\n  __depends__: [SearchPadModule],\n  __init__: [\"bpmnSearch\"],\n  bpmnSearch: [\"type\", BpmnSearchProvider],\n};\n","import inherits from \"inherits\";\n\nimport BaseModeler from \"./BaseModeler\";\n\nimport Viewer from \"./Viewer\";\nimport NavigatedViewer from \"./NavigatedViewer\";\n\nimport KeyboardMoveModule from \"diagram-js/lib/navigation/keyboard-move\";\nimport MoveCanvasModule from \"diagram-js/lib/navigation/movecanvas\";\nimport TouchModule from \"diagram-js/lib/navigation/touch\";\nimport ZoomScrollModule from \"diagram-js/lib/navigation/zoomscroll\";\n\nimport AlignElementsModule from \"diagram-js/lib/features/align-elements\";\nimport AutoPlaceModule from \"./features/auto-place\";\nimport AutoResizeModule from \"./features/auto-resize\";\nimport AutoScrollModule from \"diagram-js/lib/features/auto-scroll\";\nimport BendpointsModule from \"diagram-js/lib/features/bendpoints\";\nimport ConnectModule from \"diagram-js/lib/features/connect\";\nimport ConnectionPreviewModule from \"diagram-js/lib/features/connection-preview\";\nimport ContextPadModule from \"./features/context-pad\";\nimport CopyPasteModule from \"./features/copy-paste\";\nimport CreateModule from \"diagram-js/lib/features/create\";\nimport DistributeElementsModule from \"./features/distribute-elements\";\nimport EditorActionsModule from \"./features/editor-actions\";\nimport GridSnappingModule from \"./features/grid-snapping\";\nimport InteractionEventsModule from \"./features/interaction-events\";\nimport KeyboardModule from \"./features/keyboard\";\nimport KeyboardMoveSelectionModule from \"diagram-js/lib/features/keyboard-move-selection\";\nimport LabelEditingModule from \"./features/label-editing\";\nimport ModelingModule from \"./features/modeling\";\nimport MoveModule from \"diagram-js/lib/features/move\";\nimport PaletteModule from \"./features/palette\";\nimport ReplacePreviewModule from \"./features/replace-preview\";\nimport ResizeModule from \"diagram-js/lib/features/resize\";\nimport SnappingModule from \"./features/snapping\";\nimport SearchModule from \"./features/search\";\n\nconst initialDiagram = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  <process-Actions \n  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n  xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n  xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n  xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n  targetNamespace=\"http://bpmn.io/schema/bpmn\"\n  id=\"Definitions_1\">\n  <process-Action id=\"ProcessAction_1\">\n  </process-Action>\n  <bpmndi:BPMNDiagram id=\"BPMNDiagram_1\">\n  <bpmndi:BPMNPlane id=\"BPMNPlane_1\" bpmnElement=\"Process_1\">\n  <bpmndi:BPMNShape id=\"_BPMNShape_StartEvent_2\" bpmnElement=\"StartEvent_1\">\n  <dc:Bounds height=\"36.0\" width=\"36.0\" x=\"173.0\" y=\"102.0\"/>\n  </bpmndi:BPMNShape>\n  </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n  </process-Actions>`;\n\nexport default function Modeler(options) {\n  BaseModeler.call(this, options);\n}\n\ninherits(Modeler, BaseModeler);\n\nModeler.Viewer = Viewer;\nModeler.NavigatedViewer = NavigatedViewer;\n\n/**\n * Create a new diagram to start modeling.\n *\n * @param {Function} [done]\n */\nModeler.prototype.createDiagram = function (done) {\n  return this.importXML(initialDiagram, done);\n};\n\nModeler.prototype._interactionModules = [\n  // non-modeling components\n  KeyboardMoveModule,\n  MoveCanvasModule,\n  TouchModule,\n  ZoomScrollModule,\n];\n\nModeler.prototype._modelingModules = [\n  // modeling components\n  AlignElementsModule,\n  AutoPlaceModule,\n  AutoScrollModule,\n  AutoResizeModule,\n  BendpointsModule,\n  ConnectModule,\n  ConnectionPreviewModule,\n  ContextPadModule,\n  CopyPasteModule,\n  CreateModule,\n  DistributeElementsModule,\n  EditorActionsModule,\n  GridSnappingModule,\n  InteractionEventsModule,\n  KeyboardModule,\n  KeyboardMoveSelectionModule,\n  LabelEditingModule,\n  ModelingModule,\n  MoveModule,\n  PaletteModule,\n  ReplacePreviewModule,\n  ResizeModule,\n  SnappingModule,\n  SearchModule,\n];\n\n// modules the modeler is composed of\n//\n// - viewer modules\n// - interaction modules\n// - modeling modules\n\nModeler.prototype._modules = [].concat(\n  Viewer.prototype._modules,\n  Modeler.prototype._interactionModules,\n  Modeler.prototype._modelingModules\n);\n","import { assign } from \"min-dash\";\n\nexport default function PaletteProvider(\n  palette,\n  create,\n  elementFactory,\n  spaceTool,\n  lassoTool,\n  translate\n) {\n  this._create = create;\n  this._elementFactory = elementFactory;\n  this._spaceTool = spaceTool;\n  this._lassoTool = lassoTool;\n  this.translate = translate;\n\n  palette.registerProvider(this);\n}\n\nPaletteProvider.$inject = [\n  \"palette\",\n  \"create\",\n  \"elementFactory\",\n  \"spaceTool\",\n  \"lassoTool\",\n  \"translate\",\n];\n\nPaletteProvider.prototype.getPaletteEntries = function (element) {\n  let actions = {},\n    create = this._create,\n    elementFactory = this._elementFactory,\n    translate = this.translate;\n\n  function createAction(type, group, className, title, options) {\n    function createListener(event) {\n      let shape = elementFactory.createShape(assign({ type: type }, options));\n\n      if (options) {\n        shape.businessObject.di.isExpanded = options.isExpanded;\n      }\n\n      create.start(event, shape);\n    }\n\n    let shortType = type.replace(/^bpmn:/, \"\");\n\n    return {\n      group: group,\n      className: className,\n      title: title || \"Create \" + translate(shortType),\n      action: {\n        dragstart: createListener,\n        click: createListener,\n      },\n    };\n  }\n\n  function createParentNode(event, type) {\n    let loop = elementFactory.createShape({\n      type: type,\n      x: 0,\n      y: 0,\n      isExpanded: true,\n    });\n\n    create.start(event, [loop], {\n      hints: {\n        autoSelect: [],\n      },\n    });\n  }\n\n  assign(actions, {\n    \"create.mapper\": createAction(\n      \"bpmn:Mapper\",\n      \"activity\",\n      \"bpmn-icon-task\"\n    ),\n    \"create.query\": createAction(\n      \"bpmn:Query\",\n      \"gateway\",\n      \"bpmn-icon-gateway-xor\"\n    ),\n    // \"create.function\": createAction(\n    //   \"bpmn:Function\",\n    //   \"activity\",\n    //   \"bpmn-icon-function\"\n    // ),\n    \"create.loop\": {\n      group: \"activity\",\n      className: \"bpmn-icon-loop-marker\",\n      title: translate(\"Create Loop\"),\n      action: {\n        dragstart: (e) => createParentNode(e, \"bpmn:Loop\"),\n        click: (e) => createParentNode(e, \"bpmn:Loop\"),\n      },\n    },\n    \"create.conditional\": {\n      group: \"activity\",\n      className: \"bpmn-icon-sequential-mi-marker\",\n      title: translate(\"Create Condition\"),\n      action: {\n        dragstart: (e) => createParentNode(e, \"bpmn:Conditional\"),\n        click: (e) => createParentNode(e, \"bpmn:Conditional\"),\n      },\n    },\n  });\n\n  return actions;\n};\n","import inherits from \"inherits\";\n\nimport ContextPadProvider from \"../main/baml-js/lib/features/context-pad/ContextPadProvider\";\n\nimport { isAny } from \"../main/baml-js/lib/features/modeling/util/ModelingUtil\";\nimport { is } from \"../main/baml-js/lib/util/ModelUtil\";\nimport { assign } from \"min-dash\";\n\nexport default function CustomContextPadProvider(\n  config,\n  injector,\n  connect,\n  create,\n  translate\n) {\n  injector.invoke(ContextPadProvider, this);\n\n  this.getContextPadEntries = function (element) {\n    let modeling = this._modeling;\n    let elementFactory = this._elementFactory;\n    let autoPlace = this._autoPlace;\n    let create = this._create;\n    let translate = this._translate;\n    let connect = this._connect;\n    let businessObject = element.businessObject;\n\n    function startConnect(event, element, autoActivate) {\n      connect.start(event, element, autoActivate);\n    }\n    function removeElement(e) {\n      modeling.removeElements([element]);\n    }\n\n    let actions = {};\n\n    if (element.type === \"label\") {\n      return actions;\n    }\n\n    function createParentNode(type) {\n      let loop = elementFactory.createShape({\n        type,\n        x: 0,\n        y: 0,\n        isExpanded: true,\n      });\n      autoPlace.append(element, loop);\n    }\n\n    function appendAction(type, className, title, options) {\n      if (typeof title !== \"string\") {\n        options = title;\n        title = \"Append \" + type.replace(/^bpmn:/, \"\");\n      }\n\n      function appendStart(event, element) {\n        // if (shouldConnectNode(element)) {\n        let shape = elementFactory.createShape(assign({ type: type }, options));\n        create.start(event, shape, {\n          source: element,\n        });\n        // }\n      }\n\n      let append = autoPlace\n        ? function (event, element) {\n            // if (shouldConnectNode(element)) {\n            let shape = elementFactory.createShape(\n              assign({ type: type }, options)\n            );\n            autoPlace.append(element, shape);\n          }\n        : // }\n          appendStart;\n\n      return {\n        group: \"model\",\n        className: className,\n        title: title,\n        action: {\n          dragstart: appendStart,\n          click: append,\n        },\n      };\n    }\n    if (isAny(businessObject, [\"bpmn:FlowNode\", \"bpmn:InteractionNode\"])) {\n      assign(actions, {\n        connect: {\n          group: \"connect\",\n          className: \"bpmn-icon-connection-multi\",\n          title: translate(\"Connect using transition\"),\n          action: {\n            click: startConnect,\n            dragstart: startConnect,\n          },\n        },\n      });\n    }\n    if (is(businessObject, \"bpmn:FlowNode\")) {\n      if (!is(businessObject, \"bpmn:EndEvent\")) {\n        assign(\n          actions,\n          {\n            \"append.append-mapper\": appendAction(\n              \"bpmn:Mapper\",\n              \"bpmn-icon-task\",\n              \"Append Mapper\"\n            ),\n          },\n          {\n            \"append.query\": appendAction(\n              \"bpmn:Query\",\n              \"bpmn-icon-gateway-xor\",\n              \"Append query\"\n            ),\n          },\n          // {\n          //   \"append.funtion\": appendAction(\n          //     \"bpmn:Function\",\n          //     \"bpmn-icon-function\",\n          //     \"Append Function\"\n          //   ),\n          // }\n        );\n      }\n    }\n\n    assign(actions, {\n      \"connect-conditional\": {\n        group: \"activity\",\n        className: \"bpmn-icon-sequential-mi-marker\",\n        title: translate(\"Create Condition\"),\n        action: {\n          dragstart: () => createParentNode(\"bpmn:Conditional\"),\n          click: () => createParentNode(\"bpmn:Conditional\"),\n        },\n      },\n    });\n\n    assign(actions, {\n      \"connect-loop\": {\n        group: \"activity\",\n        className: \"bpmn-icon-loop-marker\",\n        title: translate(\"Create Loop\"),\n        action: {\n          dragstart: () => createParentNode(\"bpmn:Loop\"),\n          click: () => createParentNode(\"bpmn:Loop\"),\n        },\n      },\n    });\n\n    assign(actions, {\n      delete: {\n        group: \"edit\",\n        className: \"bpmn-icon-trash\",\n        title: \"Remove\",\n        action: {\n          click: removeElement,\n          dragstart: removeElement,\n        },\n      },\n    });\n    return actions;\n  };\n}\n\ninherits(CustomContextPadProvider, ContextPadProvider);\n\nCustomContextPadProvider.$inject = [\n  \"config.contextPad\",\n  \"injector\",\n  \"eventBus\",\n  \"contextPad\",\n  \"modeling\",\n  \"elementFactory\",\n  \"connect\",\n  \"create\",\n  \"popupMenu\",\n  \"canvas\",\n  \"rules\",\n  \"translate\",\n];\n","import { reduce } from \"min-dash\";\n\nimport inherits from \"inherits\";\n\nimport { is } from \"../main/baml-js/lib/util/ModelUtil\";\n\nimport RuleProvider from \"diagram-js/lib/features/rules/RuleProvider\";\n\nconst HIGH_PRIORITY = 1500;\n\nfunction isCustom(element) {\n  return element && /^custom:/.test(element.type);\n}\n\n/**\n * Specific rules for custom elements\n */\nexport default function CustomRules(eventBus) {\n  RuleProvider.call(this, eventBus);\n}\n\ninherits(CustomRules, RuleProvider);\n\nCustomRules.$inject = [\"eventBus\"];\n\nCustomRules.prototype.init = function () {\n  /**\n   * Can shape be created on target container?\n   */\n  function canCreate(shape, target) {\n    // return true;\n    // only judge about custom elements\n    if (!isCustom(shape)) {\n      return;\n    }\n    // allow creation on processes\n    return (\n      is(target, \"bpmn:Process-action\") ||\n      is(target, \"bpmn:Participant\") ||\n      is(target, \"bpmn:Collaboration\")\n    );\n  }\n\n  /**\n   * Can source and target be connected?\n   */\n  function canConnect(source, target) {\n    // only judge about custom elements\n    if (!isCustom(source) && !isCustom(target)) {\n      return;\n    }\n\n    // allow connection between custom shape and task\n    if (isCustom(source)) {\n      if (is(target, \"bpmn:Task\")) {\n        return { type: \"custom:connection\" };\n      } else {\n        return false;\n      }\n    } else if (isCustom(target)) {\n      if (is(source, \"bpmn:Task\")) {\n        return { type: \"custom:connection\" };\n      } else {\n        return false;\n      }\n    }\n  }\n\n  this.addRule(\"elements.move\", HIGH_PRIORITY, function (context) {\n    let target = context.target,\n      shapes = context.shapes;\n\n    let type;\n\n    // do not allow mixed movements of custom / BPMN shapes\n    // if any shape cannot be moved, the group cannot be moved, too\n    let allowed = reduce(\n      shapes,\n      function (result, s) {\n        if (type === undefined) {\n          type = isCustom(s);\n        }\n\n        if (type !== isCustom(s) || result === false) {\n          return false;\n        }\n\n        return canCreate(s, target);\n      },\n      undefined\n    );\n\n    // reject, if we have at least one\n    // custom element that cannot be moved\n    return allowed;\n  });\n\n  this.addRule(\"shape.create\", HIGH_PRIORITY, function (context) {\n    let target = context.target,\n      shape = context.shape;\n\n    return canCreate(shape, target);\n  });\n\n  this.addRule(\"shape.resize\", HIGH_PRIORITY, function (context) {\n    let shape = context.shape;\n\n    if (isCustom(shape)) {\n      // cannot resize custom elements\n      return false;\n    }\n  });\n\n  this.addRule(\"connection.create\", HIGH_PRIORITY, function (context) {\n    let source = context.source,\n      target = context.target;\n\n    return canConnect(source, target);\n  });\n\n  this.addRule(\"connection.reconnectStart\", HIGH_PRIORITY, function (context) {\n    let connection = context.connection,\n      source = context.hover || context.source,\n      target = connection.target;\n    return canConnect(source, target, connection);\n  });\n\n  this.addRule(\"connection.reconnectEnd\", HIGH_PRIORITY, function (context) {\n    let connection = context.connection,\n      source = connection.source,\n      target = context.hover || context.target;\n\n    return canConnect(source, target, connection);\n  });\n};\n","import CustomPalette from \"./CustomPalette\";\nimport CustomContextPadProvider from \"./CustomContextPadProvider\";\nimport CustomRules from \"./CustomRules\";\n\nexport default {\n  __init__: [\"contextPadProvider\", \"customRules\", \"paletteProvider\"],\n  contextPadProvider: [\"type\", CustomContextPadProvider],\n  paletteProvider: [\"type\", CustomPalette],\n  customRules: [\"type\", CustomRules],\n};\n","export const excludedFields = [\n  'createdBy',\n  'createdOn',\n  'updatedBy',\n  'updatedOn',\n  'version',\n  'id',\n];\n\nexport const VALUE_FROM = {\n  CONTEXT: 'context',\n  SELF: 'self',\n  NONE: 'none',\n  SOURCE: 'source',\n  PARENT: 'parent',\n};\n\nexport const ModelType = {\n  CUSTOM: 'CUSTOM',\n  META: 'META',\n};\n\nexport const RelationalFields = [\n  'MANY_TO_MANY',\n  'MANY_TO_ONE',\n  'ONE_TO_MANY',\n  'ONE_TO_ONE',\n];\n\nexport const DATE_FORMAT = {\n  date: \"DD/MM/YYYY\",\n  time: \"HH:mm:ss\",\n  datetime: \"DD/MM/YYYY HH:mm\",\n};\n\nexport const RelationalFieldList = [\n  'one_to_one',\n  'many_to_one',\n  'many_to_many',\n  'one_to_many',\n  'json_one_to_one',\n  'json_many_to_one',\n  'json_many_to_many',\n  'json_one_to_many',\n]\n\nexport const excludedRelationalFields = [\n  'many_to_many',\n  'one_to_many',\n  'json_many_to_many',\n  'json_one_to_many',\n]\n\nexport const dateTypes = ['date', 'datetime', 'time'];\n\nexport const excludedUITypes = ['panel', 'label', 'spacer', 'button'];\n","import { VALUE_FROM, ModelType } from \"./constant\";\nimport { lowerCaseFirstLetter } from \"./utils\";\n\nconst getTarget = (element) => {\n  if (element.target) {\n    return element.target.split(\".\").pop();\n  }\n  if (element.targetModel) {\n    return element.targetModel.split(\".\").pop();\n  }\n  return null;\n};\n\nconst getModelFieldValue = (fields) => {\n  let modelFieldText = \"\";\n  if (fields) {\n    fields.forEach((field) => {\n      if (field.name) {\n        const fieldName = lowerCaseFirstLetter(field.name);\n        if (modelFieldText) {\n          modelFieldText = `${modelFieldText}?.${fieldName}`;\n        } else {\n          modelFieldText = `${fieldName}`;\n        }\n      }\n    });\n  }\n  return modelFieldText;\n};\n\nconst getModelSubField = (subFields = []) => {\n  return subFields.map((subField) => {\n    return JSON.parse(\n      JSON.stringify({\n        name: subField.name,\n        version: subField.version,\n        type: subField.type,\n        fullName: subField.fullName,\n        modelType: subField.modelType,\n        title: subField.title,\n        targetJsonModel: subField.targetJsonModel,\n        jsonModel: subField.jsonModel,\n        targetModel: subField.targetModel,\n        id: subField.id,\n        target: subField.target,\n      })\n    );\n  });\n};\n\nexport function generateJson(data, currentJson, defaultFrom, sourceModel) {\n  const jsonData = [];\n  const getValue = (element) => {\n    const { value, modelSubField } = element;\n    const from = value ? value.from || defaultFrom : defaultFrom;\n    let newValue = value?.selected;\n    const modelFieldValue = getModelFieldValue(modelSubField);\n    if (from === VALUE_FROM.CONTEXT) {\n      if (modelFieldValue) {\n        newValue = { value: modelFieldValue };\n      } else {\n        newValue = null;\n      }\n    }\n    if (from === VALUE_FROM.SOURCE) {\n      if (modelFieldValue) {\n        const firstField = modelSubField[0];\n        let sourceModelName = sourceModel?.fullName;\n        let fieldName = firstField?.fullName;\n        if (sourceModel.modelType === ModelType.CUSTOM) {\n          sourceModelName = sourceModel?.name;\n        }\n\n        if (firstField.modelType === ModelType.CUSTOM) {\n          fieldName = firstField?.name;\n        }\n        if (fieldName && sourceModelName && fieldName === sourceModelName) {\n          newValue = { value: \"SOURCE\" };\n        } else {\n          newValue = { value: modelFieldValue };\n        }\n      } else {\n        newValue = null;\n      }\n    }\n    if (from === VALUE_FROM.SELF) {\n      if (modelFieldValue) {\n        const firstField = modelSubField[0];\n        if (firstField && sourceModel.fullName === firstField.fullName) {\n          newValue = { value: \"SOURCE\" };\n        } else {\n          newValue = { value: modelFieldValue };\n        }\n      } else {\n        newValue = null;\n      }\n    }\n    if (\n      [VALUE_FROM.PARENT].includes(from) &&\n      newValue?.value &&\n      typeof newValue?.value === \"object\"\n    ) {\n      const contextKey = lowerCaseFirstLetter(newValue.value.name);\n      if (!modelFieldValue) {\n        newValue = { value: contextKey };\n      } else {\n        newValue = { value: `${contextKey}?.${modelFieldValue}` };\n      }\n    }\n    return newValue || null;\n  };\n  data.forEach((element) => {\n    let { value, dataPath, type } = element;\n    let newValue = { ...value };\n    const { fields } = newValue || {};\n    const modelTarget = getTarget(element);\n    const jsonTarget = element.jsonTarget;\n    const jsonModel = element.jsonModel?.name;\n    if (typeof fields === \"object\" && fields) {\n      newValue.fields = generateJson(value.fields, currentJson);\n    }\n\n    newValue.selected = getValue(element);\n\n    if (newValue && !newValue.from) {\n      newValue.from = defaultFrom;\n    }\n    if (\n      !element.isRemoved &&\n      newValue.selected &&\n      ![undefined, null].includes(newValue.selected.value)\n    ) {\n      const record = {\n        dataPath,\n        type,\n        target: modelTarget || undefined,\n        value: newValue,\n        name: element.name,\n        modelSubField: getModelSubField(element.modelSubField) || undefined,\n        sourceField: element.sourceField || undefined,\n        selfField: element.selfField || undefined,\n      };\n      if (type.toLowerCase() === \"many-to-one\") {\n        record[\"jsonModel\"] = jsonModel || undefined;\n        if (!jsonModel && jsonTarget) {\n          record[\"jsonModel\"] = jsonTarget || undefined;\n        }\n      }\n      if (type.toLowerCase() === \"json-many-to-one\") {\n        record[\"target\"] = element[\"targetJsonModel.name\"];\n      }\n      jsonData.push(JSON.parse(JSON.stringify(record)));\n    }\n  });\n  return jsonData;\n}\n\nexport function getAssignmentJson(jsonData = []) {\n  let object = {};\n  jsonData.forEach((item) => {\n    const { other, ...rest } = item;\n    object = { ...object, ...rest };\n  });\n  return object;\n}\n","import services from \"../../../services/Service\";\nimport { sortBy } from \"../utils\";\nimport { ModelType, excludedUITypes } from \"../constant\";\n\nasync function fetchSelectionByName(name) {\n  const { data } = await services.post(\n    \"ws/rest/com.axelor.meta.db.MetaSelect/search\",\n    {\n      data: {\n        _domain: \"self.name = :name\",\n        _domainContext: { name },\n      },\n      fields: [\"name\", \"items\"],\n      offset: 0,\n      limit: 1,\n      sortBy: null,\n    }\n  );\n  const record = data && data[0];\n  if (record) {\n    const { items } = record;\n    const { data } = await services.post(\n      \"ws/rest/com.axelor.meta.db.MetaSelectItem/search\",\n      {\n        data: {\n          _domain: \"self.id in (:list)\",\n          _domainContext: { list: items.map((x) => x.id) },\n        },\n        fields: [\"title\", \"value\", \"color\", \"data\", \"order\"],\n        offset: 0,\n        limit: -1,\n        sortBy: [\"order\"],\n      }\n    );\n    return data;\n  }\n  return [];\n}\n\nexport async function getModels(data = {}, metaModalType, criteria) {\n  const models =\n    ((!metaModalType || metaModalType === \"metaModel\") &&\n      (await getMetaModels(data, criteria))) ||\n    [];\n  const metaJsonModels =\n    ((!metaModalType || metaModalType === \"metaJsonModel\") &&\n      (await getCustomModels(data))) ||\n    [];\n  const allModels = [];\n\n  for (let i = 0; i < models.length; i++) {\n    allModels.push({\n      ...models[i],\n      type: \"metaModel\",\n    });\n  }\n  for (let i = 0; i < metaJsonModels.length; i++) {\n    allModels.push({\n      ...metaJsonModels[i],\n      type: \"metaJsonModel\",\n    });\n  }\n  return allModels || [];\n}\n\nexport async function fetchModelByName(modelName) {\n  let record = null;\n  const res = await services.search(\"com.axelor.meta.db.MetaModel\", {\n    data: {\n      criteria: [{ fieldName: \"name\", operator: \"=\", value: modelName }],\n    },\n    fields: [\"name\", \"metaFields\", \"id\", \"fullName\"],\n  });\n  if (res && res.status !== -1) {\n    const { data = [] } = res || {};\n    record = data[0] || null;\n  }\n  if (!record) {\n    // find in custom model\n    const criteria = [{ fieldName: \"name\", operator: \"=\", value: modelName }];\n    const customModelData = await getCustomModels(criteria);\n    record = customModelData[0];\n  }\n  return record || null;\n}\n\nexport async function getMetaModels(e, criteriaParent = []) {\n  const criteria = [];\n  if (e && e.search) {\n    criteria.push({ fieldName: \"fullName\", operator: \"like\", value: e.search });\n  }\n  const res = await services.search(\"com.axelor.meta.db.MetaModel\", {\n    data: {\n      criteria: [...criteria, ...(criteriaParent || [])],\n    },\n    fields: [\"name\", \"metaFields\", \"id\", \"fullName\"],\n  });\n  const customModelCriteria = [];\n  if (e && e.search) {\n    customModelCriteria.push({\n      fieldName: \"name\",\n      operator: \"like\",\n      value: e.search,\n    });\n  }\n  const customModelData = await getCustomModels([\n    ...customModelCriteria,\n    ...criteriaParent,\n  ]);\n  if (res && res.status === -1) return [];\n  const { data = [] } = res || {};\n  return [...data, ...customModelData];\n}\n\nexport async function getCustomModels(criteria = {}) {\n  const res = await services.search(\"com.axelor.meta.db.MetaJsonModel\", {\n    data: {\n      criteria,\n    },\n  });\n  if (res && res.status === -1) return [];\n  const { data = [] } = res || {};\n  return data.map((d) => {\n    return { ...d, modelType: ModelType.CUSTOM };\n  });\n}\n\nexport async function fetchMetaFields(criteria = {}) {\n  const res = await services.search(\"com.axelor.meta.db.MetaField\", {\n    data: criteria,\n  });\n  if (res && res.status === -1) return [];\n  const { data = [] } = res || {};\n  return data;\n}\n\nexport async function fetchModelFields(item, isSubField = false) {\n  let entity = `${item.packageName}.${item.typeName}`;\n  if (isSubField) {\n    entity = item.target;\n  }\n  const fields = await fetchFields({ fullName: entity });\n  return fields;\n}\n\nexport async function fetchFields(item, excludeUIFields = false) {\n  let fields = [];\n  const entity = `${item.fullName || item.target}`;\n  if (item.modelType === ModelType.CUSTOM || !entity) {\n    const criteria = [\n      { fieldName: \"jsonModel.name\", operator: \"=\", value: item.name },\n    ];\n    const searchData = {\n      criteria,\n    };\n    const res = await services.search(\"com.axelor.meta.db.MetaJsonField\", {\n      data: searchData,\n      fields: [\n        \"type\",\n        \"nameField\",\n        \"required\",\n        \"model\",\n        \"targetModel\",\n        \"targetJsonModel\",\n        \"targetJsonModel.name\",\n        \"modelField\",\n        \"jsonModel\",\n        \"jsonModel.name\",\n        \"title\",\n        \"name\",\n        \"selection\",\n      ],\n      sortBy: [\"title\"],\n    });\n    const { data = [] } = res || {};\n    for (let i = 0; i < data.length; i++) {\n      const item = data[i];\n      if (item.selection) {\n        const selectionList = await fetchSelectionByName(item.selection);\n        item.selectionList = selectionList;\n      }\n      if (item.jsonModel) {\n        item.jsonModel[\"name\"] = item[\"jsonModel.name\"];\n      }\n      fields.push(item);\n    }\n  } else {\n    const res = await services.fetchFields(entity);\n    if (res && res.status === -1) return [];\n    const { data = [] } = res || {};\n    fields = [...data.fields];\n    Object.keys(data.jsonFields).forEach((fieldKey) => {\n      const jsonField = data.jsonFields[fieldKey];\n      fields.push(...Object.values(jsonField));\n    });\n  }\n  const newFields = sortBy(fields, \"title\");\n  return newFields.filter((field) => !excludedUITypes.includes(field.type));\n}\n\nexport async function fetchCustomFields(item) {\n  if (item.targetModel) {\n    const fields = await fetchFields({ fullName: item.targetModel });\n    return fields;\n  } else if (item.targetJsonModel) {\n    const criteria = [\n      {\n        fieldName: \"jsonModel.id\",\n        operator: \"=\",\n        value: item.targetJsonModel.id,\n      },\n    ];\n    const searchData = {\n      criteria,\n    };\n    const res = await services.search(\"com.axelor.meta.db.MetaJsonField\", {\n      data: searchData,\n      fields: [\n        \"type\",\n        \"nameField\",\n        \"required\",\n        \"model\",\n        \"targetModel\",\n        \"targetJsonModel\",\n        \"targetJsonModel.name\",\n        \"modelField\",\n        \"jsonModel\",\n        \"jsonModel.name\",\n        \"title\",\n        \"name\",\n      ],\n      sortBy: [\"title\"],\n    });\n    const { data = [] } = res || {};\n    let newData = data.map((item) => {\n      if (item.jsonModel) {\n        item.jsonModel[\"name\"] = item[\"jsonModel.name\"];\n      }\n      return item;\n    });\n    return [...newData];\n  }\n  return [];\n}\n\nexport async function saveRecord(params, record) {\n  const res = await services.add(params.model, record);\n  if (res && res.status === -1) return null;\n  const { data = [] } = res || {};\n  return data[0] || null;\n}\n\nexport async function fetchRecord(model, id) {\n  const res = await services.fetchRecord(model, id);\n  if (res && res.status === -1) return null;\n  const { data = [] } = res || {};\n  return data[0] || null;\n}\n\nexport async function getCustomModelData(jsonModel) {\n  const res = await services.search(\"com.axelor.meta.db.MetaJsonRecord\", {\n    data: {\n      criteria: [{ fieldName: \"jsonModel\", operator: \"=\", value: jsonModel }],\n      // _domain: 'self.jsonModel.id=2',\n      operator: \"and\",\n    },\n  });\n  if (res && res.status === -1) return [];\n  return res && res.data;\n}\n\nexport async function getCustomModelByDomain(jsonModelDomain) {\n  const res = await services.search(\"com.axelor.meta.db.MetaJsonRecord\", {\n    data: {\n      _domain: jsonModelDomain,\n    },\n  });\n  if (res && res.status === -1) return [];\n  return res && res.data;\n}\n\nexport async function getNameField(jsonModel) {\n  const res = await services.search(\"com.axelor.meta.db.MetaJsonField\", {\n    data: {\n      criteria: [\n        { fieldName: \"jsonModel\", operator: \"=\", value: jsonModel },\n        { fieldName: \"nameField\", operator: \"=\", value: true },\n      ],\n      operator: \"and\",\n    },\n    fields: [\"name\"],\n  });\n  if (res && res.status > -1) {\n    return res.data && res.data[0];\n  }\n}\n\nexport async function getNameFieldByDomain(jsonModelName) {\n  const res = await services.search(\"com.axelor.meta.db.MetaJsonField\", {\n    data: {\n      _domain: `self.jsonModel.name = '${jsonModelName}' and self.nameField = true`,\n    },\n    fields: [\"name\"],\n  });\n  if (res && res.status > -1) {\n    return res.data && res.data[0];\n  }\n}\n\nexport async function getData(model) {\n  const res = await services.search(model);\n  if (res && res.status === -1) return [];\n  return res && res.data;\n}\n\nexport async function generateScriptString(jsonString, model) {\n  const action = \"action-mapper-method-create-script-from-json\";\n  const data = {\n    action,\n    data: {\n      context: {\n        _model: model,\n        _jsonString: jsonString,\n      },\n    },\n  };\n  const { data: responseData = [] } = await services.action(data);\n  if (\n    Array.isArray(responseData) &&\n    responseData[0] &&\n    responseData[0].values &&\n    responseData[0].values._scriptString\n  ) {\n    return responseData[0].values._scriptString;\n  }\n  return undefined;\n}\n","import React from \"react\";\nimport {\n  excludedFields,\n  VALUE_FROM,\n  ModelType,\n  RelationalFieldList,\n  DATE_FORMAT,\n  excludedRelationalFields,\n} from \"./constant\";\nimport { getAssignmentJson } from \"./generator\";\nimport { fetchFields } from \"./services/api\";\nimport moment from \"moment\";\n\nfunction useDebounce(cb, duration) {\n  const timer = React.useRef(null);\n\n  const clearTimer = () => timer.current && clearTimeout(timer.current);\n  const setTimer = (cb) => (timer.current = setTimeout(cb, duration));\n\n  React.useEffect(() => {\n    return () => clearTimer();\n  }, []);\n\n  return (...args) => {\n    clearTimer();\n    setTimer(() => cb(...args));\n  };\n}\n\nfunction isBPMQuery(type) {\n  return type === \"bpmQuery\" ? true : false;\n}\n\nfunction lowerCaseFirstLetter(str) {\n  if (!str) return;\n  return str.charAt(0).toLowerCase() + str.slice(1);\n}\n\nfunction upperCaseFirstLetter(str) {\n  if (!str) return;\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nfunction getModelFilter(modelFilter) {\n  if (!modelFilter) return null;\n  const data = {\n    _domain: modelFilter,\n  };\n  return data;\n}\n\nconst getJsonExpression = (field, prefix, fieldName) => {\n  const { type, jsonField, targetName } = field;\n  switch (type) {\n    case \"text\":\n    case \"string\":\n    case \"date\":\n    case \"datetime\":\n    case \"time\":\n      return `json_extract_text(${prefix}.${jsonField},'${fieldName}')`;\n    case \"many-to-one\":\n    case \"json-many-to-one\":\n    case \"many_to_one\":\n    case \"json_many_to_one\":\n      if (!targetName) {\n        return `json_extract_text(${prefix}.${jsonField},'${fieldName}')`;\n      }\n      return `json_extract_text(${prefix}.${jsonField},'${fieldName}','${targetName}')`;\n    case \"integer\":\n      return `json_extract_integer(${prefix}.${jsonField},'${fieldName}')`;\n    case \"decimal\":\n      return `json_extract_decimal(${prefix}.${jsonField},'${fieldName}')`;\n    case \"boolean\":\n      return `json_extract_boolean(${prefix}.${jsonField},'${fieldName}')`;\n    default:\n      break;\n  }\n};\n\nfunction translate(str) {\n  if (window._t && typeof str === \"string\") {\n    return window._t(str);\n  }\n  return str;\n}\n\nfunction sortBy(array = [], key) {\n  return array.sort(function (a, b) {\n    let x = a[key];\n    let y = b[key];\n    return x < y ? -1 : x > y ? 1 : 0;\n  });\n}\n\nfunction getBool(val) {\n  if (!val) return false;\n  return !!JSON.parse(String(val).toLowerCase());\n}\n\nfunction excludeFields(data, otherFields = []) {\n  const getType = (type = \"\") => type.replace(/-/g, \"_\").toLowerCase();\n  const excludeFieldList = [...excludedFields, ...otherFields];\n  const dataList = data.filter(\n    (item) => excludeFieldList.indexOf(item.name) === -1\n  );\n  return dataList.filter((item) => {\n    return !excludedRelationalFields.includes(getType(item.type));\n  });\n}\n\nfunction validate(fields, errors = {}, isRoot = true) {\n  const isAvailable = (field) => {\n    const { value, contextModel, from } = field;\n    if (from === VALUE_FROM.CONTEXT && !contextModel) {\n      return false;\n    }\n    if (!value?.selected?.value) {\n      return false;\n    }\n    return true;\n  };\n\n  fields.forEach((field) => {\n    if (field.required && !isAvailable(field)) {\n      errors[field.dataPath] = \"value is required\";\n    }\n    if (field.value && field.value.fields) {\n      errors = validate(field.value.fields, errors, false);\n    }\n  });\n  if (isRoot) {\n    return { errors, isValid: Object.keys(errors).length === 0 };\n  }\n  return errors;\n}\n\nasync function mergeFieldData(jsonData, fields) {\n  const newFields = [...fields];\n  const json = getAssignmentJson(jsonData);\n  const getPath = ({ path, name, type }) => {\n    if (path) {\n      if (isRelationalField(type)) {\n        const lastIndex = path.lastIndexOf(\".\");\n        return lastIndex !== -1 ? path.substring(0, lastIndex) : path;\n      }\n      return path;\n    }\n    return name;\n  };\n  if (json) {\n    const jsonKeys = Object.keys(json);\n    for (let i = 0; i < jsonKeys.length; i++) {\n      const key = jsonKeys[i];\n\n      const object = {};\n      const item = jsonData.find((d) => d[key]);\n      const keyList = key.split(\".\");\n      const value = json[key];\n      if (item && item.other && item.other.subField) {\n        const index = newFields.findIndex(\n          (elem) => elem.name === keyList[keyList.length - 1]\n        );\n        if (index !== -1) {\n          const field = newFields[index];\n          let subFields = await fetchFields({ fullName: field.target });\n          subFields = excludeFields(subFields).map((subField) => {\n            return { ...subField, path: `${getPath(field)}.${subField.name}` };\n          });\n          newFields.splice(index + 1, 0, ...subFields);\n        }\n      }\n\n      if (key && value) {\n        const valueList = value.split(\".\");\n        const index = newFields.findIndex((elem) => elem.name === keyList[0]);\n        if (index !== -1) {\n          const field = newFields[index];\n          if (\n            !item.other.targetName ||\n            (item.other.targetName && keyList.length === 3)\n          ) {\n            object[\"subFieldName\"] = {\n              name: keyList[1],\n              type: item.other.subFieldType,\n            };\n          }\n          if (valueList[1]) {\n            let contextModel = { name: valueList[0] };\n            object[\"from\"] = VALUE_FROM.CONTEXT;\n            object[\"contextModel\"] = { name: valueList[0] };\n            object[\"modelSubField\"] = { name: valueList[1] };\n            if (item && item.other && item.other.modelType === ModelType.META) {\n              contextModel = {\n                name: upperCaseFirstLetter(valueList[0]),\n                fullName: item.other.fullName,\n              };\n            }\n            object[\"contextModel\"] = { ...contextModel };\n          } else {\n            const fieldIndex = fields.findIndex(\n              (field) => field.name === valueList[0]\n            );\n            if (fieldIndex !== -1) {\n              object[\"from\"] = VALUE_FROM.SELF;\n              object[\"selfField\"] = valueList[0];\n            } else {\n              if ((keyList[1] && !object.subFieldName) || keyList[2]) {\n                const targetName = item?.other?.targetName || field.targetName;\n                object[\"value\"] = { [targetName]: valueList[0] };\n              } else {\n                object[\"value\"] = valueList[0];\n              }\n            }\n          }\n          object[\"path\"] = field.path || key;\n          newFields.splice(index, 1, { ...field, ...object });\n        }\n      }\n    }\n  }\n  return newFields;\n}\n\nfunction getAssignmentFields(jsonData = [], fields) {\n  const json = getAssignmentJson(jsonData);\n  const newFields = fields.map((field, i) => {\n    let key = field.path;\n    const object = {};\n    const item = jsonData.find((d) => d[key]);\n    const keyList = key.split(\".\");\n    const value = json[key];\n    if (key && value) {\n      const valueList = value.split(\".\");\n      const fieldName = keyList[keyList.length - 1];\n      const index = fields.findIndex((elem) => elem.name === fieldName);\n      if (index !== -1) {\n        const field = fields[index];\n        if (valueList[1]) {\n          let contextModel = { name: valueList[0] };\n          object[\"from\"] = VALUE_FROM.CONTEXT;\n          object[\"contextModel\"] = { name: valueList[0] };\n          object[\"modelSubField\"] = { name: valueList[1] };\n          if (item && item.other && item.other.modelType === ModelType.META) {\n            contextModel = {\n              name: upperCaseFirstLetter(valueList[0]),\n              fullName: item.other.fullName,\n            };\n          }\n          object[\"contextModel\"] = { ...contextModel };\n        } else {\n          const fieldIndex = fields.findIndex(\n            (_field) => _field.name === valueList[0]\n          );\n          if (fieldIndex !== -1) {\n            object[\"from\"] = VALUE_FROM.SELF;\n            object[\"selfField\"] = valueList[0];\n          } else {\n            if (field.targetName) {\n              const targetName = item?.other?.targetName || field.targetName;\n              object[\"value\"] = { [targetName]: value };\n            } else {\n              object[\"value\"] = value;\n            }\n          }\n        }\n        object[\"path\"] = field.path;\n      }\n    }\n    return { ...field, ...object };\n  });\n  return newFields;\n}\n\nfunction isRelationalField(type = \"\") {\n  const _type = type.replace(/-/g, \"_\").toLowerCase();\n  return RelationalFieldList.indexOf(_type) !== -1;\n}\n\nfunction generatePath(field) {\n  const { targetName } = field;\n  let path = field.name;\n  if (targetName) {\n    path = `${path}.${targetName}`;\n  }\n  return path;\n}\n\nfunction getDateTimeValue(type, fieldValue, isJsonField = false) {\n  if (type === \"date\") {\n    let date = `'${moment(fieldValue, DATE_FORMAT[\"date\"]).format(\n      \"YYYY-MM-DD\"\n    )}'`;\n    if (isJsonField) {\n      return date;\n    }\n    return `LocalDate.parse(${date})`;\n  } else if (type === \"datetime\") {\n    if (isJsonField) {\n      return `'${moment(fieldValue, DATE_FORMAT[\"datetime\"]).toISOString()}'`;\n    }\n    return `LocalDateTime.of(${moment(fieldValue, DATE_FORMAT[\"datetime\"])\n      .format(\"YYYY-M-D-H-m-s\")\n      .split(\"-\")})`;\n  } else {\n    let time = `'${moment(fieldValue, DATE_FORMAT[\"time\"]).format(\n      \"HH:mm:ss\"\n    )}'`;\n    if (isJsonField) {\n      return time;\n    }\n    return `LocalTime.parse(${time})`;\n  }\n}\n\nconst isCustomTarget = (target) =>\n  target === \"com.axelor.meta.db.MetaJsonRecord\";\n\nconst dndItemTypes = {\n  ROW: \"row\",\n};\n\nexport {\n  translate,\n  sortBy,\n  useDebounce,\n  isBPMQuery,\n  lowerCaseFirstLetter,\n  upperCaseFirstLetter,\n  getModelFilter,\n  getJsonExpression,\n  getBool,\n  excludeFields,\n  validate,\n  mergeFieldData,\n  isRelationalField,\n  getAssignmentFields,\n  generatePath,\n  getDateTimeValue,\n  isCustomTarget,\n  dndItemTypes\n};\n","import React, { useEffect, useState } from \"react\";\nimport { TextField, CircularProgress } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport Autocomplete from \"@material-ui/lab/Autocomplete\";\nimport _uniqueId from \"lodash/uniqueId\";\n\nimport { translate, useDebounce } from \"../utils\";\n\nconst getKey = (key) => (key === \"_selectId\" ? \"id\" : key);\n\nconst useStyles = makeStyles((theme) => ({\n  listbox: {\n    maxHeight: \"300px !important\",\n  },\n  input: {\n    width: \"100% !important\",\n  },\n  inputSelected: {\n    width: \"100% !important\",\n    color: \"rgba(0, 0, 0, 0.87)\",\n    border: \"1px solid #e0e0e0\",\n    padding: \"0px 12px\",\n    borderRadius: 25,\n    background: \"#e0e0e0\",\n    overflow: \"hidden\",\n    whiteSpace: \"nowrap\",\n    textOverflow: \"ellipsis\",\n    textAlign: \"center\",\n    fontSize: \"0.8125rem\",\n  },\n}));\nexport default function AutoComplete(props) {\n  const [open, setOpen] = useState(false);\n  const [options, setOptions] = useState([]);\n  const [selectedValue, setSelectedValue] = useState(props.isMulti ? [] : null);\n  const [inputValue, setInputValue] = useState(\"\");\n  const {\n    name,\n    value,\n    onChange,\n    options: flatOptions,\n    optionLabelKey = \"title\",\n    optionValueKey = \"id\",\n    isMulti = false,\n    title,\n    fetchAPI,\n    inline,\n    InputProps,\n    error,\n    filterSelectedOptions = false,\n    disableCloseOnSelect = true,\n    readOnly = false,\n    concatValue,\n    isProcessContext = false,\n    inputRootClass = {},\n    ...other\n  } = props;\n\n  const classes = useStyles();\n  const [loading, setLoading] = useState(false);\n\n  const findOption = React.useCallback(\n    (option) => {\n      return (\n        flatOptions &&\n        flatOptions.find(\n          (i) => i && i[getKey(optionValueKey)] === option.trim()\n        )\n      );\n    },\n    [flatOptions, optionValueKey]\n  );\n\n  async function onInputChange(value = \"\") {\n    setInputValue(value);\n  }\n\n  const delayChange = useDebounce(onInputChange, 400);\n\n  useEffect(() => {\n    let active = true;\n    if (open) {\n      setOptions([]);\n      setLoading(true);\n      if (fetchAPI) {\n        (async () => {\n          const data = await fetchAPI({ search: inputValue });\n          if (active) {\n            setOptions(data);\n            setLoading(false);\n          }\n        })();\n      } else {\n        setOptions(flatOptions);\n        setLoading(false);\n      }\n    }\n    return () => {\n      active = false;\n      setLoading(false);\n    };\n  }, [fetchAPI, flatOptions, inputValue, open]);\n\n  useEffect(() => {\n    if (typeof value === \"string\") {\n      const values = value.split(\",\");\n      setSelectedValue(\n        isMulti ? values.map((v) => findOption(v)) : findOption(values[0])\n      );\n    } else {\n      setSelectedValue(value ? value : isMulti ? [] : null);\n    }\n  }, [value, isMulti, findOption]);\n\n  function onKeyDown(e) {\n    if (e.key === \"Backspace\") {\n      if (\n        selectedValue &&\n        selectedValue[getKey(optionLabelKey)] === inputValue\n      ) {\n        onChange(null, \"backspace\");\n      }\n    }\n  }\n\n  function handleChange(item, reason) {\n    if (typeof value === \"string\") {\n      isMulti\n        ? onChange(\n            item.map((i) => i && i[getKey(optionValueKey)]).join(\",\") || [],\n            reason\n          )\n        : onChange(item && item[getKey(optionValueKey)], reason);\n    } else {\n      onChange(item, reason);\n    }\n  }\n\n  const checkValue = (option) => {\n    return (option && option.type) === \"metaJsonModel\"\n      ? `${\n          option && option[getKey(optionLabelKey)]\n            ? option[getKey(optionLabelKey)]\n            : \"\"\n        } (Custom model)` || \"\"\n      : name === \"fieldName\"\n      ? `${translate(option && option[\"title\"] ? option[\"title\"] : \"\")} (${\n          option && option[getKey(optionLabelKey)]\n        })`\n      : option\n      ? option[getKey(optionLabelKey)] &&\n        concatValue &&\n        option[getKey(optionValueKey)]\n        ? `${option[getKey(optionLabelKey)]} (${\n            option[getKey(optionValueKey)]\n          })`\n        : option[getKey(optionLabelKey)]\n        ? option[getKey(optionLabelKey)]\n        : option[\"name\"]\n        ? option[\"name\"]\n        : option[\"id\"]\n        ? option[\"id\"].toString()\n        : \"\"\n      : \"\";\n  };\n\n  return (\n    <Autocomplete\n      getOptionSelected={(option, value) => {\n        return isMulti\n          ? option[getKey(optionValueKey)] === value[getKey(optionValueKey)]\n          : checkValue(option) === checkValue(value);\n      }}\n      getOptionLabel={(option) => {\n        return checkValue(option);\n      }}\n      loading={loading}\n      id={_uniqueId(\"select-widget\")}\n      open={open}\n      onOpen={() => setOpen(true)}\n      onClose={() => setOpen(false)}\n      disabled={readOnly}\n      value={\n        selectedValue\n          ? isMulti\n            ? Array.isArray(selectedValue)\n              ? selectedValue\n              : []\n            : selectedValue\n          : isMulti\n          ? []\n          : null\n      }\n      onChange={(event, newValue, reason) => handleChange(newValue, reason)}\n      options={options || []}\n      multiple={isMulti}\n      filterSelectedOptions={filterSelectedOptions}\n      onInputChange={(e, value) => delayChange(value)}\n      classes={{\n        option: \"menu-item\",\n        input: isProcessContext\n          ? selectedValue\n            ? classes.inputSelected\n            : classes.input\n          : \"\",\n        inputRoot: inputRootClass,\n      }}\n      renderInput={(params) => {\n        return (\n          <TextField\n            {...params}\n            error={error}\n            label={inline ? \"\" : title}\n            fullWidth\n            onClick={() => {\n              if (readOnly) return;\n              setOpen(true);\n            }}\n            InputProps={{\n              ...InputProps,\n              ...params.InputProps,\n              endAdornment: (\n                <React.Fragment>\n                  {loading ? (\n                    <CircularProgress\n                      className={classes.circularProgress}\n                      size={15}\n                    />\n                  ) : null}\n                  {params.InputProps.endAdornment}\n                </React.Fragment>\n              ),\n            }}\n            {...(isMulti ? {} : { onKeyDown: onKeyDown })}\n          />\n        );\n      }}\n      {...(isMulti ? { disableCloseOnSelect } : {})}\n      {...other}\n    />\n  );\n}\n","import React, { useEffect } from \"react\";\nimport {\n  Grid,\n  Button,\n  Typography,\n  CardActions,\n  Checkbox,\n  FormControlLabel,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  TextField,\n} from \"@material-ui/core\";\n\nimport { makeStyles } from \"@material-ui/core/styles\";\n\nconst useStyles = makeStyles((theme) => ({\n  dialogPaper: {\n    minHeight: \"75vh\",\n    maxHeight: \"75vh\",\n  },\n  cardContent: {\n    height: \"100%\",\n    minWidth: 250,\n    paddingLeft: 0,\n    paddingRight: 0,\n  },\n  cardContentItemText: {\n    fontSize: 12,\n    lineHeight: 0.5,\n    paddingBottom: 8,\n  },\n  cardContentItemContainer: {\n    marginLeft: 10,\n  },\n  cardContentItemTitle: {\n    fontSize: 16,\n  },\n  cardActionView: {\n    justifyContent: \"flex-end\",\n  },\n  noFields: {\n    textAlign: \"center\",\n    color: \"gray\",\n  },\n  save: {\n    margin: theme.spacing(1),\n    backgroundColor: \"#0275d8\",\n    borderColor: \"#0267bf\",\n    color: \"white\",\n    textTransform: \"none\",\n    \"&:hover\": {\n      backgroundColor: \"#025aa5\",\n      borderColor: \"#014682\",\n      color: \"white\",\n    },\n  },\n  dialogTitle: {\n    \"& > h2\": {\n      display: \"flex\",\n      justifyContent: \"space-between\",\n    },\n  },\n  subHeaderRow: {\n    borderBottom: \"1px solid #eee\",\n    paddingLeft: 16,\n    paddingRight: 16,\n    paddingBottom: 8,\n    display: \"flex\",\n  },\n  fieldListViewContainer: {\n    marginLeft: 16,\n    marginRight: 2,\n    marginTop: 8,\n    overflowY: \"auto\",\n    height: \"53.8vh\",\n  },\n  searchField: {\n    width: \"75%\",\n    \"& input\": {\n      padding: \"8px 0 7px !important\",\n    },\n  },\n  checkbox: {\n    color: \"#2185D0 !important\",\n    \"&$checked\": {\n      color: \"#2185D0 !important\",\n      backgrounColor: \"#2185D0 !important\",\n    },\n  },\n}));\n\nconst getFilteredFields = (list, text) => {\n  if (!text) {\n    return list;\n  }\n  return list.filter((item) => {\n    return (\n      (item.title || \"\").toLowerCase().includes(text.toLowerCase()) ||\n      (item.name || \"\").toLowerCase().includes(text.toLowerCase())\n    );\n  });\n};\n\nfunction FieldPopoverComponent({ data, onSubmit, open, onClose }) {\n  const classes = useStyles();\n  const [selected, setSelected] = React.useState([]);\n  const [selectAll, setSelectAll] = React.useState(false);\n  const [searchText, setSearchText] = React.useState(\"\");\n  const fields = Object.values(data).filter((e) => e.isRemoved !== false);\n\n  const handleClose = React.useCallback(\n    (e) => {\n      e && e.stopPropagation();\n      onClose();\n      setSelected([]);\n      setSelectAll(false);\n    },\n    [onClose]\n  );\n\n  const handleSubmit = React.useCallback(\n    (e) => {\n      e.stopPropagation();\n      const list = fields.filter((d, index) => selected.indexOf(d.name) !== -1);\n      onSubmit && onSubmit(list);\n      handleClose(e);\n    },\n    [onSubmit, selected, handleClose, fields]\n  );\n\n  const handleCheckbox = React.useCallback((e) => {\n    e.stopPropagation();\n    const { value } = e.target;\n    setSelected((selected) => {\n      if (selected.indexOf(value) !== -1) {\n        setSelectAll(false);\n        return [...selected.filter((v) => v !== value)];\n      } else {\n        return [...selected, value];\n      }\n    });\n  }, []);\n\n  const handleSelectAll = React.useCallback(\n    (_selectAll) => {\n      if (_selectAll) {\n        setSelected(fields.map((f) => f.name));\n      } else {\n        setSelected([]);\n      }\n      setSelectAll(_selectAll);\n    },\n    [fields]\n  );\n\n  const handleFieldSearch = React.useCallback((e) => {\n    setSearchText(e.target.value);\n  }, []);\n\n  useEffect(() => {\n    setSearchText(\"\");\n  }, [open]);\n\n  return (\n    <React.Fragment>\n      <Dialog\n        fullWidth={true}\n        open={open}\n        onClose={(e, reason) => {\n          if (reason !== \"backdropClick\") {\n            handleClose();\n          }\n        }}\n        aria-labelledby=\"scroll-dialog-title\"\n      >\n        <DialogTitle id=\"scroll-dialog-title\" className={classes.dialogTitle}>\n          <span>Select Fields</span>\n        </DialogTitle>\n        <DialogContent dividers={true} classes={{ root: classes.cardContent }}>\n          <div className={classes.subHeaderRow}>\n            <FormControlLabel\n              control={\n                <Checkbox\n                  classes={{ root: classes.checkbox }}\n                  onChange={() => handleSelectAll(!selectAll)}\n                  value={selectAll}\n                  checked={selectAll}\n                />\n              }\n            />\n            <TextField\n              classes={{ root: classes.searchField }}\n              placeholder=\"Search fields\"\n              onChange={(e) => handleFieldSearch(e)}\n            />\n          </div>\n          <div className={classes.fieldListViewContainer}>\n            {getFilteredFields(fields, searchText).map((field, i) => (\n              <Grid container key={i}>\n                <FormControlLabel\n                  control={\n                    <Checkbox\n                      classes={{ root: classes.checkbox }}\n                      onChange={handleCheckbox}\n                      value={field.name}\n                      checked={selected.indexOf(field.name) !== -1}\n                    />\n                  }\n                  label={\n                    <div className={classes.cardContentItemContainer}>\n                      <Typography className={classes.cardContentItemTitle}>\n                        {field.title}\n                      </Typography>\n                      <Typography className={classes.cardContentItemText}>\n                        {field.name}\n                      </Typography>\n                    </div>\n                  }\n                />\n              </Grid>\n            ))}\n            {fields.length === 0 && (\n              <Typography className={classes.noFields}>\n                No fields available\n              </Typography>\n            )}\n          </div>\n        </DialogContent>\n        <CardActions className={classes.cardActionView}>\n          <Button\n            variant=\"contained\"\n            className={classes.save}\n            color=\"primary\"\n            onClick={handleClose}\n          >\n            Close\n          </Button>\n          <Button\n            variant=\"contained\"\n            className={classes.save}\n            color=\"primary\"\n            onClick={handleSubmit}\n          >\n            OK\n          </Button>\n        </CardActions>\n      </Dialog>\n    </React.Fragment>\n  );\n}\n\nconst FieldPopover = React.memo(FieldPopoverComponent);\n\nexport default FieldPopover;\n","import React from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport classNames from \"classnames\";\nimport { Typography, Grid } from \"@material-ui/core\";\nimport { RelationalFieldList } from \"../constant\";\nimport FieldPopover from \"./FieldPopover\";\nimport AddIcon from \"@material-ui/icons/AddCircleOutline\";\n\nconst useStyles = makeStyles({\n  container: {\n    display: \"flex\",\n  },\n  input: {\n    width: \"100%\",\n    display: \"flex\",\n    position: \"relative\",\n    \"& > div:before\": {\n      border: 0,\n    },\n  },\n  parentField: {\n    marginRight: 5,\n    color: \"#3f51b5\",\n  },\n  clickableView: {\n    cursor: \"pointer\",\n    \"& input\": {\n      cursor: \"pointer\",\n    },\n    // '&:hover': {\n    //   '& $addFieldView': {\n    //     visibility: 'visible',\n    //   },\n    // }\n  },\n  fieldName: {\n    fontSize: 12,\n  },\n  fieldNameColumn: {\n    width: \"unset\",\n  },\n  // addFieldView: {\n  //   visibility: 'hidden',\n  // },\n  addFieldButton: {\n    padding: 0,\n    marginLeft: 5,\n  },\n});\n\nconst isRelationalField = (row) => {\n  const type = row.type.replace(/-/g, \"_\").toLowerCase();\n  return RelationalFieldList.indexOf(type) !== -1;\n};\n\nconst getFields = (item) => {\n  if (isRelationalField(item)) {\n    const { value } = item;\n    return value?.fields || null;\n  }\n  return null;\n};\n\nfunction ModelFieldComponent(props) {\n  const classes = useStyles();\n  const { item, handleAdd } = props;\n  const [showSubField, setShowSubField] = React.useState(false);\n  const fields = getFields(item);\n\n  React.useEffect(() => {\n    if (item && isRelationalField(item) && item[\"subFieldName\"]) {\n      setShowSubField(true);\n    }\n  }, [item]);\n\n  if (!item) {\n    return null;\n  }\n  return (\n    <div className={classNames(classes.input)}>\n      <Grid container direction=\"column\" className={classes.fieldNameColumn}>\n        <Typography title={item[\"name\"]}>\n          {item[\"title\"] || item[\"autoTitle\"] || item[\"name\"]}\n        </Typography>\n      </Grid>\n      <div>\n        {fields && showSubField && (\n          <FieldPopover\n            data={fields}\n            iconButton={true}\n            onSubmit={(data) => handleAdd(data)}\n            icon={<AddIcon />}\n            buttonTitle=\"Add Fields\"\n            iconButtonClassName={classes.addFieldButton}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\nconst ModelField = React.memo(ModelFieldComponent);\nexport default ModelField;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport Input from \"@material-ui/core/Input\";\nimport { TextField } from \"@material-ui/core\";\n\nfunction InputField({\n  name,\n  title,\n  autoTitle,\n  value = \"\",\n  onChange,\n  onBlur,\n  readOnly,\n  inline,\n  InputProps,\n  style,\n  ...other\n}) {\n  const [text, setText] = React.useState();\n\n  React.useEffect(() => {\n    setText(value);\n  }, [value]);\n\n  if (inline) {\n    return (\n      <Input\n        style={{ width: \"100%\", ...style }}\n        placeholder={title}\n        inputProps={{ \"aria-label\": title }}\n        name={name}\n        onChange={(e) => setText(e.target.value)}\n        onBlur={(e) => onBlur(e.target.value)}\n        autoComplete=\"off\"\n        readOnly={readOnly}\n        disabled={readOnly}\n        value={text || \"\"}\n        {...other}\n      />\n    );\n  }\n  return (\n    <TextField\n      label={title || autoTitle}\n      name={name}\n      style={{ width: \"100%\", ...style }}\n      onChange={(e) => setText(e.target.value)}\n      onBlur={onBlur}\n      autoComplete=\"off\"\n      InputProps={{ readOnly, ...InputProps }}\n      value={text || \"\"}\n      className={other.className}\n      {...other}\n    />\n  );\n}\n\nInputField.propTypes = {\n  name: PropTypes.string,\n  title: PropTypes.string,\n  value: PropTypes.string,\n  onChange: PropTypes.func,\n  readOnly: PropTypes.bool,\n  multiline: PropTypes.bool,\n  rows: PropTypes.number,\n};\n\nInputField.defaultProps = {\n  rows: 3,\n  readOnly: false,\n};\nexport default InputField;\n","import React, { useState, useCallback } from \"react\";\nimport PropTypes from \"prop-types\";\nimport Input from \"./TextInput\";\n\nfunction NumberField({\n  type = \"integer\",\n  title,\n  onChange,\n  value = 0,\n  readOnly,\n  scale = 2,\n  customeFormat,\n  onBlur: blur,\n  ...other\n}) {\n  let [val, setVal] = useState(value);\n\n  const formatValue = useCallback(\n    (value) => Number(Number(value).toFixed(type === \"integer\" ? 0 : scale)),\n    [type, scale]\n  );\n\n  React.useEffect(() => {\n    setVal(formatValue(value));\n  }, [value, setVal, formatValue]);\n\n  function onBlur(e) {\n    onChange(formatValue(e.target.value));\n    setVal(formatValue(e.target.value));\n    blur && blur(e);\n  }\n  return (\n    <Input\n      onChange={setVal}\n      title={title}\n      type={\"number\"}\n      value={`${val}`}\n      onBlur={onBlur}\n      {...other}\n    />\n  );\n}\nNumberField.propTypes = {\n  name: PropTypes.string,\n  title: PropTypes.string,\n  type: PropTypes.string,\n  onChange: PropTypes.func,\n  readOnly: PropTypes.bool,\n  scale: PropTypes.number,\n  customeFormat: PropTypes.object,\n};\n\nNumberField.defaultProps = {\n  readOnly: false,\n};\nexport default NumberField;\n","import React, { useState } from \"react\";\nimport MomentUtils from \"@date-io/moment\";\nimport {\n  MuiPickersUtilsProvider,\n  KeyboardTimePicker,\n  KeyboardDateTimePicker,\n  KeyboardDatePicker,\n} from \"@material-ui/pickers\";\nimport { DATE_FORMAT } from \"../constant\";\n\nconst PICKERS = {\n  date: KeyboardDatePicker,\n  time: KeyboardTimePicker,\n  datetime: KeyboardDateTimePicker,\n};\n\nfunction DateTimePicker({ inline, type = \"date\", ...props }) {\n  const [open, setOpen] = useState(false);\n  let valueRef = React.useRef();\n  const { name, title, format, error, onChange, ...other } = props;\n  const Picker = PICKERS[type];\n\n  function onKeyDown(e) {\n    if (e.keyCode === 40) setOpen(true);\n  }\n\n  function onClose() {\n    onChange(valueRef.current);\n    setOpen(false);\n  }\n\n  React.useEffect(() => {\n    if(open) {\n      valueRef.current = other.value;  \n    }\n  }, [open, other.value])\n\n  return (\n    <MuiPickersUtilsProvider utils={MomentUtils}>\n      <Picker\n        autoOk={true}\n        open={open}\n        ampm={false}\n        views={\n          type === \"date\"\n            ? [\"date\"]\n            : type === \"datetime\"\n            ? [\"date\", \"hours\", \"minutes\"]\n            : type === \"time\"\n            ? [\"hours\", \"minutes\", \"seconds\"]\n            : [\"date\"]\n        }\n        onChange={(value) => {\n          valueRef.current = value;\n          onChange(value);\n        }}\n        PopoverProps={{\n          anchorOrigin: { vertical: \"bottom\", horizontal: \"left\" },\n          transformOrigin: { vertical: \"top\", horizontal: \"left\" },\n        }}\n        disableToolbar\n        variant=\"inline\"\n        {...(inline ? { invalidDateMessage: \"\" } : {})}\n        style={{ width: \"100%\", ...(inline ? { margin: 0 } : {}) }}\n        label={inline ? \"\" : title}\n        format={format || DATE_FORMAT[type]}\n        {...(type !== \"time\" ? { animateYearScrolling: false } : {})}\n        {...other}\n        onKeyDown={onKeyDown}\n        onClose={onClose}\n        onOpen={() => setOpen(true)}\n      />\n    </MuiPickersUtilsProvider>\n  );\n}\n\nexport default DateTimePicker;\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport { Select, FormControl, InputLabel } from \"@material-ui/core\";\n\nimport { makeStyles } from \"@material-ui/core/styles\";\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n  },\n  select: {\n    width: \"100%\",\n  },\n}));\n\nexport default function Selection({\n  name,\n  value = \"\",\n  onChange,\n  options,\n  title,\n  className,\n  ...rest\n}) {\n  const classes = useStyles();\n  return (\n    <FormControl className={classnames(classes.formControl, className)}>\n      <InputLabel>{title}</InputLabel>\n      <Select\n        value={value}\n        onChange={(e) => onChange(e.target.value)}\n        name={name}\n        style={{ marginRight: 8 }}\n        classes={{ select: classes.select }}\n        {...rest}\n      >\n        {options &&\n          Array.isArray(options) &&\n          options.map(({ name, title }, index) => (\n            <MenuItem value={name} key={index}>\n              {title}\n            </MenuItem>\n          ))}\n      </Select>\n    </FormControl>\n  );\n}\n","import { useRef } from \"react\";\nimport { dndItemTypes } from \"../utils\";\nimport { useDrag, useDrop } from \"react-dnd\";\n\nconst style = {\n  border: \"1px dashed gray\",\n  padding: \"0.5rem 1rem\",\n  marginBottom: \".5rem\",\n  backgroundColor: \"white\",\n};\n\nconst Card = ({ id, text, index, moveCard, ...props }) => {\n  const ref = useRef(null);\n  const [{ handlerId }, drop] = useDrop({\n    accept: dndItemTypes.ROW,\n    collect(monitor) {\n      return {\n        handlerId: monitor.getHandlerId(),\n      };\n    },\n    hover(item, monitor) {\n      if (!ref.current) {\n        return;\n      }\n      const dragIndex = item.index;\n      const hoverIndex = index;\n      // Don't replace items with themselves\n      if (dragIndex === hoverIndex) {\n        return;\n      }\n      // Determine rectangle on screen\n      const hoverBoundingRect = ref.current?.getBoundingClientRect();\n      // Get vertical middle\n      const hoverMiddleY =\n        (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n      // Determine mouse position\n      const clientOffset = monitor.getClientOffset();\n      // Get pixels to the top\n      const hoverClientY = clientOffset.y - hoverBoundingRect.top;\n      // Only perform the move when the mouse has crossed half of the items height\n      // When dragging downwards, only move when the cursor is below 50%\n      // When dragging upwards, only move when the cursor is above 50%\n      // Dragging downwards\n      if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n        return;\n      }\n      // Dragging upwards\n      if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n        return;\n      }\n      // Time to actually perform the action\n      moveCard(dragIndex, hoverIndex);\n      // Note: we're mutating the monitor item here!\n      // Generally it's better to avoid mutations,\n      // but it's good here for the sake of performance\n      // to avoid expensive index searches.\n      item.index = hoverIndex;\n    },\n  });\n  const [{ isDragging }, drag, preview] = useDrag({\n    type: dndItemTypes.ROW,\n    item: () => {\n      return { id, index };\n    },\n    collect: (monitor) => ({\n      isDragging: monitor.isDragging(),\n    }),\n  });\n  const opacity = isDragging ? 0 : 1;\n  drag(drop(ref));\n  return props.children({\n    preview,\n    ref: ref,\n    style: { ...style, opacity },\n    handlerId,\n  });\n};\n\nexport default Card;\n","import React from \"react\";\nimport Chip from \"@material-ui/core/Chip\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport RightIcon from \"@material-ui/icons/ArrowForward\";\n\nimport Selection from \"./Selection\";\nimport { fetchFields, getModels } from \"../services/api\";\nimport { translate } from \"../utils\";\nimport { excludedFields } from \"../constant\";\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    flexWrap: \"wrap\",\n    listStyle: \"none\",\n    padding: theme.spacing(0.5),\n    margin: 0,\n  },\n  chip: {\n    margin: theme.spacing(0.5),\n  },\n  rightIcon: {\n    width: \"0.8em\",\n    height: \"0.8em\",\n  },\n}));\n\nconst getKey = (key) => (key === \"_selectId\" ? \"id\" : key);\n\nconst getIndex = (value, newValue) => {\n  let index;\n  for (let i = 0; i < value.length; i++) {\n    const element = value[i];\n    const elemIndex = newValue.findIndex((val) => val.name === element.name);\n    if (elemIndex === -1) {\n      index = i;\n      break;\n    }\n  }\n  return index;\n};\n\nfunction MultiSelector(props) {\n  const {\n    sourceModel,\n    value,\n    onChange,\n    parentRow,\n    targetModel,\n    isContext = false,\n    isProcessContext = false,\n    element,\n    isM2o = false,\n    ...rest\n  } = props;\n  const classes = useStyles();\n\n  const getModel = () => {\n    if (Array.isArray(value) && value.length) {\n      const list = value.filter((e) => e.name);\n      const record = list[list.length - 1];\n      if ((isContext || isProcessContext) && list.length - 1 === 0) {\n        return record;\n      }\n      if (\n        record.model === \"com.axelor.meta.db.MetaJsonRecord\" &&\n        record.targetModel\n      ) {\n        return { fullName: record.targetModel };\n      }\n      if (!record.target) {\n        return { fullName: record.model };\n      }\n      return { fullName: record.target };\n    } else {\n      if (sourceModel) {\n        return sourceModel;\n      } else if (parentRow) {\n        return { fullName: parentRow.target };\n      } else if (targetModel) {\n        return targetModel;\n      }\n    }\n  };\n\n  const handleChange = React.useCallback(\n    (newValue, reason) => {\n      if (reason === \"remove-option\") {\n        const index = getIndex(value, newValue);\n        if (index) {\n          newValue.splice(index, newValue.length - 1);\n        }\n      }\n      onChange(newValue);\n    },\n    [value, onChange]\n  );\n\n  const hasValue = () => Array.isArray(value) && value.length;\n  const checkValue = (option) => {\n    const { optionLabelKey, optionValueKey, concatValue, name } = rest;\n    return (option && option.type) === \"metaJsonModel\"\n      ? `${\n          option && option[getKey(optionLabelKey)]\n            ? option[getKey(optionLabelKey)]\n            : \"\"\n        } (Custom model)` || \"\"\n      : name === \"fieldName\"\n      ? `${translate(option && option[\"title\"] ? option[\"title\"] : \"\")} (${\n          option && option[getKey(optionLabelKey)]\n        })`\n      : option\n      ? option[getKey(optionLabelKey)] &&\n        concatValue &&\n        option[getKey(optionValueKey)]\n        ? `${option[getKey(optionLabelKey)] || option[getKey(optionValueKey)]}`\n        : option[getKey(optionLabelKey)]\n        ? option[getKey(optionLabelKey)]\n        : option[\"name\"]\n        ? option[\"name\"]\n        : option[\"id\"]\n        ? option[\"id\"].toString()\n        : \"\"\n      : \"\";\n  };\n  return (\n    <div className={rest.containerClassName}>\n      <Selection\n        title={props.title}\n        isMulti={true}\n        fetchAPI={async () => {\n          if (sourceModel && value && value[0]) {\n            if (value[0].title === \"SOURCE\") {\n              return [];\n            }\n          }\n          let data =\n            isProcessContext && !hasValue()\n              ? await getModels()\n              : isContext && !hasValue()\n              ? await getModels()\n              : await fetchFields(getModel());\n          if (sourceModel && (!value || value.length < 1)) {\n            const object = Object.assign({}, sourceModel, {\n              title: `SOURCE`,\n            });\n            data.splice(0, 0, { ...object });\n          }\n          if (isM2o && value && value.length > 0) {\n            data = data.filter(\n              (item) =>\n                [\"many_to_one\", \"one_to_one\"].includes(\n                  item.type.toLowerCase()\n                ) && !excludedFields.includes(item.name)\n            );\n          }\n          return data;\n        }}\n        value={value}\n        onChange={handleChange}\n        renderTags={(tags, getTagProps) => {\n          return tags.map((tag, i) => (\n            <React.Fragment key={i}>\n              <Chip\n                key={i}\n                title={tag[getKey(rest.optionValueKey)]}\n                label={checkValue(tag)}\n                className={classes.chip}\n                {...getTagProps({ index: i })}\n              />\n              {i < tags.length - 1 && (\n                <RightIcon className={classes.rightIcon} />\n              )}\n            </React.Fragment>\n          ));\n        }}\n        {...rest}\n      />\n    </div>\n  );\n}\n\nexport default MultiSelector;\n","import React, { useState } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Table, IconButton, Tooltip, TextField, Grid } from \"@material-ui/core\";\nimport TableBody from \"@material-ui/core/TableBody\";\nimport TableCell from \"@material-ui/core/TableCell\";\nimport TableHead from \"@material-ui/core/TableHead\";\nimport TableRow from \"@material-ui/core/TableRow\";\nimport Paper from \"@material-ui/core/Paper\";\n\nimport ReorderIcon from \"@material-ui/icons/Reorder\";\nimport { Close, AddRounded } from \"@material-ui/icons\";\n\nimport moment from \"moment\";\nimport { get } from \"lodash\";\n\nimport Selection from \"./components/Selection\";\nimport ModelFieldComponent from \"./components/ModelFieldComponent\";\nimport NumberField from \"./components/NumberInput\";\nimport DateTimePicker from \"./components/DateTimePicker\";\nimport Select from \"./components/Select\";\nimport InputField from \"./components/TextInput\";\nimport Card from \"./components/DndView\";\nimport {\n  fetchFields,\n  getData,\n  getCustomModelByDomain,\n  getNameFieldByDomain,\n  getCustomModelData,\n} from \"./services/api\";\nimport { VALUE_FROM, DATE_FORMAT } from \"./constant\";\nimport { isRelationalField } from \"./utils\";\nimport MultiSelector from \"./components/MultiSelector\";\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    width: \"100%\",\n    overflowX: \"auto\",\n    height: \"calc(100% - 120px)\",\n    overflowY: \"auto\",\n  },\n  table: {\n    minWidth: 650,\n    \"& td\": {\n      padding: \"0px 16px !important\",\n    },\n  },\n  tableRowRoot: {\n    \"&:nth-of-type(odd)\": {\n      backgroundColor: theme.palette.action.hover,\n    },\n    \"& .MuiInput-underline:before\": {\n      borderBottom: 0,\n    },\n  },\n  input: {\n    width: \"100%\",\n  },\n  error: {\n    fontSize: \"0.7em\",\n    position: \"absolute\",\n    paddingTop: 1,\n    color: \"red\",\n    fontWeight: \"bold\",\n  },\n  valueInputContainer: {\n    position: \"relative\",\n  },\n  radioInput: {\n    padding: 4,\n  },\n  iconButton: {\n    // border: '1px solid #0267bf',\n    padding: \"8px\",\n    marginTop: 7,\n  },\n  deleteIcon: {\n    color: \"#0275d8\",\n  },\n  headerTitle: {\n    paddingLeft: 0,\n    textAlign: \"center\",\n  },\n  rightIcon: {\n    width: \"0.8em\",\n    height: \"0.8em\",\n  },\n  addFieldButton: {\n    left: 10,\n    top: 7,\n    textTransform: \"capitalize\",\n  },\n  searchField: {\n    marginLeft: 20,\n    \"&>div\": {\n      marginTop: 10,\n    },\n  },\n}));\n\nconst getType = (row) => {\n  const { type } = row;\n  return type.replace(/-/g, \"_\").toLowerCase();\n};\n\nconst getOptions = (isRoot, parentRow, defaultFrom) => {\n  const options = [\n    { title: \"Self\", id: VALUE_FROM.SELF },\n    { title: \"Context\", id: VALUE_FROM.CONTEXT },\n    { title: \"Expression\", id: VALUE_FROM.NONE },\n    { title: \"Source\", id: VALUE_FROM.SOURCE },\n  ];\n  const from = get(parentRow, \"value.from\", defaultFrom);\n  if (\n    parentRow &&\n    [VALUE_FROM.CONTEXT, VALUE_FROM.SELF, VALUE_FROM.SOURCE].includes(from)\n  ) {\n    options.push({ title: \"Parent\", id: VALUE_FROM.PARENT });\n  }\n  return options;\n};\n\nconst getSelfValue = (row) => {\n  const { selected } = row.value || {};\n  let value;\n  if (selected && typeof selected.value === \"object\") {\n    return selected.value;\n  }\n  if (selected) {\n    value = selected.value;\n  }\n  return { name: value };\n};\n\nconst getExpressionValue = (row) => {\n  const { selected = {} } = row.value || {};\n  if (!selected) {\n    return undefined;\n  }\n  if (isRelationalField(row.type)) {\n    return { [selected.targetName]: selected.value };\n  }\n  return selected.value;\n};\n\nconst getCustomStyle = (row) => {\n  const { subField } = row;\n  const object = {};\n  if (subField) {\n    object[\"borderBottom\"] = \"0px\";\n  }\n  return object;\n};\n\nconst getOptionDisabled = (option, parentRow, sourceModel) => {\n  if (option.id === VALUE_FROM.PARENT) {\n    return !parentRow?.value?.selected;\n  }\n  if (option.id === VALUE_FROM.SOURCE && !sourceModel) {\n    return true;\n  }\n  return false;\n};\n\nconst getParentValueTarget = (row, defaultFrom) => {\n  const { contextModel } = row;\n  const from = get(row, \"value.from\", defaultFrom);\n  if (contextModel && from === \"context\") {\n    return { fullName: contextModel.target };\n  }\n  if ([VALUE_FROM.SELF, VALUE_FROM.SOURCE, VALUE_FROM.PARENT].includes(from)) {\n    const record = getSelfValue(row);\n    return { fullName: record.target };\n  }\n  return {};\n};\n\n/**\n *\n * @param {*} row\n * @param {*} value\n * @param {*} nameField\n *\n * If targetName is available\n * use targetName\n * If nameField is available\n * use nameField\n * If name property is available in value\n * use name as targetName\n * Else use id property as targetName\n */\nconst getTargetName = (row, value, nameField) => {\n  let targetName;\n  if (value && value[row.targetName]) {\n    targetName = row.targetName;\n  }\n  if (!targetName && nameField && value && value[nameField]) {\n    targetName = nameField;\n  }\n  if (!targetName) {\n    const nameValue = value ? value[\"name\"] : null;\n    if (nameValue) {\n      targetName = \"name\";\n    } else {\n      targetName = \"_selectId\";\n    }\n  }\n  return targetName;\n};\n\nfunction RenderRelationalWidget(props) {\n  const { editor, internalProps } = props;\n  const { onChange, value, ...rest } = internalProps;\n  const classes = useStyles();\n  const { field = {} } = rest;\n  const { targetName, target, targetModel } = field;\n  const [nameField, setNameField] = useState(null);\n  const fetchData = async () => {\n    let data = [];\n    if (target === \"com.axelor.meta.db.MetaJsonRecord\" && field[\"domain\"]) {\n      data = await getCustomModelByDomain(field[\"domain\"]);\n      let fieldData = await getNameFieldByDomain(field[\"jsonTarget\"]);\n      setNameField(fieldData && fieldData.name);\n    } else if (field.targetJsonModel) {\n      data = await getCustomModelData(field[\"targetJsonModel.name\"]);\n    } else {\n      data = await getData(target || targetModel);\n    }\n    return data;\n  };\n  const _value = value._selectId ? { ...value, id: value._selectId } : value;\n  return (\n    <Selection\n      name=\"fieldValue\"\n      title=\"Value\"\n      placeholder=\"Value\"\n      fetchAPI={fetchData}\n      isMulti={false}\n      optionValueKey={targetName}\n      optionLabelKey={targetName}\n      onChange={(value) => {\n        onChange({ name: \"fieldValue\", value: value, nameField }, editor);\n      }}\n      value={_value || []}\n      classes={{ root: classes.MuiAutocompleteRoot }}\n    />\n  );\n}\n\nfunction RenderSimpleWidget(props) {\n  const { Component, editor, internalProps } = props;\n  const { onChange, value, value2, classes, style, targetName, ...rest } =\n    internalProps;\n  return (\n    <Component\n      name=\"fieldValue\"\n      onChange={(value) =>\n        onChange({ name: \"fieldValue\", value: value }, editor)\n      }\n      value={value}\n      style={style}\n      {...rest}\n    />\n  );\n}\n\nconst RenderWidget = React.memo(function RenderWidgetMemo({\n  type,\n  operator = \"=\",\n  onChange,\n  value,\n  classes,\n  parentType,\n  editor,\n  ...rest\n}) {\n  const props = {\n    value: value.fieldValue,\n    value2: value.fieldValue2,\n    onChange,\n    ...rest,\n  };\n\n  let options = [],\n    widgetProps = {};\n  switch (type) {\n    case \"one_to_one\":\n    case \"many_to_one\":\n    case \"many_to_many\":\n    case \"one_to_many\":\n    case \"json_one_to_one\":\n    case \"json_many_to_one\":\n    case \"json_many_to_many\":\n    case \"json_one_to_many\":\n      return (\n        <RenderRelationalWidget\n          operator={operator}\n          editor={editor}\n          internalProps={{ ...props, value: value.fieldValue }}\n          parentType={parentType}\n        />\n      );\n    case \"date\":\n    case \"time\":\n    case \"datetime\":\n      const stringToDate = (value) =>\n        value ? moment(value, DATE_FORMAT[type]) : null;\n      return (\n        <RenderSimpleWidget\n          Component={DateTimePicker}\n          operator={operator}\n          editor={editor}\n          internalProps={{\n            type,\n            value: stringToDate(value.fieldValue),\n            onChange: ({ name, value }, index) => {\n              return onChange(\n                { name, value: value && value.format(DATE_FORMAT[type]) },\n                index\n              );\n            },\n            ...rest,\n            margin: \"none\",\n            classes,\n            style: { width: \"250px !important\" },\n          }}\n        />\n      );\n    case \"integer\":\n    case \"long\":\n    case \"decimal\":\n      options =\n        rest.field.selectionList &&\n        rest.field.selectionList.map(({ title, value, data }) => ({\n          name: (data && data.value) || value,\n          title: title,\n        }));\n\n      widgetProps = {\n        Component: options ? Select : NumberField,\n        operator,\n        editor,\n        internalProps: {\n          ...(options\n            ? { options, classes, ...props }\n            : {\n                type,\n                ...props,\n                margin: \"none\",\n                classes,\n                style: { width: \"250px !important\" },\n              }),\n        },\n      };\n      return <RenderSimpleWidget {...widgetProps} />;\n    case \"enum\":\n      options = rest.field.selectionList.map(({ title, value, data }) => ({\n        name: (data && data.value) || value,\n        title: title,\n      }));\n      return (\n        <RenderSimpleWidget\n          Component={Select}\n          operator={operator}\n          editor={editor}\n          internalProps={{\n            options,\n            classes,\n            ...props,\n          }}\n        />\n      );\n    case \"boolean\": {\n      const booleanOptions = [\n        { title: \"Yes\", value: true },\n        { title: \"No\", value: false },\n      ];\n      return (\n        <Selection\n          optionLabelKey=\"title\"\n          optionValueKey=\"value\"\n          options={booleanOptions}\n          value={booleanOptions.find((b) => b.value === value.fieldValue)}\n          onChange={(e) => onChange({ value: e.value })}\n        />\n      );\n    }\n    default:\n      options =\n        rest.field &&\n        rest.field.selectionList &&\n        rest.field.selectionList.map(({ title, value, data }) => ({\n          name: (data && data.value) || value,\n          title: title,\n        }));\n      widgetProps = {\n        Component: options ? Select : InputField,\n        operator,\n        editor,\n        internalProps: {\n          ...(options\n            ? {\n                options,\n                classes,\n                ...props,\n                value: value.fieldValue,\n                className: classes.input,\n              }\n            : {\n                classes,\n                ...props,\n                onBlur: (e) => props.onChange(e.target),\n                margin: \"none\",\n                style: { width: \"100%\" },\n              }),\n        },\n      };\n      return <RenderSimpleWidget {...widgetProps} />;\n  }\n});\n\nfunction DataTable(props) {\n  const classes = useStyles();\n  const {\n    onRowChange,\n    data = [],\n    metaFields = [],\n    onRemove,\n    errors,\n    onClearError,\n    onSubFieldAdd,\n    handleAdd,\n    sourceModel,\n    targetModel,\n    manageFieldClick,\n    handleFieldSearch,\n    onReorder,\n  } = props;\n\n  const getDefaultFrom = React.useCallback(() => {\n    return sourceModel ? VALUE_FROM.SOURCE : VALUE_FROM.NONE;\n  }, [sourceModel]);\n\n  const handleChange = React.useCallback(\n    async (e, key, rowIndex, row) => {\n      const value = e.target.value;\n      const nameField = e.target.nameField;\n      if (errors && errors[row.dataPath] && value) {\n        onClearError(row.dataPath);\n      }\n      let path = key;\n      let selectedValue = value;\n      const from = get(row, \"value.from\", getDefaultFrom());\n      if (key === \"value\") {\n        path = `${key}.selected`;\n        let _value = value;\n        let targetName = value\n          ? getTargetName(row, value, nameField)\n          : get(row, \"value.selected.targetName\");\n        if (\n          isRelationalField(row.type) &&\n          (!from || from === VALUE_FROM.NONE) &&\n          typeof _value === \"object\"\n        ) {\n          if (targetName === \"_selectId\") {\n            _value = value[\"id\"];\n          } else {\n            _value = value[targetName];\n          }\n        }\n        // if (row.from === 'self' && typeof _value === 'object') {\n        //   _value = value['name'];\n        // }\n        selectedValue = {\n          value: _value,\n        };\n\n        if (from === VALUE_FROM.NONE && isRelationalField(row.type)) {\n          selectedValue.targetName = targetName;\n        }\n      }\n      if (\n        [\"contextModel\", \"sourceField\", \"selfField\"].includes(key) ||\n        ([VALUE_FROM.SELF, VALUE_FROM.SOURCE, VALUE_FROM.PARENT].includes(\n          from\n        ) &&\n          key === \"value\")\n      ) {\n        onRowChange && onRowChange(row, rowIndex, \"modelSubField\", []);\n      }\n      onRowChange && onRowChange(row, rowIndex, path, selectedValue);\n    },\n    [onRowChange, errors, onClearError, getDefaultFrom]\n  );\n\n  const handleRemove = React.useCallback(\n    (row) => {\n      onRemove && onRemove(row);\n    },\n    [onRemove]\n  );\n\n  const renderRow = React.useCallback(\n    (row, index, level = 0, parentRow) => {\n      if (row.isRemoved || row.isHidden) {\n        return null;\n      }\n      const from = get(row, \"value.from\", getDefaultFrom());\n      return (\n        <Card index={index} key={row.name} id={row.name} moveCard={onReorder}>\n          {({ ref, style, handlerId, preview }) => (\n            <TableRow\n              data-handler-id={handlerId}\n              ref={preview}\n              style={{ ...style }}\n              classes={{ root: classes.tableRowRoot }}\n            >\n              <TableCell align=\"left\" ref={ref} style={{ cursor: \"move\" }}>\n                <div>\n                  <ReorderIcon />\n                </div>\n              </TableCell>\n              <TableCell\n                style={{\n                  ...getCustomStyle(row),\n                }}\n              >\n                <ModelFieldComponent\n                  name=\"name\"\n                  className={classes.input}\n                  item={row}\n                  onChange={(e) => handleChange(e, \"name\", index)}\n                  onSubFieldAdd={onSubFieldAdd}\n                  handleAdd={handleAdd}\n                  onSubFieldChange={(e) => {\n                    handleChange(e, \"subFieldName\", index);\n                  }}\n                />\n              </TableCell>\n              <TableCell>=</TableCell>\n\n              <TableCell\n                style={{ ...getCustomStyle(row) }}\n                className={classes.valueInputContainer}\n              >\n                {from === VALUE_FROM.SELF ? (\n                  <MultiSelector\n                    optionValueKey=\"name\"\n                    optionLabelKey=\"title\"\n                    concatValue={true}\n                    parentRow={parentRow}\n                    targetModel={targetModel}\n                    value={row.modelSubField}\n                    onChange={(e) =>\n                      handleChange(\n                        { target: { value: e } },\n                        \"modelSubField\",\n                        index,\n                        row\n                      )\n                    }\n                  />\n                ) : from === VALUE_FROM.SOURCE ? (\n                  <MultiSelector\n                    optionValueKey=\"name\"\n                    optionLabelKey=\"title\"\n                    concatValue={true}\n                    sourceModel={sourceModel}\n                    value={row.modelSubField}\n                    onChange={(e) =>\n                      handleChange(\n                        { target: { value: e } },\n                        \"modelSubField\",\n                        index,\n                        row\n                      )\n                    }\n                  />\n                ) : from === VALUE_FROM.PARENT ? (\n                  <Selection\n                    optionValueKey=\"name\"\n                    optionLabelKey=\"title\"\n                    concatValue={true}\n                    options={metaFields}\n                    fetchAPI={() =>\n                      fetchFields(\n                        getParentValueTarget(parentRow, getDefaultFrom())\n                      )\n                    }\n                    value={getSelfValue(row)}\n                    onChange={(e) =>\n                      handleChange(\n                        { target: { value: e } },\n                        \"value\",\n                        index,\n                        row\n                      )\n                    }\n                  />\n                ) : from === VALUE_FROM.CONTEXT ? (\n                  <MultiSelector\n                    optionValueKey=\"name\"\n                    optionLabelKey=\"title\"\n                    concatValue={true}\n                    isContext={true}\n                    value={row.modelSubField}\n                    onChange={(e) =>\n                      handleChange(\n                        { target: { value: e } },\n                        \"modelSubField\",\n                        index,\n                        row\n                      )\n                    }\n                  />\n                ) : (\n                  <RenderWidget\n                    row={row}\n                    type={getType(row)}\n                    onChange={(e, editor) => {\n                      handleChange({ target: e }, \"value\", index, row);\n                    }}\n                    value={{\n                      fieldValue: getExpressionValue(row),\n                      fieldValue2: \"\",\n                    }}\n                    classes={classes}\n                    field={row.subFieldName || row}\n                  />\n                )}\n                {/* {getError(errors, row) && (\n                <Typography className={classes.error}>\n                  {getError(errors, row)}\n                </Typography>\n              )} */}\n              </TableCell>\n              <TableCell style={{ ...getCustomStyle(row) }} size=\"small\">\n                <Selection\n                  disableClearable\n                  options={getOptions(level === 0, parentRow, getDefaultFrom())}\n                  value={from || getDefaultFrom()}\n                  getOptionDisabled={(option) =>\n                    getOptionDisabled(option, parentRow, sourceModel)\n                  }\n                  onChange={(e) =>\n                    handleChange(\n                      { target: { value: e } },\n                      \"value.from\",\n                      index,\n                      row\n                    )\n                  }\n                />\n              </TableCell>\n              {/* <TableCell style={{ ...getCustomStyle(row) }}> */}\n              {/* {showSubField(row) && (\n                <>\n                  {\n                    row.modelSubField.map((field, i) => (\n                      <Selection\n                        name=\"metaModalField\"\n                        title=\"Model Field\"\n                        placeholder=\"Model field\"\n                        optionValueKey=\"name\"\n                        optionLabelKey=\"name\"\n                        fetchAPI={() => fetchFields(getSubFieldModel(row, field, i))}\n                        value={field}\n                        onChange={(e) =>\n                          handleChange(\n                            { target: { value: e } },\n                            'modelSubField',\n                            index,\n                            row\n                          )\n                        }\n                      />\n                    ))\n                  }\n                </>\n              )} */}\n              {/* {\n                showSubField(row, getDefaultFrom()) &&\n                <SubFieldComponent \n                  row={row}\n                  data={row.modelSubField}\n                  defaultFrom={getDefaultFrom()}\n                  onChange={(e) => handleChange(\n                    { target: { value: e } },\n                    'modelSubField',\n                    index,\n                    row\n                  )}\n                />\n              }\n            </TableCell> */}\n              <TableCell\n                style={\n                  row.level !== undefined\n                    ? { borderBottom: \"0px\", ...getCustomStyle(row) }\n                    : { ...getCustomStyle(row) }\n                }\n              >\n                <IconButton\n                  size=\"medium\"\n                  onClick={() => handleRemove(row)}\n                  className={classes.iconButton}\n                >\n                  <Tooltip title={\"Remove field\"}>\n                    <Close fontSize=\"small\" className={classes.deleteIcon} />\n                  </Tooltip>\n                </IconButton>\n              </TableCell>\n            </TableRow>\n          )}\n        </Card>\n      );\n    },\n    [\n      classes,\n      handleRemove,\n      handleChange,\n      metaFields,\n      onSubFieldAdd,\n      handleAdd,\n      sourceModel,\n      getDefaultFrom,\n      targetModel,\n      onReorder,\n    ]\n  );\n  return (\n    <Paper className={classes.root}>\n      <Grid container style={{ backgroundColor: \"#FAFAFA\" }}>\n        <IconButton\n          variant=\"contained\"\n          color=\"primary\"\n          startIcon={<AddRounded />}\n          className={classes.addFieldButton}\n          onClick={manageFieldClick}\n          title=\"Manage Fields\"\n        >\n          <AddRounded />\n        </IconButton>\n        <TextField\n          classes={{ root: classes.searchField }}\n          placeholder=\"Search fields\"\n          onChange={(e) => handleFieldSearch(e)}\n        />\n      </Grid>\n      <Table\n        className={classes.table}\n        aria-label=\"simple table\"\n        stickyHeader={true}\n      >\n        <colgroup>\n          <col style={{ width: \"3%\" }} />\n          <col style={{ width: \"27%\", minWidth: 300 }} />\n          <col style={{ width: \"15px\" }} />\n          <col style={{ width: \"50%\", minWidth: 200 }} />\n          <col style={{ width: \"210px\", minWidth: 230 }} />\n          <col style={{ width: \"5%\" }} />\n        </colgroup>\n        <TableHead>\n          <TableRow>\n            <TableCell align=\"left\">&nbsp;</TableCell>\n            <TableCell className={classes.headerTitle}>Field name</TableCell>\n            <TableCell className={classes.headerTitle}></TableCell>\n            <TableCell className={classes.headerTitle}>Value</TableCell>\n            <TableCell className={classes.headerTitle}>Value from</TableCell>\n            <TableCell className={classes.headerTitle}></TableCell>\n          </TableRow>\n        </TableHead>\n        <TableBody>{data.map((row, index) => renderRow(row, index))}</TableBody>\n      </Table>\n    </Paper>\n  );\n}\n\nexport default DataTable;\n","import React from 'react';\nimport produce from 'immer';\n\nconst StoreContext = React.createContext();\n\nfunction useMutableState(defaultValue) {\n  const [state, setState] = React.useState(defaultValue);\n  return [\n    state,\n    React.useCallback((updater) => setState(produce(updater)), [setState]),\n  ];\n}\n\nfunction StoreProvider({ children }) {\n  const [state, setState] = useMutableState({\n    builderFields: [],\n  });\n\n  const value = {\n    state,\n    update: setState,\n  };\n  return (\n    <StoreContext.Provider value={value}>{children}</StoreContext.Provider>\n  );\n}\n\nexport function useStore() {\n  return React.useContext(StoreContext);\n}\n\nexport function useStoreState() {\n  const { state } = React.useContext(StoreContext);\n  return state;\n}\n\nexport function useWidget(id) {\n  const { widgets } = useStore();\n  return widgets[id];\n}\n\nexport default StoreProvider;\n","import React from \"react\";\nimport {\n  Grid,\n  Button,\n  Typography,\n  CircularProgress,\n  Switch,\n  Paper,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  DialogContentText,\n} from \"@material-ui/core\";\nimport AddIcon from \"@material-ui/icons/Add\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Selection from \"./components/Selection\";\nimport DataTable from \"./DataTable\";\nimport {\n  getMetaModels,\n  fetchFields,\n  fetchModelByName,\n  fetchCustomFields,\n  generateScriptString,\n} from \"./services/api\";\nimport { generateJson } from \"./generator\";\nimport {\n  excludeFields,\n  generatePath,\n  upperCaseFirstLetter,\n  isCustomTarget,\n  useDebounce,\n} from \"./utils\";\nimport { ModelType, VALUE_FROM } from \"./constant\";\nimport { useStore } from \"./store/context\";\nimport { set, get } from \"lodash\";\nimport FieldPopover from \"./components/FieldPopover\";\nimport MultiSelector from \"./components/MultiSelector\";\n\nconst useStyles = makeStyles((theme) => ({\n  table: {\n    minWidth: 650,\n  },\n  input: {\n    width: \"13%\",\n    marginRight: 20,\n  },\n  metaFieldGrid: {\n    flex: 1,\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: \"center\",\n  },\n  newRecordSwitch: {\n    marginTop: 2,\n  },\n  newRecordSwitchText: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: \"center\",\n  },\n  newRecordInputView: {\n    display: \"flex\",\n    flexDirection: \"row\",\n    marginTop: 5,\n  },\n  modelFieldSelection: {\n    // width: '30%',\n    marginRight: 20,\n    marginLeft: 50,\n  },\n  addModelFieldIcon: {\n    marginLeft: 15,\n  },\n  saveButton: {\n    marginLeft: 10,\n  },\n  cardContent: {\n    overflow: \"auto\",\n    height: 600,\n  },\n  cardContentItemText: {\n    lineHeight: 3,\n  },\n  cardActionView: {\n    justifyContent: \"flex-end\",\n  },\n  capitalizeText: {\n    textTransform: \"capitalize\",\n  },\n  saveButtonText: {\n    marginLeft: 10,\n  },\n  saveMessageAlert: {\n    width: \"100%\",\n    marginBottom: 10,\n    display: \"flex\",\n    justifyContent: \"space-between\",\n  },\n  topView: {\n    margin: \"10px 10px 0px 10px\",\n  },\n  searchField: {\n    flexDirection: \"row\",\n    width: \"12%\",\n    \"& input\": {\n      paddingBottom: 0,\n    },\n  },\n  loaderView: {\n    position: \"absolute\",\n    left: 0,\n    right: 0,\n    top: 0,\n    bottom: 0,\n    height: \"100%\",\n    backgroundColor: \"rgba(0,0,0,0.2)\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    zIndex: \"999\",\n  },\n  paper: {\n    margin: theme.spacing(1),\n    width: `calc(100% - 16px)`,\n    display: \"flex\",\n    height: \"calc(100% - 50px)\",\n    overflow: \"hidden\",\n  },\n  dialogPaper: {\n    maxWidth: \"100%\",\n    maxHeight: \"100%\",\n    resize: \"both\",\n    width: \"100%\",\n    height: \"90%\",\n  },\n  root: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"flex-start\",\n    height: \"100%\",\n    overflow: \"hidden\",\n  },\n  save: {\n    margin: theme.spacing(1),\n    backgroundColor: \"#0275d8\",\n    borderColor: \"#0267bf\",\n    color: \"white\",\n    \"&:hover\": {\n      backgroundColor: \"#025aa5\",\n      borderColor: \"#014682\",\n      color: \"white\",\n    },\n  },\n  selectContainer: {\n    minWidth: 150,\n  },\n  targetModelInputRoot: {\n    marginTop: \"22px !important\",\n  },\n}));\n\nconst getDefaultFrom = (sourceModel) => {\n  return sourceModel ? VALUE_FROM.SOURCE : VALUE_FROM.NONE;\n};\n\nconst getSourceModelString = (list) => {\n  let string = \"\";\n  list.forEach((item) => {\n    if (string === \"\") {\n      string = item.name;\n    } else {\n      string = `${string}.${item.name}`;\n    }\n  });\n  return string;\n};\n\nconst getFieldValue = (value) => {\n  return value;\n};\n\nconst getCustomTarget = (item) => {\n  if (item.targetJsonModel) {\n    return item.targetJsonModel.id;\n  }\n  return item.targetModel;\n};\n\nconst getModelSubField = (fields) => {\n  if (fields) {\n    const newFields = fields.filter((f) => Object.keys(f).length > 0);\n    return newFields;\n  }\n  return fields;\n};\n\nconst getFieldInfo = (item) => {\n  if (item.target && !isCustomTarget(item.target)) {\n    return { ...item, fullName: item.target };\n  } else {\n    if (item.targetModel) {\n      // refers to base model\n      return { ...item, fullName: item.targetModel };\n    }\n    return { ...item, modelType: ModelType.CUSTOM, name: item.jsonTarget };\n  }\n};\n\nconst getContextValue = (value, from) => {\n  let contextValue = {};\n  let newValue = value;\n  if (value && value?.selected && value?.selected?.value) {\n    const splitedValue = `${value.selected.value}`.split(\".\");\n    // const modelSubField = getModelFields(splitedValue);\n    if (from === VALUE_FROM.CONTEXT) {\n      const contextModel = { name: upperCaseFirstLetter(splitedValue[0]) };\n      return { contextModel };\n    }\n    if (from === VALUE_FROM.SELF) {\n      newValue.selected = { ...newValue.selected, value: splitedValue[0] };\n      return { value: newValue };\n    }\n  }\n  return contextValue;\n};\n\nconst findFields = (item, jsonData = []) => {\n  let field = jsonData.find((f) => f.name === item.name);\n  if (!field) {\n    for (let i = 0; i < jsonData.length; i++) {\n      const jsonField = jsonData[i];\n      const fields = get(jsonField, \"value.fields\");\n      if (fields) {\n        field = findFields(item, fields);\n        if (field) {\n          break;\n        }\n      }\n    }\n  }\n  return field;\n};\n\nconst getNewBuilderFields = (fields, searchText) => {\n  return fields.map((field) => {\n    let newField = { ...field };\n    let hasChildrenShow = false;\n    if (newField.value && newField.value.fields) {\n      const newFieldlist = getNewBuilderFields(\n        newField.value.fields,\n        searchText\n      );\n      hasChildrenShow =\n        newFieldlist.findIndex((f) => f.isHidden === false) !== -1;\n      newField = {\n        ...newField,\n        value: {\n          ...newField.value,\n          fields: newFieldlist,\n        },\n      };\n    }\n    if (\n      !field.name.toLowerCase().includes(searchText.toLowerCase()) &&\n      !hasChildrenShow\n    ) {\n      newField.isHidden = true;\n    } else {\n      newField.isHidden = false;\n    }\n    return newField;\n  });\n};\n\nconst clearChildrenParentValue = ({\n  fields = [],\n  from = VALUE_FROM.PARENT,\n  shouldChangeFrom = true,\n}) => {\n  return fields.map((field) => {\n    let newField = { ...field };\n    const newFieldFrom = get(newField, \"value.from\");\n    if (newFieldFrom === from) {\n      if (shouldChangeFrom) {\n        newField.value.from = VALUE_FROM.NONE;\n      }\n      if (newField.value && newField.value.selected) {\n        newField = Object.assign(\n          {},\n          {\n            ...newField,\n            value: {\n              ...newField.value,\n              selected: {\n                ...newField.value.selected,\n                value: null,\n              },\n            },\n          }\n        );\n      }\n      newField.modelSubField = [];\n    }\n    if (newField.value && newField.value.fields) {\n      const fields = [\n        ...clearChildrenParentValue({\n          fields: newField.value.fields,\n          from,\n          shouldChangeFrom,\n        }),\n      ];\n      newField = Object.assign(\n        {},\n        {\n          ...newField,\n          value: {\n            ...newField.value,\n            fields,\n          },\n        }\n      );\n    }\n    return newField;\n  });\n};\n\nfunction Builder({ params, onSave, handleClose, open, bpmnModeler }) {\n  const classes = useStyles();\n  const { state, update } = useStore();\n  const { builderFields } = state;\n  const [model, setModel] = React.useState();\n  const [sourceModel, setSourceModel] = React.useState();\n  const [sourceModelList, setSourceModelList] = React.useState([]);\n  const [loading, setLoading] = React.useState(false);\n  const [newRecord, setNewRecord] = React.useState(false);\n  const [modelFieldMap, setModelFieldMap] = React.useState({});\n  const [metaFields, setMetaFields] = React.useState([]);\n  const [errors, setErrors] = React.useState({});\n  const [manageField, setManageField] = React.useState(false);\n  const [openAlert, setAlert] = React.useState(false);\n  const [alertConfig, setAlertConfig] = React.useState({\n    alertMessage: \"Add all values\",\n    alertTitle: \"Error\",\n  });\n  const [isClose, setClose] = React.useState(false);\n\n  const setBuilderFields = React.useCallback(\n    (fields) => {\n      update((draft) => {\n        set(draft, \"builderFields\", fields);\n      });\n    },\n    [update]\n  );\n\n  const handleRowChange = React.useCallback(\n    (row, rowIndex, key, value) => {\n      update((draft) => {\n        const recordIndex = draft.builderFields.findIndex(\n          (f) => f.name === row.name\n        );\n        const record = draft.builderFields[recordIndex];\n\n        if (\n          key === \"value.from\" &&\n          [VALUE_FROM.CONTEXT, VALUE_FROM.SELF].includes(\n            get(record, \"value.from\")\n          )\n        ) {\n          const prevFields = get(record, \"value.fields\", []);\n          if (prevFields.length) {\n            const fields = clearChildrenParentValue({ fields: prevFields });\n            set(draft.builderFields, `[${recordIndex}].value.fields`, fields);\n          }\n        }\n        if (\n          key === \"value.selected\" &&\n          [VALUE_FROM.CONTEXT, VALUE_FROM.SELF].includes(\n            get(record, \"value.from\")\n          )\n        ) {\n          const prevFields = get(record, \"value.fields\", []);\n          if (prevFields.length) {\n            const fields = clearChildrenParentValue({\n              fields: prevFields,\n              shouldChangeFrom: false,\n            });\n            set(draft.builderFields, `[${recordIndex}].value.fields`, fields);\n          }\n        }\n        set(draft.builderFields, `[${recordIndex}].${key}`, value);\n      });\n    },\n    [update]\n  );\n  const handleRowRemove = React.useCallback(\n    (row) => {\n      update((draft) => {\n        const index = draft.builderFields.findIndex((f) => f.name === row.name);\n        if (index !== -1) {\n          draft.builderFields[index].isRemoved = true;\n        }\n      });\n    },\n    [update]\n  );\n\n  const handleSubFieldAdd = React.useCallback(\n    async (item, expand) => {\n      // const oldFields = [...draft.builderFields];\n      if (expand) {\n        const target = item.target || getCustomTarget(item);\n        let fields = modelFieldMap[target];\n        const builder = JSON.parse(params.resultMetaField || \"{}\");\n        const builderJSONFields = get(builder, \"fields\", []);\n        if (!modelFieldMap[target]) {\n          if (model.modelType === ModelType.CUSTOM) {\n            fields = await fetchCustomFields({ ...item });\n          } else {\n            fields = await fetchFields(getFieldInfo(item));\n          }\n          setModelFieldMap({ [target]: fields });\n          const dataPath = `${item.dataPath}.value.fields`;\n          const newFields = [];\n\n          const builderField = findFields(item, builderJSONFields);\n          const jsonFieldList = get(builderField, \"value.fields\", []);\n\n          excludeFields(fields).forEach((field, i) => {\n            const jsonField =\n              jsonFieldList.find((f) => f.name === field.name) || {};\n            const value = getFieldValue(jsonField.value);\n            const from = get(jsonField, \"value.from\");\n\n            const contextValue = getContextValue(value, from);\n\n            newFields.push({\n              ...field,\n              dataPath: `${dataPath}[${i}]`,\n              from,\n              value,\n              hideFields: true,\n              isRemoved: true,\n              modelSubField: jsonField.modelSubField,\n              ...contextValue,\n            });\n          });\n          update((draft) => {\n            set(\n              draft.builderFields,\n              `${item.dataPath}.value.fields`,\n              newFields\n            );\n            set(draft.builderFields, `${item.dataPath}.hideFields`, false);\n          });\n          // const newFields = updateBuilderFields(oldFields, item, excludeFields(fields));\n          // setBuilderFields([...newFields]);\n        } else {\n          const newFields = [];\n          const dataPath = `${item.dataPath}.value.fields`;\n          const builderField = findFields(item, builderJSONFields);\n          const jsonFieldList = get(builderField, \"value.fields\", []);\n          excludeFields(fields).forEach((field, i) => {\n            const jsonField =\n              jsonFieldList.find((f) => f.name === field.name) || {};\n            const value = getFieldValue(jsonField.value);\n            const from = get(jsonField, \"value.from\");\n            const contextValue = getContextValue(value, from);\n            newFields.push({\n              ...field,\n              dataPath: `${dataPath}[${i}]`,\n              from,\n              value,\n              hideFields: true,\n              isRemoved: false,\n              modelSubField: jsonField.modelSubField,\n              ...contextValue,\n            });\n          });\n          update((draft) => {\n            set(\n              draft.builderFields,\n              `${item.dataPath}.value.fields`,\n              newFields\n            );\n            set(draft.builderFields, `${item.dataPath}.hideFields`, false);\n          });\n          // const newFields = showHideBuilderFields(oldFields, item, false);\n          // setBuilderFields([...newFields]);\n        }\n      } else {\n        update((draft) => {\n          set(draft.builderFields, `${item.dataPath}.hideFields`, true);\n        });\n        // hide fields from builder field\n        // const newFields = showHideBuilderFields(oldFields, item, true);\n        // setBuilderFields([...newFields]);\n      }\n    },\n    [model, modelFieldMap, update, params]\n  );\n\n  const handleAdd = React.useCallback(\n    (rows) => {\n      update((draft) => {\n        rows.forEach((row) => {\n          set(draft.builderFields, `${row.dataPath}.isRemoved`, false);\n        });\n      });\n    },\n    [update]\n  );\n\n  const getBuilderFields = React.useCallback(\n    async (data, _builderRecord = {}) => {\n      const builder = JSON.parse(params.resultMetaField || \"{}\");\n      const jsonData = get(builder, \"fields\", []);\n      const newFields = new Array(jsonData.length);\n      excludeFields([...data]).forEach((field, index) => {\n        const jsonFieldIndex = jsonData.findIndex((f) => f.name === field.name);\n        const jsonField = jsonData[jsonFieldIndex] || {};\n\n        const value = getFieldValue(jsonField.value);\n        const from = get(jsonField, \"value.from\");\n        // get(jsonData, `${field.name}.from`);\n        const contextValue = getContextValue(value, from);\n\n        const obj = {\n          ...field,\n          path: generatePath(field),\n          from,\n          value,\n          hideFields: true,\n          isRemoved: value ? false : true,\n          modelSubField: getModelSubField(jsonField.modelSubField),\n          selfField: jsonField.selfField,\n          sourceField: jsonField.sourceField,\n          processId: jsonField.processId ? { name: jsonField.processId } : null,\n          ...contextValue,\n        };\n        if (jsonFieldIndex !== -1) {\n          obj.dataPath = `[${jsonFieldIndex}]`;\n          newFields.splice(jsonFieldIndex, 1, { ...obj });\n        } else {\n          obj.dataPath = `[${newFields.length}]`;\n          newFields.push({ ...obj });\n        }\n      });\n      // const builder = JSON.parse(_builderRecord[params.resultMetaField] || '{}');\n      // const newFields = getAssignmentFields(jsonData, fields);\n      update((draft) => {\n        set(\n          draft,\n          \"builderFields\",\n          newFields.filter((e) => e)\n        );\n      });\n      // setBuilderFields(newFields);\n    },\n    [params, update]\n  );\n\n  const getMetaFields = React.useCallback(\n    async (model, _builderRecord) => {\n      if (model) {\n        const data = await fetchFields(model);\n        setMetaFields([...data]);\n        setErrors({});\n        getBuilderFields(data, _builderRecord);\n      }\n    },\n    [getBuilderFields]\n  );\n\n  const handleClearError = React.useCallback((path) => {\n    setErrors((err) => {\n      return JSON.parse(JSON.stringify(set(err, path, undefined)));\n    });\n  }, []);\n\n  const getJSON = React.useCallback(() => {\n    const currentJson = JSON.parse(params.resultMetaField || \"{}\");\n    const jsonFields = generateJson(\n      builderFields,\n      currentJson,\n      getDefaultFrom(sourceModel),\n      sourceModel\n    );\n    const sourceModelString = getSourceModelString(sourceModelList);\n    const json = {\n      fields: jsonFields,\n      targetModel: model && model.name,\n      sourceModel:\n        !sourceModelString || sourceModelString === \"\"\n          ? undefined\n          : sourceModelString,\n      sourceModelList,\n      newRecord,\n      isJson: (model && model.modelType) === ModelType.CUSTOM,\n    };\n    return json;\n  }, [builderFields, model, newRecord, sourceModel, sourceModelList, params]);\n\n  const handleSave = React.useCallback(async () => {\n    setErrors({});\n    const json = getJSON();\n    const jsonQuery = JSON.stringify({ ...json });\n    if (!model) {\n      onSave(undefined);\n      return;\n    }\n    let _model = params.model;\n    if (!_model) {\n      if (model.modelType === \"CUSTOM\") {\n        _model = \"com.axelor.meta.db.MetaJsonRecord\";\n      } else {\n        _model = model.fullName;\n      }\n    }\n    const scriptString = await generateScriptString(jsonQuery, _model);\n    const record = {\n      resultMetaField: jsonQuery,\n      resultField: scriptString,\n      targetField: json.targetModel,\n      sourceField: json.sourceModel,\n    };\n    onSave(record);\n  }, [params, model, onSave, getJSON]);\n\n  const onCancel = () => {\n    const jsonData = JSON.parse(params.resultMetaField || \"{}\");\n    const currentJson = getJSON();\n    if (\n      !(currentJson && currentJson.targetModel) ||\n      JSON.stringify(jsonData) === JSON.stringify(currentJson)\n    ) {\n      handleClose();\n      return;\n    }\n    setClose(true);\n    setAlert(true);\n    setAlertConfig({\n      alertMessage:\n        \"Current changes will be lost. Do you really want to proceed?\",\n      alertTitle: \"Question\",\n    });\n  };\n\n  const handleModelSelect = React.useCallback(\n    async (e) => {\n      setModel(e);\n      getMetaFields(e);\n    },\n    [getMetaFields]\n  );\n\n  const searchField = React.useCallback(\n    (searchText) => {\n      const fields = getNewBuilderFields(builderFields, searchText);\n      setBuilderFields([...fields]);\n    },\n    [builderFields, setBuilderFields]\n  );\n\n  const delayFetch = useDebounce(searchField, 400);\n\n  const handleFieldSearch = React.useCallback(\n    (e) => {\n      const searchText = e.target.value;\n      delayFetch(searchText);\n    },\n    [delayFetch]\n  );\n\n  const handleManageFieldClick = React.useCallback(() => {\n    setManageField(true);\n  }, []);\n\n  const handleCloseManageField = React.useCallback(() => {\n    setManageField(false);\n  }, []);\n\n  const handleReorder = React.useCallback(\n    (dragIndex, hoverIndex) => {\n      update((draft) => {\n        const item = draft.builderFields[dragIndex];\n        draft.builderFields.splice(dragIndex, 1);\n        draft.builderFields.splice(hoverIndex, 0, item);\n      });\n    },\n    [update]\n  );\n\n  React.useEffect(() => {\n    async function init() {\n      if (!params) return;\n      const jsonData = JSON.parse(params.resultMetaField || \"{}\");\n      if (jsonData && params.resultMetaField) {\n        setLoading(true);\n        const modelResult = await fetchModelByName(jsonData.targetModel);\n        const lastSourceModel = jsonData.sourceModelList\n          ? jsonData.sourceModelList[jsonData.sourceModelList.length - 1] || {}\n          : {};\n        const sourceModelName = lastSourceModel.target\n          ? lastSourceModel.target.split(\".\").pop()\n          : lastSourceModel.name;\n        const sourceModelResult = await fetchModelByName(sourceModelName);\n        setSourceModelList([...(jsonData.sourceModelList || [])]);\n        setModel(modelResult);\n        setSourceModel(sourceModelResult);\n        setNewRecord(jsonData.newRecord);\n        getMetaFields(modelResult);\n        setLoading(false);\n      }\n    }\n    init();\n  }, [params, getMetaFields]);\n\n  return (\n    <Dialog\n      onClose={(e, reason) => {\n        if (reason !== \"backdropClick\") {\n          handleClose();\n        }\n      }}\n      aria-labelledby=\"simple-dialog-title\"\n      open={open}\n      classes={{\n        paper: classes.dialogPaper,\n      }}\n    >\n      <DialogTitle id=\"simple-dialog-title\">Script</DialogTitle>\n      <div className={classes.root}>\n        <Paper variant=\"outlined\" className={classes.paper}>\n          <div style={{ height: \"100%\", width: \"100%\" }}>\n            <>\n              <Grid container style={{ height: \"100%\" }}>\n                <Grid container className={classes.topView}>\n                  <Grid\n                    container\n                    justify=\"space-between\"\n                    style={{ marginBottom: 10 }}\n                  >\n                    <Grid item className={classes.metaFieldGrid}>\n                      <Grid container>\n                        <FieldPopover\n                          data={builderFields}\n                          onSubmit={(data) => handleAdd(data)}\n                          icon={<AddIcon />}\n                          buttonTitle=\"Add Fields\"\n                          iconButton={true}\n                          buttonClassName={classes.modelFieldSelection}\n                          iconButtonClassName={classes.addModelFieldIcon}\n                          open={manageField}\n                          onClose={handleCloseManageField}\n                        />\n                      </Grid>\n                    </Grid>\n                  </Grid>\n                  <Grid\n                    container\n                    style={{ marginBottom: 10, alignItems: \"flex-end\" }}\n                  >\n                    <Selection\n                      className={classes.input}\n                      name=\"metaModal\"\n                      title=\"Target Model\"\n                      placeholder=\"Target Model\"\n                      fetchAPI={(e) => getMetaModels(e)}\n                      optionLabelKey=\"name\"\n                      onChange={(e) => handleModelSelect(e)}\n                      value={model}\n                      inputRootClass={classes.targetModelInputRoot}\n                    />\n                    <MultiSelector\n                      containerClassName={classes.selectContainer}\n                      title=\"Source Model\"\n                      optionValueKey=\"name\"\n                      optionLabelKey=\"name\"\n                      concatValue={true}\n                      isM2o={true}\n                      isContext={true}\n                      value={sourceModelList}\n                      onChange={(e) => {\n                        const list = e.map((item) => {\n                          if (!item.fullName && item.target) {\n                            return { ...item, fullName: item.target };\n                          }\n                          return item;\n                        });\n                        setSourceModelList([...list]);\n                        setSourceModel({ ...list[list.length - 1] });\n                      }}\n                    />\n                    <Grid item className={classes.newRecordInputView}>\n                      <Switch\n                        className={classes.newRecordSwitch}\n                        checked={newRecord}\n                        onChange={(e) => setNewRecord(e.target.checked)}\n                      />\n                      <Typography className={classes.newRecordSwitchText}>\n                        New Record\n                      </Typography>\n                    </Grid>\n                  </Grid>\n                </Grid>\n                <DataTable\n                  builderFields={builderFields}\n                  data={builderFields}\n                  onRowChange={handleRowChange}\n                  onRemove={handleRowRemove}\n                  metaFields={metaFields}\n                  errors={errors}\n                  onClearError={handleClearError}\n                  onSubFieldAdd={handleSubFieldAdd}\n                  handleAdd={handleAdd}\n                  sourceModel={sourceModel}\n                  targetModel={model}\n                  bpmnModeler={bpmnModeler}\n                  manageFieldClick={handleManageFieldClick}\n                  handleFieldSearch={handleFieldSearch}\n                  onReorder={handleReorder}\n                />\n              </Grid>\n              {loading && (\n                <div className={classes.loaderView}>\n                  <CircularProgress size={32} />\n                </div>\n              )}\n            </>\n          </div>\n        </Paper>\n        <div>\n          <Button className={classes.save} onClick={handleSave}>\n            OK\n          </Button>\n          <Button\n            className={classes.save}\n            onClick={onCancel}\n            style={{ textTransform: \"none\" }}\n          >\n            Cancel\n          </Button>\n        </div>\n      </div>\n      {openAlert && (\n        <Dialog\n          open={openAlert}\n          onClose={(e, reason) => {\n            if (reason !== \"backdropClick\") {\n              setAlert(false);\n            }\n          }}\n          aria-labelledby=\"alert-dialog-title\"\n          aria-describedby=\"alert-dialog-description\"\n          classes={{\n            paper: classes.dialog,\n          }}\n        >\n          <DialogTitle id=\"alert-dialog-title\">\n            {alertConfig.alertTitle}\n          </DialogTitle>\n          <DialogContent>\n            <DialogContentText id=\"alert-dialog-description\">\n              {alertConfig.alertMessage}\n            </DialogContentText>\n          </DialogContent>\n          <DialogActions>\n            <Button\n              onClick={() => {\n                setAlert(false);\n                if (isClose) {\n                  handleClose();\n                }\n              }}\n              color=\"primary\"\n              autoFocus\n              className={classes.save}\n            >\n              Ok\n            </Button>\n            <Button\n              onClick={() => {\n                setAlert(false);\n              }}\n              color=\"primary\"\n              autoFocus\n              style={{ textTransform: \"none\" }}\n              className={classes.save}\n            >\n              Cancel\n            </Button>\n          </DialogActions>\n        </Dialog>\n      )}\n    </Dialog>\n  );\n}\n\nexport default Builder;\n","import React, { useEffect } from \"react\";\nimport { DndProvider } from \"react-dnd\";\nimport { HTML5Backend } from \"react-dnd-html5-backend\";\n\nimport \"./App.css\";\nimport Builder from \"./Builder\";\nimport BuilderProvider from \"./store/context\";\n\nfunction AppContent({ params, onSave, handleClose, open, bpmnModeler }) {\n  const [values, setValues] = React.useState(null);\n\n  useEffect(() => {\n    const value = params();\n    setValues(value);\n  }, [params]);\n\n  return (\n    <div className=\"App\">\n      <Builder\n        onSave={onSave}\n        params={values}\n        handleClose={handleClose}\n        open={open}\n        bpmnModeler={bpmnModeler}\n      />\n    </div>\n  );\n}\n\nexport default function App({\n  handleClose,\n  open,\n  onSave,\n  params,\n  bpmnModeler,\n}) {\n  return (\n    <DndProvider backend={HTML5Backend}>\n      <BuilderProvider>\n        <AppContent\n          onSave={onSave}\n          handleClose={handleClose}\n          open={open}\n          params={params}\n          bpmnModeler={bpmnModeler}\n        />\n      </BuilderProvider>\n    </DndProvider>\n  );\n}\n","const download = (entity, name) => {\n  let encodedData = encodeURIComponent(entity);\n  let dl = document.createElement(\"a\");\n  document.body.appendChild(dl);\n  dl.setAttribute(\"href\", \"data:image/svg+xml;utf-8,\" + encodedData);\n  dl.setAttribute(\"download\", name);\n  dl.click();\n};\nfunction lowerCaseFirstLetter(str) {\n  if (!str) return;\n  return str.charAt(0).toLowerCase() + str.slice(1);\n}\nfunction sortBy(array = [], key) {\n  return array.sort(function (a, b) {\n    let x = a[key];\n    let y = b[key];\n    return x < y ? -1 : x > y ? 1 : 0;\n  });\n}\n\nfunction getItemsByType(view, type) {\n  function collectItems(item) {\n    const { items = [], jsonFields = [] } = item;\n    const allItems = [...items, ...jsonFields];\n    return allItems.reduce(\n      (all, item) => [...all, ...collectItems(item)],\n      item.type === type ? [item] : []\n    );\n  }\n  return collectItems(view);\n}\n\nfunction getFormName(str) {\n  if (!str) return;\n  const formString = str.match(/[A-Z][a-z]+/g);\n  if (!formString) return;\n  if (formString.join(\"\").trim().length !== str.length) {\n    return \"fetchAPI\";\n  }\n  const form = formString && formString.join(\"-\");\n  return `${form.toLowerCase()}-form`;\n}\n\nfunction translate(str) {\n  if (window._t && typeof str === \"string\") {\n    return window._t(str);\n  }\n  return str;\n}\n\nfunction pascalToKebabCase(string) {\n  return (\n    string &&\n    string\n      .match(\n        /[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g\n      )\n      .map((x) => x.toLowerCase())\n      .join(\"-\")\n  );\n}\n\nfunction getBool(val) {\n  if (!val) return false;\n  return !!JSON.parse(String(val).toLowerCase());\n}\n\nexport {\n  download,\n  translate,\n  pascalToKebabCase,\n  getBool,\n  getFormName,\n  getItemsByType,\n  sortBy,\n  lowerCaseFirstLetter,\n};\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport { makeStyles } from \"@material-ui/styles\";\n\nconst useStyles = makeStyles({\n  desciption: {\n    marginTop: 5,\n    color: \"#999\",\n  },\n  error:{\n    color: \"#CC3333\"\n  }\n});\n\nexport default function Description({ desciption, type }) {\n  const classes = useStyles();\n  return (\n    <div className={classnames(classes.desciption, type && classes.error)}>\n      {desciption}\n    </div>\n  );\n}\n","import React, { useEffect, useState } from \"react\";\nimport classnames from \"classnames\";\nimport TextareaAutosize from \"@material-ui/core/TextareaAutosize\";\nimport { makeStyles } from \"@material-ui/styles\";\n\nimport Description from \"./Description\";\n\nconst useStyles = makeStyles({\n  root: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    marginTop: 5,\n  },\n  label: {\n    fontWeight: \"bolder\",\n    display: \"inline-block\",\n    verticalAlign: \"middle\",\n    color: \"#666\",\n    marginBottom: 3,\n  },\n  textarea: {\n    fontFamily: \"Helvetica Neue, Helvetica, Arial, sans-serif\",\n    resize: \"vertical\",\n    borderColor: \"#ccc\",\n    \"&:focus\": {\n      boxShadow: \"rgba(82, 180, 21, 0.2) 0px 0px 1px 2px\",\n      outline: \"none\",\n      borderColor: \"rgb(82, 180, 21)\",\n    },\n  },\n  error: {\n    borderColor: \"#cc3333 !important\",\n    background: \"#f0c2c2\",\n    \"&:focus\": {\n      boxShadow: \"rgba(204,58,51, 0.2) 0px 0px 1px 2px !important\",\n      outline: \"none\",\n      borderColor: \"#cc3333 !important\",\n    },\n  },\n  readOnly: {\n    borderColor: \"#ccc !important\",\n    background: \"#E3E3E3\",\n    color: \"#7E7E7E\",\n    \"&:focus\": {\n      boxShadow: \"none !important\",\n      outline: \"none\",\n      borderColor: \"#ccc !important\",\n    },\n  },\n});\n\nexport default function Textbox({\n  entry,\n  element,\n  rows = 1,\n  bpmnModeler,\n  className,\n  readOnly,\n}) {\n  const classes = useStyles();\n  const { label, description, name, validate, get, set } = entry || {};\n  const [value, setValue] = useState(null);\n  const [errorMessage, setErrorMessage] = useState(null);\n  const [isError, setError] = useState(false);\n\n  const setProperty = (value) => {\n    if (set) {\n      set(element, {\n        [name]: value,\n      });\n      setValue(value);\n    } else {\n      const modeling = bpmnModeler.get(\"modeling\");\n      modeling.updateProperties(element, {\n        [name]: value,\n      });\n    }\n  };\n\n  const getProperty = React.useCallback(() => {\n    if (get) {\n      const values = get(element);\n      return values[name];\n    }\n    return element.businessObject[name];\n  }, [element, get, name]);\n\n  const updateProperty = (value) => {\n    setProperty(value);\n    setValue(value);\n    const isError = getValidation();\n    setError(isError);\n  };\n\n  const getValidation = React.useCallback(() => {\n    if (\n      !validate ||\n      ((value === null || value === undefined) && name === \"id\")\n    ) {\n      setErrorMessage(null);\n      return false;\n    }\n    let valid = validate(element, {\n      [name]: value === \"\" ? undefined : value,\n    });\n    if (valid && valid[name]) {\n      setErrorMessage(valid[name]);\n      return true;\n    } else {\n      setErrorMessage(null);\n      return false;\n    }\n  }, [validate, element, value, name]);\n\n  useEffect(() => {\n    const isError = getValidation();\n    setError(isError);\n  }, [getValidation]);\n\n  useEffect(() => {\n    if (!element) return;\n    let value = getProperty(element);\n    setValue(value);\n  }, [element, getProperty, entry]);\n\n  return (\n    <div className={classnames(classes.root, className)}>\n      <label className={classes.label}>{label}</label>\n      <TextareaAutosize\n        id={`camunda_${name}_${Date()}`}\n        value={value || \"\"}\n        className={classnames(\n          classes.textarea,\n          isError && classes.error,\n          readOnly && classes.readOnly\n        )}\n        rowsMin={rows}\n        onBlur={(e) => {\n          if (!readOnly) {\n            updateProperty(e.target.value);\n          }\n        }}\n        onChange={(e) => {\n          setValue(e.target.value);\n        }}\n        readOnly={typeof readOnly === \"function\" ? readOnly() : readOnly}\n      />\n      {errorMessage && <Description desciption={errorMessage} type=\"error\" />}\n      {description && <Description desciption={description} />}\n    </div>\n  );\n}\n","import React, { useState, useEffect } from \"react\";\nimport classnames from \"classnames\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport { Close } from \"@material-ui/icons\";\n\nimport Description from \"./Description\";\n\nconst useStyles = makeStyles({\n  root: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    marginTop: 5,\n    width: \"100%\",\n  },\n  error: {\n    borderColor: \"#cc3333 !important\",\n    background: \"#f0c2c2\",\n    \"&:focus\": {\n      boxShadow: \"rgba(204,58,51, 0.2) 0px 0px 1px 2px !important\",\n      outline: \"none\",\n      borderColor: \"#cc3333 !important\",\n    },\n  },\n  label: {\n    fontWeight: \"bolder\",\n    display: \"inline-block\",\n    verticalAlign: \"middle\",\n    color: \"#666\",\n    marginBottom: 3,\n  },\n  fieldWrapper: {\n    position: \"relative\",\n  },\n  input: {\n    width: \"calc(100% - 35px)\",\n    padding: \"3px 28px 3px 6px \",\n    border: \"1px solid #ccc\",\n    \"&:focus\": {\n      boxShadow: \"rgba(82, 180, 21, 0.2) 0px 0px 1px 2px\",\n      outline: \"none\",\n      borderColor: \"rgb(82, 180, 21)\",\n    },\n  },\n  clearButton: {\n    background: \"transparent\",\n    border: \"none\",\n    top: 0,\n    right: 0,\n    position: \"absolute\",\n    height: 23,\n    width: 24,\n    overflow: \"hidden\",\n    cursor: \"pointer\",\n    display: \"flex\",\n    alignItems: \"center\",\n  },\n  clear: {\n    fontSize: \"1rem\",\n  },\n  readOnly: {\n    borderColor: \"#ccc !important\",\n    background: \"#E3E3E3\",\n    \"&:focus\": {\n      boxShadow: \"none !important\",\n      outline: \"none\",\n      borderColor: \"#ccc !important\",\n    },\n  },\n});\n\nexport default function TextField({\n  entry,\n  element,\n  canRemove = false,\n  rootClass,\n  labelClass,\n  type = \"text\",\n  isLabel = true,\n  readOnly = false,\n  bpmnModeler,\n}) {\n  const classes = useStyles();\n  const { label, description, name, modelProperty, set, get } = entry || {};\n  const [value, setValue] = useState(null);\n\n  const setProperty = (value) => {\n    if (!bpmnModeler) return;\n    const modeling = bpmnModeler.get(\"modeling\");\n    modeling.updateProperties(element, {\n      [name]: value,\n    });\n  };\n\n  const getProperty = React.useCallback(() => {\n    return element.businessObject[name];\n  }, [element, name]);\n\n  const updateProperty = (value) => {\n    if (set) {\n      set(element, {\n        [modelProperty]: value,\n      });\n    } else {\n      setProperty(value);\n    }\n  };\n\n  const handleClear = () => {\n    setValue(\"\");\n    updateProperty(undefined)\n  };\n\n  useEffect(() => {\n    if (!element) return;\n    let value;\n    if (get) {\n      const property = get()\n      value = property && property[modelProperty];\n    } else {\n      value = getProperty();\n    }\n    setValue(value);\n  }, [element, get, getProperty, modelProperty]);\n\n  return (\n    <div className={classnames(classes.root, rootClass)}>\n      {isLabel && (\n        <label className={classnames(classes.label, labelClass)}>{label}</label>\n      )}\n      <div className={classes.fieldWrapper}>\n        <input\n          id={`camunda-${name}_${Date()}`}\n          type={type}\n          readOnly={readOnly}\n          name={name}\n          value={value || \"\"}\n          onChange={(e) => setValue(e.target.value)}\n          className={classnames(classes.input, readOnly && classes.readOnly)}\n          onBlur={(e) => updateProperty(e.target.value)}\n        />\n        {canRemove && value && (\n          <button onClick={handleClear} className={classes.clearButton}>\n            <Close className={classes.clear} />\n          </button>\n        )}\n      </div>\n      {description && <Description desciption={description} />}\n    </div>\n  );\n}\n","import React, { useState, useEffect } from \"react\";\nimport { makeStyles } from \"@material-ui/styles\";\n\nimport Description from \"./Description\";\n\nconst useStyles = makeStyles({\n  root: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    marginTop: 5,\n  },\n  label: {\n    fontWeight: \"bolder\",\n    display: \"inline-block\",\n    verticalAlign: \"middle\",\n    color: \"#666\",\n    marginBottom: 3,\n  },\n});\n\nexport default function SelectBox({ entry, element }) {\n  const classes = useStyles();\n  const {\n    id,\n    name,\n    emptyParameter,\n    selectOptions,\n    canBeDisabled,\n    canBeHidden,\n    label,\n    modelProperty,\n    description,\n    set,\n    get,\n  } = entry || {};\n  const [options, setOptions] = useState([]);\n  const [selectedOption, setSelectedOption] = useState(null);\n\n  const setProperty = (value) => {\n    element.businessObject[name] = value;\n  };\n\n  const getProperty = React.useCallback(() => {\n    return element.businessObject[name];\n  }, [element, name]);\n\n  const handleChange = (e) => {\n    setSelectedOption(e.target.value);\n    if (!set && !setProperty) return;\n    if (set) {\n      set(element, {\n        [modelProperty]: e.target.value,\n      });\n    } else {\n      setProperty(e.target.value);\n    }\n  };\n\n  useEffect(() => {\n    if (!element) return;\n    const values = get && get(element);\n    let value = getProperty\n      ? getProperty(element)\n      : values && values[modelProperty];\n    setSelectedOption(value);\n  }, [element, modelProperty, get, getProperty]);\n\n  useEffect(() => {\n    if (typeof selectOptions === \"object\") {\n      setOptions(selectOptions);\n    } else {\n      let dynamicOptions = selectOptions(element);\n      if (dynamicOptions) {\n        setOptions(dynamicOptions);\n      }\n    }\n  }, [selectOptions, element]);\n\n  return (\n    <div className={classes.root}>\n      <label htmlFor={`camunda-${id}`} className={classes.label}>\n        {label}\n      </label>\n      <select\n        id={`camunda-${id}-select`}\n        name={modelProperty}\n        data-disable={canBeDisabled ? \"isDisabled\" : \"\"}\n        data-show={canBeHidden ? \"isHidden\" : \"\"}\n        value={selectedOption || \"\"}\n        onChange={handleChange}\n      >\n        {options &&\n          options.map((option, index) => (\n            <option value={option.value} key={index}>\n              {option.name ? option.name : \"\"}{\" \"}\n            </option>\n          ))}\n        {emptyParameter && <option value=\"\"></option>}\n      </select>\n      {description && <Description desciption={description} />}\n    </div>\n  );\n}\n","import React, { useEffect, useState } from \"react\";\nimport classnames from \"classnames\";\nimport { makeStyles } from \"@material-ui/styles\";\n\nimport { getBool } from \"../../utils\";\n\nconst useStyles = makeStyles({\n  root: {\n    display: \"flex\",\n    alignItems: \"center\",\n    marginTop: 5,\n  },\n  label: {\n    fontWeight: \"bolder\",\n    color: \"#666\",\n  },\n  checkbox: {\n    margin: \"3px 3px 3px 0px\",\n  },\n});\n\nexport default function Checkbox({ entry, element, className }) {\n  const classes = useStyles();\n  const { id, name, label, modelProperty, get, set, defaultValue = false } =\n    entry || {};\n  const [value, setValue] = useState(defaultValue);\n\n  const setProperty = React.useCallback(\n    (value) => {\n      element.businessObject[name] = value.toString();\n    },\n    [element, name]\n  );\n\n  const getProperty = React.useCallback(() => {\n    return getBool(\n      element.businessObject[name] || element.businessObject.$attrs[name]\n    );\n  }, [element, name]);\n\n  const updateValue = (e) => {\n    setValue((value) => !value);\n    if (set) {\n      set(element, {\n        [modelProperty]: e.target.checked,\n      });\n    } else {\n      setProperty(e.target.checked);\n    }\n  };\n\n  useEffect(() => {\n    if (!element) return;\n    let value;\n    if (get) {\n      const values = get(element);\n      value = values && values[modelProperty];\n    } else {\n      value = getProperty();\n      setProperty(value);\n    }\n    setValue(value);\n  }, [element, modelProperty, get, getProperty, setProperty]);\n\n  return (\n    <div className={classnames(classes.root, className)}>\n      <input\n        id={`camunda-${id}`}\n        type=\"checkbox\"\n        name={modelProperty}\n        checked={value}\n        onChange={updateValue}\n        className={classes.checkbox}\n      />\n      {label && (\n        <label htmlFor={`camunda-${id}`} className={classes.label}>\n          {label}\n        </label>\n      )}\n    </div>\n  );\n}\n","import React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport classnames from \"classnames\";\nimport AutoComplete from \"@material-ui/lab/Autocomplete\";\nimport { TextField, CircularProgress } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\n\nfunction useDebounceEffect(handler, interval) {\n  const isMounted = useRef(false);\n  useEffect(() => {\n    if (isMounted.current) {\n      const timer = setTimeout(() => handler(), interval);\n      return () => clearTimeout(timer);\n    }\n    isMounted.current = true;\n  }, [handler, interval]);\n}\n\nconst useStyles = makeStyles((theme) => ({\n  autoComplete: {\n    \"& > div > label\": {\n      fontSize: 14,\n    },\n    \"& > div > div\": {\n      paddingRight: \"15px !important\",\n    },\n    // margin: \"8px 0px\",\n    background: \"white\",\n    border: \"1px solid #ccc\",\n    padding: \"0px 5px\",\n  },\n  input: {\n    fontSize: 14,\n    color: theme.palette.common.black,\n    padding: \"3px 0 3px !important\",\n  },\n  label: {\n    fontSize: 14,\n  },\n  endAdornment: {\n    top: 0,\n  },\n  circularProgress: {\n    color: \"#0A73FA\",\n  },\n  error: {\n    borderColor: \"#cc3333 !important\",\n    background: \"#f0c2c2\",\n    \"&:focus\": {\n      boxShadow: \"rgba(204,58,51, 0.2) 0px 0px 1px 2px !important\",\n      outline: \"none\",\n      borderColor: \"#cc3333 !important\",\n    },\n  },\n  errorDescription: {\n    marginTop: 5,\n    color: \"#CC3333\",\n  },\n  labelTitle: {\n    fontWeight: \"bolder\",\n    display: \"inline-block\",\n    verticalAlign: \"middle\",\n    color: \"#666\",\n    marginBottom: 3,\n  },\n  container: {\n    marginTop: 10,\n  },\n}));\n\nexport default function SelectComponent({\n  optionLabel = \"name\",\n  multiple = false,\n  index,\n  value,\n  update,\n  criteriaIds,\n  type,\n  options: propOptions,\n  entry,\n  isLabel = false,\n  error = false,\n  className,\n  defaultValue,\n  placeholder,\n  validate,\n  bpmnModeler,\n  element,\n  onChange,\n}) {\n  const [open, setOpen] = useState(false);\n  const [options, setOptions] = useState([]);\n  const [searchText, setsearchText] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [errorMessage, setErrorMessage] = useState(null);\n  const [isError, setError] = useState(false);\n  const classes = useStyles();\n  const { name, label, fetchMethod } = entry;\n\n  const setProperty = (value, valueObj) => {\n    if (!bpmnModeler) return;\n    const modeling = bpmnModeler.get(\"modeling\");\n    modeling.updateProperties(element, {\n      [name]: value,\n    });\n    if (onChange) {\n      onChange(valueObj);\n    }\n  };\n\n  const getProperty = () => {\n    return element.businessObject[name];\n  };\n\n  const fetchOptions = useCallback(\n    (searchText = \"\") => {\n      setLoading(true);\n      const criteria = [];\n      if (searchText) {\n        criteria.push({\n          fieldName: optionLabel,\n          operator: \"like\",\n          value: searchText,\n        });\n      }\n      if (!fetchMethod || !open) {\n        setLoading(false);\n        return;\n      }\n      return fetchMethod(criteria).then((res) => {\n        if (res) {\n          setOptions(res || []);\n          setLoading(false);\n        }\n      });\n    },\n    [optionLabel, fetchMethod, open]\n  );\n\n  const optionDebounceHandler = React.useCallback(() => {\n    if (searchText) {\n      fetchOptions(searchText, criteriaIds);\n    }\n  }, [fetchOptions, searchText, criteriaIds]);\n\n  useDebounceEffect(optionDebounceHandler, 500);\n\n  const getValidation = React.useCallback(() => {\n    if (\n      !validate ||\n      ((value === null || value === undefined) && name === \"id\")\n    ) {\n      setErrorMessage(null);\n      return false;\n    }\n    let valid = validate({\n      [name]: value === \"\" ? undefined : value,\n    });\n    if (valid && valid[name]) {\n      setErrorMessage(valid[name]);\n      return true;\n    } else {\n      setErrorMessage(null);\n      return false;\n    }\n  }, [validate, value, name]);\n\n  useEffect(() => {\n    const isError = getValidation();\n    setError(isError);\n  }, [getValidation]);\n\n  useEffect(() => {\n    if (!open || (propOptions && propOptions.length < 1)) {\n      setOptions([]);\n    }\n  }, [open, propOptions]);\n\n  useEffect(() => {\n    if (open) {\n      if (propOptions && propOptions.length > 0) {\n        setOptions([...propOptions]);\n      } else {\n        fetchOptions(null, criteriaIds);\n      }\n    }\n  }, [fetchOptions, open, criteriaIds, propOptions]);\n\n  useEffect(() => {\n    if (propOptions) {\n      setLoading(true);\n      setOptions(propOptions);\n      setLoading(false);\n    }\n  }, [propOptions]);\n\n  return (\n    <div className={classes.container}>\n      <label className={classes.labelTitle}>{label}</label>\n      <AutoComplete\n        classes={{\n          inputFocused: classes.input,\n          clearIndicator: classes.input,\n          popupIndicator: classes.input,\n          endAdornment: classes.endAdornment,\n        }}\n        size=\"small\"\n        key={index}\n        open={open}\n        onOpen={(e) => {\n          e && e.stopPropagation();\n          setOpen(true);\n        }}\n        onClose={(e) => {\n          e && e.stopPropagation();\n          setOpen(false);\n        }}\n        onClick={(e) => {\n          e && e.stopPropagation();\n          setOpen(true);\n        }}\n        loading={loading}\n        defaultValue={() => {\n          if (defaultValue) {\n            return defaultValue;\n          } else {\n            return getProperty();\n          }\n        }}\n        clearOnEscape\n        autoComplete\n        className={classnames(\n          classes.autoComplete,\n          className,\n          isError && classes.error\n        )}\n        options={options}\n        multiple={multiple}\n        value={value}\n        getOptionSelected={(option, val) => {\n          if (!val) return;\n          let optionName = \"\";\n          optionName = option[optionLabel]\n            ? optionLabel\n            : option[\"title\"]\n            ? \"title\"\n            : \"name\";\n          return option[optionName] === (val.id ? val[optionName] : val);\n        }}\n        onChange={(e, value) => {\n          let values = value;\n          if (type === \"multiple\") {\n            values =\n              value &&\n              value.filter(\n                (val, i, self) =>\n                  i ===\n                  self.findIndex((t) => t[optionLabel] === val[optionLabel])\n              );\n          }\n          if (update) {\n            update(values, value && value[optionLabel]);\n          } else {\n            setProperty(value && value[optionLabel], value);\n          }\n        }}\n        name={name}\n        onInputChange={(e, val) => setsearchText(val)}\n        renderInput={(params) => (\n          <TextField\n            error={error}\n            helperText={error ? \"Required\" : \"\"}\n            className={isError ? classes.error : \"\"}\n            fullWidth\n            {...params}\n            InputProps={{\n              ...(params.InputProps || {}),\n              endAdornment: (\n                <React.Fragment>\n                  {loading ? (\n                    <CircularProgress\n                      className={classes.circularProgress}\n                      size={15}\n                    />\n                  ) : null}\n                  {params.InputProps.endAdornment}\n                </React.Fragment>\n              ),\n              onClick: (e) => e && e.stopPropagation(),\n              disableUnderline: true,\n            }}\n            inputProps={{\n              ...(params.inputProps || {}),\n              onClick: (e) => {\n                e && e.stopPropagation();\n                params.inputProps &&\n                  params.inputProps.onClick &&\n                  params.inputProps.onClick(e);\n              },\n            }}\n            placeholder={placeholder || label || \"\"}\n            InputLabelProps={{\n              className: classes && classes.label,\n            }}\n            label={isLabel ? label : undefined}\n          />\n        )}\n        getOptionLabel={(option) => {\n          let optionName = \"\";\n          optionName = option[optionLabel]\n            ? option[optionLabel]\n            : option[\"title\"]\n            ? option[\"title\"]\n            : typeof option === \"object\"\n            ? \"\"\n            : option;\n          return optionName;\n        }}\n      />\n      {errorMessage && (\n        <div className={classes.errorDescription}>{errorMessage}</div>\n      )}\n    </div>\n  );\n}\n","import React, { useState, useEffect } from \"react\";\nimport { makeStyles } from \"@material-ui/styles\";\n\nconst useStyles = makeStyles({\n  root: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    marginTop: 10,\n  },\n  assignElements: {\n    width: \"100%\",\n  },\n  label: {\n    fontWeight: \"bolder\",\n    display: \"inline-block\",\n    verticalAlign: \"middle\",\n    color: \"#666\",\n    marginBottom: 3,\n  },\n  add: {\n    top: \"-23px !important\",\n    position: \"absolute\",\n    height: 23,\n    width: 24,\n    overflow: \"hidden\",\n    cursor: \"pointer\",\n    backgroundColor: \"#f8f8f8\",\n    border: \"1px solid #ccc\",\n    borderBottom: \"none\",\n    right: 0,\n  },\n  clear: {\n    top: \"-23px !important\",\n    position: \"absolute\",\n    height: 23,\n    width: 24,\n    overflow: \"hidden\",\n    cursor: \"pointer\",\n    backgroundColor: \"#f8f8f8\",\n    border: \"1px solid #ccc\",\n    borderBottom: \"none\",\n    right: 23,\n  },\n  container: {\n    position: \"relative\",\n  },\n});\n\nexport default function ExtensionElementTable({\n  entry,\n  options: defaultOptions,\n}) {\n  const classes = useStyles();\n  const {\n    label,\n    defaultSize = 5,\n    id,\n    setOptionLabelValue,\n    createExtensionElement,\n    onSelectionChange,\n    removeExtensionElement,\n  } = entry || {};\n  const [options, setOptions] = useState([]);\n  const [selectedOption, setSelectedOption] = useState(null);\n\n  const addElement = () => {\n    createExtensionElement();\n    let label = setOptionLabelValue(options.length);\n    setOptions((options) => [\n      ...(options || []),\n      { id: options.length, text: label },\n    ]);\n    setSelectedOption(options.length);\n    onSelectionChange(options.length);\n  };\n\n  const handleChange = (e) => {\n    setSelectedOption(e.target.value);\n    onSelectionChange(e.target.value);\n  };\n\n  const removeElement = () => {\n    removeExtensionElement(selectedOption);\n  };\n\n  useEffect(() => {\n    if (defaultOptions) {\n      setOptions(defaultOptions);\n    }\n  }, [defaultOptions]);\n\n  return (\n    <div className={classes.root}>\n      <div>\n        <label\n          htmlFor={`cam-assignElements-${id}`}\n          className={classes.label}\n        >\n          {label}\n        </label>\n        <div className={classes.container}>\n          <select\n            id={`cam-assignElements-${id}`}\n            className={classes.assignElements}\n            name=\"selectedExtensionElement\"\n            size={defaultSize}\n            data-list-entry-container\n            value={selectedOption || \"\"}\n            onChange={() => {}}\n          >\n            {options &&\n              options.length > 0 &&\n              options.map((option) => (\n                <option\n                  key={option.id}\n                  value={option.id}\n                  onClick={handleChange}\n                >\n                  {option.text}\n                </option>\n              ))}\n          </select>\n          <button\n            className={classes.add}\n            id={`cam-assignElements-create-${id}`}\n            onClick={addElement}\n          >\n            <span>+</span>\n          </button>\n          <button\n            className={classes.clear}\n            id={`cam-assignElements-remove-${id}`}\n            onClick={removeElement}\n          >\n            <span style={{ fontSize: 10 }}>X</span>\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport { Select, FormControl, InputLabel } from \"@material-ui/core\";\n\nimport { makeStyles } from \"@material-ui/core/styles\";\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n  },\n  select: {\n    width: \"150px\",\n  },\n}));\n\nexport default function Selection({\n  name,\n  value = \"\",\n  onChange,\n  options,\n  title,\n  className,\n  disableUnderline = false,\n  ...rest\n}) {\n  const classes = useStyles();\n  return (\n    <FormControl className={classnames(classes.formControl, className)}>\n      <InputLabel>{title}</InputLabel>\n      <Select\n        disableUnderline={disableUnderline}\n        value={value}\n        onChange={(e) => onChange(e.target.value)}\n        name={name}\n        style={{ marginRight: 8 }}\n        classes={{ select: classnames(classes.select, className) }}\n        {...rest}\n      >\n        {options &&\n          Array.isArray(options) &&\n          options.map(({ name, title }, index) => (\n            <MenuItem value={name} key={index}>\n              {title}\n            </MenuItem>\n          ))}\n      </Select>\n    </FormControl>\n  );\n}\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport Input from \"@material-ui/core/Input\";\nimport classnames from \"classnames\";\nimport { TextField } from \"@material-ui/core\";\n\nfunction InputField({\n  name,\n  title,\n  autoTitle,\n  value = \"\",\n  onChange,\n  onBlur,\n  readOnly,\n  inline,\n  InputProps,\n  style,\n  disableUnderline = false,\n  className,\n  ...other\n}) {\n  if (inline) {\n    return (\n      <Input\n        style={{ width: \"100%\", ...style }}\n        className={className}\n        placeholder={title}\n        inputProps={{ \"aria-label\": title, disableUnderline }}\n        name={name}\n        onChange={(e) => onChange(e.target.value)}\n        onBlur={onBlur}\n        autoComplete=\"off\"\n        readOnly={readOnly}\n        disabled={readOnly}\n        value={value || \"\"}\n        {...other}\n      />\n    );\n  }\n  return (\n    <TextField\n      id={`filled-${name}`}\n      label={title || autoTitle}\n      name={name}\n      style={{ width: \"100%\", ...style }}\n      onChange={(e) => onChange(e.target.value)}\n      onBlur={onBlur}\n      autoComplete=\"off\"\n      InputProps={{ readOnly, ...InputProps, disableUnderline }}\n      value={value || \"\"}\n      className={classnames(other.className, className)}\n      {...other}\n    />\n  );\n}\n\nInputField.propTypes = {\n  name: PropTypes.string,\n  title: PropTypes.string,\n  value: PropTypes.string,\n  onChange: PropTypes.func,\n  readOnly: PropTypes.bool,\n  multiline: PropTypes.bool,\n  rows: PropTypes.number,\n};\n\nInputField.defaultProps = {\n  rows: 3,\n  readOnly: false,\n};\nexport default InputField;\n","import React from \"react\";\nimport classnames from \"classnames\";\nimport Button from \"@material-ui/core/Button\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport { makeStyles } from \"@material-ui/core/styles\";\n\nconst useStyles = makeStyles((theme) => ({\n  button: {\n    color: \"#0275d8\",\n    textTransform: \"none\",\n  },\n  buttonLabel: {\n    maxHeight: 30,\n  },\n}));\n\nfunction ButtonComp({ title, Icon, onClick, className }) {\n  const classes = useStyles();\n  if (!title) {\n    return (\n      <IconButton\n        size=\"medium\"\n        onClick={onClick}\n        className={classnames(classes.button, className)}\n        style={{ padding: \"0px 12px\" }}\n      >\n        <Icon fontSize=\"small\" />\n      </IconButton>\n    );\n  }\n\n  if (!Icon) {\n    return (\n      <Button\n        className={classnames(classes.button, classes.buttonLabel, className)}\n        onClick={onClick}\n      >\n        {title}\n      </Button>\n    );\n  }\n\n  return (\n    <Button\n      className={classnames(classes.button, classes.buttonLabel, className)}\n      endIcon={<Icon />}\n      onClick={onClick}\n    >\n      {title}\n    </Button>\n  );\n}\n\nexport default ButtonComp;\n","import React, { useState, useCallback } from \"react\";\nimport PropTypes from \"prop-types\";\nimport Input from \"./input\";\n\nfunction NumberField({\n  type = \"integer\",\n  title,\n  onChange,\n  value = 0,\n  readOnly,\n  scale = 2,\n  customeFormat,\n  onBlur: blur,\n  className,\n  disableUnderline,\n  ...other\n}) {\n  let [val, setVal] = useState(value);\n\n  const formatValue = useCallback(\n    (value) => Number(Number(value).toFixed(type === \"integer\" ? 0 : scale)),\n    [type, scale]\n  );\n\n  React.useEffect(() => {\n    setVal(formatValue(value));\n  }, [value, setVal, formatValue]);\n\n  function onBlur(e) {\n    onChange(formatValue(val));\n    setVal(formatValue(val));\n    blur && blur(e);\n  }\n  return (\n    <Input\n      className={className}\n      onChange={setVal}\n      title={title}\n      type={\"number\"}\n      value={`${val}`}\n      onBlur={onBlur}\n      disableUnderline={disableUnderline}\n      {...other}\n    />\n  );\n}\nNumberField.propTypes = {\n  name: PropTypes.string,\n  title: PropTypes.string,\n  type: PropTypes.string,\n  onChange: PropTypes.func,\n  readOnly: PropTypes.bool,\n  scale: PropTypes.number,\n  customeFormat: PropTypes.object,\n};\n\nNumberField.defaultProps = {\n  readOnly: false,\n};\nexport default NumberField;\n","const combinator = [\n  { name: \"and\", title: \"AND\" },\n  { name: \"or\", title: \"OR\" },\n];\n\nconst map_combinator = {\n  and: \"&&\",\n  or: \"||\",\n};\n\nconst map_bpm_combinator = {\n  and: \"and\",\n  or: \"or\",\n};\n\nconst expressionType = [\n  // { name: \"JS\", title: \"JS\" },\n  { name: \"GROOVY\", title: \"GROOVY\" },\n];\n\nconst join_operator = {\n  JS: \".\",\n  GROOVY: \"?.\",\n  BPM: \".\",\n};\n\nconst dateFormat = {\n  date: \"DD/MM/YYYY\",\n  time: \"HH:mm:ss\",\n  datetime: \"DD/MM/YYYY HH:mm\",\n};\n\nconst positive_operators = [\n  \"=\",\n  \">=\",\n  \"<=\",\n  \">\",\n  \"<\",\n  \"like\",\n  \"isNull\",\n  \"between\",\n  \"contains\",\n  \"in\",\n  \"isTrue\",\n];\n\nconst query_custom_types = [\n  \"many_to_many\",\n  \"many-to-many\",\n  \"json_many_to_many\",\n  \"json-many-to-many\",\n  \"one_to_one\",\n  \"one-to-one\",\n  \"json_one_to_one\",\n  \"json-one-to-one\",\n  \"enum\",\n];\n\nconst allowed_types = [\n  \"long\",\n  \"decimal\",\n  \"date\",\n  \"time\",\n  \"datetime\",\n  \"enum\",\n  \"text\",\n  \"integer\",\n  \"boolean\",\n  \"many_to_many\",\n  \"many-to-many\",\n  \"json_many_to_many\",\n  \"json-many-to-many\",\n  \"many_to_one\",\n  \"many-to-one\",\n  \"json_many_to_one\",\n  \"json-many-to-one\",\n  \"one_to_one\",\n  \"one-to-one\",\n  \"json_one_to_one\",\n  \"json-one-to-one\",\n  \"string\",\n];\n\nconst operators_by_type = {\n  enum: [\"=\", \"!=\", \"isNull\", \"isNotNull\"],\n  text: [\"like\", \"notLike\", \"isNull\", \"isNotNull\"],\n  integer: [\n    \"=\",\n    \"!=\",\n    \">=\",\n    \"<=\",\n    \">\",\n    \"<\",\n    \"between\",\n    \"notBetween\",\n    \"isNull\",\n    \"isNotNull\",\n  ],\n  boolean: [\"isTrue\", \"isFalse\"],\n  button: [\"=\"],\n};\n\nconst map_operator_groovy = {\n  \"=\": \"==\",\n  \"!=\": \"!=\",\n  \">\": \">\",\n  \">=\": \">=\",\n  \"<\": \"<\",\n  \"<=\": \"<=\",\n  isNotNull: \"!= null\",\n  isNull: \"== null\",\n  isTrue: \"==\",\n  isFalse: \"==\",\n  in: \"contains\",\n  notIn: \"contains\",\n  like: \"contains\",\n  notLike: \"contains\",\n  contains: \"contains\",\n  notContains: \"contains\",\n};\n\nconst map_operator_bpm = {\n  \"=\": \"=\",\n  \"!=\": \"!=\",\n  \">\": \">\",\n  \">=\": \">=\",\n  \"<\": \"<\",\n  \"<=\": \"<=\",\n  isNotNull: \"is NOT NULL\",\n  isNull: \"is NULL\",\n  isTrue: \"is\",\n  isFalse: \"is\",\n  in: \"IN\",\n  notIn: \"NOT IN\",\n  like: \"LIKE\",\n  notLike: \"NOT LIKE\",\n  contains: \"MEMBER OF\",\n  notContains: \"NOT MEMBER OF\",\n};\n\nconst map_operator_js = {\n  \"=\": \"===\",\n  \"!=\": \"!==\",\n  \">\": \">\",\n  \">=\": \">=\",\n  \"<\": \"<\",\n  \"<=\": \"<=\",\n  in: \"in\",\n  notIn: \"in\",\n  like: \"LIKE\",\n  notLike: \"NOT LIKE\",\n  isNotNull: \"!== null\",\n  isNull: \"=== null\",\n  isTrue: \"===\",\n  isFalse: \"===\",\n};\n\nconst map_operator = {\n  JS: map_operator_js,\n  GROOVY: map_operator_groovy,\n  BPM: map_operator_bpm,\n};\n\nconst operators = [\n  { name: \"=\", title: \"equals\" },\n  { name: \"!=\", title: \"not equal\" },\n  { name: \">\", title: \"greater than\" },\n  { name: \">=\", title: \"greater or equal\" },\n  { name: \"<\", title: \"less than\" },\n  { name: \"<=\", title: \"less or equal\" },\n  { name: \"in\", title: \"in\" },\n  { name: \"between\", title: \"between\" },\n  { name: \"notBetween\", title: \"not Between\" },\n  { name: \"notIn\", title: \"not in\" },\n  { name: \"isNull\", title: \"is null\" },\n  { name: \"isNotNull\", title: \"is not null\" },\n  { name: \"like\", title: \"contains\" },\n  { name: \"notLike\", title: \"doesn't contain\" },\n  { name: \"isTrue\", title: \"is true\" },\n  { name: \"isFalse\", title: \"is false\" },\n  { name: \"contains\", title: \"contains\" },\n  { name: \"notContains\", title: \"not contains\" },\n];\n\nexport {\n  combinator,\n  expressionType,\n  operators,\n  operators_by_type,\n  map_operator,\n  map_combinator,\n  dateFormat,\n  join_operator,\n  map_operator_bpm,\n  map_bpm_combinator,\n  positive_operators,\n  allowed_types,\n  query_custom_types,\n};\n","import React, { useState } from \"react\";\nimport MomentUtils from \"@date-io/moment\";\nimport {\n  MuiPickersUtilsProvider,\n  KeyboardTimePicker,\n  KeyboardDateTimePicker,\n  KeyboardDatePicker,\n} from \"@material-ui/pickers\";\nimport { dateFormat } from \"../extra/data\";\n\nconst PICKERS = {\n  date: KeyboardDatePicker,\n  time: KeyboardTimePicker,\n  datetime: KeyboardDateTimePicker,\n};\n\nfunction DateTimePicker({\n  inline,\n  type = \"date\",\n  disableUnderline = false,\n  className,\n  ...props\n}) {\n  const [open, setOpen] = useState(false);\n  let valueRef = React.useRef();\n  const { name, title, format, error, onChange, ...other } = props;\n  const Picker = PICKERS[type];\n\n  function onKeyDown(e) {\n    if (e.keyCode === 40) setOpen(true);\n  }\n\n  function onClose() {\n    onChange(valueRef.current);\n    setOpen(false);\n  }\n\n  return (\n    <MuiPickersUtilsProvider utils={MomentUtils}>\n      <Picker\n        autoOk={true}\n        open={open}\n        ampm={false}\n        views={\n          type === \"date\"\n            ? [\"date\"]\n            : type === \"datetime\"\n            ? [\"date\", \"hours\", \"minutes\"]\n            : type === \"time\"\n            ? [\"hours\", \"minutes\", \"seconds\"]\n            : [\"date\"]\n        }\n        InputProps={{\n          disableUnderline,\n        }}\n        onChange={(value) => {\n          valueRef.current = value;\n          onChange(value);\n        }}\n        PopoverProps={{\n          anchorOrigin: { vertical: \"bottom\", horizontal: \"left\" },\n          transformOrigin: { vertical: \"top\", horizontal: \"left\" },\n        }}\n        disableToolbar\n        variant=\"inline\"\n        {...(inline ? { invalidDateMessage: \"\" } : {})}\n        className={className}\n        style={{ width: \"100%\", ...(inline ? { margin: 0 } : {}) }}\n        label={inline ? \"\" : title}\n        format={format || dateFormat[type]}\n        {...(type !== \"time\" ? { animateYearScrolling: false } : {})}\n        {...other}\n        onKeyDown={onKeyDown}\n        onClose={onClose}\n        onOpen={() => setOpen(true)}\n      />\n    </MuiPickersUtilsProvider>\n  );\n}\n\nexport default DateTimePicker;\n","import React from \"react\";\n\nexport function useDebounce(cb, duration) {\n  const timer = React.useRef(null);\n\n  const clearTimer = () => timer.current && clearTimeout(timer.current);\n  const setTimer = (cb) => (timer.current = setTimeout(cb, duration));\n\n  React.useEffect(() => {\n    return () => clearTimer();\n  }, []);\n\n  return (...args) => {\n    clearTimer();\n    setTimer(() => cb(...args));\n  };\n}\n\nexport function isBPMQuery(type) {\n  return type === \"bpmQuery\" ? true : false;\n}\n\nexport function lowerCaseFirstLetter(str) {\n  if (!str) return;\n  return str.charAt(0).toLowerCase() + str.slice(1);\n}\n\nexport function upperCaseFirstLetter(str) {\n  if (!str) return;\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nexport function getBO(bo) {\n  if (\n    bo &&\n    (bo.$type === \"bpmn:SubProcess\" || bo.$type === \"bpmn:Transaction\")\n  ) {\n    return getBO(bo.$parent);\n  }\n  return bo;\n}\n\nexport const getJsonExpression = (field, prefix, fieldName) => {\n  const { type, jsonField, targetName } = field;\n  switch (type) {\n    case \"text\":\n    case \"string\":\n    case \"date\":\n    case \"datetime\":\n    case \"time\":\n      return `json_extract_text(${prefix}.${jsonField},'${fieldName}')`;\n    case \"many-to-one\":\n    case \"json-many-to-one\":\n    case \"many_to_one\":\n    case \"json_many_to_one\":\n      if (!targetName) {\n        return `json_extract_text(${prefix}.${jsonField},'${fieldName}')`;\n      }\n      return `json_extract_text(${prefix}.${jsonField},'${fieldName}','${targetName}')`;\n    case \"integer\":\n      return `json_extract_integer(${prefix}.${jsonField},'${fieldName}')`;\n    case \"decimal\":\n      return `json_extract_decimal(${prefix}.${jsonField},'${fieldName}')`;\n    case \"boolean\":\n      return `json_extract_boolean(${prefix}.${jsonField},'${fieldName}')`;\n    default:\n      break;\n  }\n};\n\nexport const join_operator = {\n  JS: \".\",\n  GROOVY: \"?.\",\n  BPM: \".\",\n};\n","import React, { useEffect, useState } from \"react\";\nimport { TextField, CircularProgress, Chip } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/styles\";\nimport Autocomplete from \"@material-ui/lab/Autocomplete\";\nimport _uniqueId from \"lodash/uniqueId\";\n\nimport { translate } from \"../../../utils\";\nimport { useDebounce } from \"../extra/util\";\n\nconst useStyles = makeStyles((theme) => ({\n  listbox: {\n    maxHeight: \"300px !important\",\n  },\n  chip: {\n    \"&.MuiChip-outlined .MuiChip-deleteIconSmall\": {\n      color: \"#0275d8\",\n    },\n    border: \"1px solid #0275d8\",\n    color: \"#0275d8\",\n  },\n}));\nexport default function AutoComplete(props) {\n  const [open, setOpen] = useState(false);\n  const [options, setOptions] = useState([]);\n  const [selectedValue, setSelectedValue] = useState(props.isMulti ? [] : null);\n  const [inputValue, setInputValue] = useState(\"\");\n  const {\n    name,\n    value,\n    onChange,\n    options: flatOptions,\n    optionLabelKey = \"title\",\n    optionValueKey = \"id\",\n    isMulti = false,\n    title,\n    fetchAPI,\n    inline,\n    InputProps,\n    error,\n    filterSelectedOptions = false,\n    disableCloseOnSelect = true,\n    readOnly,\n    ...other\n  } = props;\n\n  const classes = useStyles();\n  const [loading, setLoading] = useState(false);\n\n  const findOption = React.useCallback(\n    (option) => {\n      return (\n        flatOptions &&\n        flatOptions.find((i) => i && i[optionValueKey] === option.trim())\n      );\n    },\n    [flatOptions, optionValueKey]\n  );\n\n  async function onInputChange(value = \"\") {\n    setInputValue(value);\n  }\n\n  const delayChange = useDebounce(onInputChange, 400);\n\n  useEffect(() => {\n    let active = true;\n    if (open) {\n      setLoading(true);\n      if (fetchAPI) {\n        (async () => {\n          const data = await fetchAPI({ search: inputValue });\n          if (active) {\n            setOptions(data);\n            setLoading(false);\n          }\n        })();\n      } else {\n        setOptions(flatOptions);\n        setLoading(false);\n      }\n    }\n    return () => {\n      active = false;\n      setLoading(false);\n    };\n  }, [fetchAPI, flatOptions, inputValue, open]);\n\n  useEffect(() => {\n    if (typeof value === \"string\") {\n      const values = value.split(\",\");\n      setSelectedValue(\n        isMulti ? values.map((v) => findOption(v)) : findOption(values[0])\n      );\n    } else {\n      setSelectedValue(value ? value : isMulti ? [] : null);\n    }\n  }, [value, isMulti, findOption]);\n\n  function onKeyDown(e) {\n    if (e.key === \"Backspace\") {\n      if (selectedValue && selectedValue[optionLabelKey] === inputValue) {\n        onChange(null);\n      }\n    }\n  }\n\n  function handleChange(item) {\n    if (typeof value === \"string\") {\n      isMulti\n        ? onChange(item.map((i) => i && i[optionValueKey]).join(\",\") || [])\n        : onChange(item && item[optionValueKey]);\n    } else {\n      onChange(item);\n    }\n  }\n\n  const checkValue = (option) => {\n    return (option && option.type) === \"metaJsonModel\"\n      ? `${option && option.title} (${\n          option && option[optionLabelKey] ? option[optionLabelKey] : \"\"\n        }) (Custom model)` || \"\"\n      : name === \"fieldName\"\n      ? `${translate(option && option[\"title\"] ? option[\"title\"] : \"\")} (${\n          option && option[optionLabelKey]\n        })`\n      : (option && option.type) === \"metaModel\"\n      ? `${option && option[\"title\"] ? option[\"title\"] : \"\"} (${\n          option && option[optionLabelKey] ? option[optionLabelKey] : \"\"\n        })` || \"\"\n      : (option && option.type) === \"dmnModel\"\n      ? `${option && option[\"dmnNodeNameId\"] ? option[\"dmnNodeNameId\"] : \"\"} (${\n          option && option[\"resultVariable\"] ? option[\"resultVariable\"] : \"\"\n        })` || \"\"\n      : option\n      ? option[optionLabelKey]\n        ? option[optionLabelKey]\n        : option[\"id\"]\n        ? option[\"id\"].toString()\n        : \"\"\n      : \"\";\n  };\n\n  return (\n    <Autocomplete\n      getOptionSelected={(option, value) => {\n        return isMulti\n          ? option[optionValueKey] === value[optionValueKey]\n          : checkValue(option) === checkValue(value);\n      }}\n      getOptionLabel={(option) => {\n        return checkValue(option);\n      }}\n      disabled={readOnly}\n      loading={loading}\n      id={_uniqueId(\"select-widget\")}\n      open={open}\n      onOpen={() => setOpen(true)}\n      onClose={() => setOpen(false)}\n      value={\n        selectedValue\n          ? isMulti\n            ? Array.isArray(selectedValue)\n              ? selectedValue\n              : []\n            : selectedValue\n          : isMulti\n          ? []\n          : null\n      }\n      onChange={(event, newValue) => handleChange(newValue)}\n      options={options || []}\n      multiple={isMulti}\n      filterSelectedOptions={filterSelectedOptions}\n      onInputChange={(e, value) => delayChange(value)}\n      classes={{ option: \"menu-item\", listbox: classes.listbox }}\n      renderTags={(value, getTagProps) =>\n        value.map((option, index) => (\n          <Chip\n            variant=\"outlined\"\n            label={option[optionLabelKey]}\n            size=\"small\"\n            classes={{\n              root: classes.chip,\n            }}\n            {...getTagProps({ index })}\n          />\n        ))\n      }\n      renderInput={(params) => {\n        return (\n          <TextField\n            {...params}\n            error={error}\n            label={inline ? \"\" : title}\n            fullWidth\n            onClick={() => {\n              if (readOnly) return;\n              setOpen(true);\n            }}\n            InputProps={{\n              ...InputProps,\n              ...params.InputProps,\n              endAdornment: (\n                <React.Fragment>\n                  {loading ? (\n                    <CircularProgress\n                      className={classes.circularProgress}\n                      size={15}\n                    />\n                  ) : null}\n                  {params.InputProps.endAdornment}\n                </React.Fragment>\n              ),\n            }}\n            {...(isMulti ? {} : { onKeyDown: onKeyDown })}\n          />\n        );\n      }}\n      {...(isMulti ? { disableCloseOnSelect } : {})}\n      {...other}\n    />\n  );\n}\n","import Service from \"./Service\";\nimport { getItemsByType, getFormName } from \"../utils\";\nimport * as _ from \"lodash\";\n\nexport async function getMetaModal(data) {\n  const res = await Service.search(\"com.axelor.meta.db.MetaModel\", { data });\n  return res && res.data && res.data[0];\n}\n\nexport async function getSubMetaField(\n  model,\n  relationJsonModel,\n  isCollection = false,\n  allowAllFields = false\n) {\n  if (model === \"com.axelor.meta.db.MetaJsonRecord\" && relationJsonModel) {\n    const res = await Service.get(\n      `ws/meta/fields/com.axelor.meta.db.MetaJsonRecord?jsonModel=${relationJsonModel}`\n    );\n    let result = getResultedFields(res) || [];\n    return (\n      result &&\n      result.filter((r) =>\n        isCollection\n          ? [\"many_to_one\", \"one_to_many\", \"many_to_many\"].includes(\n              r.type.toLowerCase()\n            )\n          : allowAllFields\n          ? r\n          : [\"many_to_one\", \"many-to-one\"].includes(r.type.toLowerCase())\n      )\n    );\n  } else {\n    const data = {\n      criteria: [{ fieldName: \"fullName\", operator: \"=\", value: model }],\n    };\n    const metaModel = await getMetaModal(data);\n    if (!metaModel) return [];\n    const fields = metaModel && metaModel.metaFields.map((f) => f.name);\n    const res = await Service.fields({\n      fields,\n      model: metaModel.fullName,\n    });\n    let resultFields = res && res.data && res.data.fields;\n    return (\n      resultFields &&\n      resultFields.filter((r) =>\n        isCollection\n          ? [\"many_to_one\", \"one_to_many\", \"many_to_many\"].includes(\n              r.type.toLowerCase()\n            )\n          : allowAllFields\n          ? r\n          : [\"many_to_one\", \"many-to-one\"].includes(r.type.toLowerCase())\n      )\n    );\n  }\n}\n\nexport async function getMetaFields(model) {\n  if (!model) return [];\n  if (model.type === \"metaModel\") {\n    if (!model.fullName) return [];\n    let res = await Service.get(`ws/meta/fields/${model.fullName}`);\n    let result = getResultedFields(res);\n    return result;\n  } else {\n    if (!model.name) return [];\n    const res = await Service.get(\n      `ws/meta/fields/com.axelor.meta.db.MetaJsonRecord?jsonModel=${model.name}`\n    );\n    let result = getResultedFields(res);\n    return result || [];\n  }\n}\n\nexport async function getModels(data = {}, metaModalType, dmnModels) {\n  const models =\n    ((!metaModalType || metaModalType === \"metaModel\") &&\n      (await getMetaModels(data, true))) ||\n    [];\n  const metaJsonModels =\n    ((!metaModalType || metaModalType === \"metaJsonModel\") &&\n      (await getCustomModels(data))) ||\n    [];\n  const allModels = [];\n\n  for (let i = 0; i < models.length; i++) {\n    allModels.push({\n      ...models[i],\n      type: \"metaModel\",\n    });\n  }\n  for (let i = 0; i < metaJsonModels.length; i++) {\n    allModels.push({\n      ...metaJsonModels[i],\n      type: \"metaJsonModel\",\n    });\n  }\n  if (dmnModels) {\n    for (let i = 0; i < dmnModels.length; i++) {\n      allModels.push({\n        ...dmnModels[i],\n        type: \"dmnModel\",\n      });\n    }\n  }\n  return allModels || [];\n}\n\nexport async function getDMNModels(criteria = []) {\n  const res = await Service.search(\"com.axelor.apps.bpm.db.DmnTable\", {\n    data: {\n      criteria,\n    },\n  });\n  const { data = [] } = res || {};\n  return data;\n}\n\nexport async function getDMNFields(options) {\n  const res = await Service.search(\"com.axelor.apps.bpm.db.DmnField\", options);\n  const { data = [] } = res || {};\n  return data;\n}\n\nconst getResultedFields = (res) => {\n  const responseData = res && res.data;\n  const allFields = responseData && responseData.fields;\n  const jsonFields = Object.values(\n    (responseData && responseData.jsonFields) || [{}]\n  );\n  let result = [];\n  result = allFields || [];\n\n  jsonFields &&\n    jsonFields.forEach((jsonField) => {\n      const nestedFields = Object.values(jsonField || {}) || [];\n      result = [...result, ...nestedFields];\n    });\n  return result;\n};\n\nexport async function getViews(model, criteria = [], type = \"form\") {\n  if (!model || !model.name) return [];\n  let options = [\n    {\n      fieldName: \"type\",\n      operator: \"=\",\n      value: type,\n    },\n  ];\n\n  if (model.type === \"metaJsonModel\") {\n    options.push({\n      fieldName: \"name\",\n      operator: \"=\",\n      value: `custom-model-${model.name}-${type}`,\n    });\n  } else {\n    if (!model.fullName) return;\n    options.push({\n      fieldName: \"model\",\n      operator: \"=\",\n      value: model.fullName,\n    });\n  }\n\n  const res = await Service.search(`com.axelor.meta.db.MetaView`, {\n    fields: [\"name\", \"title\"],\n    data: {\n      criteria: [...options, ...criteria],\n      operator: \"and\",\n    },\n  });\n  const { data = [] } = res || {};\n  let views = data.filter((val) => val.name !== null);\n  views = _.uniqBy(views || [], \"name\") || [];\n  return views;\n}\n\nexport async function getButtons(models = []) {\n  let buttons = [];\n  let metaModeNames = [];\n  let modelNames = [];\n  if (models.length > 0) {\n    for (let i = 0; i < models.length; i++) {\n      const { type, model, modelFullName } = models[i];\n      let formName = getFormName(model);\n      if (formName === \"fetchAPI\") {\n        const views = await getViews({\n          name: model,\n          type,\n          fullName: modelFullName,\n        });\n        if (views && views[0]) {\n          formName = views[0].name;\n        }\n      }\n      if (formName) {\n        if (type === \"metaModel\") {\n          metaModeNames.push(modelFullName);\n        }\n        const res = await Service.view({\n          data: {\n            name:\n              type === \"metaModel\" ? formName : `custom-model-${model}-form`,\n            type: \"form\",\n          },\n          model,\n        });\n        const formView = res && res.data && res.data.view;\n        if (formView) {\n          const btns = getItemsByType(formView, \"button\");\n          buttons = [...buttons, ...(btns || [])];\n        }\n      } else {\n        if (type === \"metaJsonModel\") {\n          modelNames.push(model);\n        }\n      }\n    }\n    if (metaModeNames && metaModeNames.length > 0) {\n      for (let i = 0; i < metaModeNames.length; i++) {\n        const res = await Service.search(`com.axelor.meta.db.MetaJsonField`, {\n          data: {\n            criteria: [\n              {\n                fieldName: \"model\",\n                operator: \"like\",\n                value: metaModeNames[i],\n              },\n              {\n                fieldName: \"type\",\n                operator: \"=\",\n                value: \"button\",\n              },\n            ],\n            operator: \"and\",\n          },\n        });\n        const buttonFields = res && res.data;\n        if (buttonFields && buttonFields.length > 0) {\n          buttons = [...buttons, ...(buttonFields || [])];\n        }\n      }\n    }\n    if (modelNames && modelNames.length > 0) {\n      for (let i = 0; i < modelNames.length; i++) {\n        const res = await Service.get(\n          `ws/meta/fields/com.axelor.meta.db.MetaJsonRecord?jsonModel=${modelNames[i]}`\n        );\n        const fields = getResultedFields(res);\n        const buttonFields = fields.filter((f) => f.type === \"button\");\n        buttons = [...buttons, ...(buttonFields || [])];\n      }\n    }\n    return buttons;\n  }\n}\n\nexport async function getFormViews(formViewNames) {\n  const res = await Service.search(\"com.axelor.meta.db.MetaView\", {\n    data: {\n      _domain:\n        \"self.type = :type and self.extension IS NULL and self.name in :names\",\n      _domainContext: {\n        type: \"form\",\n        names: formViewNames && formViewNames.length > 0 ? formViewNames : [\"\"],\n      },\n    },\n    fields: [\"name\", \"title\", \"model\"],\n  });\n  const { data = [] } = res || {};\n  return data;\n}\n\nexport async function getMetaModels(criteria = {}, allowTitles = false) {\n  const res = await Service.search(\"com.axelor.meta.db.MetaModel\", {\n    data: criteria,\n  });\n  if (res && res.status === -1) return [];\n  const { data = [] } = res || {};\n  if (!allowTitles) {\n    return data;\n  }\n  const defaultForms = data.reduce(async (arrs, item) => {\n    const accumulator = await arrs.then();\n    const formName = getFormName(item.name);\n    if (formName === \"fetchAPI\") {\n      const views = await getViews({\n        ...item,\n        type: \"metaModel\",\n      });\n      if (views && views[0]) {\n        accumulator.push(views[0].name);\n      }\n    } else if (formName) {\n      accumulator.push(formName);\n    }\n    return Promise.resolve(accumulator);\n  }, Promise.resolve([]));\n  const forms = await defaultForms;\n  const formData = await getFormViews(forms);\n  const result = data.reduce(async (arrs, item) => {\n    const accumulator = await arrs.then();\n    const formName = getFormName(item.name);\n    if (formName === \"fetchAPI\") {\n      const views = await getViews({\n        ...item,\n        type: \"metaModel\",\n      });\n      if (views && views[0]) {\n        accumulator.push({ ...item, title: views[0].title });\n      }\n    } else if (formName) {\n      const form = formData.find((f) => f.name === formName);\n      accumulator.push({ ...item, title: form && form.title });\n    }\n    return Promise.resolve(accumulator);\n  }, Promise.resolve([]));\n  return result;\n}\n\nexport async function getCustomModels(criteria = {}) {\n  const res = await Service.search(\"com.axelor.meta.db.MetaJsonModel\", {\n    data: criteria,\n  });\n  if (res && res.status === -1) return [];\n  const { data = [] } = res || {};\n  return data;\n}\n\nexport async function getAllModels(criteria = {}) {\n  const models = (await getMetaModels(criteria)) || [];\n  const metaJsonModels = (await getCustomModels(criteria)) || [];\n  const data = [...models, ...metaJsonModels];\n  return data;\n}\n","import React, { useEffect, useState } from \"react\";\nimport classnames from \"classnames\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Close, ArrowForward } from \"@material-ui/icons\";\nimport { IconButton, Tooltip } from \"@material-ui/core\";\n\nimport { translate } from \"../../utils\";\nimport { Selection } from \"../expression-builder/components\";\nimport { getSubMetaField } from \"../../services/api\";\n\nconst useStyles = makeStyles(() => ({\n  MuiAutocompleteRoot: {\n    width: \"250px\",\n    marginRight: \"10px\",\n  },\n  iconButton: {\n    marginRight: 10,\n  },\n  icon: {\n    color: \"#0275d8\",\n  },\n}));\n\nexport default function FieldEditor({\n  initValue = \"\",\n  getMetaFields,\n  onChange,\n  value,\n  classNames,\n  isParent = false,\n  isUserPath = false,\n  startModel,\n  isCollection = false,\n  allowAllFields = false,\n  excludeUITypes = false,\n  isDatePath = false,\n}) {\n  const { fieldName = \"\", allFields } = value || {};\n  const [fields, setFields] = useState([]);\n  const [isShow, setShow] = useState(true);\n  const [isButton, setButton] = useState(true);\n  const [allFieldValues, setAllFieldValues] = useState(null);\n  const classes = useStyles();\n  const values = fieldName && fieldName.split(\".\");\n  const [startValue] = values || [];\n  const hasManyValues =\n    fieldName &&\n    isParent &&\n    fields &&\n    fields.some((x) => x.name === startValue);\n  const relationModel =\n    hasManyValues && (fields.find((x) => x.name === startValue) || {}).target;\n  const relationJsonModel =\n    hasManyValues &&\n    (fields.find((x) => x.name === startValue) || {}).jsonTarget;\n\n  function handleChange(value) {\n    const isRelationalField =\n      value && fields.some((x) => x.name === value.name && x.target);\n    let newFieldName = isParent\n      ? `${initValue}${value ? value.name : \"\"}`\n      : value\n      ? value.name\n      : \"\"\n      ? `${isRelationalField ? \".\" : \"\"}${initValue}${value ? value.name : \"\"}`\n      : \"\";\n    newFieldName =\n      value && value.name ? newFieldName : newFieldName.slice(0, -1);\n\n    const relationalField =\n      allFieldValues &&\n      [...(allFieldValues || []), value].reverse().find((x) => x && x.target);\n    onChange(\n      newFieldName === \"\" ? undefined : newFieldName,\n      value,\n      relationalField\n    );\n  }\n  const transformValue = fields && fields.find((f) => f.name === startValue);\n\n  useEffect(() => {\n    let isSubscribed = true;\n    (async () => {\n      const data = await getMetaFields();\n      if (isSubscribed) {\n        setFields(\n          data &&\n            data.filter((d) =>\n              isCollection\n                ? [\"many_to_one\", \"one_to_many\", \"many_to_many\"].includes(\n                    d.type.toLowerCase()\n                  )\n                : allowAllFields\n                ? isDatePath\n                  ? [\"date\", \"datetime\"].includes(d.type.toLowerCase())\n                  : d\n                : [\"many_to_one\", \"many-to-one\"].includes(d.type.toLowerCase())\n            )\n        );\n      }\n    })();\n    return () => {\n      isSubscribed = false;\n    };\n  }, [getMetaFields, isCollection, allowAllFields, excludeUITypes, isDatePath]);\n\n  useEffect(() => {\n    const values = fieldName && fieldName.split(\".\");\n    const transformValue =\n      fields && fields.find((f) => f.name === (values && values[0]));\n\n    const lastValue =\n      values && values.length > 0 ? values[values.length - 1] : undefined;\n\n    if (\n      isUserPath &&\n      transformValue &&\n      lastValue &&\n      transformValue.name === lastValue &&\n      values.length === 1\n    ) {\n      if (transformValue.target === \"com.axelor.auth.db.User\") {\n        setShow(false);\n      } else {\n        setShow(true);\n      }\n    } else if (\n      isCollection &&\n      transformValue &&\n      lastValue &&\n      transformValue.name === lastValue &&\n      values.length === 1\n    ) {\n      if ([\"MANY_TO_MANY\", \"ONE_TO_MANY\"].includes(transformValue.type)) {\n        setShow(false);\n        setButton(false);\n      } else {\n        setShow(true);\n      }\n    } else if (isDatePath && transformValue) {\n      if (\n        [\"datetime\", \"date\"].includes(\n          transformValue.type && transformValue.type.toLowerCase()\n        )\n      ) {\n        setShow(false);\n        setButton(false);\n      } else {\n        setShow(true);\n      }\n    } else if (\n      startModel &&\n      transformValue &&\n      lastValue &&\n      transformValue.name === lastValue &&\n      (startModel.fullName === transformValue.target ||\n        startModel.name === transformValue.jsonTarget) &&\n      values.length === 1\n    ) {\n      setShow(false);\n    } else {\n      setShow(true);\n    }\n  }, [isUserPath, startModel, fields, isCollection, isDatePath, fieldName]);\n\n  useEffect(() => {\n    setAllFieldValues(allFields);\n  }, [allFields]);\n\n  return (\n    <React.Fragment>\n      <Selection\n        name=\"fieldName\"\n        title=\"Field Name\"\n        placeholder=\"field name\"\n        options={fields}\n        optionLabelKey=\"name\"\n        onChange={(value) => handleChange(value)}\n        value={transformValue}\n        classes={{\n          root: classnames(\n            classes.MuiAutocompleteRoot,\n            classNames && classNames.root\n          ),\n        }}\n      />\n      {hasManyValues &&\n        relationModel &&\n        (isUserPath\n          ? transformValue &&\n            transformValue.target !== \"com.axelor.meta.db.MetaJsonRecord\" &&\n            !transformValue.jsonField\n          : true) && (\n          <React.Fragment>\n            {isShow && (\n              <IconButton\n                size=\"small\"\n                onClick={() => {\n                  setShow((isShow) => !isShow);\n                  if (fields && fields.length > 0 && startValue) {\n                    const previousField = fields.find(\n                      (f) => f.name === startValue\n                    );\n                    handleChange({\n                      ...(previousField || {}),\n                    });\n                  }\n                }}\n                className={classes.iconButton}\n              >\n                <Tooltip title={translate(\"Remove sub field\")}>\n                  <Close className={classes.icon} fontSize=\"small\" />\n                </Tooltip>\n              </IconButton>\n            )}\n            {isShow && (\n              <FieldEditor\n                getMetaFields={() => {\n                  return getSubMetaField(\n                    relationModel,\n                    relationJsonModel,\n                    isCollection,\n                    allowAllFields\n                  );\n                }}\n                initValue={`${initValue}${startValue}${\".\"}`}\n                value={{\n                  fieldName: values.slice(1).join(\".\"),\n                  allFields,\n                }}\n                onChange={onChange}\n                classNames={classNames}\n                isParent={relationModel ? true : false}\n                isUserPath={isUserPath}\n                isDatePath={isDatePath}\n                startModel={startModel}\n                isCollection={isCollection}\n                allowAllFields={allowAllFields}\n              />\n            )}\n            {!isShow && isButton && (\n              <IconButton\n                size=\"small\"\n                onClick={() => setShow((isShow) => !isShow)}\n                className={classes.iconButton}\n              >\n                <Tooltip title={translate(\"Add sub field\")}>\n                  <ArrowForward className={classes.icon} fontSize=\"small\" />\n                </Tooltip>\n              </IconButton>\n            )}\n          </React.Fragment>\n        )}\n    </React.Fragment>\n  );\n}\n","import React, { useEffect, useState } from \"react\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  DialogContentText,\n  Button,\n  Tooltip,\n} from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Edit, NotInterested } from \"@material-ui/icons\";\n\nimport MapperBuilder from \"../mapper-builder/App\";\nimport { translate } from \"../../utils\";\nimport { Textbox, TextField } from \"../components\";\n\nconst useStyles = makeStyles((theme) => ({\n  expressionBuilder: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n  },\n  newIcon: {\n    color: \"#58B423\",\n    marginLeft: 5,\n  },\n  new: {\n    cursor: \"pointer\",\n    marginTop: 18.6,\n    display: \"flex\",\n  },\n  textbox: {\n    width: \"100%\",\n  },\n  dialog: {\n    minWidth: 300,\n  },\n  title: {\n    fontSize: 18,\n    fontWeight: \"bold\",\n  },\n  save: {\n    margin: theme.spacing(1),\n    backgroundColor: \"#0275d8\",\n    borderColor: \"#0267bf\",\n    textTransform: \"none\",\n    color: \"white\",\n    \"&:hover\": {\n      backgroundColor: \"#025aa5\",\n      borderColor: \"#014682\",\n      color: \"white\",\n    },\n  },\n}));\n\nconst createElement = (elementType, properties, parent, factory) => {\n  let element = factory.create(elementType, properties);\n  element.$parent = parent;\n  return element;\n};\n\nexport default function ScriptProps({ element, bpmnFactory, bpmnModeler }) {\n  const [isReadOnly, setReadOnly] = useState(false);\n  const [openAlert, setAlert] = useState(false);\n  const [openMapper, setMapper] = useState(false);\n  const [alertTitle, setAlertTitle] = useState(null);\n  const [alertMessage, setAlertMessage] = useState(null);\n\n  const classes = useStyles();\n\n  const handleMapperOpen = () => {\n    setMapper(true);\n  };\n\n  const handleCloseMapper = () => {\n    setMapper(false);\n  };\n\n  const getPropertyValue = (name) => {\n    if (!element) return;\n    const bo = element.businessObject;\n    return bo[name];\n  };\n\n  const setProperty = (name, value) => {\n    if (!element) return;\n    const bo = element.businessObject;\n    if (!bo) return;\n    bo[name] = value;\n    if (!value) {\n      delete bo[name];\n    }\n  };\n\n  const onSave = (expr) => {\n    const { resultField, resultMetaField, sourceField, targetField } =\n      expr || {};\n    updateScript(resultField, resultMetaField);\n    setProperty(\"sourceField\", sourceField);\n    setProperty(\"targetField\", targetField);\n    handleCloseMapper();\n  };\n\n  const getExpression = () => {\n    const bo = element && element.businessObject;\n    if (!bo) return {};\n    let script = bo.script && bo.script.value;\n    let scriptMeta = bo.scriptMeta && bo.scriptMeta.value;\n\n    return {\n      resultField: script,\n      resultMetaField: scriptMeta,\n    };\n  };\n\n  const getProperty = React.useCallback(\n    (name) => {\n      let bo = element.businessObject;\n      return (bo && bo[name] && bo[name].value) || \"\";\n    },\n    [element]\n  );\n\n  const updateScript = (scriptValue, scriptMetaValue) => {\n    if (element.businessObject && element.businessObject.script) {\n      element.businessObject.script.value = scriptValue;\n    } else {\n      const script = createElement(\n        \"bpmn:Script\",\n        { value: scriptValue },\n        element.businessObject,\n        bpmnFactory\n      );\n      element.businessObject.script = script;\n    }\n    if (element.businessObject && element.businessObject.scriptMeta) {\n      element.businessObject.scriptMeta.value = scriptMetaValue;\n    } else {\n      const scriptMeta = createElement(\n        \"bpmn:ScriptMeta\",\n        { value: scriptMetaValue },\n        element.businessObject,\n        bpmnFactory\n      );\n      element.businessObject.scriptMeta = scriptMeta;\n    }\n    if (!scriptMetaValue) {\n      delete element.businessObject[\"scriptMeta\"];\n    }\n    if (!scriptValue) {\n      delete element.businessObject[\"script\"];\n    }\n  };\n\n  useEffect(() => {\n    const scriptMeta = getProperty(\"scriptMeta\");\n    setReadOnly(scriptMeta ? true : false);\n  }, [getProperty]);\n\n  return (\n    <React.Fragment>\n      <div className={classes.expressionBuilder}>\n        <Textbox\n          element={element}\n          className={classes.textbox}\n          rows={3}\n          readOnly={isReadOnly}\n          bpmnModeler={bpmnModeler}\n          entry={{\n            id: \"script\",\n            label: translate(\"Script\"),\n            modelProperty: \"script\",\n            name: \"script\",\n            get: function () {\n              const bo = element && element.businessObject;\n              let script = bo && bo.script && bo.script.value;\n              return {\n                script: (script || \"\").replace(/[\\u200B-\\u200D\\uFEFF]/g, \"\"),\n              };\n            },\n            set: function (e, values) {\n              updateScript(values.script, undefined);\n            },\n          }}\n        />\n        <div className={classes.new}>\n          <Tooltip title=\"Enable\" aria-label=\"enable\">\n            <NotInterested\n              className={classes.newIcon}\n              onClick={() => {\n                if (isReadOnly) {\n                  setAlertMessage(\n                    \"Script can't be managed using builder once changed manually.\"\n                  );\n                  setAlertTitle(\"Warning\");\n                  setAlert(true);\n                }\n              }}\n            />\n          </Tooltip>\n          <Edit\n            className={classes.newIcon}\n            onClick={() => {\n              handleMapperOpen();\n            }}\n          />\n          {openMapper && (\n            <MapperBuilder\n              open={openMapper}\n              handleClose={handleCloseMapper}\n              bpmnModeler={bpmnModeler}\n              onSave={(expr) => {\n                onSave(expr);\n                setReadOnly(true);\n              }}\n              params={() => getExpression()}\n            />\n          )}\n          {openAlert && (\n            <Dialog\n              open={openAlert}\n              onClose={(e, reason) => {\n                if (reason !== \"backdropClick\") {\n                  setAlert(false);\n                }\n              }}\n              aria-labelledby=\"alert-dialog-title\"\n              aria-describedby=\"alert-dialog-description\"\n              classes={{\n                paper: classes.dialog,\n              }}\n            >\n              <DialogTitle id=\"alert-dialog-title\">\n                <label className={classes.title}>{translate(alertTitle)}</label>\n              </DialogTitle>\n              <DialogContent>\n                <DialogContentText id=\"alert-dialog-description\">\n                  {translate(alertMessage)}\n                </DialogContentText>\n              </DialogContent>\n              <DialogActions>\n                <Button\n                  onClick={() => {\n                    setAlert(false);\n                    setAlertMessage(null);\n                    setAlertTitle(null);\n                    setReadOnly(false);\n                    if (element.businessObject) {\n                      element.businessObject.scriptValue = undefined;\n                    }\n                  }}\n                  color=\"primary\"\n                  className={classes.save}\n                  autoFocus\n                >\n                  Ok\n                </Button>\n                <Button\n                  onClick={() => {\n                    setAlert(false);\n                  }}\n                  color=\"primary\"\n                  className={classes.save}\n                >\n                  Cancel\n                </Button>\n              </DialogActions>\n            </Dialog>\n          )}\n        </div>\n      </div>\n      <TextField\n        entry={{\n          id: \"sourceField\",\n          label: translate(\"Source Field\"),\n          modelProperty: \"sourceField\",\n          get: function () {\n            return { sourceField: getPropertyValue(\"sourceField\") };\n          },\n          set: function (e, values) {\n            setProperty(\"sourceField\", values.sourceField);\n          },\n        }}\n        bpmnModeler={bpmnModeler}\n        element={element}\n        canRemove={true}\n      />\n      <TextField\n        entry={{\n          id: \"targetField\",\n          label: translate(\"Target Field\"),\n          modelProperty: \"targetField\",\n          get: function () {\n            return { targetField: getPropertyValue(\"targetField\") };\n          },\n          set: function (e, values) {\n            setProperty(\"targetField\", values.targetField);\n          },\n        }}\n        element={element}\n        canRemove={true}\n      />\n    </React.Fragment>\n  );\n}\n","import services from \"../../../services/Service\";\n\nconst joinURL = (model, subURL) => {\n  return `ws/rest/${model}/${subURL}`;\n};\n\nclass AxelorService {\n  constructor(props = {}) {\n    this.model = props.model;\n  }\n\n  search({ fields, sortBy, data, limit, offset }) {\n    const _subURL = `search`;\n    const url = joinURL(this.model, _subURL);\n    return services.post(url, { fields, sortBy, data, limit, offset });\n  }\n\n  fetch(id, data) {\n    const _subURL = `${id}/fetch`;\n    const url = joinURL(this.model, _subURL);\n    return services.post(url, data);\n  }\n\n  view(data) {\n    const url = \"/ws/meta/view\";\n    return services.post(url, data);\n  }\n\n  fields(data) {\n    const url = \"/ws/meta/view/fields\";\n    return services.post(url, data);\n  }\n\n  save(data, spread = false) {\n    const url = joinURL(this.model, \"\");\n    return services.post(url, { ...(spread ? data : { data }) });\n  }\n\n  removeAll(records) {\n    const url = joinURL(this.model, \"removeAll\");\n    return services.post(url, { records });\n  }\n\n  action(name, data) {\n    const url = `/ws/action/${name}`;\n    return services.post(url, { ...data, model: this.model });\n  }\n}\n\nexport default AxelorService;\n","import AxelorService from \"./axelor.rest\";\nimport services from \"../../../services/Service\";\nimport { sortBy } from \"../../../utils\";\nimport {\n  allowed_types,\n  query_custom_types,\n} from \"../extra/data\";\nimport { getButtons } from \"../../../services/api\";\n\nconst metaModalService = new AxelorService({\n  model: \"com.axelor.meta.db.MetaModel\",\n});\n\nconst metaFieldService = new AxelorService({\n  model: \"com.axelor.meta.db.MetaField\",\n});\n\nexport async function getMetaModals({ search = \"\" }) {\n  const data = {\n    ...(search ? { name: search } : {}),\n  };\n  const fields = [\"name\", \"fullName\", \"metaFields\"];\n  return metaModalService\n    .search({ data, fields })\n    .then(({ data = [] }) => data);\n}\n\nconst getResultedFields = (\n  res,\n  isQuery,\n  isM2OField,\n  isContextValue = false\n) => {\n  const responseData = res && res.data;\n  const allFields = responseData && responseData.fields;\n  const jsonFields = Object.values(\n    (responseData && responseData.jsonFields) || [{}]\n  );\n  let result = [];\n  result =\n    (allFields &&\n      allFields.filter(\n        (f) => !f.json && allowed_types.includes((f.type || \"\").toLowerCase())\n      )) ||\n    [];\n\n  jsonFields &&\n    jsonFields.forEach((jsonField) => {\n      const nestedFields = Object.values(jsonField || {}) || [];\n      let fields =\n        nestedFields.filter(\n          (a) =>\n            allowed_types.includes((a.type || \"\").toLowerCase()) &&\n            (a.type === \"many-to-many\" ? a.targetName : true)\n        ) || [];\n      if (isQuery && !isContextValue) {\n        fields =\n          fields.filter(\n            (f) =>\n              ![\n                ...query_custom_types,\n                ...(isM2OField\n                  ? [\n                      \"many_to_one\",\n                      \"json_many_to_one\",\n                      \"many-to-one\",\n                      \"json-many-to-one\",\n                    ]\n                  : []),\n              ].includes((f.type || \"\").toLowerCase())\n          ) || [];\n      }\n      result = [...result, ...fields];\n    });\n  return result;\n};\n\nexport async function getMetaFields(model, isQuery) {\n  if (!model) return [];\n  if (model.type === \"metaModel\") {\n    let res = await services.get(\n      `ws/meta/fields/${\n        model.fullName ? model.fullName : `${model.packageName}.${model.name}`\n      }`\n    );\n    let result = getResultedFields(res, isQuery);\n    const zonedDateTimeFieldsRes = await services.search(\n      \"com.axelor.meta.db.MetaField\",\n      {\n        data: {\n          _domain: `self.metaModel.name = '${model.name}' AND self.typeName = 'ZonedDateTime'`,\n          _domainContext: {\n            _model: \"com.axelor.meta.db.MetaField\",\n          },\n        },\n        fields: [\"name\", \"typeName\", \"metaModel\"],\n      }\n    );\n    const zonedDateTimeFields =\n      zonedDateTimeFieldsRes &&\n      zonedDateTimeFieldsRes.data &&\n      zonedDateTimeFieldsRes.data.length > 0 &&\n      zonedDateTimeFieldsRes.data.map((f) => f.name);\n    if (\n      zonedDateTimeFields &&\n      zonedDateTimeFields.length > 0 &&\n      result &&\n      result.length > 0\n    ) {\n      result.forEach((field) => {\n        if (zonedDateTimeFields.includes(field.name)) {\n          field.typeName = \"ZonedDateTime\";\n        }\n      });\n      return result;\n    }\n    return result;\n  } else {\n    const res = await services.get(\n      `ws/meta/fields/com.axelor.meta.db.MetaJsonRecord?jsonModel=${model.name}`\n    );\n    let result = getResultedFields(res, isQuery);\n    return sortBy(result, \"sequence\") || [];\n  }\n}\n\nexport async function getMetaModal(data) {\n  const res = await metaModalService.search({ data });\n  return res && res.data && res.data[0];\n}\n\nexport async function getSubMetaField(\n  model,\n  isM2MFields = true,\n  isQuery = false,\n  relationJsonModel,\n  isM2OField = false,\n  isContextValue,\n  isAllowedButtons = false\n) {\n  if (model === \"com.axelor.meta.db.MetaJsonRecord\" && relationJsonModel) {\n    const res = await services.get(\n      `ws/meta/fields/com.axelor.meta.db.MetaJsonRecord?jsonModel=${relationJsonModel}`\n    );\n    let result =\n      getResultedFields(res, isQuery, isM2OField, isContextValue) || [];\n    result = result.filter(\n      (a) =>\n        allowed_types.includes((a.type || \"\").toLowerCase()) &&\n        (isQuery ? !a.json : true) &&\n        ((a.type || \"\").toLowerCase() === \"many-to-many\" ? a.targetName : true)\n    );\n    if (isAllowedButtons) {\n      const buttons = await getButtons([\n        {\n          model: relationJsonModel,\n          type: \"metaJsonModel\",\n          modelFullName: model,\n        },\n      ]);\n      result = [...(result || []), ...(buttons || [])];\n    }\n    if (!isM2MFields && result && result.length > 0) {\n      return result.filter(\n        (f) =>\n          ![\"many_to_many\", \"json_many_to_many\"].includes(\n            (f && (f.type || \"\")).toLowerCase().replaceAll(\"-\", \"_\")\n          )\n      );\n    }\n    return sortBy(result, \"sequence\") || [];\n  } else {\n    const data = {\n      criteria: [{ fieldName: \"fullName\", operator: \"=\", value: model }],\n    };\n    const metaModel = await getMetaModal(data);\n    if (!metaModel) return [];\n    const fields = metaModel && metaModel.metaFields.map((f) => f.name);\n    const res = await metaFieldService.fields({\n      fields,\n      model: metaModel.fullName,\n    });\n    let resultFields = res && res.data && res.data.fields;\n    resultFields = resultFields.filter(\n      (a) =>\n        allowed_types.includes((a.type || \"\").toLowerCase()) &&\n        (isQuery ? !a.json : true) &&\n        (a.type === \"many-to-many\" ? a.targetName : true)\n    );\n    if (isAllowedButtons) {\n      const buttons = await getButtons([\n        {\n          model: metaModel && metaModel.name,\n          type: \"metaModel\",\n          modelFullName: metaModel && metaModel.fullName,\n        },\n      ]);\n      resultFields = [...(resultFields || []), ...(buttons || [])];\n    }\n    if (!isM2MFields && resultFields && resultFields.length > 0) {\n      return resultFields.filter(\n        (f) =>\n          ![\"many_to_many\", \"json_many_to_many\"].includes(\n            (f && (f.type || \"\")).toLowerCase().replaceAll(\"-\", \"_\")\n          )\n      );\n    }\n    return resultFields;\n  }\n}\n\nexport async function getData(model) {\n  const modelService = new AxelorService({ model });\n  const res = await modelService.search({});\n  if (res && res.status === -1) return [];\n  return res && res.data;\n}\n\nexport async function getCustomModelData(jsonModel) {\n  const res = await services.search(\"com.axelor.meta.db.MetaJsonRecord\", {\n    data: {\n      criteria: [{ fieldName: \"jsonModel\", operator: \"=\", value: jsonModel }],\n      operator: \"and\",\n    },\n  });\n  if (res && res.status === -1) return [];\n  return res && res.data;\n}\n\nexport async function getNameField(jsonModel) {\n  const res = await services.search(\"com.axelor.meta.db.MetaJsonField\", {\n    data: {\n      criteria: [\n        { fieldName: \"jsonModel\", operator: \"=\", value: jsonModel },\n        { fieldName: \"nameField\", operator: \"=\", value: true },\n      ],\n      operator: \"and\",\n    },\n    fields: [\"name\"],\n  });\n  if (res && res.status > -1) {\n    return res.data && res.data[0];\n  }\n}\n","import React, { useEffect, useState } from \"react\";\nimport classnames from \"classnames\";\nimport { IconButton, Tooltip } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Close, ArrowForward } from \"@material-ui/icons\";\n\nimport { Selection } from \"./components\";\nimport { getSubMetaField } from \"./services/api\";\nimport { isBPMQuery, join_operator } from \"./extra/util\";\nimport { translate } from \"../../utils\";\n\nconst useStyles = makeStyles(() => ({\n  MuiAutocompleteRoot: {\n    width: \"250px\",\n    marginRight: \"10px\",\n  },\n  iconButton: {\n    marginRight: 10,\n  },\n  icon: {\n    color: \"#0275d8\",\n  },\n}));\n\nexport default function FieldEditor({\n  initValue = \"\",\n  getMetaFields,\n  editor,\n  onChange,\n  value,\n  classNames,\n  expression: parentExpression = \"GROOVY\",\n  type,\n  isParent = false,\n  isBPM,\n  isField,\n  setInitialField = () => {},\n  isAllowButtons = false,\n}) {\n  const { fieldName = \"\", allField = [], isShow: propIsShow } = value || {};\n  const [fields, setFields] = useState([]);\n  const classes = useStyles();\n  const isContextValue = isField === \"context\" && isBPMQuery(type) && isBPM;\n  const expression = isBPMQuery(type) ? \"BPM\" : parentExpression;\n  const values =\n    fieldName &&\n    join_operator[expression] &&\n    fieldName.split(isContextValue ? \"?.\" : join_operator[expression]);\n  const isName =\n    values &&\n    values.slice(1) &&\n    values.slice(1).join(isContextValue ? \"?.\" : join_operator[expression]);\n  const [isShow, setShow] = useState(propIsShow || isName ? true : false);\n  const [startValue] = values || [];\n  const hasManyValues =\n    fieldName &&\n    isParent &&\n    fields &&\n    fields.some((x) => x.name === startValue);\n  const relationModel =\n    hasManyValues && (fields.find((x) => x.name === startValue) || {}).target;\n  const relationJsonModel =\n    hasManyValues &&\n    (fields.find((x) => x.name === startValue) || {}).jsonTarget;\n  const fieldType = (fields.find((x) => x.name === startValue) || {}).type;\n  const isM2MField =\n    allField &&\n    allField.length > 0 &&\n    allField.find((f) =>\n      [\"many_to_many\", \"json_many_to_many\"].includes(\n        (f && (f.type || \"\")).toLowerCase().replaceAll(\"-\", \"_\")\n      )\n    );\n  const isM2OField =\n    allField &&\n    allField.length > 0 &&\n    allField.find((f) =>\n      [\"many_to_one\", \"json_many_to_one\"].includes(\n        (f && (f.type || \"\")).toLowerCase().replaceAll(\"-\", \"_\")\n      )\n    );\n  const isOneToOne = [\"one_to_one\", \"json_one_to_one\"].includes(\n    (fieldType || \"\").toLowerCase().replaceAll(\"-\", \"_\")\n  );\n\n  const getUpdatedValue = () => {\n    let spiltedValues = initValue && initValue.split(join_operator[expression]);\n    return (\n      spiltedValues &&\n      spiltedValues.length > 0 &&\n      (spiltedValues.filter(Boolean) || []).join(join_operator[expression])\n    );\n  };\n\n  function handleChange(value) {\n    const isRelationalField =\n      value && fields.some((x) => x.name === value.name && x.target);\n    if (isBPM) {\n      let allFields;\n      let newFieldName = isParent\n        ? value && value.name\n          ? `${initValue}${value.name}`\n          : `${getUpdatedValue()}`\n        : value && value.name\n        ? `${\n            isRelationalField\n              ? isContextValue\n                ? \"?.\"\n                : join_operator[expression]\n              : \"\"\n          }${initValue}${value.name}`\n        : \"\";\n      if (value && allField.findIndex((f) => f.name === value.name) <= -1) {\n        let fieldNames =\n          (newFieldName || \"\").split(\n            isContextValue ? \"?.\" : join_operator[expression]\n          ) || [];\n        let filterFields =\n          (allField && allField.filter((f) => fieldNames.includes(f.name))) ||\n          [];\n        allFields = [...filterFields, value];\n      } else {\n        let fields = [...(allField || [])];\n        let fieldNames = (fieldName || \"\").split(\n          isContextValue ? \"?.\" : join_operator[expression]\n        );\n        fieldNames &&\n          fieldNames.length > 0 &&\n          fieldNames.forEach((fName) => {\n            let index = fields.findIndex((f) => f.name === fName);\n            if (index > -1) {\n              fields.splice(index, 1);\n            }\n          });\n        allFields = fields;\n      }\n      onChange(\n        {\n          name: \"fieldName\",\n          value,\n          fieldNameValue: newFieldName ? newFieldName : undefined,\n          allField: allFields,\n          isShow,\n        },\n        editor\n      );\n      return;\n    }\n    let newFieldName = isParent\n      ? `${initValue}${value ? value.name : \"\"}`\n      : value\n      ? value.name\n      : \"\"\n      ? `${isRelationalField ? join_operator[expression] : \"\"}${initValue}${\n          value ? value.name : \"\"\n        }`\n      : \"\";\n    newFieldName = isBPMQuery(type)\n      ? value && value.name\n        ? newFieldName\n        : newFieldName.slice(0, -1)\n      : newFieldName;\n    onChange(\n      {\n        name: \"fieldName\",\n        value: newFieldName,\n      },\n      editor\n    );\n    onChange({ name: \"fieldType\", value: (value && value.type) || \"\" }, editor);\n    onChange({ name: \"field\", value }, editor);\n    onChange({ name: \"isShow\", value: isShow }, editor);\n    if (value && allField.findIndex((f) => f.name === value.name) <= -1) {\n      let fieldNames =\n        (newFieldName || \"\").split(join_operator[expression]) || [];\n      let allFields =\n        (allField && allField.filter((f) => fieldNames.includes(f.name))) || [];\n      onChange({ name: \"allField\", value: [...allFields, value] }, editor);\n    } else {\n      let fields = [...(allField || [])];\n      let fieldNames = (fieldName || \"\").split(join_operator[expression]);\n      let initValues =\n        `${initValue}${join_operator[expression]}${startValue}`.split(\n          join_operator[expression]\n        );\n      fieldNames &&\n        fieldNames.length > 0 &&\n        fieldNames.forEach((fName) => {\n          let index = fields.findIndex((f) => f.name === fName);\n          if (index > -1 && !(initValues || []).includes(fName)) {\n            fields.splice(index, 1);\n          }\n        });\n      onChange({ name: \"allField\", value: fields }, editor);\n      if (fields && fields.length === 1) {\n        const val = fields[0];\n        onChange({ name: \"fieldType\", value: (val && val.type) || \"\" }, editor);\n        onChange({ name: \"field\", value: val }, editor);\n        setInitialField();\n      } else {\n        const val = fields[fields.length - 1];\n        onChange({ name: \"fieldType\", value: (val && val.type) || \"\" }, editor);\n        onChange({ name: \"field\", value: val }, editor);\n        setInitialField();\n      }\n    }\n  }\n  const transformValue =\n    (fields && fields.find((f) => f.name === startValue)) ||\n    (allField && allField.find((f) => f.name === startValue));\n\n  useEffect(() => {\n    let isSubscribed = true;\n    if (isSubscribed) {\n      setShow(propIsShow || isName ? true : false);\n    }\n    return () => {\n      isSubscribed = false;\n    };\n  }, [propIsShow, isName]);\n\n  useEffect(() => {\n    let isSubscribed = true;\n    (async () => {\n      const data = await getMetaFields();\n      if (isSubscribed) {\n        setFields(data);\n      }\n    })();\n    return () => {\n      isSubscribed = false;\n    };\n  }, [getMetaFields]);\n\n  return (\n    <React.Fragment>\n      <Selection\n        name=\"fieldName\"\n        title=\"Field Name\"\n        placeholder=\"field name\"\n        options={fields}\n        optionLabelKey=\"name\"\n        onChange={(value) => handleChange(value)}\n        value={transformValue}\n        classes={{\n          root: classnames(\n            classes.MuiAutocompleteRoot,\n            classNames && classNames.root\n          ),\n        }}\n      />\n      {hasManyValues && relationModel && (\n        <React.Fragment>\n          {isShow && !isOneToOne && (\n            <IconButton\n              size=\"small\"\n              onClick={() => {\n                setShow((isShow) => !isShow);\n                if (allField && allField.length > 0 && startValue) {\n                  const previousField = allField.find(\n                    (f) => f.name === startValue\n                  );\n                  handleChange({\n                    ...(previousField || {}),\n                  });\n                }\n              }}\n              className={classes.iconButton}\n            >\n              <Tooltip title={translate(\"Remove sub field\")}>\n                <Close className={classes.icon} fontSize=\"small\" />\n              </Tooltip>\n            </IconButton>\n          )}\n          {(isShow || isOneToOne) && (\n            <FieldEditor\n              getMetaFields={() => {\n                return getSubMetaField(\n                  relationModel,\n                  !isBPMQuery(type)\n                    ? isM2MField &&\n                        values &&\n                        values.length > 0 &&\n                        values.includes(isM2MField.name) &&\n                        values[0] !== isM2MField.name\n                    : true,\n                  isBPMQuery(type),\n                  relationJsonModel,\n                  isM2OField,\n                  isBPM,\n                  isAllowButtons\n                );\n              }}\n              editor={editor}\n              initValue={`${initValue}${startValue}${\n                isContextValue ? \"?.\" : join_operator[expression]\n              }`}\n              value={{\n                fieldName: values\n                  .slice(1)\n                  .join(isContextValue ? \"?.\" : join_operator[expression]),\n                allField,\n              }}\n              onChange={onChange}\n              classNames={classNames}\n              expression={expression}\n              type={type}\n              isParent={relationModel ? true : false}\n              isBPM={isBPM}\n              setInitialField={setInitialField}\n              isField={isField}\n              isAllowButtons={isAllowButtons}\n            />\n          )}\n          {!isShow && !isOneToOne && (\n            <IconButton\n              size=\"small\"\n              onClick={() => setShow((isShow) => !isShow)}\n              className={classes.iconButton}\n            >\n              <Tooltip title={translate(\"Add sub field\")}>\n                <ArrowForward className={classes.icon} fontSize=\"small\" />\n              </Tooltip>\n            </IconButton>\n          )}\n        </React.Fragment>\n      )}\n    </React.Fragment>\n  );\n}\n","import React, { useEffect, useState } from \"react\";\nimport AddIcon from \"@material-ui/icons/Add\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport Paper from \"@material-ui/core/Paper\";\nimport classNames from \"classnames\";\nimport moment from \"moment\";\nimport {\n  Radio,\n  RadioGroup,\n  FormControlLabel,\n  IconButton,\n  Tooltip,\n} from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Close, ArrowForward } from \"@material-ui/icons\";\nimport {\n  TimelineContent,\n  TimelineItem,\n  TimelineConnector,\n  TimelineSeparator,\n  Timeline,\n  TimelineOppositeContent,\n  TimelineDot,\n} from \"@material-ui/lab\";\n\nimport { getModels } from \"../../services/api\";\nimport {\n  Select,\n  Button,\n  Selection,\n  DateTimePicker,\n  NumberField,\n  InputField,\n} from \"./components\";\nimport {\n  combinator,\n  operators,\n  operators_by_type,\n  dateFormat,\n  join_operator,\n  allowed_types,\n} from \"./extra/data\";\nimport {\n  getCustomModelData,\n  getNameField,\n  getData,\n  getMetaFields as getMetaFieldsAPI,\n} from \"./services/api\";\nimport { isBPMQuery, lowerCaseFirstLetter } from \"./extra/util\";\nimport FieldEditor from \"./field-editor\";\nimport { translate } from \"../../utils\";\n\nconst useStyles = makeStyles((theme) => ({\n  Container: {\n    display: \"flex\",\n  },\n  rulesGroupHeader: {\n    display: \"flex\",\n  },\n  paper: {\n    margin: theme.spacing(1, 0),\n    padding: theme.spacing(3, 2),\n    overflow: \"auto\",\n  },\n  rules: {\n    display: \"flex\",\n    alignItems: \"flex-end\",\n    justifyContent: \"flex-start\",\n    marginBottom: 15,\n  },\n  MuiAutocompleteRoot: {\n    width: \"250px\",\n    marginRight: \"10px\",\n  },\n  disabled: {\n    pointerEvents: \"none\",\n    opacity: 0.5,\n  },\n  valueFrom: {\n    fontSize: 12,\n    color: \"rgba(0, 0, 0, 0.54)\",\n    fontFamily: '\"Roboto\", \"Helvetica\", \"Arial\", sans-serif',\n  },\n  radio: {\n    padding: \"1px 9px\",\n    color: \"#0275d8\",\n    \"&.MuiRadio-colorSecondary.Mui-checked\": {\n      color: \"#0275d8\",\n    },\n  },\n  operators: {\n    minWidth: 75,\n  },\n  iconButton: {\n    marginRight: 10,\n  },\n  timelineConnector: {\n    backgroundColor: \"#0275d8\",\n  },\n  combinator: {\n    width: \"fit-content\",\n  },\n  icon: {\n    color: \"#0275d8\",\n  },\n  timeline: {\n    height: \"100%\",\n    padding: 0,\n    margin: 0,\n  },\n  timelineOppositeContent: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"flex-end\",\n    maxWidth: 60,\n    padding: 0,\n  },\n}));\n\nasync function fetchField(metaModals, type) {\n  const isQuery = isBPMQuery(type);\n  const allFields = (await getMetaFieldsAPI(metaModals, isQuery)) || [];\n  return allFields.filter(\n    (a) =>\n      allowed_types.includes((a.type || \"\").toLowerCase()) &&\n      (isQuery ? !a.json : true)\n  );\n}\n\nfunction RenderRelationalWidget(props) {\n  const { operator, editor, internalProps, parentType } = props;\n  const { onChange, value, ...rest } = internalProps;\n  const classes = useStyles();\n  const { field = {} } = rest;\n  const { targetName, target, targetModel, model, jsonTarget } = field;\n  const [nameField, setNameField] = useState(null);\n  const fetchData = async () => {\n    let data;\n    if (model === \"com.axelor.meta.db.MetaJsonRecord\" && jsonTarget) {\n      data = await getCustomModelData(jsonTarget);\n      let fieldData = await getNameField(jsonTarget);\n      setNameField(fieldData && fieldData.name);\n    } else {\n      data = await getData(target || targetModel);\n    }\n    return data;\n  };\n  if ([\"like\", \"notLike\"].includes(operator)) {\n    return (\n      <InputField\n        name=\"fieldValue\"\n        onChange={(value) => {\n          let isNameField;\n          if (typeof value !== \"string\" && !isBPMQuery(parentType)) {\n            isNameField =\n              value && value.length > 0\n                ? value && value.find((v) => v && targetName && v[targetName])\n                : value && value[targetName];\n            onChange(\n              { name: \"nameField\", value: isNameField ? nameField : \"id\" },\n              editor\n            );\n          }\n          onChange({ name: \"fieldValue\", value: value }, editor);\n        }}\n        margin=\"none\"\n        style={{ marginTop: \"15px\", width: \"250px !important\" }}\n        value={value}\n        {...rest}\n      />\n    );\n  } else if (\n    [\"contains\", \"notContains\", \"in\", \"notIn\", \"=\", \"!=\"].includes(operator)\n  ) {\n    return (\n      <Selection\n        name=\"fieldValue\"\n        title=\"Value\"\n        placeholder=\"Value\"\n        fetchAPI={fetchData}\n        isMulti={\n          (isBPMQuery(parentType) &&\n            [\"contains\", \"notContains\"].includes(operator)) ||\n          [\"=\", \"!=\"].includes(operator)\n            ? false\n            : true\n        }\n        optionLabelKey={targetName}\n        onChange={(value) => {\n          let isNameField;\n          if (typeof value !== \"string\" && !isBPMQuery(parentType)) {\n            isNameField =\n              value && value.length > 0\n                ? value && value.find((v) => v && targetName && v[targetName])\n                : value && value[targetName];\n            onChange(\n              { name: \"nameField\", value: isNameField ? nameField : \"id\" },\n              editor\n            );\n          }\n          onChange({ name: \"fieldValue\", value: value }, editor);\n        }}\n        value={value || []}\n        classes={{ root: classes.MuiAutocompleteRoot }}\n      />\n    );\n  } else {\n    return null;\n  }\n}\n\nfunction RenderSimpleWidget(props) {\n  const { Component, operator, editor, internalProps } = props;\n  const { onChange, value, value2, classes, style, targetName, ...rest } =\n    internalProps;\n  if ([\"=\", \"!=\", \">\", \">=\", \"<\", \"<=\", \"like\", \"notLike\"].includes(operator)) {\n    return (\n      <Component\n        name=\"fieldValue\"\n        onChange={(value) =>\n          onChange({ name: \"fieldValue\", value: value }, editor)\n        }\n        value={value}\n        style={style}\n        {...rest}\n      />\n    );\n  } else if ([\"between\", \"notBetween\"].includes(operator)) {\n    return (\n      <React.Fragment>\n        <Component\n          name=\"fieldValue\"\n          style={{ marginRight: 8, ...style }}\n          onChange={(value) => onChange({ name: \"fieldValue\", value }, editor)}\n          value={value}\n          {...rest}\n        />\n\n        <Component\n          name=\"fieldValue2\"\n          onChange={(value) =>\n            onChange({ name: \"fieldValue2\", value: value }, editor)\n          }\n          value={value2}\n          style={style}\n          {...rest}\n        />\n      </React.Fragment>\n    );\n  } else if ([\"in\", \"notIn\"].includes(operator)) {\n    return (\n      <Selection\n        name=\"fieldValue\"\n        title=\"Value\"\n        placeholder=\"Value\"\n        isMulti={true}\n        optionLabelKey={targetName}\n        onChange={(val) => {\n          onChange({ name: \"fieldValue\", value: val }, editor);\n        }}\n        value={value || []}\n        classes={{ root: classes.MuiAutocompleteRoot }}\n        optionValueKey=\"name\"\n        {...rest}\n      />\n    );\n  } else {\n    return null;\n  }\n}\n\nfunction RenderWidget({\n  type,\n  operator,\n  onChange,\n  value,\n  classes,\n  parentType,\n  editor,\n  ...rest\n}) {\n  const props = {\n    value: value.fieldValue,\n    value2: value.fieldValue2,\n    onChange,\n    ...rest,\n  };\n\n  let options = [],\n    widgetProps = {};\n  switch (type) {\n    case \"one_to_one\":\n    case \"many_to_one\":\n    case \"many_to_many\":\n    case \"one_to_many\":\n    case \"json_one_to_one\":\n    case \"json_many_to_one\":\n    case \"json_many_to_many\":\n    case \"json_one_to_many\":\n      return (\n        <RenderRelationalWidget\n          operator={operator}\n          editor={editor}\n          internalProps={{ ...props }}\n          parentType={parentType}\n        />\n      );\n    case \"date\":\n    case \"time\":\n    case \"datetime\":\n      const stringToDate = (value) =>\n        value ? moment(value, dateFormat[type]) : null;\n      return (\n        <RenderSimpleWidget\n          Component={DateTimePicker}\n          operator={operator}\n          editor={editor}\n          internalProps={{\n            type,\n            value: stringToDate(value.fieldValue),\n            value2: stringToDate(value.fieldValue2),\n            onChange: ({ name, value }, index) =>\n              onChange(\n                { name, value: value && value.format(dateFormat[type]) },\n                index\n              ),\n            ...rest,\n            margin: \"none\",\n            classes,\n            style: { marginTop: \"15px\", width: \"250px !important\" },\n          }}\n        />\n      );\n    case \"integer\":\n    case \"long\":\n    case \"decimal\":\n    case \"double\":\n      options =\n        rest.field.selectionList &&\n        rest.field.selectionList.map(({ title, value, data }) => ({\n          name: (data && data.value) || value,\n          title: title,\n        }));\n\n      widgetProps = {\n        Component: options ? Select : NumberField,\n        operator,\n        editor,\n        internalProps: {\n          ...(options\n            ? { options, classes, ...props }\n            : {\n                type,\n                ...props,\n                margin: \"none\",\n                classes,\n                style: { marginTop: \"15px\", width: \"250px !important\" },\n              }),\n        },\n      };\n      return <RenderSimpleWidget {...widgetProps} />;\n    case \"enum\":\n      options = rest.field.selectionList.map(({ title, value, data }) => ({\n        name: (data && data.value) || value,\n        title: title,\n      }));\n      return (\n        <RenderSimpleWidget\n          Component={Select}\n          operator={operator}\n          editor={editor}\n          internalProps={{\n            options,\n            classes,\n            ...props,\n          }}\n        />\n      );\n    default:\n      options =\n        rest.field &&\n        rest.field.selectionList &&\n        rest.field.selectionList.map(({ title, value, data }) => ({\n          name: (data && data.value) || value,\n          title: title,\n        }));\n      widgetProps = {\n        Component: options ? Select : InputField,\n        operator,\n        editor,\n        internalProps: {\n          ...(options\n            ? { options, classes, ...props }\n            : {\n                classes,\n                ...props,\n                margin: \"none\",\n                style: { marginTop: \"15px\", width: \"250px !important\" },\n              }),\n        },\n      };\n      return <RenderSimpleWidget {...widgetProps} />;\n  }\n}\n\nfunction Rule(props) {\n  const {\n    getMetaFields,\n    onChange,\n    onRemoveRule,\n    editor,\n    value,\n    expression,\n    parentType,\n    parentMetaModal,\n    isAllowButtons = false,\n  } = props;\n  const {\n    fieldType = \"\",\n    field,\n    operator,\n    fieldValue,\n    fieldValue2 = \"\",\n    isRelationalValue,\n    relatedValueModal,\n    relatedValueFieldName,\n    relatedElseValueModal,\n    relatedElseValueFieldName,\n    isShowMetaModelField: showMetaModelField,\n    isShowElseMetaModelField: showElseMetaModelField,\n  } = value;\n  const classes = useStyles();\n  const type = fieldType && fieldType.toLowerCase().replaceAll(\"-\", \"_\");\n  const [isField, setField] = useState(\n    isRelationalValue ? isRelationalValue : \"none\"\n  );\n  const [metaModal, setMetaModal] = useState(relatedValueModal || null);\n  const [isShowMetaModelField, setIsShowMetaModelField] = useState(\n    showMetaModelField || false\n  );\n  const [elseMetaModal, setElseMetaModal] = useState(\n    relatedElseValueModal || null\n  );\n  const [isShowElseMetaModelField, setIsShowElseMetaModelField] = useState(\n    showElseMetaModelField || false\n  );\n\n  const getValue = (val) => {\n    if (val && typeof val === \"string\") {\n      let values = val.toString().split(\".\");\n      if (values && values.length > 1) {\n        return values.slice(1).join(\".\");\n      } else {\n        return val;\n      }\n    } else {\n      return;\n    }\n  };\n\n  const [elseNameValue, setElseNameValue] = useState(null);\n  const [nameValue, setNameValue] = useState(null);\n\n  const addOperatorByType = (keys, value) => {\n    keys.map((key) => (operators_by_type[key] = value));\n  };\n\n  addOperatorByType(\n    [\"long\", \"decimal\", \"double\", \"date\", \"time\", \"datetime\"],\n    operators_by_type.integer\n  );\n  addOperatorByType(\n    [\"one_to_many\", \"json_one_to_many\"],\n    operators_by_type.text\n  );\n  addOperatorByType(\n    [\"many_to_many\", \"json_many_to_many\"],\n    [\"in\", \"notIn\", \"isNull\", \"contains\", \"notContains\"]\n  );\n  addOperatorByType(\n    [\"many_to_one\", \"one_to_one\", \"json_many_to_one\", \"json_one_to_one\"],\n    [\"=\", \"!=\", \"in\", \"notIn\", \"isNull\", \"isNotNull\"]\n  );\n\n  addOperatorByType(\n    [\"string\"],\n    [\"=\", \"!=\", \"isNull\", \"isNotNull\", \"like\", \"notLike\"]\n  );\n\n  let operatorsOptions = operators.filter((item) => {\n    let operatorType = type;\n    if (operatorType === \"\" && value.fieldName && value.allField.length > 0) {\n      let parentField = value.allField.find((f) => f.name === value.fieldName);\n      operatorType = ((parentField && parentField.type) || \"\").toLowerCase();\n    }\n    return (operators_by_type[operatorType] || []).includes(item.name);\n  });\n\n  const handleChange = (name, value) => {\n    onChange({ name, value }, editor);\n  };\n\n  useEffect(() => {\n    setField(isRelationalValue ? isRelationalValue : \"none\");\n    setMetaModal(relatedValueModal || null);\n    setIsShowMetaModelField(showMetaModelField || false);\n    setElseMetaModal(relatedElseValueModal || null);\n    setIsShowElseMetaModelField(showElseMetaModelField || false);\n  }, [\n    isRelationalValue,\n    relatedValueModal,\n    showMetaModelField,\n    relatedElseValueModal,\n    showElseMetaModelField,\n  ]);\n\n  useEffect(() => {\n    const {\n      fieldValue,\n      allField = [],\n      fieldValue2 = \"\",\n      isRelationalValue,\n      relatedValueModal,\n      relatedValueFieldName,\n      relatedElseValueModal,\n      relatedElseValueFieldName,\n      isShowMetaModelField: showMetaModelField,\n      isShowElseMetaModelField: showElseMetaModelField,\n    } = value;\n    setElseNameValue({\n      allField: allField,\n      field: relatedElseValueFieldName,\n      fieldName:\n        getValue(fieldValue2) ||\n        (relatedElseValueFieldName && relatedElseValueFieldName.name),\n      fieldType: relatedElseValueFieldName && relatedElseValueFieldName.type,\n      fieldValue: null,\n      fieldValue2: null,\n      operator: null,\n      isRelationalValue: isRelationalValue ? isRelationalValue : \"none\",\n      relatedValueFieldName: relatedValueFieldName,\n      relatedValueModal: relatedValueModal,\n      relatedElseValueFieldName: relatedElseValueFieldName,\n      relatedElseValueModal: relatedElseValueModal,\n      isShow: showElseMetaModelField,\n    });\n    setNameValue({\n      allField: allField,\n      field: relatedValueFieldName,\n      fieldName:\n        getValue(fieldValue) ||\n        (relatedValueFieldName && relatedValueFieldName.fieldName),\n      fieldType: relatedValueFieldName && relatedValueFieldName.type,\n      fieldValue: null,\n      fieldValue2: null,\n      operator: null,\n      isRelationalValue: isRelationalValue ? isRelationalValue : \"none\",\n      relatedValueFieldName: relatedValueFieldName,\n      relatedValueModal: relatedValueModal,\n      isShow: showMetaModelField,\n    });\n  }, [value]);\n\n  return (\n    <div className={classes.rules}>\n      <FieldEditor\n        getMetaFields={getMetaFields}\n        isField={isField}\n        editor={editor}\n        onChange={onChange}\n        value={value}\n        expression={expression}\n        type={parentType}\n        isParent={true}\n        isAllowButtons={isAllowButtons}\n        setInitialField={() => {\n          setField(\"none\");\n        }}\n      />\n      <React.Fragment>\n        <Select\n          name=\"operator\"\n          title=\"Operator\"\n          options={\n            field && field.selectionList\n              ? operators.filter((o) =>\n                  (isField && isField !== \"none\"\n                    ? [\"=\", \"!=\", \"isNull\", \"isNotNull\"]\n                    : [\"=\", \"!=\", \"isNull\", \"isNotNull\", \"in\", \"notIn\"]\n                  ).includes(o.name)\n                )\n              : isField && isField !== \"none\"\n              ? operatorsOptions.filter(\n                  (o) => o.name !== \"in\" && o.name !== \"notIn\"\n                )\n              : operatorsOptions\n          }\n          onChange={(value) => {\n            onChange({ name: \"operator\", value }, editor);\n            setField(null);\n          }}\n          value={operator}\n          className={classes.operators}\n        />\n        {operator &&\n          field.type !== \"button\" &&\n          ![\"isNull\", \"isNotNull\", \"isTrue\", \"isFalse\"].includes(operator) && (\n            <RadioGroup\n              aria-label=\"radioType\"\n              name=\"radioType\"\n              value={isField || \"none\"}\n              onChange={(e) => {\n                setField(e.target.value);\n                setNameValue({\n                  fieldValue: null,\n                });\n                handleChange(\"fieldValue\", null);\n                setElseNameValue({\n                  fieldValue2: null,\n                });\n                handleChange(\"fieldValue2\", null);\n                if (\n                  e.target.value &&\n                  (operator === \"in\" || operator === \"notIn\")\n                ) {\n                  onChange({ name: \"operator\", value: undefined }, editor);\n                  setField(null);\n                }\n                if (e.target.value) {\n                  handleChange(\n                    \"isRelationalValue\",\n                    e.target.value === \"none\" ? null : e.target.value\n                  );\n                  handleChange(\"fieldValue\", null);\n                  handleChange(\"fieldValue2\", null);\n                  if (e.target.value === \"self\") {\n                    setMetaModal(parentMetaModal);\n                    setElseMetaModal(parentMetaModal);\n                    handleChange(\"relatedValueModal\", parentMetaModal);\n                    handleChange(\"relatedElseValueModal\", parentMetaModal);\n                  } else {\n                    setMetaModal(null);\n                    setElseMetaModal(null);\n                    setIsShowElseMetaModelField(false);\n                    setIsShowMetaModelField(false);\n                    handleChange(\"relatedValueModal\", null);\n                    handleChange(\"relatedElseValueModal\", null);\n                  }\n                } else {\n                  handleChange(\"relatedValueFieldName\", null);\n                  handleChange(\"relatedValueModal\", null);\n                  handleChange(\"relatedElseValueFieldName\", null);\n                  handleChange(\"relatedElseValueModal\", null);\n                }\n              }}\n            >\n              <label className={classes.valueFrom}>Value from</label>\n              <FormControlLabel\n                value=\"self\"\n                control={<Radio className={classes.radio} size=\"small\" />}\n                label=\"Self\"\n              />\n              <FormControlLabel\n                value=\"context\"\n                control={<Radio className={classes.radio} size=\"small\" />}\n                label=\"Context\"\n              />\n              <FormControlLabel\n                value=\"none\"\n                control={<Radio className={classes.radio} size=\"small\" />}\n                label=\"None\"\n              />\n            </RadioGroup>\n          )}\n      </React.Fragment>\n      {isField &&\n      isField !== \"none\" &&\n      operator &&\n      ![\"isNull\", \"isNotNull\", \"isTrue\", \"isFalse\"].includes(operator) ? (\n        <React.Fragment>\n          {isField === \"context\" && (\n            <React.Fragment>\n              <Selection\n                name=\"metaModal\"\n                title=\"Model\"\n                placeholder=\"Model\"\n                fetchAPI={() => getModels()}\n                optionLabelKey=\"name\"\n                onChange={(e) => {\n                  setMetaModal(e);\n                  if (e) {\n                    setNameValue({\n                      fieldValue: lowerCaseFirstLetter(e.name),\n                    });\n                    handleChange(\"relatedValueModal\", e);\n                    handleChange(\"fieldValue\", lowerCaseFirstLetter(e.name));\n                  } else {\n                    setNameValue({\n                      fieldValue: null,\n                    });\n                    handleChange(\"fieldValue\", null);\n                  }\n                }}\n                value={metaModal}\n                classes={{ root: classes.MuiAutocompleteRoot }}\n              />\n              {isShowMetaModelField && isField === \"context\" && (\n                <IconButton\n                  size=\"small\"\n                  onClick={() => {\n                    setIsShowMetaModelField(false);\n                    handleChange(\"isShowMetaModelField\", false);\n                    if (!metaModal) return;\n                    const model = metaModal.name;\n                    setNameValue({\n                      fieldValue: lowerCaseFirstLetter(model),\n                    });\n                    handleChange(\"relatedValueModal\", metaModal);\n                    handleChange(\"fieldValue\", lowerCaseFirstLetter(model));\n                  }}\n                  className={classes.iconButton}\n                >\n                  <Tooltip title={translate(\"Remove sub field\")}>\n                    <Close color=\"primary\" fontSize=\"small\" />\n                  </Tooltip>\n                </IconButton>\n              )}\n            </React.Fragment>\n          )}\n          {(isShowMetaModelField || isField === \"self\") && (\n            <FieldEditor\n              getMetaFields={() =>\n                isField === \"context\"\n                  ? fetchField(metaModal, parentType)\n                  : getMetaFields()\n              }\n              editor={editor}\n              isField={isField}\n              onChange={(\n                { value, fieldNameValue, allField, isShow },\n                editor\n              ) => {\n                setNameValue({\n                  allField: allField,\n                  field: value,\n                  fieldName: fieldNameValue,\n                  fieldType: value && value.type,\n                  fieldValue: null,\n                  fieldValue2: null,\n                  operator: null,\n                  isRelationalValue: isField === \"none\" ? null : isField,\n                  relatedValueFieldName: null,\n                  relatedValueModal: null,\n                  isShow,\n                  isShowMetaModelField,\n                });\n                handleChange(\n                  \"isRelationalValue\",\n                  isField === \"none\" ? null : isField\n                );\n                handleChange(\"relatedValueFieldName\", value);\n                handleChange(\"relatedValueModal\", metaModal);\n                let isBPM = isBPMQuery(parentType);\n                const isContextValue = isField === \"context\" && isBPM;\n                handleChange(\n                  \"fieldValue\",\n                  fieldNameValue\n                    ? (parentMetaModal && parentMetaModal.id) ===\n                      (metaModal && metaModal.id)\n                      ? isBPM\n                        ? `self.${fieldNameValue}`\n                        : `${lowerCaseFirstLetter(\n                            (metaModal && metaModal.name) ||\n                              (parentMetaModal && parentMetaModal.name) ||\n                              \"self\"\n                          )}${\n                            isContextValue\n                              ? \"?.\"\n                              : join_operator[isBPM ? \"BPM\" : expression]\n                          }${fieldNameValue}${\n                            value && value.typeName && !isBPM\n                              ? `${\n                                  isContextValue\n                                    ? \"?.\"\n                                    : join_operator[expression]\n                                }toLocalDateTime()`\n                              : \"\"\n                          }`\n                      : `${lowerCaseFirstLetter(\n                          (metaModal && metaModal.name) ||\n                            (parentMetaModal && parentMetaModal.name) ||\n                            isBPM\n                            ? \"self\"\n                            : \"\"\n                        )}${\n                          isContextValue\n                            ? \"?.\"\n                            : join_operator[isBPM ? \"BPM\" : expression]\n                        }${fieldNameValue}${\n                          value &&\n                          [\n                            \"json-many-to-one\",\n                            \"MANY_TO_ONE\",\n                            \"many-to-one\",\n                          ].includes(value.type) &&\n                          isBPM &&\n                          isField === \"context\"\n                            ? `${\n                                isContextValue\n                                  ? \"?.\"\n                                  : join_operator[expression]\n                              }getTarget()`\n                            : \"\"\n                        }${\n                          value && value.typeName && !isBPM\n                            ? `${\n                                isContextValue\n                                  ? \"?.\"\n                                  : join_operator[expression]\n                              }toLocalDateTime()`\n                            : \"\"\n                        }`\n                    : undefined\n                );\n              }}\n              value={nameValue}\n              expression={expression}\n              type={parentType}\n              isParent={true}\n              isBPM={true}\n            />\n          )}\n          {!isShowMetaModelField && metaModal && isField === \"context\" && (\n            <IconButton\n              size=\"small\"\n              onClick={() => {\n                setIsShowMetaModelField(true);\n                handleChange(\"isShowMetaModelField\", true);\n              }}\n              className={classes.iconButton}\n            >\n              <Tooltip title={translate(\"Add sub field\")}>\n                <ArrowForward className={classes.icon} fontSize=\"small\" />\n              </Tooltip>\n            </IconButton>\n          )}\n          {[\"between\", \"notBetween\"].includes(operator) && (\n            <React.Fragment>\n              {isField === \"context\" && (\n                <React.Fragment>\n                  <Selection\n                    name=\"metaModal\"\n                    title=\"Meta Modal Else\"\n                    placeholder=\"meta modal\"\n                    fetchAPI={() => getModels()}\n                    optionLabelKey=\"name\"\n                    onChange={(e) => {\n                      setElseMetaModal(e);\n                      if (e) {\n                        setElseNameValue({\n                          fieldValue2: lowerCaseFirstLetter(e.name),\n                        });\n                        handleChange(\"relatedElseValueModal\", e);\n                        handleChange(\n                          \"fieldValue2\",\n                          lowerCaseFirstLetter(e.name)\n                        );\n                      } else {\n                        setElseNameValue({\n                          fieldValue2: null,\n                        });\n                        handleChange(\"fieldValue2\", null);\n                      }\n                    }}\n                    value={elseMetaModal}\n                    classes={{ root: classes.MuiAutocompleteRoot }}\n                  />\n                  {isShowElseMetaModelField && isField === \"context\" && (\n                    <IconButton\n                      size=\"small\"\n                      onClick={() => {\n                        setIsShowElseMetaModelField(false);\n                        handleChange(\"isShowElseMetaModelField\", false);\n                        if (!elseMetaModal) return;\n                        const model = elseMetaModal.name;\n                        setNameValue({\n                          fieldValue: lowerCaseFirstLetter(model),\n                        });\n                        handleChange(\"relatedElseValueModal\", elseMetaModal);\n                        handleChange(\n                          \"fieldValue2\",\n                          lowerCaseFirstLetter(model)\n                        );\n                      }}\n                      className={classes.iconButton}\n                    >\n                      <Tooltip title={translate(\"Remove sub field\")}>\n                        <Close color=\"primary\" fontSize=\"small\" />\n                      </Tooltip>\n                    </IconButton>\n                  )}\n                </React.Fragment>\n              )}\n              {(isShowElseMetaModelField || isField === \"self\") && (\n                <FieldEditor\n                  getMetaFields={() => fetchField(elseMetaModal, type)}\n                  editor={editor}\n                  isField={isField}\n                  onChange={(\n                    { value, fieldNameValue, allField, isShow },\n                    editor\n                  ) => {\n                    setElseNameValue({\n                      allField: allField,\n                      field: value,\n                      fieldName: fieldNameValue,\n                      fieldType: value && value.type,\n                      fieldValue: null,\n                      fieldValue2: null,\n                      operator: null,\n                      isRelationalValue: isField === \"none\" ? null : isField,\n                      relatedValueFieldName: relatedValueFieldName,\n                      relatedValueModal: relatedElseValueModal,\n                      relatedElseValueFieldName: relatedElseValueFieldName,\n                      relatedElseValueModal: relatedElseValueModal,\n                      isShow,\n                      isShowMetaModelField,\n                      isShowElseMetaModelField,\n                    });\n                    handleChange(\"relatedElseValueFieldName\", value);\n                    handleChange(\"relatedElseValueModal\", elseMetaModal);\n                    let isBPM = isBPMQuery(parentType);\n                    const isContextValue = isField === \"context\" && isBPM;\n                    handleChange(\n                      \"fieldValue2\",\n                      fieldNameValue\n                        ? (parentMetaModal && parentMetaModal.id) ===\n                          (elseMetaModal && elseMetaModal.id)\n                          ? isBPM\n                            ? `self.${fieldNameValue}`\n                            : `${lowerCaseFirstLetter(\n                                metaModal &&\n                                  metaModal.name &&\n                                  parentMetaModal &&\n                                  parentMetaModal.name\n                              )}${\n                                isContextValue\n                                  ? \"?.\"\n                                  : join_operator[isBPM ? \"BPM\" : expression]\n                              }${fieldNameValue}${\n                                value && value.typeName && !isBPM\n                                  ? `${\n                                      isContextValue\n                                        ? \"?.\"\n                                        : join_operator[expression]\n                                    }toLocalDateTime()`\n                                  : \"\"\n                              }`\n                          : `${lowerCaseFirstLetter(\n                              elseMetaModal && elseMetaModal.name\n                            )}${\n                              isContextValue\n                                ? \"?.\"\n                                : join_operator[isBPM ? \"BPM\" : expression]\n                            }${fieldNameValue}${\n                              value &&\n                              [\n                                \"json-many-to-one\",\n                                \"MANY_TO_ONE\",\n                                \"many-to-one\",\n                              ].includes(value.type) &&\n                              isBPM &&\n                              isField === \"context\"\n                                ? `${\n                                    isContextValue\n                                      ? \"?.\"\n                                      : join_operator[expression]\n                                  }getTarget()`\n                                : \"\"\n                            }${\n                              value && value.typeName && !isBPM\n                                ? `${\n                                    isContextValue\n                                      ? \"?.\"\n                                      : join_operator[expression]\n                                  }toLocalDateTime()`\n                                : \"\"\n                            }`\n                        : undefined\n                    );\n                  }}\n                  value={elseNameValue}\n                  expression={expression}\n                  type={parentType}\n                  isParent={true}\n                  isBPM={true}\n                />\n              )}\n              {!isShowElseMetaModelField &&\n                elseMetaModal &&\n                isField === \"context\" && (\n                  <IconButton\n                    size=\"small\"\n                    onClick={() => {\n                      setIsShowElseMetaModelField(true);\n                      handleChange(\"isShowElseMetaModelField\", true);\n                    }}\n                    className={classes.iconButton}\n                  >\n                    <Tooltip title={translate(\"Add sub field\")}>\n                      <ArrowForward className={classes.icon} fontSize=\"small\" />\n                    </Tooltip>\n                  </IconButton>\n                )}\n            </React.Fragment>\n          )}\n        </React.Fragment>\n      ) : (\n        operator &&\n        (field.type === \"button\" ? (\n          <Select\n            name=\"fieldValue\"\n            onChange={(value) =>\n              onChange({ name: \"fieldValue\", value: value }, editor)\n            }\n            value={fieldValue}\n            options={[\n              { name: true, title: \"true\" },\n              { name: false, title: \"false\" },\n            ]}\n            className={classes.operators}\n          />\n        ) : (\n          <RenderWidget\n            type={type}\n            parentType={parentType}\n            operator={operator}\n            onChange={(e, editor) => {\n              onChange(e, editor);\n              handleChange(\"isRelationalValue\", null);\n              handleChange(\"relatedValueFieldName\", null);\n              handleChange(\"relatedValueModal\", null);\n            }}\n            value={{ fieldValue, fieldValue2 }}\n            classes={classes}\n            editor={editor}\n            field={field}\n          />\n        ))\n      )}\n      <Button Icon={DeleteIcon} onClick={onRemoveRule} />\n    </div>\n  );\n}\n\nexport default function Editor({\n  onAddGroup,\n  isRemoveGroup,\n  onRemoveGroup,\n  onAddRule,\n  onRemoveRule,\n  editor = {},\n  getChildEditors,\n  onChange,\n  getMetaFields,\n  isDisable,\n  expression,\n  type,\n  parentMetaModal,\n  element,\n  isAllowButtons = false,\n}) {\n  const classes = useStyles();\n  const [isBPM, setBPM] = useState(false);\n  const { id, rules = [] } = editor;\n  const childEditors = getChildEditors(editor.id);\n\n  useEffect(() => {\n    const isBPM = isBPMQuery(type);\n    setBPM(isBPM);\n  }, [type]);\n\n  return (\n    <Paper\n      variant=\"outlined\"\n      className={classNames(classes.paper, isDisable && classes.disabled)}\n    >\n      <div className={classNames(classes.rulesGroupHeader)}>\n        <Timeline align=\"alternate\" className={classes.timeline}>\n          <TimelineItem>\n            <TimelineOppositeContent\n              className={classes.timelineOppositeContent}\n            >\n              <Select\n                name=\"combinator\"\n                className={classes.combinator}\n                disableUnderline={true}\n                options={combinator}\n                value={editor.combinator || \"and\"}\n                onChange={(value) =>\n                  onChange({ name: \"combinator\", value }, editor)\n                }\n              />\n            </TimelineOppositeContent>\n            <TimelineSeparator>\n              <TimelineDot\n                variant=\"outlined\"\n                style={{ borderColor: \"#0275d8\" }}\n              />\n              <TimelineConnector className={classes.timelineConnector} />\n            </TimelineSeparator>\n            <TimelineContent>\n              <Button\n                title=\"Add Group\"\n                Icon={AddIcon}\n                onClick={() => onAddGroup(id)}\n              />\n              {isRemoveGroup && (\n                <Button\n                  title=\"Remove Group\"\n                  Icon={DeleteIcon}\n                  onClick={() => onRemoveGroup(id)}\n                />\n              )}\n              {rules.map((rule, i) => (\n                <React.Fragment key={i}>\n                  <Rule\n                    getMetaFields={getMetaFields}\n                    onRemoveRule={() => onRemoveRule(editor.id, i)}\n                    onChange={(e, editor) => onChange(e, editor, i)}\n                    editor={editor}\n                    value={rule}\n                    expression={expression}\n                    parentType={type}\n                    isBPM={isBPM}\n                    parentMetaModal={parentMetaModal}\n                    element={element}\n                    isAllowButtons={isAllowButtons}\n                  />\n                </React.Fragment>\n              ))}\n              <Button\n                title=\"Add Rule\"\n                Icon={AddIcon}\n                onClick={() => onAddRule(id)}\n              />\n              {childEditors.map((editor, i) => (\n                <React.Fragment key={editor.id}>\n                  <Editor\n                    isRemoveGroup={true}\n                    onAddGroup={onAddGroup}\n                    onRemoveGroup={onRemoveGroup}\n                    onAddRule={onAddRule}\n                    onRemoveRule={onRemoveRule}\n                    getChildEditors={getChildEditors}\n                    getMetaFields={getMetaFields}\n                    onChange={(e, editor, i) => onChange(e, editor, i)}\n                    editor={editor}\n                    type={type}\n                    element={element}\n                    expression={expression}\n                    isAllowButtons={isAllowButtons}\n                  />\n                </React.Fragment>\n              ))}\n            </TimelineContent>\n          </TimelineItem>\n        </Timeline>\n      </div>\n    </Paper>\n  );\n}\n","import React, { useState, useEffect } from \"react\";\nimport produce from \"immer\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Paper } from \"@material-ui/core\";\n\nimport Editor from \"./editor\";\nimport { getMetaFields } from \"./services/api\";\nimport { getButtons, getDMNFields, getModels } from \"../../services/api\";\nimport { isBPMQuery } from \"./extra/util\";\nimport { allowed_types } from \"./extra/data\";\nimport { Selection } from \"./components\";\n\nconst useStyles = makeStyles((theme) => ({\n  Container: {\n    display: \"flex\",\n  },\n  rulesGroupHeader: {\n    display: \"flex\",\n  },\n  paper: {\n    margin: theme.spacing(1),\n    padding: theme.spacing(3, 2),\n  },\n  rules: {\n    display: \"flex\",\n  },\n  MuiAutocompleteRoot: {\n    width: \"100%\",\n    marginRight: \"10px\",\n  },\n  MuiAutocompleteRoot1: {\n    width: \"500px\",\n  },\n  title: {\n    flexGrow: 1,\n  },\n  disabled: {\n    pointerEvents: \"none\",\n    opacity: 0.5,\n  },\n  popoverContainer: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    padding: theme.spacing(2),\n  },\n  typography: {\n    display: \"flex\",\n  },\n  popoverHeader: {\n    display: \"flex\",\n    alignItems: \"center\",\n    borderBottom: \"solid 1px #DDD\",\n  },\n}));\n\nlet id = 0;\n\nconst defaultRules = {\n  id,\n  parentId: -1,\n  combinator: \"and\",\n  rules: [{}],\n};\n\nconst defaultState = {\n  rules: [defaultRules],\n};\n\nfunction ExpressionBuilder(props) {\n  const {\n    value = defaultState,\n    setValue,\n    index,\n    element,\n    type,\n    processConfigs,\n    isAllowButtons,\n    defaultModel,\n  } = props;\n\n  const { metaModals: model, rules: r } = value;\n  const [expression] = useState(\"GROOVY\");\n  const [metaModals, setMetaModals] = useState(model || defaultModel);\n  const [rules, setRules] = useState(r);\n  const classes = useStyles();\n\n  function onAddGroup(parentId) {\n    id = (rules ? rules.length : id) + 1;\n    setRules((state) => [...state, { id, parentId, rules: [] }]);\n  }\n\n  function onRemoveGroup(id) {\n    setRules(\n      produce((draft) => {\n        const index = rules.findIndex((r) => r.id === id);\n        draft.splice(index, 1);\n      })\n    );\n  }\n\n  function onAddRule(editorId, rule = {}) {\n    setRules(\n      produce((draft) => {\n        const editorIndex = rules.findIndex((i) => i.id === editorId);\n        draft[editorIndex].rules = [...draft[editorIndex].rules, rule];\n      })\n    );\n  }\n\n  function onRemoveRule(editorId, index) {\n    setRules(\n      produce((draft) => {\n        const editorIndex = rules.findIndex((i) => i.id === editorId);\n        draft[editorIndex].rules.splice(index, 1);\n      })\n    );\n  }\n\n  const getChildEditors = (parentId) => {\n    return rules.filter((editor) => editor.parentId === parentId);\n  };\n\n  function onChange({ name, value }, editor, index) {\n    setRules(\n      produce((draft) => {\n        const editorIndex = rules.findIndex((i) => i.id === editor.id);\n        if (index >= 0) {\n          Object.assign(\n            (draft[editorIndex].rules[index] = {\n              ...draft[editorIndex].rules[index],\n              [name]: value,\n              ...(name === \"fieldName\"\n                ? {\n                    operator: \"\",\n                    fieldValue: null,\n                    fieldValue2: null,\n                    isRelationalValue: null,\n                    relatedValueFieldName: null,\n                    relatedValueModal: null,\n                  }\n                : {}),\n              ...(name === \"operator\"\n                ? {\n                    fieldValue: null,\n                    fieldValue2: null,\n                    isRelationalValue: null,\n                    relatedValueFieldName: null,\n                    relatedValueModal: null,\n                  }\n                : {}),\n            })\n          );\n        } else {\n          draft[editorIndex][name] = value;\n        }\n      })\n    );\n  }\n\n  async function fetchField() {\n    if (model && model.type === \"dmnModel\") {\n      const dmnFieldIds = model.outputDmnFieldList.map((f) => f.id);\n      if (dmnFieldIds && dmnFieldIds.length > 0) {\n        const dmnFields = await getDMNFields({\n          data: {\n            criteria: [{ fieldName: \"id\", operator: \"IN\", value: dmnFieldIds }],\n          },\n        });\n        return (\n          dmnFields &&\n          dmnFields.map((f) => {\n            return { ...f, type: f.fieldType };\n          })\n        );\n      }\n    }\n    const isQuery = isBPMQuery(type);\n    let allFields = (await getMetaFields(metaModals, isQuery)) || [];\n    if (metaModals && isAllowButtons) {\n      const buttons = await getButtons([\n        {\n          model: metaModals.name,\n          type: metaModals.type,\n          modelFullName: `${metaModals.packageName}.${metaModals.name}`,\n        },\n      ]);\n      allFields = [...(allFields || []), ...(buttons || [])];\n    }\n    return allFields.filter((a) => {\n      return (\n        (isAllowButtons\n          ? [...allowed_types, \"button\"]\n          : allowed_types\n        ).includes((a.type || \"\").toLowerCase()) && (isQuery ? !a.json : true)\n      );\n    });\n  }\n\n  async function fetchModels() {\n    return getModels();\n  }\n\n  useEffect(() => {\n    setMetaModals(model || defaultModel);\n    setRules(r);\n  }, [r, model, defaultModel]);\n\n  useEffect(() => {\n    setValue({ metaModals, rules }, index);\n  }, [index, setValue, metaModals, rules]);\n\n  return (\n    <div style={{ width: \"100%\" }}>\n      <Paper\n        variant=\"outlined\"\n        className={classes.paper}\n        style={{\n          border: isBPMQuery(type) ? \"none\" : \"1px solid rgba(0, 0, 0, 0.12)\",\n        }}\n      >\n        {!isBPMQuery(type) && (\n          <div\n            style={{ display: \"flex\", width: \"100%\", flexDirection: \"column\" }}\n          >\n            <div style={{ display: \"flex\" }}>\n              <Selection\n                name=\"metaModal\"\n                title=\"Model\"\n                placeholder=\"meta modal\"\n                fetchAPI={fetchModels}\n                optionLabelKey=\"name\"\n                onChange={(e) => {\n                  setMetaModals(e);\n                  setRules([defaultRules]);\n                }}\n                readOnly={defaultModel ? true : false}\n                value={metaModals}\n                classes={{ root: classes.MuiAutocompleteRoot }}\n              />\n            </div>\n          </div>\n        )}\n        {rules\n          .filter((e) => e.parentId === -1)\n          .map((editor) => {\n            return (\n              <React.Fragment key={editor.id}>\n                <Editor\n                  onAddGroup={onAddGroup}\n                  onRemoveGroup={onRemoveGroup}\n                  onAddRule={onAddRule}\n                  onRemoveRule={onRemoveRule}\n                  getChildEditors={getChildEditors}\n                  getMetaFields={fetchField}\n                  onChange={(e, editor, index) => onChange(e, editor, index)}\n                  editor={editor}\n                  isDisable={!Boolean(metaModals)}\n                  expression={expression}\n                  type={type}\n                  parentMetaModal={metaModals}\n                  element={element}\n                  processConfigs={processConfigs}\n                  isAllowButtons={isAllowButtons}\n                />\n                <br />\n              </React.Fragment>\n            );\n          })}\n      </Paper>\n    </div>\n  );\n}\n\nexport default ExpressionBuilder;\n","import React, { useEffect, useState } from \"react\";\nimport jsStringEscape from \"js-string-escape\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport {\n  Dialog,\n  DialogTitle,\n  Checkbox,\n  FormControlLabel,\n  DialogContent,\n  DialogActions,\n  DialogContentText,\n  Button as MaterialButton,\n  Paper,\n} from \"@material-ui/core\";\nimport {\n  TimelineContent,\n  TimelineItem,\n  TimelineConnector,\n  TimelineSeparator,\n  Timeline,\n  TimelineOppositeContent,\n  TimelineDot,\n} from \"@material-ui/lab\";\nimport AddIcon from \"@material-ui/icons/Add\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport produce from \"immer\";\nimport moment from \"moment\";\nimport { isEmpty } from \"lodash\";\nimport _ from \"lodash\";\n\nimport ExpressionComponent from \"./expression-builder\";\nimport { Button, Select } from \"./components\";\nimport {\n  combinator as combinators,\n  map_operator,\n  join_operator,\n  dateFormat,\n  map_combinator,\n  map_bpm_combinator,\n  positive_operators,\n} from \"./extra/data\";\nimport { getModels, getDMNModels } from \"../../services/api\";\nimport {\n  isBPMQuery,\n  lowerCaseFirstLetter,\n  upperCaseFirstLetter,\n  getJsonExpression,\n} from \"./extra/util\";\n\nconst useStyles = makeStyles((theme) => ({\n  paper: {\n    margin: theme.spacing(1),\n    padding: theme.spacing(3, 2),\n    width: `calc(100% - 50px)`,\n    display: \"flex\",\n    height: \"calc(100% - 50px)\",\n    overflow: \"auto\",\n  },\n  expressionContainer: {\n    display: \"flex\",\n    alignItems: \"center\",\n    width: \"100%\",\n  },\n  dialogPaper: {\n    maxWidth: \"100%\",\n    maxHeight: \"100%\",\n    resize: \"both\",\n    width: \"70%\",\n    height: 650,\n  },\n  dialog: {\n    minWidth: 300,\n  },\n  root: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"flex-start\",\n    height: \"100%\",\n    overflow: \"hidden\",\n  },\n  combinator: {\n    width: \"fit-content\",\n  },\n  timelineConnector: {\n    backgroundColor: \"#0275d8\",\n  },\n  save: {\n    margin: theme.spacing(1),\n    backgroundColor: \"#0275d8\",\n    borderColor: \"#0267bf\",\n    color: \"white\",\n    \"&:hover\": {\n      backgroundColor: \"#025aa5\",\n      borderColor: \"#014682\",\n      color: \"white\",\n    },\n  },\n  timeline: {\n    width: \"100%\",\n    padding: 0,\n    margin: 0,\n    justifyContent: \"flex-start\",\n  },\n  timelineOppositeContent: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"flex-end\",\n    maxWidth: 60,\n    padding: 0,\n  },\n  checkbox: {\n    color: \"#0275d8\",\n    \"&.MuiCheckbox-colorSecondary.Mui-checked\": {\n      color: \"#0275d8\",\n    },\n  },\n  timelineItem: {\n    \"&.MuiTimelineItem-missingOppositeContent:before\": {\n      padding: 0,\n    },\n  },\n  expression: {\n    height: \"100%\",\n    width: \"100%\",\n  },\n}));\n\nfunction ExpressionBuilder({\n  handleClose,\n  open,\n  element,\n  setProperty,\n  getExpression,\n  type: parentType = \"expressionBuilder\",\n  title = \"Add Expression\",\n  processConfigs,\n  isAllowButtons = true,\n  allowAllModels = false,\n  bpmnModeler,\n  defaultModel,\n}) {\n  const expression = isBPMQuery(parentType) ? \"BPM\" : \"GROOVY\";\n  const [combinator, setCombinator] = useState(\"and\");\n  const [openAlert, setAlert] = useState(false);\n  const [expressionComponents, setExpressionComponents] = useState([\n    { Component: ExpressionComponent },\n  ]);\n  const [generateWithId, setGenerateWithId] = useState(false);\n  const [alertConfig, setAlertConfig] = useState({\n    alertMessage: \"Add all values\",\n    alertTitle: \"Error\",\n  });\n  const [isClose, setClose] = useState(false);\n  const [initialValues, setInitialValues] = useState(null);\n\n  const classes = useStyles();\n  function onAddExpressionEditor() {\n    setExpressionComponents(\n      produce((draft) => {\n        draft.push({ Component: ExpressionComponent.bind({}) });\n      })\n    );\n  }\n\n  function onRemoveExpressionEditor(index) {\n    setExpressionComponents(\n      produce((draft) => {\n        draft.splice(index, 1);\n      })\n    );\n  }\n\n  function getRelationalCondition(\n    rule,\n    initValue = \"\",\n    isParent = false,\n    prefix\n  ) {\n    const map_operators =\n      map_operator[isBPMQuery(parentType) ? \"BPM\" : expression];\n    const { fieldName: propFieldName, operator, allField } = rule;\n    let {\n      fieldValue,\n      fieldValue2,\n      isRelationalValue,\n      relatedValueFieldName,\n      relatedValueModal,\n      relatedElseValueFieldName,\n      relatedElseValueModal,\n      parent,\n      nameField,\n    } = rule;\n    let fieldName = propFieldName;\n    const values = fieldName\n      .split(join_operator[isBPMQuery(parentType) ? \"BPM\" : expression])\n      .filter((f) => f !== \"\");\n\n    const fName = values[0];\n    const field = allField.find((f) => f.name === fName);\n    const { targetName, selectionList, nameField: nameColumn } = field || {};\n    const type =\n      field && field.type && field.type.toLowerCase().replaceAll(\"-\", \"_\");\n    const typeName = field && field.typeName;\n    const nestedFields = (values && values.splice(1)) || [];\n    if (\n      [\n        \"many_to_many\",\n        \"one_to_many\",\n        \"json_many_to_many\",\n        \"json_one_to_many\",\n      ].includes(type)\n    ) {\n      const findRelational = initValue.match(/\\$\\$/g);\n      if (findRelational && findRelational.length > 0) {\n        const str =\n          nestedFields.length >= 1\n            ? `${fName}.find{it->it.$$$$}${\n                positive_operators.includes(operator) ? \" != null\" : \" == null\"\n              }`\n            : `${fName}.${\n                nestedFields.length > 0 ? \"find\" : \"collect\"\n              }{it->it$$$$}${\n                nestedFields.length > 0\n                  ? positive_operators.includes(operator)\n                    ? \" != null\"\n                    : \" == null\"\n                  : \"\"\n              }`;\n        initValue = initValue.replace(/\\$\\$/g, str);\n      } else {\n        const str =\n          nestedFields.length >= 1\n            ? `${fName}.find{it->it.$$}${\n                positive_operators.includes(operator) ? \" != null\" : \" == null\"\n              }`\n            : `${fName}.${\n                nestedFields.length > 0 ? \"find\" : \"collect\"\n              }{it->it$$}${\n                nestedFields.length > 0\n                  ? positive_operators.includes(operator)\n                    ? \" != null\"\n                    : \" == null\"\n                  : \"\"\n              }`;\n        initValue += str;\n      }\n      const nestedFieldName = nestedFields.join(join_operator[expression]);\n      return getRelationalCondition(\n        {\n          fieldName: nestedFieldName,\n          operator,\n          allField,\n          fieldValue,\n          fieldValue2,\n          isRelationalValue,\n          relatedValueFieldName,\n          relatedValueModal,\n          relatedElseValueFieldName,\n          relatedElseValueModal,\n          parent: values && values[0],\n          nameField: nameColumn || nameField,\n        },\n        initValue,\n        nestedFields.length > 1,\n        prefix\n      );\n    } else if (\n      [\n        \"json_many_to_one\",\n        \"json_one_to_one\",\n        \"many_to_one\",\n        \"one_to_one\",\n      ].includes(type)\n    ) {\n      const nestedFieldName = nestedFields.join(join_operator[expression]);\n      const findRelational = initValue.match(/\\$\\$/g);\n      const str =\n        nestedFields.length >= 1\n          ? `${fName}${join_operator[expression]}`\n          : fName;\n      if (findRelational && findRelational.length > 0) {\n        initValue = initValue.replace(/\\$\\$/g, `${str}$$$$`);\n      } else {\n        initValue += `${str}$$`;\n      }\n      return getRelationalCondition(\n        {\n          fieldName: nestedFieldName,\n          operator,\n          allField,\n          fieldValue,\n          fieldValue2,\n          isRelationalValue,\n          relatedValueFieldName,\n          relatedValueModal,\n          relatedElseValueFieldName,\n          relatedElseValueModal,\n          nameField: nameColumn || nameField,\n          parent: values && values[0],\n        },\n        initValue,\n        nestedFields.length > 1,\n        prefix\n      );\n    } else {\n      const isNumber = [\n        \"long\",\n        \"integer\",\n        \"decimal\",\n        \"boolean\",\n        \"button\",\n        \"double\",\n      ].includes(type);\n      const isDateTime = [\"date\", \"time\", \"datetime\"].includes(type);\n\n      if (isNumber) {\n        if (\n          !fieldValue &&\n          fieldValue !== false &&\n          !selectionList &&\n          !isRelationalValue\n        ) {\n          fieldValue = 0;\n        }\n        if ([\"between\", \"notBetween\"].includes(operator) && !fieldValue2) {\n          fieldValue2 = 0;\n        }\n      }\n\n      if (!isRelationalValue && !isNumber && typeof fieldValue !== \"object\") {\n        fieldValue = `'${jsStringEscape(fieldValue)}'`;\n        fieldValue2 = `'${jsStringEscape(fieldValue2)}'`;\n      }\n\n      if (isDateTime) {\n        if (!isRelationalValue) {\n          fieldValue = getDateTimeValue(type, fieldValue);\n          fieldValue2 = getDateTimeValue(type, fieldValue2);\n        }\n        fieldName = typeName ? `${fieldName}?.toLocalDateTime()` : fieldName;\n      }\n      if ([\"in\", \"notIn\"].includes(operator)) {\n        const isManyToManyField = initValue && initValue.includes(\"{it->it$$}\");\n        const field = allField.find((f) => f.name === parent) || {};\n        const value =\n          typeof rule.fieldValue === \"string\"\n            ? rule.fieldValue\n            : rule.fieldValue\n                .map((i) =>\n                  isNumber\n                    ? `${\n                        i[\"nameField\"] ||\n                        i[\"targetName\"] ||\n                        i[\"fullName\"] ||\n                        i[\"name\"] ||\n                        i[\"id\"]\n                      }`\n                    : i[\"nameField\"] ||\n                      i[\"targetName\"] ||\n                      i[\"fullName\"] ||\n                      i[\"name\"]\n                    ? `'${\n                        i[\"nameField\"] ||\n                        i[\"targetName\"] ||\n                        i[\"fullName\"] ||\n                        i[\"name\"]\n                      }'`\n                    : i[\"id\"]\n                )\n                .join(\",\");\n        const name =\n          isParent || nestedFields.length >= 1\n            ? \"\"\n            : `${fieldName}${\n                selectionList\n                  ? \"\"\n                  : `${join_operator[expression]}${\n                      nameField ||\n                      (field && field.targetName) ||\n                      targetName ||\n                      \"fullName\"\n                    }`\n              }`;\n        const str = `${operator === \"notIn\" ? \"!\" : \"\"}${`[${value}]`}${\n          join_operator[expression]\n        }${map_operators[operator]}${isManyToManyField ? \"All\" : \"\"}(${prefix}${\n          join_operator[expression]\n        }${initValue.replace(/\\$\\$/g, name)})`;\n        return str;\n      } else if ([\"contains\", \"notContains\"].includes(operator)) {\n        const isManyToManyField = initValue && initValue.includes(\"{it->it$$}\");\n        const field = allField.find((f) => f.name === parent) || {};\n        const value =\n          typeof rule.fieldValue === \"string\"\n            ? rule.fieldValue\n            : rule.fieldValue\n                .map((i) =>\n                  isNumber\n                    ? `${\n                        i[\"nameField\"] ||\n                        i[\"targetName\"] ||\n                        i[\"fullName\"] ||\n                        i[\"name\"] ||\n                        i[\"id\"]\n                      }`\n                    : i[\"nameField\"] ||\n                      i[\"targetName\"] ||\n                      i[\"fullName\"] ||\n                      i[\"name\"]\n                    ? `'${\n                        i[\"nameField\"] ||\n                        i[\"targetName\"] ||\n                        i[\"fullName\"] ||\n                        i[\"name\"]\n                      }'`\n                    : i[\"id\"]\n                )\n                .join(\",\");\n        const name =\n          isParent || nestedFields.length >= 1\n            ? \"\"\n            : `${fieldName}${\n                selectionList\n                  ? \"\"\n                  : `${join_operator[expression]}${\n                      nameField ||\n                      (field && field.targetName) ||\n                      targetName ||\n                      \"fullName\"\n                    }`\n              }`;\n        const str = `${operator === \"notContains\" ? \"!\" : \"\"}(${prefix}${\n          join_operator[expression]\n        }${initValue.replace(/\\$\\$/g, name)})${join_operator[expression]}${\n          map_operators[operator]\n        }${isManyToManyField ? \"All\" : \"\"}(${`[${value}]`})`;\n        return str;\n      } else if ([\"between\", \"notBetween\"].includes(operator)) {\n        const temp = initValue.match(/it.\\$\\$/g);\n        if (temp && temp.length) {\n          const str = `(it.${prefix}${join_operator[expression]}${fieldName} >= ${fieldValue} && it.${prefix}${join_operator[expression]}${fieldName} <= ${fieldValue2})`;\n          if (\"notBetween\" === operator) {\n            return `${initValue.replace(/it.\\$\\$/g, `!${str}`)}`;\n          }\n          return initValue.replace(/it.\\$\\$/g, str);\n        } else {\n          const replace = (p1) => {\n            const field = (p1 && p1.replace(/\\$\\$/g, fieldName)) || fieldName;\n            if (\"notBetween\" === operator) {\n              return `!(${prefix}${join_operator[expression]}${field} >= ${fieldValue} && ${prefix}${join_operator[expression]}${field} <= ${fieldValue2})`;\n            }\n            return `(${prefix}${join_operator[expression]}${field} >= ${fieldValue} && ${prefix}${join_operator[expression]}${field} <= ${fieldValue2})`;\n          };\n          return replace(initValue);\n        }\n      } else if ([\"isNotNull\", \"isNull\"].includes(operator)) {\n        const str = `${fieldName} ${map_operators[operator]}`;\n        const field = allField.find((f) => f.name === parent) || {};\n        const isManyToManyField = initValue && initValue.includes(\"{it->it$$}\");\n        if (isManyToManyField) {\n          const name =\n            isParent || nestedFields.length >= 1\n              ? \"\"\n              : `${fieldName}${\n                  selectionList\n                    ? \"\"\n                    : `${join_operator[expression]}${\n                        (field && field.targetName) || targetName || \"fullName\"\n                      }`\n                }`;\n          return `${prefix}${join_operator[expression]}${initValue.replace(\n            /\\$\\$/g,\n            `${name} ${str}`\n          )}`;\n        }\n        return `${prefix}${join_operator[expression]}${initValue.replace(\n          /\\$\\$/g,\n          str\n        )}`;\n      } else if ([\"isTrue\", \"isFalse\"].includes(operator)) {\n        const value = operator === \"isTrue\" ? true : false;\n        const str = `${fieldName} ${map_operators[operator]} ${value}`;\n        return `${prefix}${join_operator[expression]}${initValue.replace(\n          /\\$\\$/g,\n          str\n        )}`;\n      } else if ([\"like\", \"notLike\"].includes(operator)) {\n        const str = `${fieldName}${join_operator[expression]}${map_operators[operator]}(${fieldValue})`;\n        return `${operator === \"notLike\" ? \"!\" : \"\"}${prefix}${\n          join_operator[expression]\n        }${initValue.replace(/\\$\\$/g, str)}`;\n      } else {\n        let fieldNew = field || allField.find((f) => f.name === parent) || {};\n        let value =\n          typeof fieldValue === \"object\" && fieldValue\n            ? `'${jsStringEscape(\n                fieldValue[nameField] ||\n                  fieldValue[targetName] ||\n                  fieldValue[\"fullName\"] ||\n                  fieldValue[\"name\"] ||\n                  fieldValue[\"id\"] ||\n                  \"\"\n              )}'`\n              ? `'${jsStringEscape(\n                  fieldValue[nameField] ||\n                    fieldValue[targetName] ||\n                    fieldValue[\"fullName\"] ||\n                    fieldValue[\"name\"] ||\n                    fieldValue[\"id\"] ||\n                    \"\"\n                )}'`\n              : fieldValue[\"name\"]\n            : fieldValue;\n        const str = `${\n          typeof fieldValue === \"object\" && fieldValue\n            ? `${fieldName}${join_operator[expression]}${\n                nameField || fieldNew.targetName || \"fullName\"\n              }`\n            : fieldName\n        } ${map_operators[operator]} ${value}`;\n        return type === \"button\"\n          ? `${initValue.replace(/\\$\\$/g, str)}`\n          : `${prefix}${join_operator[expression]}${initValue.replace(\n              /\\$\\$/g,\n              str\n            )}`;\n      }\n    }\n  }\n\n  function getDateTimeValue(type, fieldValue, isJsonField = false) {\n    if (type === \"date\") {\n      let date = `\"${moment(fieldValue, dateFormat[\"date\"]).format(\n        \"YYYY-MM-DD\"\n      )}\"`;\n      if (isJsonField) {\n        return date;\n      }\n      return `LocalDate.parse(${date})`;\n    } else if (type === \"datetime\") {\n      if (isJsonField) {\n        return `\"${moment(fieldValue, dateFormat[\"datetime\"]).toISOString()}\"`;\n      }\n      return `LocalDateTime.of(${moment(fieldValue, dateFormat[\"datetime\"])\n        .format(\"YYYY-M-D-H-m-s\")\n        .split(\"-\")})`;\n    } else {\n      let time = `\"${moment(fieldValue, dateFormat[\"time\"]).format(\n        \"HH:mm:ss\"\n      )}\"`;\n      if (isJsonField) {\n        return time;\n      }\n      return `LocalTime.parse(${time})`;\n    }\n  }\n\n  const onCancel = () => {\n    const values = generateExpressionValues();\n    if (\n      (values && values.length <= 0) ||\n      JSON.stringify(values) === JSON.stringify(initialValues)\n    ) {\n      handleClose();\n      return;\n    }\n    setClose(true);\n    setAlert(true);\n    setAlertConfig({\n      alertMessage:\n        \"Current changes will be lost. Do you really want to proceed?\",\n      alertTitle: \"Question\",\n    });\n  };\n\n  function getCondition(rules, modalName) {\n    const isBPM = isBPMQuery(parentType);\n    const prefix = isBPM\n      ? \"self\"\n      : generateWithId\n      ? `$ctx.find('${upperCaseFirstLetter(modalName)}', ${modalName}Id)`\n      : modalName;\n    const map_operators = map_operator[isBPM ? \"BPM\" : expression];\n    const returnValues = [];\n    for (let i = 0; i < (rules && rules.length); i++) {\n      const rule = rules[i];\n      const { fieldName: propFieldName, field = {}, operator, allField } = rule;\n      const { targetName, selectionList } = field || {};\n      const type = field && field.type && field.type.toLowerCase();\n      const typeName = field && field.typeName;\n      const isNumber = [\n        \"long\",\n        \"integer\",\n        \"decimal\",\n        \"boolean\",\n        \"button\",\n        \"double\",\n      ].includes(type);\n      const isDateTime = [\"date\", \"time\", \"datetime\"].includes(type);\n      let { fieldValue, fieldValue2, isRelationalValue } = rule;\n      let fieldName = propFieldName;\n      if (isNumber && !selectionList && !isRelationalValue) {\n        if (!fieldValue && fieldValue !== false) {\n          fieldValue = 0;\n        }\n        if ([\"between\", \"notBetween\"].includes(operator) && !fieldValue2) {\n          fieldValue2 = 0;\n        }\n      }\n      const fValue = isNaN(fieldValue) ? fieldValue : `${fieldValue}`;\n      if (\n        operator === \"\" ||\n        (selectionList &&\n          !fieldValue &&\n          ![\"isNull\", \"isNotNull\", \"isTrue\", \"isFalse\"].includes(operator)) ||\n        (((!isNumber && !fieldValue) ||\n          (isNumber && isRelationalValue && !fieldValue && selectionList) ||\n          (fieldValue && fieldValue.length <= 0) ||\n          ((!fieldValue2 || (fieldValue2 && fieldValue2.length <= 0)) &&\n            [\"between\", \"notBetween\"].includes(operator))) &&\n          ![\"isNull\", \"isNotNull\", \"isTrue\", \"isFalse\"].includes(operator))\n      ) {\n        break;\n      }\n      if (!fieldName) {\n        break;\n      }\n\n      if (isEmpty(fValue)) {\n        if (![\"isNull\", \"isNotNull\", \"isTrue\", \"isFalse\"].includes(operator)) {\n          break;\n        }\n      }\n\n      //check relational field\n      const name = fieldName && fieldName.split(join_operator[expression])[0];\n      const f = allField && allField.find((f) => f.name === name);\n      const isRelational = [\n        \"many_to_many\",\n        \"one_to_many\",\n        \"many_to_one\",\n        \"one_to_one\",\n        \"json_many_to_many\",\n        \"json_one_to_many\",\n        \"json_many_to_one\",\n        \"json_one_to_one\",\n      ].includes(\n        f &&\n          f.type &&\n          f.type.toLowerCase() &&\n          f.type.toLowerCase().replaceAll(\"-\", \"_\")\n      );\n      if (isRelational) {\n        returnValues.push(\n          getRelationalCondition(rule, undefined, false, prefix)\n        );\n      } else {\n        if (!isRelationalValue && !isNumber && typeof fieldValue !== \"object\") {\n          fieldValue = `'${jsStringEscape(fieldValue)}'`;\n          fieldValue2 = `'${jsStringEscape(fieldValue2)}'`;\n        }\n        if (isDateTime) {\n          if (!isRelationalValue) {\n            fieldValue = getDateTimeValue(type, fieldValue);\n            fieldValue2 = getDateTimeValue(type, fieldValue2);\n          }\n          fieldName = typeName ? `${fieldName}?.toLocalDateTime()` : fieldName;\n        }\n        const map_type = isBPM ? map_bpm_combinator : map_combinator;\n        if ([\"in\", \"notIn\"].includes(operator)) {\n          const value = rule.fieldValue\n            .map((f) =>\n              isNumber\n                ? `${f[\"targetName\"] || f[\"fullName\"] || f[\"name\"]}`\n                : `'${f[\"targetName\"] || f[\"fullName\"] || f[\"name\"]}'`\n            )\n            .filter((f) => f !== \"\")\n            .join(\",\");\n          returnValues.push(\n            `${operator === \"notIn\" ? \"!\" : \"\"}${`[${value}]`}${\n              join_operator[expression]\n            }${map_operators[operator]}(${prefix}${\n              join_operator[expression]\n            }${fieldName}${\n              selectionList\n                ? \" \"\n                : `${join_operator[expression]} ${targetName || \"fullName\"}`\n            })`\n          );\n        } else if ([\"between\", \"notBetween\"].includes(operator)) {\n          if (operator === \"notBetween\") {\n            returnValues.push(\n              `!(${prefix}${join_operator[expression]}${fieldName} >= ${fieldValue} ${map_type[\"and\"]} ${prefix}${join_operator[expression]}${fieldName} <= ${fieldValue2})`\n            );\n          }\n          returnValues.push(\n            `(${prefix}${join_operator[expression]}${fieldName} >= ${fieldValue} ${map_type[\"and\"]} ${prefix}${join_operator[expression]}${fieldName} <= ${fieldValue2})`\n          );\n        } else if ([\"isNotNull\", \"isNull\"].includes(operator)) {\n          returnValues.push(\n            `${prefix}${join_operator[expression]}${fieldName} ${map_operators[operator]}`\n          );\n        } else if ([\"isTrue\", \"isFalse\"].includes(operator)) {\n          const value = operator === \"isTrue\" ? true : false;\n          returnValues.push(\n            `${prefix}${join_operator[expression]}${fieldName} ${map_operators[operator]} ${value}`\n          );\n        } else if ([\"like\", \"notLike\"].includes(operator)) {\n          returnValues.push(\n            `${operator === \"notLike\" ? \"!\" : \"\"}${prefix}${\n              join_operator[expression]\n            }${fieldName}${join_operator[expression]}${\n              map_operators[operator]\n            }(${fieldValue})`\n          );\n        } else {\n          let value =\n            typeof fieldValue === \"object\" && fieldValue\n              ? `'${jsStringEscape(\n                  fieldValue[targetName] ||\n                    fieldValue[\"fullName\"] ||\n                    fieldValue[\"name\"] ||\n                    \"\"\n                )}'`\n                ? `'${jsStringEscape(\n                    fieldValue[targetName] ||\n                      fieldValue[\"fullName\"] ||\n                      fieldValue[\"name\"] ||\n                      \"\"\n                  )}'`\n                : fieldValue[\"name\"]\n              : fieldValue;\n          returnValues.push(\n            type === \"button\"\n              ? `${fieldName} ${map_operators[operator]} ${value}`\n              : `${prefix}${join_operator[expression]}${\n                  type === \"many_to_one\" || type === \"json_many_to_one\"\n                    ? `${fieldName}${join_operator[expression]}${\n                        field.targetName || \"fullName\"\n                      }`\n                    : fieldName\n                } ${map_operators[operator]} ${value}`\n          );\n        }\n      }\n    }\n    return returnValues;\n  }\n\n  function getBPMCondition(rules, modalName, parentCount = 0) {\n    const isBPM = isBPMQuery(parentType);\n    const prefix = isBPM ? \"self\" : modalName;\n    const map_operators = map_operator[isBPM ? \"BPM\" : expression];\n    let count = parentCount;\n    const returnValues = [];\n    for (let i = 0; i < (rules && rules.length); i++) {\n      const rule = rules[i];\n      const { fieldName, field = {}, operator, allField } = rule;\n      const { targetName, selectionList, model, target, jsonField } =\n        field || {};\n      const type = field && field.type && field.type.toLowerCase();\n      const isNumber = [\n        \"long\",\n        \"integer\",\n        \"double\",\n        \"decimal\",\n        \"boolean\",\n      ].includes(type);\n      const isDateTime = [\"date\", \"time\", \"datetime\"].includes(type);\n      let isJsonField =\n        model === \"com.axelor.meta.db.MetaJsonRecord\" ||\n        target === \"com.axelor.meta.db.MetaJsonRecord\" ||\n        jsonField;\n      let parentCustomField;\n      const values = fieldName && fieldName.split(join_operator[expression]);\n      if (!isJsonField && values && values.length > 1) {\n        values.forEach((name) => {\n          let value =\n            allField &&\n            allField.find(\n              (field) =>\n                field.name === name &&\n                (field.model === \"com.axelor.meta.db.MetaJsonRecord\" ||\n                  field.target === \"com.axelor.meta.db.MetaJsonRecord\" ||\n                  field.jsonField)\n            );\n          if (value) {\n            isJsonField = true;\n            parentCustomField = value;\n          }\n        });\n      }\n      const jsonFieldName = isJsonField\n        ? `${getJsonExpression(\n            parentCustomField\n              ? {\n                  ...parentCustomField,\n                  targetName: field && field.targetName,\n                }\n              : field,\n            prefix,\n            fieldName\n          )}`\n        : undefined;\n      let { fieldValue, fieldValue2, isRelationalValue } = rule || {};\n      if (isNumber && !selectionList && !isRelationalValue) {\n        if (!fieldValue) {\n          fieldValue = 0;\n        }\n        if ([\"between\", \"notBetween\"].includes(operator) && !fieldValue2) {\n          fieldValue2 = 0;\n        }\n      }\n      const fValue = isNaN(fieldValue) ? fieldValue : `${fieldValue}`;\n      if (\n        operator === \"\" ||\n        (selectionList && !fieldValue) ||\n        (isNumber && isRelationalValue && !fieldValue) ||\n        (((!isNumber && !fieldValue) ||\n          (fieldValue && fieldValue.length <= 0) ||\n          ((!fieldValue2 || (fieldValue2 && fieldValue2.length <= 0)) &&\n            [\"between\", \"notBetween\"].includes(operator))) &&\n          ![\"isNull\", \"isNotNull\", \"isTrue\", \"isFalse\"].includes(operator))\n      ) {\n        break;\n      }\n      const isRelatedModalSame = false;\n      const isRelatedElseModalSame = false;\n      if (![\"isNotNull\", \"isNull\"].includes(operator) && !isRelatedModalSame) {\n        ++count;\n      }\n      if (!fieldName) {\n        break;\n      }\n\n      if (isEmpty(fValue)) {\n        if (![\"isNull\", \"isNotNull\", \"isTrue\", \"isFalse\"].includes(operator)) {\n          break;\n        }\n      }\n\n      if (!isRelationalValue && !isNumber && typeof fieldValue !== \"object\") {\n        fieldValue = `'${jsStringEscape(fieldValue)}'`;\n        fieldValue2 = `'${jsStringEscape(fieldValue2)}'`;\n      }\n\n      if (isDateTime) {\n        if (!isRelationalValue) {\n          fieldValue = getDateTimeValue(type, fieldValue, isJsonField);\n          fieldValue2 = getDateTimeValue(type, fieldValue2, isJsonField);\n        }\n      }\n\n      const map_type = isBPM ? map_bpm_combinator : map_combinator;\n      if ([\"in\", \"notIn\"].includes(operator)) {\n        const value =\n          rule &&\n          rule.fieldValue &&\n          rule.fieldValue\n            .map((f) =>\n              isNumber\n                ? `${f[\"targetName\"] || f[\"fullName\"] || f[\"name\"]}`\n                : `'${f[\"targetName\"] || f[\"fullName\"] || f[\"name\"]}'`\n            )\n            .filter((f) => f !== \"\");\n        returnValues.push({\n          condition: `${\n            jsonFieldName\n              ? jsonFieldName\n              : `${prefix}.${fieldName}${\n                  selectionList ? \"\" : `.${targetName || \"fullName\"}`\n                }`\n          } ${map_operators[operator]} ${\n            isRelatedModalSame ? fieldValue : `?${count}`\n          }`,\n          values: isRelatedModalSame ? undefined : [[value]],\n        });\n      } else if ([\"between\", \"notBetween\"].includes(operator)) {\n        let values =\n          isRelatedModalSame && isRelatedElseModalSame\n            ? undefined\n            : isRelatedModalSame\n            ? [fieldValue2]\n            : isRelatedElseModalSame\n            ? [fieldValue]\n            : [fieldValue, fieldValue2];\n        if (isDateTime && isBPM) {\n          if (operator === \"notBetween\") {\n            returnValues.push({\n              condition: `${\n                jsonFieldName ? jsonFieldName : `${prefix}.${fieldName}`\n              } NOT BETWEEN ${isRelatedModalSame ? fieldValue : `?${count}`} ${\n                map_type[\"and\"]\n              } ${isRelatedElseModalSame ? fieldValue2 : `?${++count}`}`,\n              values,\n            });\n          }\n          returnValues.push({\n            condition: `${\n              jsonFieldName ? jsonFieldName : `${prefix}.${fieldName}`\n            } BETWEEN ${isRelatedModalSame ? fieldValue : `?${count}`} ${\n              map_type[\"and\"]\n            } ${isRelatedElseModalSame ? fieldValue2 : `?${++count}`}`,\n            values,\n          });\n        } else {\n          if (operator === \"notBetween\") {\n            returnValues.push({\n              condition: `NOT (${\n                jsonFieldName ? jsonFieldName : `${prefix}.${fieldName}`\n              } >= ${isRelatedModalSame ? fieldValue : `?${count}`} ${\n                map_type[\"and\"]\n              } ${\n                jsonFieldName ? jsonFieldName : `${prefix}.${fieldName}`\n              } <= ${isRelatedElseModalSame ? fieldValue2 : `?${++count}`})`,\n              values,\n            });\n          }\n          returnValues.push({\n            condition: `(${\n              jsonFieldName ? jsonFieldName : `${prefix}.${fieldName}`\n            } >= ${isRelatedModalSame ? fieldValue : `?${count}`} ${\n              map_type[\"and\"]\n            } ${jsonFieldName ? jsonFieldName : `${prefix}.${fieldName}`} <= ${\n              isRelatedElseModalSame ? fieldValue2 : `?${++count}`\n            })`,\n            values,\n          });\n        }\n      } else if ([\"isNotNull\", \"isNull\"].includes(operator)) {\n        returnValues.push({\n          condition: `${\n            jsonFieldName ? jsonFieldName : `${prefix}.${fieldName}`\n          } ${map_operators[operator]}`,\n        });\n      } else if ([\"isTrue\", \"isFalse\"].includes(operator)) {\n        //Remove param\n        --count;\n        const value = operator === \"isTrue\" ? true : false;\n        returnValues.push({\n          condition: `${\n            jsonFieldName ? jsonFieldName : `${prefix}.${fieldName}`\n          } ${map_operators[operator]} ${value}`,\n          values: undefined,\n        });\n      } else if ([\"contains\", \"notContains\"].includes(operator)) {\n        let value =\n          typeof fieldValue === \"object\" && fieldValue\n            ? `'${jsStringEscape(fieldValue[field.targetName] || \"\")}'`\n              ? `'${jsStringEscape(fieldValue[field.targetName] || \"\")}'`\n              : fieldValue[\"name\"]\n            : fieldValue;\n\n        returnValues.push({\n          condition: `${isRelatedModalSame ? fieldValue : `?${count}`} ${\n            map_operators[operator]\n          } ${jsonFieldName ? jsonFieldName : `${prefix}.${fieldName}`}`,\n          values: isRelatedModalSame ? undefined : [value],\n        });\n      } else {\n        let value =\n          typeof fieldValue === \"object\" && fieldValue\n            ? `'${jsStringEscape(fieldValue[field.targetName] || \"\")}'`\n              ? `'${jsStringEscape(fieldValue[field.targetName] || \"\")}'`\n              : fieldValue[\"name\"]\n            : fieldValue;\n\n        returnValues.push({\n          condition: `${\n            jsonFieldName\n              ? jsonFieldName\n              : `${prefix}.${\n                  [\n                    \"many_to_one\",\n                    \"json_many_to_one\",\n                    \"one_to_one\",\n                    \"json_one_to_one\",\n                  ].includes(type) && !isRelationalValue\n                    ? `${fieldName}.${field.targetName || \"fullName\"}`\n                    : fieldName\n                }`\n          } ${map_operators[operator]} ${\n            isRelatedModalSame\n              ? [\"like\", \"notLike\"].includes(operator)\n                ? `CONCAT('%',${fieldValue},'%')`\n                : fieldValue\n              : [\"like\", \"notLike\"].includes(operator)\n              ? `CONCAT('%',?${count},'%')`\n              : `?${count}`\n          }`,\n          values: isRelatedModalSame ? undefined : [value],\n        });\n      }\n    }\n    return returnValues;\n  }\n\n  function getBPMCriteria(rule, modalName, isChildren, count = 0) {\n    const {\n      rules,\n      combinator = \"and\",\n      children,\n      parentId,\n    } = (rule && rule[0]) || {};\n    const allConditions = getBPMCondition(rules, modalName, count);\n    const condition = allConditions && allConditions.filter((f) => f);\n    const childrenConditions = [];\n    children &&\n      children.length > 0 &&\n      children.forEach((child) => {\n        const parentValues =\n          (condition &&\n            condition.map((co) => co && co.values).filter((f) => f)) ||\n          [];\n        const childrenValues =\n          (childrenConditions &&\n            childrenConditions.map((co) => co && co.values).filter((f) => f)) ||\n          [];\n        const { condition: conditions, values } =\n          getBPMCriteria(\n            [child],\n            modalName,\n            true,\n            (parentValues && parentValues.length) +\n              (childrenValues && childrenValues.length)\n          ) || {};\n        const newValues = [].concat.apply([], values);\n        childrenConditions.push({\n          condition: conditions,\n          values: newValues && newValues.length > 0 ? newValues : undefined,\n        });\n      });\n    const map_type = isBPMQuery(parentType)\n      ? map_bpm_combinator\n      : map_combinator;\n    const conditions = condition && condition.map((co) => co && co.condition);\n    const c = conditions && conditions.filter((val) => val !== null);\n    const childConditions =\n      childrenConditions &&\n      (childrenConditions.map((co) => co && co.condition) || []).filter(\n        (f) => f\n      );\n    const childValues =\n      childrenConditions && childrenConditions.filter((val) => val !== null);\n\n    if (parentId === -1 && children.length > 0) {\n      let isChild = childConditions && childConditions.length !== 0;\n      return {\n        condition: `${isChild ? \"( \" : \"\"}(${\n          c ? c.join(\" \" + map_type[combinator] + \" \") : \"\"\n        } ${\n          isChild\n            ? ` ${map_type[combinator]} ${childConditions.join(\n                \" \" + map_type[combinator] + \" \"\n              )}`\n            : \"\"\n        })${isChild ? \" )\" : \"\"}`,\n        values: [\n          ...((condition &&\n            condition.map((co) => co && co.values).filter((f) => f)) ||\n            []),\n          ...((childValues &&\n            childValues.map((co) => co && co.values).filter((f) => f)) ||\n            []),\n        ],\n      };\n    } else if (isChildren && condition && c && c.length !== 0) {\n      return {\n        condition: `(${c.join(\" \" + map_type[combinator] + \" \")})`,\n        values:\n          condition && condition.map((co) => co && co.values).filter((f) => f),\n      };\n    } else if (c && c.length !== 0) {\n      return {\n        condition: `${c.join(\" \" + map_type[combinator] + \" \")}`,\n        values:\n          condition && condition.map((co) => co && co.values).filter((f) => f),\n      };\n    }\n  }\n\n  function getCriteria(rule, modalName, isChildren) {\n    const { rules, combinator = \"and\", children, parentId } = rule[0];\n    const conditions = getCondition(rules, modalName);\n    const condition = conditions && conditions.filter((f) => f !== \"\");\n    const childrenConditions = [];\n    children &&\n      children.length > 0 &&\n      children.forEach((child) => {\n        const conditions = getCriteria([child], modalName, true);\n        if (conditions) {\n          childrenConditions.push(conditions);\n        }\n      });\n    const map_type = isBPMQuery(parentType)\n      ? map_bpm_combinator\n      : map_combinator;\n\n    if (\n      parentId === -1 &&\n      children.length > 0 &&\n      condition &&\n      condition.length > 0\n    ) {\n      let isChild = childrenConditions && childrenConditions.length !== 0;\n      return `${isChild ? \"( \" : \"\"}(${\n        condition ? condition.join(\" \" + map_type[combinator] + \" \") : \"\"\n      } ${\n        isChild\n          ? ` ${map_type[combinator]} ${childrenConditions.join(\n              \" \" + map_type[combinator] + \" \"\n            )}`\n          : \"\"\n      })${isChild ? \")\" : \"\"}`;\n    } else if (isChildren && condition && condition.length > 0) {\n      return \" (\" + condition.join(\" \" + map_type[combinator] + \" \") + \") \";\n    } else if (condition && condition.length > 0) {\n      return condition.join(\" \" + map_type[combinator] + \" \");\n    }\n  }\n\n  const checkValidation = () => {\n    let isValid = true;\n    const nodes = [];\n    for (\n      let i = 0;\n      i < (expressionComponents && expressionComponents.length);\n      i++\n    ) {\n      const component = expressionComponents[i];\n      const { value } = component;\n      const { rules, metaModals } = value || {};\n      if (!metaModals) {\n        return isValid;\n      }\n      nodes.push(rules);\n    }\n    const parentNodes = _.flattenDeep(nodes || []);\n    const rules = parentNodes && parentNodes.map((n) => n.rules);\n    const allRules = _.flattenDeep(rules || []);\n    for (let i = 0; i < (allRules && allRules.length); i++) {\n      const rule = allRules && allRules[i];\n      const { fieldName: propFieldName, field = {}, operator } = rule || {};\n      const { selectionList } = field || {};\n      const type = field && field.type && field.type.toLowerCase();\n      const isNumber = [\n        \"long\",\n        \"integer\",\n        \"decimal\",\n        \"boolean\",\n        \"button\",\n        \"double\",\n      ].includes(type);\n      let { fieldValue, fieldValue2, isRelationalValue } = rule;\n      let fieldName = propFieldName;\n      if (isNumber && !selectionList && !isRelationalValue) {\n        if (!fieldValue && fieldValue !== false) {\n          fieldValue = 0;\n        }\n        if ([\"between\", \"notBetween\"].includes(operator) && !fieldValue2) {\n          fieldValue2 = 0;\n        }\n      }\n      const fValue = isNaN(fieldValue) ? fieldValue : `${fieldValue}`;\n      if (!fieldName && !isBPMQuery(parentType)) {\n        isValid = false;\n        break;\n      }\n      if (isEmpty(fValue) && fieldName) {\n        if (![\"isNull\", \"isNotNull\", \"isTrue\", \"isFalse\"].includes(operator)) {\n          isValid = false;\n          break;\n        }\n      }\n      if (\n        fieldName &&\n        (operator === \"\" ||\n          (selectionList && !fieldValue) ||\n          (isNumber && isRelationalValue && !fieldValue) ||\n          (((!isNumber && !fieldValue) ||\n            (fieldValue && fieldValue.length <= 0) ||\n            ((!fieldValue2 || (fieldValue2 && fieldValue2.length <= 0)) &&\n              [\"between\", \"notBetween\"].includes(operator))) &&\n            ![\"isNull\", \"isNotNull\", \"isTrue\", \"isFalse\"].includes(operator)))\n      ) {\n        isValid = false;\n        break;\n      }\n    }\n    return isValid;\n  };\n\n  function getListOfTree(list) {\n    var map = {},\n      node,\n      roots = [];\n    const rules = list.map((item, index) => {\n      map[item.id] = index;\n      return { ...item, children: [] };\n    });\n    for (let i = 0; i < rules.length; i += 1) {\n      node = rules[i];\n      if (node.parentId >= 0) {\n        rules[map[node.parentId]] &&\n          rules[map[node.parentId]].children.push(node);\n      } else {\n        roots.push(node);\n      }\n    }\n    return roots;\n  }\n\n  const onChange = React.useCallback(function onChange(value, index) {\n    setExpressionComponents(\n      produce((draft) => {\n        draft[index].value = value;\n      })\n    );\n  }, []);\n\n  function generateExpressionValues() {\n    const expressionValues = [];\n    expressionComponents &&\n      expressionComponents.forEach(({ value }) => {\n        const { rules, metaModals } = value || {};\n        const modalName = metaModals && metaModals.name;\n        if (metaModals) {\n          expressionValues.push({\n            metaModalName: modalName,\n            metaModalType: metaModals && metaModals.type,\n            rules,\n            generateWithId,\n          });\n        }\n      });\n    return expressionValues;\n  }\n\n  function generateExpression(combinator, type) {\n    const expressionValues = [];\n    let vals = [];\n    const isValid = checkValidation();\n    if (!isValid) {\n      setAlert(true);\n      setAlertConfig({\n        alertMessage: \"Add all values\",\n        alertTitle: \"Error\",\n      });\n      return;\n    }\n    const expressions = [];\n\n    for (let i = 0; i < expressionComponents.length; i++) {\n      const component = expressionComponents[i];\n      const { value } = component;\n      const { rules, metaModals } = value;\n\n      const modalName =\n        metaModals && metaModals.type === \"dmnModel\"\n          ? metaModals.resultVariable\n          : metaModals && metaModals.name;\n      let str = \"\";\n      const listOfTree = getListOfTree(rules);\n      const criteria = isBPMQuery(type)\n        ? getBPMCriteria(listOfTree, lowerCaseFirstLetter(modalName), undefined)\n        : getCriteria(listOfTree, lowerCaseFirstLetter(modalName), undefined);\n      vals.push(\n        ...((criteria &&\n          ((criteria.values || []).filter((f) => Array.isArray(f)) || [])) ||\n          [])\n      );\n      if (metaModals) {\n        if (isBPMQuery(type) && criteria && criteria.condition) {\n          str += criteria.condition;\n        } else if (criteria) {\n          str += criteria;\n        }\n      } else {\n        break;\n      }\n      let expressionValue = {\n        metaModalName: modalName,\n        metaModalType: metaModals.type,\n        rules,\n        generateWithId,\n      };\n      if (metaModals && metaModals.type === \"dmnModel\") {\n        expressionValue.decisionId = metaModals.decisionId;\n        expressionValue.dmnNodeId = metaModals.dmnNodeId;\n      }\n      expressionValues.push(expressionValue);\n      if (str) {\n        expressions.push(`${str}`);\n      }\n    }\n\n    const map_type = isBPMQuery(parentType)\n      ? map_bpm_combinator\n      : map_combinator;\n\n    const str = expressions\n      .filter((e) => e !== \"\")\n      .map((e) => (expressions.length > 1 ? `(${e})` : e))\n      .join(\" \" + map_type[combinator] + \" \");\n\n    let expr = str;\n    if (isBPMQuery(type)) {\n      let parameters = \"\";\n      vals &&\n        vals.forEach((v) => {\n          if (v && Array.isArray(v[0]) && v[0]) {\n            parameters = parameters + `, [${v[0]}]`;\n          } else {\n            if (v && Array.isArray(v) && v.length > 0) {\n              v = v.join(\", \");\n            }\n            parameters = parameters + \", \" + v;\n          }\n        });\n\n      expr = str\n        ? `\"${str}\"${vals && vals.length > 0 ? `${parameters}` : ``}`\n        : undefined;\n    }\n\n    if (isValid) {\n      setProperty({\n        expression: expr,\n        value:\n          expressionValues && expressionValues.length > 0\n            ? JSON.stringify(expressionValues)\n            : undefined,\n        combinator,\n      });\n      handleClose();\n    }\n  }\n\n  useEffect(() => {\n    let isSubscribed = true;\n    async function fetchValue() {\n      const { values, combinator } = getExpression() || {};\n      const expressionComponents = [];\n      setInitialValues(values);\n      if (!values || values.length === 0) {\n        setExpressionComponents([\n          {\n            Component: ExpressionComponent,\n            value: undefined,\n          },\n        ]);\n        return;\n      }\n      for (let i = 0; i < values.length; i++) {\n        const ele = values[i];\n        const {\n          metaModalName,\n          decisionId,\n          dmnNodeId,\n          metaModalType,\n          generateWithId,\n        } = ele;\n        if (metaModalType === \"dmnModel\") {\n          if (!decisionId) return;\n          const dmnTables = await getDMNModels([\n            {\n              fieldName: \"decisionId\",\n              operator: \"=\",\n              value: decisionId,\n            },\n          ]);\n          if (!dmnTables || !bpmnModeler) return;\n          const elementRegistry = bpmnModeler.get(\"elementRegistry\");\n          const element =\n            elementRegistry &&\n            elementRegistry.find((el) => el.id === dmnNodeId);\n          const value = {\n            metaModals: dmnTables && {\n              ...dmnTables[0],\n              dmnNodeId: element && element.id,\n              dmnNodeNameId:\n                element &&\n                element.businessObject &&\n                element.businessObject.name,\n              resultVariable:\n                element &&\n                element.businessObject &&\n                element.businessObject.resultVariable,\n              type: \"dmnModel\",\n            },\n            rules: ele.rules,\n          };\n          expressionComponents.push({\n            Component: ExpressionComponent,\n            value,\n          });\n        } else {\n          const criteria = {\n            criteria: [\n              {\n                fieldName: \"name\",\n                operator: \"=\",\n                value: metaModalName,\n              },\n            ],\n            operator: \"and\",\n          };\n          const metaModels = await getModels(criteria, metaModalType);\n          if (!metaModels) return;\n          const value = {\n            metaModals: metaModels && metaModels[0],\n            rules: ele.rules,\n          };\n          expressionComponents.push({\n            Component: ExpressionComponent,\n            value,\n          });\n        }\n        setGenerateWithId(generateWithId);\n      }\n      if (isSubscribed) {\n        setExpressionComponents(expressionComponents);\n        setCombinator(combinator || \"and\");\n      }\n    }\n    fetchValue();\n    return () => (isSubscribed = false);\n  }, [getExpression, parentType, bpmnModeler]);\n\n  return (\n    <Dialog\n      onClose={(event, reason) => {\n        if (reason !== \"backdropClick\") {\n          handleClose();\n        }\n      }}\n      aria-labelledby=\"simple-dialog-title\"\n      open={open}\n      classes={{\n        paper: classes.dialogPaper,\n      }}\n    >\n      <DialogTitle id=\"simple-dialog-title\">{title}</DialogTitle>\n      <div className={classes.root}>\n        <Paper variant=\"outlined\" className={classes.paper}>\n          <div\n            style={{\n              height: \"100%\",\n              width: \"100%\",\n            }}\n          >\n            <div className={classes.expression}>\n              {!isBPMQuery(parentType) && (\n                <FormControlLabel\n                  control={\n                    <Checkbox\n                      checked={generateWithId}\n                      onChange={(e) => setGenerateWithId(e.target.checked)}\n                      name=\"generateWithId\"\n                      className={classes.checkbox}\n                    />\n                  }\n                  style={{ color: \"#0275d8\", padding: \"0px 15px\" }}\n                  label=\"Generate with saved record\"\n                />\n              )}\n              <Timeline\n                align=\"alternate\"\n                className={classes.timeline}\n                style={{\n                  border:\n                    expression === \"BPM\"\n                      ? \"none\"\n                      : \"1px solid rgba(0, 0, 0, 0.12)\",\n                }}\n              >\n                {isBPMQuery(parentType) ? (\n                  <TimelineItem\n                    className={classes.timelineItem}\n                    style={{\n                      width: \"100%\",\n                    }}\n                  >\n                    <div\n                      style={{\n                        width: \"100%\",\n                      }}\n                    >\n                      {expressionComponents &&\n                        expressionComponents.map(\n                          ({ Component, value }, index) => {\n                            return (\n                              <div\n                                className={classes.expressionContainer}\n                                key={index}\n                              >\n                                <Component\n                                  value={value}\n                                  index={index}\n                                  setValue={onChange}\n                                  element={element}\n                                  type={parentType}\n                                  processConfigs={processConfigs}\n                                  isAllowButtons={isAllowButtons}\n                                  allowAllModels={allowAllModels}\n                                  bpmnModeler={bpmnModeler}\n                                  defaultModel={defaultModel}\n                                />\n                              </div>\n                            );\n                          }\n                        )}\n                    </div>\n                  </TimelineItem>\n                ) : (\n                  <TimelineItem style={{ minHeight: \"100%\", width: \"89%\" }}>\n                    <TimelineOppositeContent\n                      className={classes.timelineOppositeContent}\n                      style={{ paddingLeft: 16 }}\n                    >\n                      <Select\n                        name=\"expression\"\n                        options={combinators}\n                        value={combinator || \"and\"}\n                        disableUnderline={true}\n                        className={classes.combinator}\n                        onChange={(value) => {\n                          setCombinator(value);\n                        }}\n                      />\n                    </TimelineOppositeContent>\n                    <TimelineSeparator>\n                      <TimelineDot\n                        variant=\"outlined\"\n                        style={{ borderColor: \"#0275d8\" }}\n                      />\n                      <TimelineConnector\n                        className={classes.timelineConnector}\n                      />\n                    </TimelineSeparator>\n                    <TimelineContent style={{ width: \"100%\" }}>\n                      <Button\n                        title=\"Add Expression\"\n                        Icon={AddIcon}\n                        onClick={() => onAddExpressionEditor()}\n                      />\n                      <div>\n                        {expressionComponents &&\n                          expressionComponents.map(\n                            ({ Component, value }, index) => {\n                              return (\n                                <div\n                                  className={classes.expressionContainer}\n                                  key={index}\n                                >\n                                  <Component\n                                    value={value}\n                                    index={index}\n                                    setValue={onChange}\n                                    element={element}\n                                    type={parentType}\n                                    processConfigs={processConfigs}\n                                    isAllowButtons={isAllowButtons}\n                                    allowAllModels={allowAllModels}\n                                    bpmnModeler={bpmnModeler}\n                                    defaultModel={defaultModel}\n                                  />\n                                  {!isBPMQuery(parentType) && (\n                                    <Button\n                                      Icon={DeleteIcon}\n                                      onClick={() =>\n                                        onRemoveExpressionEditor(index)\n                                      }\n                                    />\n                                  )}\n                                </div>\n                              );\n                            }\n                          )}\n                      </div>\n                    </TimelineContent>\n                  </TimelineItem>\n                )}\n              </Timeline>\n            </div>\n          </div>\n        </Paper>\n        <div>\n          <Button\n            title=\"OK\"\n            className={classes.save}\n            onClick={() => generateExpression(combinator, parentType)}\n          />\n          <Button title=\"Cancel\" className={classes.save} onClick={onCancel} />\n        </div>\n      </div>\n      {openAlert && (\n        <Dialog\n          open={openAlert}\n          onClose={(event, reason) => {\n            if (reason !== \"backdropClick\") {\n              setAlert(false);\n            }\n          }}\n          aria-labelledby=\"alert-dialog-title\"\n          aria-describedby=\"alert-dialog-description\"\n          classes={{\n            paper: classes.dialog,\n          }}\n        >\n          <DialogTitle id=\"alert-dialog-title\">\n            {alertConfig.alertTitle}\n          </DialogTitle>\n          <DialogContent>\n            <DialogContentText id=\"alert-dialog-description\">\n              {alertConfig.alertMessage}\n            </DialogContentText>\n          </DialogContent>\n          <DialogActions>\n            <MaterialButton\n              onClick={() => {\n                setAlert(false);\n                if (isClose) {\n                  handleClose();\n                }\n              }}\n              color=\"primary\"\n              autoFocus\n              className={classes.save}\n            >\n              Ok\n            </MaterialButton>\n            <MaterialButton\n              onClick={() => {\n                setAlert(false);\n              }}\n              color=\"primary\"\n              autoFocus\n              style={{ textTransform: \"none\" }}\n              className={classes.save}\n            >\n              Cancel\n            </MaterialButton>\n          </DialogActions>\n        </Dialog>\n      )}\n    </Dialog>\n  );\n}\n\nexport default ExpressionBuilder;\n","import React, { useEffect, useState } from \"react\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  DialogContentText,\n  Button,\n  Tooltip,\n} from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Edit, NotInterested } from \"@material-ui/icons\";\n\nimport ExpressionBuilder from \"../expression-builder/index\";\nimport { translate } from \"../../utils\";\nimport { Select, Checkbox, Textbox } from \"../components\";\nimport { getBool } from \"../../utils\";\nimport { getCustomModels, getMetaModels, getModels } from \"../../services/api\";\n\nconst useStyles = makeStyles((theme) => ({\n  expressionBuilder: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n  },\n  newIcon: {\n    color: \"#58B423\",\n    marginLeft: 5,\n  },\n  new: {\n    cursor: \"pointer\",\n    marginTop: 18.6,\n    display: \"flex\",\n  },\n  textbox: {\n    width: \"100%\",\n  },\n  dialog: {\n    minWidth: 300,\n  },\n  title: {\n    fontSize: 18,\n    fontWeight: \"bold\",\n  },\n  save: {\n    margin: theme.spacing(1),\n    backgroundColor: \"#0275d8\",\n    borderColor: \"#0267bf\",\n    textTransform: \"none\",\n    color: \"white\",\n    \"&:hover\": {\n      backgroundColor: \"#025aa5\",\n      borderColor: \"#014682\",\n      color: \"white\",\n    },\n  },\n}));\n\nexport default function ExtendedQueryProps({ element, bpmnModeler }) {\n  const [isJson, setIsJson] = useState(false);\n  const [isReadOnly, setReadOnly] = useState(false);\n  const [openAlert, setAlert] = useState(false);\n  const [openExpressionBuilder, setExpressionBuilder] = useState(false);\n  const [alertTitle, setAlertTitle] = useState(null);\n  const [alertMessage, setAlertMessage] = useState(null);\n  const [model, setModel] = useState(null);\n  const classes = useStyles();\n\n  const setProperty = (name, value) => {\n    if (!bpmnModeler) return;\n    const modeling = bpmnModeler.get(\"modeling\");\n    modeling.updateProperties(element, {\n      [name]: value,\n    });\n  };\n\n  const getProperty = React.useCallback(\n    (name) => {\n      return element.businessObject[name];\n    },\n    [element]\n  );\n\n  const handleOpen = () => {\n    setExpressionBuilder(true);\n  };\n\n  const handleClose = () => {\n    setExpressionBuilder(false);\n  };\n\n  useEffect(() => {\n    async function fetchModel() {\n      const name = getProperty(\"model\");\n      const isJson = getProperty(\"isJson\");\n      if (!name) {\n        setModel(null);\n        return;\n      }\n      const criteria = {\n        criteria: [\n          {\n            fieldName: \"name\",\n            operator: \"=\",\n            value: name,\n          },\n        ],\n        operator: \"and\",\n      };\n      const metaModels = await getModels(\n        criteria,\n        isJson ? \"metaJsonModel\" : \"metaModel\"\n      );\n      setModel(metaModels && metaModels[0]);\n    }\n    const isJson = getProperty(\"isJson\");\n    setIsJson(isJson);\n    setReadOnly(getProperty(\"expressionValue\") ? true : false);\n    fetchModel();\n  }, [getProperty]);\n\n  return (\n    <div>\n      <Checkbox\n        entry={{\n          id: \"isJson\",\n          label: translate(\"Is Json\"),\n          modelProperty: \"isJson\",\n          widget: \"checkbox\",\n          get: function () {\n            return { isJson: getBool(isJson) };\n          },\n          set: function (e, value) {\n            let isJson = value.isJson;\n            setIsJson(isJson);\n            setProperty(\"isJson\", isJson);\n          },\n        }}\n        element={element}\n      />\n      <Select\n        element={element}\n        bpmnModeler={bpmnModeler}\n        entry={{\n          fetchMethod: () => (isJson ? getCustomModels() : getMetaModels()),\n          name: \"model\",\n          label: translate(\"Model\"),\n        }}\n        value={model}\n        onChange={(value) => {\n          setModel(\n            value\n              ? {\n                  ...(value || {}),\n                  type: isJson ? \"metaJsonModel\" : \"metaModel\",\n                }\n              : undefined\n          );\n        }}\n      />\n      <div className={classes.expressionBuilder}>\n        <Textbox\n          element={element}\n          className={classes.textbox}\n          readOnly={isReadOnly || !model || model === \"\" ? true : false}\n          bpmnModeler={bpmnModeler}\n          entry={{\n            id: \"expression\",\n            label: translate(\"Query\"),\n            modelProperty: \"expression\",\n            name: \"expression\",\n            get: function () {\n              let expression = getProperty(\"expression\");\n              return {\n                expression: (expression || \"\").replace(\n                  /[\\u200B-\\u200D\\uFEFF]/g,\n                  \"\"\n                ),\n              };\n            },\n            set: function (e, values) {\n              setProperty(\n                \"expression\",\n                values.expression === \"\" ? undefined : values.expression\n              );\n            },\n          }}\n        />\n        {model && (\n          <div className={classes.new}>\n            <Tooltip title=\"Enable\" aria-label=\"enable\">\n              <NotInterested\n                className={classes.newIcon}\n                onClick={() => {\n                  if (isReadOnly) {\n                    setAlertMessage(\n                      \"Query can't be managed using builder once changed manually.\"\n                    );\n                    setAlertTitle(\"Warning\");\n                    setAlert(true);\n                  }\n                }}\n              />\n            </Tooltip>\n            <Edit\n              className={classes.newIcon}\n              onClick={() => {\n                handleOpen();\n              }}\n            />\n            {openExpressionBuilder && (\n              <ExpressionBuilder\n                open={openExpressionBuilder}\n                handleClose={() => handleClose()}\n                type=\"bpmQuery\"\n                defaultModel={model}\n                getExpression={() => {\n                  const value = getProperty(\"expressionValue\");\n                  let values;\n                  if (value !== undefined) {\n                    try {\n                      values = JSON.parse(value);\n                      if (!values.length) {\n                        values = null;\n                      }\n                    } catch (errror) {}\n                  }\n                  return { values: values, combinator: undefined };\n                }}\n                setProperty={(val) => {\n                  const { expression, value } = val;\n                  setProperty(\"expression\", expression);\n                  if (\n                    expression === \"\" ||\n                    expression === null ||\n                    expression === undefined\n                  ) {\n                    setProperty(\"expressionValue\", undefined);\n                    return;\n                  }\n                  if (value) {\n                    (value || \"\").replace(/[\\u200B-\\u200D\\uFEFF]/g, \"\");\n                    setProperty(\"expressionValue\", value);\n                    setReadOnly(true);\n                  }\n                }}\n                element={element}\n                title=\"Add Query\"\n              />\n            )}\n            {openAlert && (\n              <Dialog\n                open={openAlert}\n                onClose={(e, reason) => {\n                  if (reason !== \"backdropClick\") {\n                    setAlert(false);\n                  }\n                }}\n                aria-labelledby=\"alert-dialog-title\"\n                aria-describedby=\"alert-dialog-description\"\n                classes={{\n                  paper: classes.dialog,\n                }}\n              >\n                <DialogTitle id=\"alert-dialog-title\">\n                  <label className={classes.title}>\n                    {translate(alertTitle)}\n                  </label>\n                </DialogTitle>\n                <DialogContent>\n                  <DialogContentText id=\"alert-dialog-description\">\n                    {translate(alertMessage)}\n                  </DialogContentText>\n                </DialogContent>\n                <DialogActions>\n                  <Button\n                    onClick={() => {\n                      setAlert(false);\n                      setAlertMessage(null);\n                      setAlertTitle(null);\n                      setReadOnly(false);\n                      setProperty(\"expressionValue\", undefined);\n                    }}\n                    color=\"primary\"\n                    className={classes.save}\n                    autoFocus\n                  >\n                    Ok\n                  </Button>\n                  <Button\n                    onClick={() => {\n                      setAlert(false);\n                    }}\n                    color=\"primary\"\n                    className={classes.save}\n                  >\n                    Cancel\n                  </Button>\n                </DialogActions>\n              </Dialog>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import React, { useEffect, useState } from \"react\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  DialogContentText,\n  Button,\n  Tooltip,\n} from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Edit, NotInterested } from \"@material-ui/icons\";\n\nimport ExpressionBuilder from \"../expression-builder/index\";\nimport { translate } from \"../../utils\";\nimport { Textbox } from \"../components\";\nimport { getModels } from \"../../services/api\";\n\nconst useStyles = makeStyles((theme) => ({\n  expressionBuilder: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n  },\n  newIcon: {\n    color: \"#58B423\",\n    marginLeft: 5,\n  },\n  new: {\n    cursor: \"pointer\",\n    marginTop: 18.6,\n    display: \"flex\",\n  },\n  textbox: {\n    width: \"100%\",\n  },\n  dialog: {\n    minWidth: 300,\n  },\n  title: {\n    fontSize: 18,\n    fontWeight: \"bold\",\n  },\n  save: {\n    margin: theme.spacing(1),\n    backgroundColor: \"#0275d8\",\n    borderColor: \"#0267bf\",\n    textTransform: \"none\",\n    color: \"white\",\n    \"&:hover\": {\n      backgroundColor: \"#025aa5\",\n      borderColor: \"#014682\",\n      color: \"white\",\n    },\n  },\n}));\n\nexport default function ExtendedQueryProps({ element, bpmnModeler }) {\n  const [isReadOnly, setReadOnly] = useState(false);\n  const [openAlert, setAlert] = useState(false);\n  const [openExpressionBuilder, setExpressionBuilder] = useState(false);\n  const [alertTitle, setAlertTitle] = useState(null);\n  const [alertMessage, setAlertMessage] = useState(null);\n  const [model, setModel] = useState(null);\n  const classes = useStyles();\n\n  const setProperty = (name, value) => {\n    if (!bpmnModeler) return;\n    const modeling = bpmnModeler.get(\"modeling\");\n    modeling.updateProperties(element, {\n      [name]: value,\n    });\n  };\n\n  const getProperty = React.useCallback(\n    (name) => {\n      return element.businessObject[name];\n    },\n    [element]\n  );\n\n  const handleOpen = () => {\n    setExpressionBuilder(true);\n  };\n\n  const handleClose = () => {\n    setExpressionBuilder(false);\n  };\n\n  useEffect(() => {\n    async function fetchModel() {\n      const name = getProperty(\"model\");\n      const isJson = getProperty(\"isJson\");\n      if (!name) {\n        setModel(null);\n        return;\n      }\n      const criteria = {\n        criteria: [\n          {\n            fieldName: \"name\",\n            operator: \"=\",\n            value: name,\n          },\n        ],\n        operator: \"and\",\n      };\n      const metaModels = await getModels(\n        criteria,\n        isJson ? \"metaJsonModel\" : \"metaModel\"\n      );\n      setModel(metaModels && metaModels[0]);\n    }\n    setReadOnly(getProperty(\"expressionValue\") ? true : false);\n    fetchModel();\n  }, [getProperty]);\n\n  return (\n    <div className={classes.expressionBuilder}>\n      <Textbox\n        element={element}\n        className={classes.textbox}\n        readOnly={isReadOnly}\n        bpmnModeler={bpmnModeler}\n        entry={{\n          id: \"expression\",\n          label: translate(\"Expression\"),\n          modelProperty: \"expression\",\n          name: \"expression\",\n          get: function () {\n            let expression = getProperty(\"expression\");\n            return {\n              expression: (expression || \"\").replace(\n                /[\\u200B-\\u200D\\uFEFF]/g,\n                \"\"\n              ),\n            };\n          },\n          set: function (e, values) {\n            setProperty(\n              \"expression\",\n              values.expression === \"\" ? undefined : values.expression\n            );\n          },\n        }}\n      />\n      <div className={classes.new}>\n        <Tooltip title=\"Enable\" aria-label=\"enable\">\n          <NotInterested\n            className={classes.newIcon}\n            onClick={() => {\n              if (isReadOnly) {\n                setAlertMessage(\n                  \"Query can't be managed using builder once changed manually.\"\n                );\n                setAlertTitle(\"Warning\");\n                setAlert(true);\n              }\n            }}\n          />\n        </Tooltip>\n        <Edit\n          className={classes.newIcon}\n          onClick={() => {\n            handleOpen();\n          }}\n        />\n        {openExpressionBuilder && (\n          <ExpressionBuilder\n            open={openExpressionBuilder}\n            handleClose={() => handleClose()}\n            defaultModel={model}\n            getExpression={() => {\n              const value = getProperty(\"expressionValue\");\n              let values;\n              if (value !== undefined) {\n                try {\n                  values = JSON.parse(value);\n                  if (!values.length) {\n                    values = null;\n                  }\n                } catch (errror) {}\n              }\n              return { values: values, combinator: undefined };\n            }}\n            setProperty={(val) => {\n              const { expression, value } = val;\n              setProperty(\"expression\", expression);\n              if (\n                expression === \"\" ||\n                expression === null ||\n                expression === undefined\n              ) {\n                setProperty(\"expressionValue\", undefined);\n                return;\n              }\n              if (value) {\n                (value || \"\").replace(/[\\u200B-\\u200D\\uFEFF]/g, \"\");\n                setProperty(\"expressionValue\", value);\n                setReadOnly(true);\n              }\n            }}\n            element={element}\n            title={translate(\"Add Expression\")}\n          />\n        )}\n        {openAlert && (\n          <Dialog\n            open={openAlert}\n            onClose={(e, reason) => {\n              if (reason !== \"backdropClick\") {\n                setAlert(false);\n              }\n            }}\n            aria-labelledby=\"alert-dialog-title\"\n            aria-describedby=\"alert-dialog-description\"\n            classes={{\n              paper: classes.dialog,\n            }}\n          >\n            <DialogTitle id=\"alert-dialog-title\">\n              <label className={classes.title}>{translate(alertTitle)}</label>\n            </DialogTitle>\n            <DialogContent>\n              <DialogContentText id=\"alert-dialog-description\">\n                {translate(alertMessage)}\n              </DialogContentText>\n            </DialogContent>\n            <DialogActions>\n              <Button\n                onClick={() => {\n                  setAlert(false);\n                  setAlertMessage(null);\n                  setAlertTitle(null);\n                  setReadOnly(false);\n                  setProperty(\"expressionValue\", undefined);\n                }}\n                color=\"primary\"\n                className={classes.save}\n                autoFocus\n              >\n                Ok\n              </Button>\n              <Button\n                onClick={() => {\n                  setAlert(false);\n                }}\n                color=\"primary\"\n                className={classes.save}\n              >\n                Cancel\n              </Button>\n            </DialogActions>\n          </Dialog>\n        )}\n      </div>\n    </div>\n  );\n}\n","import React, { useEffect, useState } from \"react\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  DialogContentText,\n  Button,\n} from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Edit } from \"@material-ui/icons\";\n\nimport { Selection } from \"../expression-builder/components\";\nimport { getModels, getMetaFields } from \"../../services/api\";\nimport { FieldEditor } from \"../components\";\nimport { translate, lowerCaseFirstLetter } from \"../../utils\";\nimport { Textbox } from \"../components\";\n\nconst useStyles = makeStyles((theme) => ({\n  expressionBuilder: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n  },\n  newIcon: {\n    color: \"#58B423\",\n    marginLeft: 5,\n  },\n  new: {\n    cursor: \"pointer\",\n    marginTop: 18.6,\n    display: \"flex\",\n  },\n  textbox: {\n    width: \"100%\",\n  },\n  dialog: {\n    minWidth: 300,\n  },\n  title: {\n    fontSize: 18,\n    fontWeight: \"bold\",\n  },\n  save: {\n    margin: theme.spacing(1),\n    backgroundColor: \"#0275d8\",\n    borderColor: \"#0267bf\",\n    textTransform: \"none\",\n    color: \"white\",\n    \"&:hover\": {\n      backgroundColor: \"#025aa5\",\n      borderColor: \"#014682\",\n      color: \"white\",\n    },\n  },\n  dialogContent: {\n    display: \"flex\",\n    alignItems: \"flex-end\",\n  },\n  MuiAutocompleteRoot: {\n    width: \"250px\",\n    marginRight: \"10px\",\n  },\n}));\n\nexport default function FieldBuilder({ element, bpmnModeler }) {\n  const [openAlert, setAlert] = useState(false);\n  const [openExpressionBuilder, setExpressionBuilder] = useState(false);\n  const [alertTitle, setAlertTitle] = useState(null);\n  const [alertMessage, setAlertMessage] = useState(null);\n  const [expression, setExpression] = useState(null);\n  const [expressionPathDummy, setExpressionPathDummy] = useState(null);\n  const [field, setField] = useState(null);\n  const [model, setModel] = useState(null);\n\n  const classes = useStyles();\n\n  const setProperty = (name, value) => {\n    if (!bpmnModeler) return;\n    const modeling = bpmnModeler.get(\"modeling\");\n    modeling.updateProperties(element, {\n      [name]: value,\n    });\n  };\n\n  const getProperty = React.useCallback(\n    (name) => {\n      return element.businessObject[name];\n    },\n    [element]\n  );\n\n  const handleOpen = () => {\n    setExpressionBuilder(true);\n  };\n\n  const handleClose = () => {\n    setExpressionBuilder(false);\n  };\n\n  const getData = () => {\n    return model\n      ? {\n          fullName: model.fullName,\n          name: model.name,\n          type: model.type,\n        }\n      : undefined;\n  };\n\n  useEffect(() => {\n    async function fetchModel() {\n      const expression = getProperty(\"expression\");\n      setExpression(expression);\n      setExpressionPathDummy(expression);\n      if (expression) {\n        setField({\n          type: \"MANY_TO_MANY\",\n        });\n      }\n      const modelName =\n        expression && expression.split(\"?.\") && expression.split(\"?.\")[0];\n      if (!modelName) {\n        setModel(null);\n        return;\n      }\n      const criteria = {\n        criteria: [\n          {\n            fieldName: \"name\",\n            operator: \"like\",\n            value: modelName,\n          },\n        ],\n        operator: \"and\",\n      };\n      const metaModels = await getModels(criteria);\n      setModel(metaModels && metaModels[0]);\n    }\n    fetchModel();\n  }, [getProperty]);\n\n  return (\n    <div className={classes.expressionBuilder}>\n      <Textbox\n        element={element}\n        className={classes.textbox}\n        bpmnModeler={bpmnModeler}\n        entry={{\n          id: \"expression\",\n          label: translate(\"Expression\"),\n          modelProperty: \"expression\",\n          name: \"expression\",\n          get: function () {\n            let expression = getProperty(\"expression\");\n            return {\n              expression: (expression || \"\").replace(\n                /[\\u200B-\\u200D\\uFEFF]/g,\n                \"\"\n              ),\n            };\n          },\n          set: function (e, values) {\n            if (!values.expression || values.expression === \"\") {\n              setExpression(null);\n              setModel(null);\n              setExpressionPathDummy(null);\n            }\n            setProperty(\n              \"expression\",\n              values.expression === \"\" ? undefined : values.expression\n            );\n          },\n        }}\n      />\n      <div className={classes.new}>\n        <Edit\n          className={classes.newIcon}\n          onClick={() => {\n            handleOpen();\n          }}\n        />\n        {openExpressionBuilder && (\n          <Dialog\n            open={openExpressionBuilder}\n            onClose={(event, reason) => {\n              if (reason !== \"backdropClick\") {\n                handleClose();\n              }\n            }}\n            aria-labelledby=\"alert-dialog-title\"\n            aria-describedby=\"alert-dialog-description\"\n            classes={{\n              paper: classes.dialog,\n            }}\n          >\n            <DialogTitle id=\"alert-dialog-title\">\n              {translate(\"Expression\")}\n            </DialogTitle>\n            <DialogContent className={classes.dialogContent}>\n              <Selection\n                name=\"model\"\n                title=\"Model\"\n                placeholder=\"Model\"\n                fetchAPI={() => getModels()}\n                onChange={(e) => {\n                  if (!e) {\n                    setExpressionPathDummy(null);\n                  }\n                  setModel(e);\n                }}\n                optionLabelKey=\"name\"\n                value={model}\n                classes={{ root: classes.MuiAutocompleteRoot }}\n              />\n              {model && (\n                <FieldEditor\n                  getMetaFields={() => getMetaFields(getData())}\n                  isCollection={true}\n                  onChange={(val, field) => {\n                    if (val && val !== \"\") {\n                      setExpressionPathDummy(\n                        `${model && lowerCaseFirstLetter(model.name)}?.${val}`\n                      );\n                    } else {\n                      setExpressionPathDummy(null);\n                    }\n                    setField(field);\n                  }}\n                  value={{\n                    fieldName:\n                      expressionPathDummy &&\n                      expressionPathDummy.split(\"?.\") &&\n                      expressionPathDummy.split(\"?.\")[1],\n                  }}\n                  isParent={true}\n                />\n              )}\n            </DialogContent>\n            <DialogActions>\n              <Button\n                onClick={() => {\n                  if (\n                    ![\"MANY_TO_MANY\", \"ONE_TO_MANY\"].includes(\n                      field && field.type && field.type.toUpperCase()\n                    ) &&\n                    model\n                  ) {\n                    setAlertMessage(\n                      \"Last field selected  must be of O2M or M2M type\"\n                    );\n                    setAlert(true);\n                    return;\n                  }\n                  setExpression(expressionPathDummy);\n                  setProperty(\"expression\", expressionPathDummy);\n                  handleClose();\n                }}\n                color=\"primary\"\n                autoFocus\n                className={classes.save}\n              >\n                OK\n              </Button>\n              <Button\n                onClick={() => {\n                  setExpressionPathDummy(expression);\n                  handleClose();\n                }}\n                color=\"primary\"\n                className={classes.save}\n              >\n                Cancel\n              </Button>\n            </DialogActions>\n          </Dialog>\n        )}\n        {openAlert && (\n          <Dialog\n            open={openAlert}\n            onClose={(e, reason) => {\n              if (reason !== \"backdropClick\") {\n                setAlert(false);\n              }\n            }}\n            aria-labelledby=\"alert-dialog-title\"\n            aria-describedby=\"alert-dialog-description\"\n            classes={{\n              paper: classes.dialog,\n            }}\n          >\n            <DialogTitle id=\"alert-dialog-title\">\n              <label className={classes.title}>{translate(alertTitle)}</label>\n            </DialogTitle>\n            <DialogContent>\n              <DialogContentText id=\"alert-dialog-description\">\n                {translate(alertMessage)}\n              </DialogContentText>\n            </DialogContent>\n            <DialogActions>\n              <Button\n                onClick={() => {\n                  setAlert(false);\n                  setAlertMessage(null);\n                  setAlertTitle(null);\n                }}\n                color=\"primary\"\n                className={classes.save}\n                autoFocus\n              >\n                Ok\n              </Button>\n              <Button\n                onClick={() => {\n                  setAlert(false);\n                }}\n                color=\"primary\"\n                className={classes.save}\n              >\n                Cancel\n              </Button>\n            </DialogActions>\n          </Dialog>\n        )}\n      </div>\n    </div>\n  );\n}\n","export function getBusinessObject(element) {\n  return (element && element.businessObject) || element;\n}\n\nexport function is(element, type) {\n  var bo = getBusinessObject(element);\n\n  return bo && (typeof bo.$instanceOf === 'function') && bo.$instanceOf(type);\n}\n","import React, { useEffect, useState } from \"react\";\nimport Ids from \"ids\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { getBusinessObject, is } from \"../ModelUtil\";\n\nimport { translate } from \"../../utils\";\nimport { ExtensionElementTable, TextField } from \"../components\";\n\nconst useStyles = makeStyles({\n  groupLabel: {\n    fontWeight: \"bolder\",\n    display: \"inline-block\",\n    verticalAlign: \"middle\",\n    color: \"#666\",\n    fontSize: \"120%\",\n    margin: \"10px 0px\",\n    transition: \"margin 0.218s linear\",\n    fontStyle: \"italic\",\n  },\n  divider: {\n    marginTop: 15,\n    borderTop: \"1px dotted #ccc\",\n  },\n});\n\nconst PARAMETER_ELEMENT = \"bpmn:Parameter\";\n\nconst createElement = (elementType, properties, parent, factory) => {\n  let element = factory.create(elementType, properties);\n  element.$parent = parent;\n  return element;\n};\n\nconst fetchParameterElements = (bo) => {\n  return bo.get(\"values\");\n};\n\nconst getParameters = (bo, type) => {\n  let parameters = fetchParameterElements(bo);\n  if (typeof parameters !== \"undefined\") {\n    let elements = parameters.filter(function (value) {\n      return is(value, type);\n    });\n    if (elements.length) {\n      return elements;\n    }\n  }\n};\n\nfunction getParameterElements(bo, type) {\n  return (bo && getParameters(bo, type)) || [];\n}\n\nexport default function ParameterProps({ element, index, label, bpmnFactory }) {\n  const [parameterEntity, setParameterEntity] = useState(null);\n  const [parameterOptions, setParameterOptions] = useState(null);\n\n  const classes = useStyles();\n\n  const newElement = (element, type) => {\n    return function (e, extensionEle, value) {\n      const RENDERER_IDS = new Ids();\n      const rendererId = RENDERER_IDS.next();\n      let id = `parameter_${rendererId}`;\n      let props = {\n        id,\n      };\n\n      let newElem = createElement(type, props, extensionEle, bpmnFactory);\n\n      let bo = getBusinessObject(element);\n      if (bo.values) {\n        element.businessObject.values.push(newElem);\n      } else {\n        element.businessObject.values = [newElem];\n      }\n      return newElem;\n    };\n  };\n\n  const removeElement = (type) => {\n    return function (index) {\n      let bo = getBusinessObject(element);\n      const parameters = bo && bo.values;\n      let count;\n      parameters &&\n        parameters.forEach((element, ind) => {\n          if (element.$type === type) {\n            if (count > -1) {\n              count++;\n            } else {\n              count = 0;\n            }\n          }\n          if (count === Number(index)) {\n            bo.values.splice(ind, 1);\n            return;\n          }\n        });\n      addOptions(element);\n      if (parameters && !parameters.find((e) => e.$type === type)) {\n        if (type === PARAMETER_ELEMENT) {\n          setParameterEntity(null);\n        }\n      } else {\n        setParameterEntity(null);\n      }\n    };\n  };\n\n  const getBO = React.useCallback(() => {\n    let bo = getBusinessObject(element);\n    if (is(element, \"bpmn:Participant\")) {\n      bo = bo.get(\"processRef\");\n    }\n    return bo;\n  }, [element]);\n\n  const getParameterElement = React.useCallback(() => {\n    let type = PARAMETER_ELEMENT;\n    let bo = getBO();\n    const parameters = getParameterElements(bo, type);\n    const parameterElement = parameters[parameterEntity];\n    return parameterElement || (parameters && parameters[0]);\n  }, [getBO, parameterEntity]);\n\n  const showParameter = () => {\n    if (\n      is(element, \"bpmn:FlowElement\") ||\n      is(element, \"bpmn:Process\") ||\n      is(element, \"bpmn:Participant\")\n    ) {\n      const bo = getBO();\n      if (bo) {\n        return true;\n      } else {\n        return false;\n      }\n    } else {\n      return false;\n    }\n  };\n\n  const setOptionLabelValue = (type) => {\n    const bo = getBO();\n    return function (index) {\n      let parameters = getParameterElements(bo, type);\n      let parameterElement = parameters[index];\n      if (!parameterElement) return \"\";\n      let label = parameterElement.id;\n      return label;\n    };\n  };\n\n  const addOptions = (element, isInitial = false) => {\n    const bo = getBusinessObject(element);\n    const parameters = getParameterElements(bo, PARAMETER_ELEMENT);\n\n    const parameterOptions =\n      parameters &&\n      parameters.map(function (l, index) {\n        return {\n          id: index,\n          text: l.id,\n        };\n      });\n    setParameterOptions(parameterOptions);\n    if (isInitial) {\n      if (parameterOptions.length > 0) {\n        setParameterEntity(parameterOptions[0]);\n      }\n    }\n  };\n\n  useEffect(() => {\n    addOptions(element, true);\n  }, [element]);\n\n  return (\n    <div>\n      <React.Fragment>\n        {index > 0 && <div className={classes.divider} />}\n      </React.Fragment>\n      <div className={classes.groupLabel}>{label}</div>\n      {showParameter() && (\n        <ExtensionElementTable\n          element={element}\n          options={parameterOptions}\n          entry={{\n            id: \"parameter\",\n            label: translate(\"Parameter\"),\n            modelProperty: \"name\",\n            idGeneration: \"false\",\n            reference: \"processRef\",\n            createExtensionElement: newElement(element, PARAMETER_ELEMENT),\n            removeExtensionElement: removeElement(PARAMETER_ELEMENT),\n            onSelectionChange: function (value) {\n              setParameterEntity(value);\n            },\n            setOptionLabelValue: setOptionLabelValue(PARAMETER_ELEMENT),\n          }}\n        />\n      )}\n      {(parameterEntity || parameterEntity === 0) && (\n        <React.Fragment>\n          <TextField\n            element={element}\n            canRemove={true}\n            entry={{\n              id: \"target\",\n              label: translate(\"Target\"),\n              modelProperty: \"target\",\n              get: function () {\n                const parameterElement = getParameterElement();\n                if (!parameterElement) return;\n                return { target: parameterElement.target };\n              },\n              set: function (e, values) {\n                const parameterElement = getParameterElement();\n                if (!parameterElement) return;\n                parameterElement[\"target\"] = values.target;\n              },\n            }}\n          />\n          <TextField\n            element={element}\n            canRemove={true}\n            entry={{\n              id: \"expression\",\n              label: translate(\"Expression\"),\n              modelProperty: \"expression\",\n              get: function () {\n                const parameterElement = getParameterElement();\n                if (!parameterElement) return;\n                return { expression: parameterElement.expression };\n              },\n              set: function (e, values) {\n                const parameterElement = getParameterElement();\n                if (!parameterElement) return;\n                parameterElement[\"expression\"] = values.expression;\n              },\n            }}\n          />\n        </React.Fragment>\n      )}\n    </div>\n  );\n}\n","import { getAllModels } from \"../services/api\";\nexport const tabProperty = [\n  {\n    type: \"bpmn:Process-action\",\n    properties: [\n      { name: \"name\", label: \"Name\", widget: \"textBox\" },\n      {\n        name: \"targetModel\",\n        isAttr: true,\n        type: \"String\",\n        label: \"Target model\",\n        widget: \"many-to-one\",\n        fetchMethod: () => getAllModels(),\n      },\n      {\n        name: \"sourceModel\",\n        isAttr: true,\n        type: \"String\",\n        label: \"Source model\",\n        widget: \"many-to-one\",\n        fetchMethod: () => getAllModels(),\n      },\n    ],\n  },\n  {\n    type: \"bpmn:Query\",\n    properties: [\n      { name: \"name\", label: \"Name\", widget: \"textBox\" },\n      { name: \"target\", label: \"Var\", widget: \"textField\" },\n      {\n        name: \"extendedQueryProperties\",\n        label: \"\",\n        widget: \"extendedQueryProperties\",\n      },\n      {\n        name: \"returnType\",\n        label: \"Return type\",\n        widget: \"selectBox\",\n        emptyParameter: true,\n        selectOptions: [\n          { name: \"Map\", value: \"MAP\" },\n          { name: \"Single\", value: \"SINGLE\" },\n          { name: \"Multiple\", value: \"MULTIPLE\" },\n        ],\n      },\n    ],\n  },\n  {\n    type: \"bpmn:Conditional\",\n    properties: [\n      { name: \"name\", label: \"Name\", widget: \"textBox\" },\n      { name: \"expression\", label: \"Expression\", widget: \"expressionBuilder\" },\n    ],\n  },\n  {\n    type: \"bpmn:Loop\",\n    properties: [\n      { name: \"name\", label: \"Name\", widget: \"textBox\" },\n      { name: \"target\", label: \"Variable\", widget: \"textField\" },\n      { name: \"expression\", label: \"Expression\", widget: \"fieldBuilder\" },\n    ],\n  },\n  {\n    type: \"bpmn:Function\",\n    properties: [\n      { name: \"name\", label: \"Name\", widget: \"textBox\" },\n      { name: \"functionName\", label: \"Function Name\", widget: \"textBox\" },\n      {\n        name: \"returnType\",\n        label: \"Return type\",\n        widget: \"selectBox\",\n        emptyParameter: true,\n        selectOptions: [\n          { name: \"Map\", value: \"MAP\" },\n          { name: \"Single\", value: \"SINGLE\" },\n          { name: \"Multiple\", value: \"MULTIPLE\" },\n        ],\n      },\n      { name: \"parameter\", label: \"Parameter\", widget: \"parameterTable\" },\n    ],\n  },\n  {\n    type: \"bpmn:Mapper\",\n    properties: [\n      { name: \"name\", label: \"Name\", widget: \"textBox\" },\n      {\n        name: \"script\",\n        label: \"Script\",\n        widget: \"scriptBox\",\n      },\n    ],\n  },\n  {\n    type: \"label\",\n    properties: [{ name: \"name\", label: \"Name\", widget: \"textBox\" }],\n  },\n  {\n    type: \"bpmn:SequenceFlow\",\n    properties: [{ name: \"name\", label: \"Name\", widget: \"textBox\" }],\n  },\n];\n","import React, { useEffect, useState } from \"react\";\nimport Alert from \"@material-ui/lab/Alert\";\nimport {\n  Drawer,\n  Typography,\n  IconButton,\n  Tooltip,\n  Snackbar,\n} from \"@material-ui/core\";\nimport { Resizable } from \"re-resizable\";\n\nimport Service from \"../services/Service\";\nimport BpmnModeler from \"./main/baml-js/lib/Modeler\";\nimport customControlsModule from \"./custom\";\nimport ScriptBox from \"./views/ScriptBox\";\nimport ExtendedQuery from \"./views/ExtendedQueryProps\";\nimport Builder from \"./views/Builder\";\nimport FieldBuilder from \"./views/FieldBuilder\";\nimport ParameterTable from \"./views/ParameterProps\";\nimport { Textbox, TextField, SelectBox, Checkbox, Select } from \"./components\";\nimport { tabProperty } from \"./tabProperty\";\nimport { download } from \"../utils\";\n\nimport { Panorama, Publish, GetApp, Save, Code } from \"@material-ui/icons\";\n\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport \"./main/baml-js/assets/diagram-js.css\";\nimport \"../BAML/main/baml-font/css/bpmn.css\";\nimport \"./css/bpmn.css\";\n\nconst resizeStyle = {\n  display: \"flex\",\n  alignItems: \"center\",\n  justifyContent: \"center\",\n  borderLeft: \"solid 1px #ddd\",\n  background: \"#f0f0f0\",\n};\n\nconst useStyles = makeStyles(() => ({\n  drawer: {\n    width: drawerWidth,\n    flexShrink: 0,\n  },\n  drawerPaper: {\n    background: \"#F8F8F8\",\n    width: \"100%\",\n    position: \"absolute\",\n    borderLeft: \"1px solid #ccc\",\n    overflow: \"auto\",\n    height: \"100%\",\n    textAlign: \"left\",\n  },\n  drawerContainer: {\n    padding: 10,\n    height: \"100%\",\n  },\n  nodeTitle: {\n    fontSize: \"120%\",\n    fontWeight: \"bolder\",\n  },\n  propertyLable: {\n    fontSize: 13,\n    fontWeight: \"bolder\",\n    margin: \"10px 0px\",\n  },\n  icon: {\n    color: \"black\",\n    width: \"1.2em\",\n    height: \"1.2em\",\n  },\n  btnContainer: {\n    border: \"1px solid #dcdc\",\n    background: \"#F8F8F8\",\n  },\n  iconButton: {\n    padding: \"5px 15px\",\n  },\n}));\n\nconst drawerWidth = 380;\n\nconst defaultXml = `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<process-actions \n  xmlns:xs=\"http://www.w3.org/2001/XMLSchema-instance\" \n  xs:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n  xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" \n  xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" \n  xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\" \n  xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\" \n  id=\"sample-diagram\" targetNamespace=\"http://bpmn.io/schema/bpmn\">\n  <process-action id=\"ProcessAction_1\">\n  </process-action>\n  <bpmndi:BPMNDiagram id=\"BPMNDiagram_1\">\n    <bpmndi:BPMNPlane id=\"BPMNPlane_1\" bpmnElement=\"Process_1\">\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</process-actions>`;\n\nconst saveSVG = (bpmnModeler) => {\n  bpmnModeler.saveSVG({ format: true }, async function (err, svg) {\n    download(svg, \"diagram.svg\");\n  });\n};\n\nconst getStartElements = (type, types, elements) => {\n  return elements.filter(\n    (e) =>\n      e.element &&\n      e.element.incoming &&\n      e.element.incoming.length === 0 &&\n      (e.element.parent && e.element.parent.type) === type &&\n      ![\n        \"bpmn:Process-action\",\n        \"bpmn:SequenceFlow\",\n        \"bpmn:TextAnnotation\",\n        \"label\",\n        ...types,\n      ].includes(e.element.type)\n  );\n};\n\nconst getSequencedChildElements = (\n  startElements,\n  flowElements,\n  sequenceFlows\n) => {\n  if (!startElements) return;\n  startElements.forEach((startElement) => {\n    let start = startElement.element && startElement.element.businessObject;\n    if (\n      startElement.element &&\n      (startElement.element.type === \"bpmn:Loop\" ||\n        startElement.element.type === \"bpmn:Conditional\")\n    ) {\n      let ele = updateChildFlowElements(\n        startElement.element && startElement.element.businessObject,\n        startElement.element.type\n      );\n      start = ele ? ele : start;\n    }\n    flowElements.push(start);\n    const seqFlow = sequenceFlows.find(\n      (f) =>\n        f.sourceRef.id === (startElement.element && startElement.element.id)\n    );\n    if (seqFlow) {\n      const targetElement = seqFlow.targetRef;\n      let target = targetElement;\n      if (\n        targetElement.type === \"bpmn:Loop\" ||\n        targetElement.$type === \"bpmn:Loop\" ||\n        targetElement.type === \"bpmn:Conditional\" ||\n        targetElement.$type === \"bpmn:Conditional\"\n      ) {\n        let ele = updateChildFlowElements(\n          targetElement,\n          targetElement.type || targetElement.$type\n        );\n        target = ele ? ele : target;\n      }\n      flowElements.push(target);\n      flowElements.push(seqFlow);\n      const newElements = addFlowElements(\n        flowElements,\n        sequenceFlows,\n        targetElement\n      );\n      flowElements = newElements ? newElements : flowElements;\n    }\n  });\n  return flowElements;\n};\n\nconst updateChildFlowElements = (element, type) => {\n  if (!element) return;\n  const elements = element.flowElements;\n  if (!elements) return;\n  const sequenceFlows = elements.filter(\n    (e) =>\n      (e.type || e.$type || (e.element && e.element.type)) ===\n      \"bpmn:SequenceFlow\"\n  );\n  const elementIds = elements.map((e) => e.id);\n  let elementRegistry = bpmnModeler.get(\"elementRegistry\");\n  let nodes = elementRegistry && elementRegistry._elements;\n  const allElements = Object.values(nodes) || [];\n  const basicElements = allElements.filter((e) =>\n    elementIds.includes(e.element && e.element.id)\n  );\n  const startElements = getStartElements(type, [type], basicElements);\n  let flowElements = getSequencedChildElements(\n    startElements,\n    [],\n    sequenceFlows\n  );\n  element.flowElements = flowElements;\n  return element;\n};\n\nconst addFlowElements = (flowElements, sequenceFlows, source) => {\n  const seqFlow = sequenceFlows.find(\n    (f) =>\n      ((f.sourceRef && f.sourceRef.id) ||\n        f.element.businessObject.sourceRef.id) === source.id\n  );\n  if (seqFlow) {\n    const targetElement =\n      seqFlow.targetRef || seqFlow.element.businessObject.targetRef;\n    let target = targetElement;\n    if (\n      targetElement.type === \"bpmn:Loop\" ||\n      targetElement.$type === \"bpmn:Loop\" ||\n      targetElement.type === \"bpmn:Conditional\" ||\n      targetElement.$type === \"bpmn:Conditional\"\n    ) {\n      let ele = updateChildFlowElements(\n        targetElement,\n        targetElement.type || targetElement.$type\n      );\n      target = ele ? ele : target;\n    }\n    flowElements.push(target);\n    flowElements.push(\n      (seqFlow.element && seqFlow.element.businessObject) || seqFlow\n    );\n    addFlowElements(flowElements, sequenceFlows, targetElement);\n  } else {\n    return flowElements;\n  }\n};\n\nconst getSequencedFlowElements = (\n  startElements,\n  flowElements,\n  sequenceFlows\n) => {\n  if (!startElements) return;\n  startElements.forEach((startElement) => {\n    let start = startElement.element && startElement.element.businessObject;\n    if (\n      startElement.element &&\n      (startElement.element.type === \"bpmn:Loop\" ||\n        startElement.element.type === \"bpmn:Conditional\")\n    ) {\n      let ele = updateChildFlowElements(\n        startElement.element && startElement.element.businessObject,\n        startElement.element.type\n      );\n      start = ele ? ele : start;\n    }\n    flowElements.push(start);\n    const seqFlow = sequenceFlows.find(\n      (f) =>\n        (f.element &&\n          f.element.businessObject &&\n          f.element.businessObject.sourceRef &&\n          f.element.businessObject.sourceRef.id) ===\n        (startElement.element && startElement.element.id)\n    );\n    if (seqFlow) {\n      const targetElement =\n        seqFlow.element &&\n        seqFlow.element.businessObject &&\n        seqFlow.element.businessObject.targetRef;\n      let target = targetElement;\n      if (\n        targetElement.type === \"bpmn:Loop\" ||\n        targetElement.$type === \"bpmn:Loop\" ||\n        targetElement.type === \"bpmn:Conditional\" ||\n        targetElement.$type === \"bpmn:Conditional\"\n      ) {\n        let ele = updateChildFlowElements(\n          targetElement,\n          targetElement.type || targetElement.$type\n        );\n        target = ele ? ele : target;\n      }\n      flowElements.push(target);\n      flowElements.push(seqFlow.element && seqFlow.element.businessObject);\n      const newElements = addFlowElements(\n        flowElements,\n        sequenceFlows,\n        targetElement\n      );\n      flowElements = newElements ? newElements : flowElements;\n    }\n  });\n  return flowElements;\n};\n\nconst updateXml = () => {\n  let elementRegistry = bpmnModeler.get(\"elementRegistry\");\n  let nodes = elementRegistry && elementRegistry._elements;\n  const elements = Object.values(nodes) || [];\n  let flowElements = [];\n  if (!elements || elements.length === 0) return;\n  const sequenceFlows =\n    elements &&\n    elements.filter(\n      (e) => (e.element && e.element.type) === \"bpmn:SequenceFlow\"\n    );\n  const startElements = getStartElements(\"bpmn:Process-action\", [], elements);\n  flowElements = getSequencedFlowElements(\n    startElements,\n    flowElements,\n    sequenceFlows\n  );\n  if (!flowElements) return;\n  let canvas = bpmnModeler.get(\"canvas\");\n  canvas.zoom(\"fit-viewport\");\n  let element = canvas.getRootElement();\n  element.businessObject.flowElements = flowElements;\n};\n\nconst downloadXml = (bpmnModeler) => {\n  updateXml();\n  bpmnModeler.saveXML({ format: true }, async function (err, xml) {\n    download(xml, \"diagram.baml\");\n  });\n};\n\nconst uploadXml = () => {\n  document.getElementById(\"inputFile\").click();\n};\n\nconst fetchId = () => {\n  const regexBPMN = /[?&]id=([^&#]*)/g; // ?id=1\n  const url = window.location.href;\n  let matchBPMNId, id;\n  while ((matchBPMNId = regexBPMN.exec(url))) {\n    id = matchBPMNId[1];\n    return id;\n  }\n};\n\nlet bpmnModeler = null;\n\nfunction BamlEditor() {\n  const [width, setWidth] = useState(drawerWidth);\n  const [height, setHeight] = useState(\"100%\");\n  const [drawerOpen, setDrawerOpen] = useState(true);\n  const [element, setElement] = useState(null);\n  const [baml, setBaml] = useState(null);\n  const [openSnackbar, setSnackbar] = useState({\n    open: false,\n    messageType: null,\n    message: null,\n  });\n  const classes = useStyles();\n\n  const setCSSWidth = (width) => {\n    document.documentElement.style.setProperty(\n      \"--bpmn-container-width\",\n      `${width}px`\n    );\n    setDrawerOpen(width === \"0px\" ? false : true);\n  };\n\n  const generateCode = async () => {\n    updateXml();\n    bpmnModeler.saveXML({ format: true }, async function (err, xml) {\n      let res = await Service.add(\"com.axelor.apps.bpm.db.BamlModel\", {\n        ...baml,\n        bamlXml: xml,\n      });\n      if (res && res.data && res.data[0]) {\n        const baml = res.data[0];\n        if (!baml) return;\n        const actionResponse = await Service.action({\n          model: \"com.axelor.apps.bpm.db.BamlModel\",\n          action: \"action-baml-model-method-generate-code\",\n          data: {\n            context: {\n              ...(baml || {}),\n            },\n          },\n        });\n        if (!actionResponse || actionResponse.status === -1) return;\n        const { data } = actionResponse;\n        const resultScript =\n          data[0] && data[0].values && data[0].values.resultScript;\n        let updatedRes = await Service.add(\"com.axelor.apps.bpm.db.BamlModel\", {\n          ...baml,\n          resultScript,\n        });\n        if (updatedRes && updatedRes.data && updatedRes.data[0]) {\n          setBaml({ ...updatedRes.data[0] });\n          handleSnackbarClick(\"success\", \"Operation successful\");\n        } else {\n          handleSnackbarClick(\n            \"error\",\n            (updatedRes &&\n              updatedRes.data &&\n              (updatedRes.data.message || updatedRes.data.title)) ||\n              \"Error!\"\n          );\n        }\n      }\n    });\n  };\n\n  const onSave = () => {\n    updateXml();\n    bpmnModeler.saveXML({ format: true }, async function (err, xml) {\n      let res = await Service.add(\"com.axelor.apps.bpm.db.BamlModel\", {\n        ...baml,\n        bamlXml: xml,\n      });\n      if (res && res.data && res.data[0]) {\n        setBaml({ ...res.data[0] });\n        handleSnackbarClick(\"success\", \"Saved Successfully\");\n      } else {\n        handleSnackbarClick(\n          \"error\",\n          (res && res.data && (res.data.message || res.data.title)) || \"Error!\"\n        );\n      }\n    });\n  };\n\n  const handleSnackbarClose = (event, reason) => {\n    if (reason === \"clickaway\") {\n      return;\n    }\n    setSnackbar({\n      open: false,\n      messageType: null,\n      message: null,\n    });\n  };\n\n  const toolBarButtons = [\n    {\n      name: \"Save\",\n      icon: <Save className={classes.icon} />,\n      tooltipText: \"Save\",\n      onClick: onSave,\n    },\n    {\n      name: \"Image\",\n      icon: <Panorama className={classes.icon} />,\n      tooltipText: \"Download SVG\",\n      onClick: () => saveSVG(bpmnModeler),\n    },\n    {\n      name: \"DownloadXml\",\n      icon: <GetApp className={classes.icon} />,\n      tooltipText: \"Download\",\n      onClick: () => downloadXml(bpmnModeler),\n    },\n    {\n      name: \"UploadXml\",\n      icon: <Publish className={classes.icon} />,\n      tooltipText: \"Upload\",\n      onClick: uploadXml,\n    },\n    {\n      name: \"GenerateCode\",\n      icon: <Code className={classes.icon} />,\n      tooltipText: \"Generate Code\",\n      onClick: generateCode,\n    },\n  ];\n\n  const getProperties = () => {\n    let ele = tabProperty.find((p) => p.type === (element && element.type));\n    if (!ele) return [];\n    if (ele.properties) {\n      return ele.properties;\n    }\n  };\n\n  const openDiagramImage = (bamlXml) => {\n    if (!bamlXml) return;\n    bpmnModeler.importXML(bamlXml, (err) => {\n      if (err) {\n        return console.error(\"could not import BPMN 2.0 diagram\", err);\n      }\n      let canvas = bpmnModeler.get(\"canvas\");\n      canvas.zoom(\"fit-viewport\");\n      let element = canvas.getRootElement();\n      setElement(element);\n    });\n  };\n\n  const fetchDiagram = React.useCallback(async function fetchDiagram(id) {\n    if (id) {\n      let res = await Service.fetchId(\"com.axelor.apps.bpm.db.BamlModel\", id, {\n        fields: [\"bamlXml\", \"name\", \"resultScript\"],\n      });\n      const baml = (res && res.data && res.data[0]) || {};\n      let { bamlXml } = baml;\n      setBaml(baml);\n      openDiagramImage(bamlXml || defaultXml);\n    } else {\n      openDiagramImage(defaultXml);\n    }\n  }, []);\n\n  const uploadFile = (e) => {\n    let files = e.target.files;\n    let reader = new FileReader();\n    if (\n      files &&\n      files[0] &&\n      files[0].name &&\n      !files[0].name.includes(\".baml\")\n    ) {\n      return;\n    }\n    reader.readAsText(files[0]);\n    reader.onload = (e) => {\n      openDiagramImage(e.target.result);\n    };\n  };\n\n  const renderComponent = (entry) => {\n    if (!entry && entry.widget) return;\n    switch (entry.widget) {\n      case \"textField\":\n        return (\n          <TextField\n            entry={entry}\n            bpmnModeler={bpmnModeler}\n            element={element}\n            canRemove={true}\n          />\n        );\n      case \"textBox\":\n        return (\n          <Textbox entry={entry} bpmnModeler={bpmnModeler} element={element} />\n        );\n      case \"selectBox\":\n        return (\n          <SelectBox\n            entry={entry}\n            element={element}\n            bpmnModeler={bpmnModeler}\n          />\n        );\n      case \"checkbox\":\n        return <Checkbox entry={entry} element={element} />;\n      case \"many-to-one\":\n        return (\n          <Select entry={entry} element={element} bpmnModeler={bpmnModeler} />\n        );\n      case \"scriptBox\":\n        return (\n          <ScriptBox\n            entry={entry}\n            element={element}\n            bpmnModeler={bpmnModeler}\n            bpmnFactory={bpmnModeler && bpmnModeler.get(\"bpmnFactory\")}\n          />\n        );\n      case \"parameterTable\":\n        return (\n          <ParameterTable\n            entry={entry}\n            element={element}\n            bpmnModeler={bpmnModeler}\n            bpmnFactory={bpmnModeler && bpmnModeler.get(\"bpmnFactory\")}\n          />\n        );\n      case \"extendedQueryProperties\":\n        return (\n          <ExtendedQuery\n            entry={entry}\n            element={element}\n            bpmnModeler={bpmnModeler}\n          />\n        );\n      case \"expressionBuilder\":\n        return (\n          <Builder entry={entry} element={element} bpmnModeler={bpmnModeler} />\n        );\n      case \"fieldBuilder\":\n        return (\n          <FieldBuilder\n            entry={entry}\n            element={element}\n            bpmnModeler={bpmnModeler}\n          />\n        );\n      default:\n        return (\n          <Textbox entry={entry} element={element} bpmnModeler={bpmnModeler} />\n        );\n    }\n  };\n\n  const handleSnackbarClick = (messageType, message) => {\n    setSnackbar({\n      open: true,\n      messageType,\n      message,\n    });\n  };\n\n  useEffect(() => {\n    bpmnModeler = new BpmnModeler({\n      container: \"#bpmnview\",\n      keyboard: { bindTo: document },\n      additionalModules: [customControlsModule],\n    });\n    let id = fetchId();\n    fetchDiagram(id);\n  }, [fetchDiagram]);\n\n  useEffect(() => {\n    if (!bpmnModeler) return;\n    bpmnModeler.on(\"element.click\", (event) => {\n      setElement(event.element);\n    });\n    bpmnModeler.on(\"shape.changed\", (event) => {\n      setElement(event.element);\n    });\n    bpmnModeler.on(\"shape.removed\", () => {\n      const elementRegistry = bpmnModeler.get(\"elementRegistry\");\n      const definitions = bpmnModeler.getDefinitions();\n      const element =\n        definitions && definitions.rootElements && definitions.rootElements[0];\n      if (!element) return;\n      const rootElement = elementRegistry.get(element.id);\n      if (!rootElement) return;\n      setElement(rootElement);\n    });\n  }, []);\n\n  return (\n    <div id=\"container\">\n      <div id=\"bpmncontainer\">\n        <div id=\"propview\"></div>\n        <div id=\"bpmnview\">\n          <div className=\"toolbar-buttons\">\n            {toolBarButtons.map((btn) => (\n              <div key={btn.name} className={classes.btnContainer}>\n                {btn.name === \"UploadXml\" && (\n                  <input\n                    id=\"inputFile\"\n                    type=\"file\"\n                    name=\"file\"\n                    onChange={uploadFile}\n                    style={{ display: \"none\" }}\n                  />\n                )}\n                <Tooltip\n                  title={btn.tooltipText}\n                  children={\n                    <IconButton\n                      fontSize=\"large\"\n                      onClick={btn.onClick}\n                      className={classes.iconButton}\n                    >\n                      {btn.icon}\n                    </IconButton>\n                  }\n                />\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n      <div>\n        <div\n          className=\"bpmn-property-toggle\"\n          onClick={() => {\n            setWidth((width) => (width === 0 ? 380 : 0));\n            setCSSWidth(width === 0 ? 380 : 0);\n          }}\n        >\n          Properties Panel\n        </div>\n        <Resizable\n          style={resizeStyle}\n          size={{ width, height }}\n          onResizeStop={(e, direction, ref, d) => {\n            setWidth((width) => width + d.width);\n            setHeight(height + d.height);\n            setCSSWidth(width + d.width);\n          }}\n          maxWidth={window.innerWidth - 150}\n        >\n          <Drawer\n            variant=\"persistent\"\n            anchor=\"right\"\n            open={drawerOpen}\n            style={{\n              width: drawerWidth,\n            }}\n            classes={{\n              paper: classes.drawerPaper,\n            }}\n            id=\"drawer\"\n          >\n            <div className={classes.drawerContainer}>\n              <Typography className={classes.nodeTitle}>\n                {element && element.id}\n              </Typography>\n              <Typography className={classes.propertyLable}>\n                Properties\n              </Typography>\n              {getProperties().map((t, index) => (\n                <div key={index}>{renderComponent(t)}</div>\n              ))}\n            </div>\n          </Drawer>\n        </Resizable>\n      </div>\n      {openSnackbar.open && (\n        <Snackbar\n          open={openSnackbar.open}\n          autoHideDuration={2000}\n          onClose={handleSnackbarClose}\n        >\n          <Alert\n            elevation={6}\n            variant=\"filled\"\n            onClose={handleSnackbarClose}\n            className=\"snackbarAlert\"\n            severity={openSnackbar.messageType}\n          >\n            {openSnackbar.message}\n          </Alert>\n        </Snackbar>\n      )}\n    </div>\n  );\n}\n\nexport default BamlEditor;\n","import BAML from \"./BAML\";\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <BAML />\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\n\nimport \"./index.css\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}