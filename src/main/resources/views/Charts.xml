<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://apps.axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://apps.axelor.com/xml/ns/object-views http://apps.axelor.com/xml/ns/object-views/object-views_2.1.xsd">
	
	<chart name="chart.nbr.product.per.family" title="Number of Product per Family">
	  <dataset type="sql">
	  
	    SELECT
	      COUNT(_product.id) AS _num_prod,
	      _family.name AS _prod_family
	    FROM
	      base_product AS _product
	    RIGHT JOIN
	      base_product_family AS _family
	    ON
	      _family.id = _product.product_family
	    GROUP BY
	      _prod_family
	    ORDER BY
	      _prod_family
	  
	  </dataset>
	  <category key="_prod_family" type="text" title="Product Family"/>
	  <series key="_num_prod" type="bar" title="Products"/>
	</chart>
		
	<chart name="chart.nbr.product.per.category" title="Number of Product per Category">
	  <dataset type="sql">
	  
	    SELECT
	      COUNT(_product.id) AS _num_prod,
	      _category.name AS _prod_category
	    FROM
	      base_product AS _product
	    JOIN
	      base_product_category AS _category
	    ON
	      _category.id = _product.product_category
	    GROUP BY
	      _prod_category
	    ORDER BY
	      _prod_category
	  
	  </dataset>
	  <category key="_prod_category" type="text" title="Product Category"/>
	  <series key="_num_prod" type="donut" title="Products"/>
	</chart>
	
	<chart name="chart.product.type.distribution" title="Product type distribution">
	  <dataset type="sql">
	  
	    SELECT
	      COUNT(self.id) AS _num_prod,
	      _item.title AS _type
	    FROM
	      base_product AS self
	    JOIN
	      meta_select AS selection
	      ON selection.name = 'product.product.type.select'
	    JOIN
	      meta_select_item AS _item
	      ON _item.select_id = selection.id
	      AND _item.value = self.product_type_select
	    GROUP BY
	      _type
	    
	  </dataset>
	  <category key="_type" type="text" title="Product Type"/>
	  <series key="_num_prod" type="donut" title="Products"/>
	</chart>
	
	<chart onInit="action.general.chart.set.date.6m" name="chart.product.launches.withdrawal.each.month" title="Product launches/withdrawal each month">
	  <search-fields>
	    <field type="date" name="fromDate" title="From Date"/>
	    <field type="date" name="toDate" title="To Date"/>
	  </search-fields>
	  <dataset type="sql">
	  
	  SELECT
	    _num_prod,
	    _month,
	    _label
	  FROM
	  (
	    (SELECT
	      COUNT(self.id) AS _num_prod,
	     date_part('year',self.start_date) || '-' || date_part('mon',self.start_date) || '-01' AS _month,
	      'Launch' AS _label
	    FROM
	      base_product AS self
	    WHERE
	      self.start_date BETWEEN DATE(:fromDate) AND DATE(:toDate)
	    GROUP BY
	      _month)
	
	    UNION ALL
	
	    (SELECT
	      COUNT(self.id) AS _num_prod,
	      date_part('year',self.end_date) || '-' || date_part('mon',self.end_date) || '-01' AS _month,
	      'Withdrawal' AS _label
	    FROM
	      base_product AS self
	    WHERE
	      self.end_date BETWEEN DATE(:fromDate)  AND DATE(:toDate)
	    GROUP BY
	      _month)
	  ) prod_status
	  ORDER BY
       _month 
	  
	  </dataset>
	  <category key="_month" type="month" title="Month"/>
	  <series key="_num_prod" groupBy="_label" type="bar" title="Products"/>
	  <config name="xFormat" value="MM-YYYY"/>
	</chart>

	
	

</object-views>