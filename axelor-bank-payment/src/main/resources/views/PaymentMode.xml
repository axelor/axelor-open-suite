<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">

  <form name="payment-mode-form" title="Payment Mode"
    model="com.axelor.apps.account.db.PaymentMode" id="bank-payment-payment-mode-form"
    extension="true">
    <extend target="//field[@name='canSelectInPaymentSession']">
      <attribute name="onChange"
        value="action-payment-mode-record-can-select-in-payment-session-onchange"/>
    </extend>
    <extend target="//panel[@name='paymentSessionPanel']">
      <insert position="after">
        <panel name="bankOrderPanel" title="Bank order config." hidden="true"
          hideIf="typeSelect != 2 &amp;&amp; typeSelect != 9 &amp;&amp; typeSelect != 10">
          <field name="generateBankOrder"
            showIf="typeSelect == 2 || typeSelect == 9 ||Â typeSelect == 10"
            onChange="action-payment-mode-record-generate-bank-order-onchange"/>
          <field name="autoConfirmBankOrder" showIf="generateBankOrder"/>
          <panel name="generateBankOrderPanel" showIf="generateBankOrder" colSpan="12">
            <field name="automaticTransmission"
              if="__config__.app.getApp('bank-payment')?.enableEbicsModule"/>
            <field name="consoBankOrderLinePerPartner"/>
            <panel stacked="true" readonlyIf="!generateBankOrder">
              <field name="bankOrderMoveGenTriggerSelect" showIf="canSelectInPaymentSession"
                requiredIf="canSelectInPaymentSession" selection-in="[1,2,3,4]"/>
              <field name="bankOrderMoveGenTriggerSelect" showIf="!canSelectInPaymentSession"
                requiredIf="canSelectInPaymentSession" selection-in="[0,2,3,4]"/>
            </panel>
            <panel stacked="true">
              <field name="orderTypeSelect" selection-in="[2,4]" hidden="true"
                showIf="typeSelect == 2" requiredIf="generateBankOrder &amp;&amp; typeSelect == 2"
                onChange="action-payment-mode-attrs-on-order-type-change"/>
              <field name="orderTypeSelect" selection-in="[1,3,5,6]" hidden="true"
                showIf="typeSelect == 9" requiredIf="generateBankOrder &amp;&amp; typeSelect == 9"
                onChange="action-payment-mode-attrs-on-order-type-change"/>
              <field name="orderTypeSelect" selection-in="[1, 2, 3, 4, 5, 6, 8]" hidden="true"
                showIf="typeSelect == 10" requiredIf="generateBankOrder &amp;&amp; typeSelect == 10"
                onChange="action-payment-mode-attrs-on-order-type-change"/>
            </panel>
            <field name="bankOrderExportFolderPath" requiredIf="generateBankOrder"/>
            <field name="bankOrderFileFormat"
              domain="self.orderTypeSelect = :orderTypeSelect AND self.fileGenerationSupported = 'true'"
              canEdit="false" requiredIf="generateBankOrder" form-view="bank-order-file-format-form"
              grid-view="bank-order-file-format-grid"/>
          </panel>
        </panel>
      </insert>
    </extend>
  </form>

  <action-record name="action-payment-mode-record-empty"
    model="com.axelor.apps.account.db.PaymentMode">
    <field name="orderTypeSelect" expr=""/>
    <field name="generateBankOrder" expr="false"/>
    <field name="automaticTransmission" expr="false"/>
    <field name="bankOrderExportFolderPath" expr=""/>
    <field name="validatePaymentByDepositSlipPublication" expr="false"
      if="__config__.app.isApp('account')"/>
  </action-record>

  <action-record name="action-payment-mode-record-generate-bank-order-onchange"
    model="com.axelor.apps.account.db.PaymentMode">
    <field name="bankOrderMoveGenTriggerSelect" expr="eval: 0" if="!canSelectInPaymentSession"/>
    <field name="bankOrderMoveGenTriggerSelect" expr="eval: 1" if="canSelectInPaymentSession"/>
  </action-record>

  <action-record
    name="action-payment-mode-record-can-select-in-payment-session-onchange"
    model="com.axelor.apps.account.db.PaymentMode">
    <field name="bankOrderMoveGenTriggerSelect" expr="eval: 0"
      if="!canSelectInPaymentSession &amp;&amp; bankOrderMoveGenTriggerSelect == 1"/>
    <field name="bankOrderMoveGenTriggerSelect" expr="eval: 1"
      if="canSelectInPaymentSession &amp;&amp; bankOrderMoveGenTriggerSelect == 0"/>
  </action-record>

  <action-attrs name="action-payment-mode-attrs-on-order-type-change">
    <attribute name="value" for="bankOrderFileFormat" expr=""/>
  </action-attrs>

</object-views>
