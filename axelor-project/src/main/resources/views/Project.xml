<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

	
	<grid name="project-grid" title="Projects" model="com.axelor.apps.project.db.Project">
		<hilite background="primary" if="isProject &amp;&amp; projectTypeSelect == 1"/>
		<hilite background="info" if="isProject &amp;&amp; projectTypeSelect == 2"/>
		<field name="code"/>
		<field name="name"/>
        <field name="parentProject"/>
		<field name="clientPartner"/>
		<field name="assignedTo"/>
		<field name="fromDate" />
		<field name="toDate" />
		<field name="dueDate" />
		<button name="openGantt" title="Gantt" icon="fa-tasks" onClick="action-project-open-gantt"/>
		<field name="isProject" hidden="true"/>
		<field name="projectTypeSelect" hidden="true"/>
	</grid>
	
	<form name="project-form" title="Project" model="com.axelor.apps.project.db.Project" onNew="action-project-group-on-new-project" width="large"
	onLoad="action-project-on-load-group,save">
		<toolbar>
			<button name="printProject" title="Reporting folder" onClick="save,action-project-method-print-project" showIf="isBusinessProject" if-module="axelor-business-project" if="__config__.app.isApp('business-project')" />
		</toolbar>
		<menubar>
	     <menu title="Reports" icon="img/16px/create_16px.png" showTitle="true">
	            <item title="Planification and costs" action="save,action-project-method-print-planif-and-cost" if-module="axelor-business-project" />
	        </menu>
		 <menu title="Tools" icon="img/16px/create_16px.png" showTitle="true">
	            <item title="Gantt" action="action-project-open-gantt" showIf="isProject"/>
	            <item title="Book resource" action="save,action-project-book-resource" showIf="isProject"/>
	            <item title="Planning the project" action="save,action-project-method-create-planning" showIf="!excludePlanning &amp;&amp; isProject" />
			 	<item title="Generate quotation" action="action-project-method-generate-quotation" showIf="isBusinessProject"/>
	     </menu>
		</menubar>
		
		<panel name="overview" title="Overview">
		
			<field name="fullName" showTitle="false" colSpan="12" css="label-bold bold large">
				<editor x-show-titles="false">
					<field name="code" x-bind="{{code|unaccent|uppercase}}" showTitle="false" css="label-bold bold large" colSpan="3"/>
					<field name="name" showTitle="false" css="label-bold bold large" colSpan="9"/>
				</editor>
			</field>
			<field showTitle="false" if="__config__.app.isApp('business-project')" if-module="axelor-business-project" name="isProject" showIf="isProject &amp;&amp; $readonly()" colSpan="1">
				<viewer>
					<![CDATA[
                       <h4 style="text-align: right;">
                       		<span class="label label-default" style="background-color: #FC6355; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isProject" x-translate>Project/Phase</span>
                       </h4>
					]]>
				</viewer>
			</field>
			<field showTitle="false" if="__config__.app.isApp('business-project')" if-module="axelor-business-project" name="isBusinessProject" showIf="isBusinessProject &amp;&amp; $readonly()" colSpan="1">
				<viewer>
					<![CDATA[
                       <h4 style="text-align: right;">
                       		<span class="label label-default" style="background-color: #5680FC; margin: 5px 0 !important; display: inline-table; line-height: initial;" ng-show="record.isBusinessProject" x-translate>Affaire</span>
                       </h4>
					]]>
				</viewer>
			</field>
			<spacer colSpan="10"/>
			<field if="__config__.app.isApp('business-project')" if-module="axelor-business-project" name="isProject" showIf="!$readonly()"/>
			<field if="__config__.app.isApp('business-project')" if-module="axelor-business-project" name="isBusinessProject" showIf="!$readonly()"/>
			<field name="projectType" showIf="isProject" requiredIf="isProject" onChange="action-project-record-empty-parent-project"/>
			<field name="parentProject" showIf="isProject &amp;&amp; projectType == 'PHASE'"/>
			<!--
				<field name="statusSelect" widget="NavSelect" colSpan="6"/>
				<field name="project" onChange="action-project-record-inv-type-select,action-project-record-bind-customer-project" colSpan="6" title="Parent Project" domain="self.typeSelect = 'project'" form-view="project-form" grid-view="project-grid"/>
			 -->
			 <field name="company" requiredIf="project == null" hideIf="project != null" form-view="company-form" grid-view="company-grid"/>
			<field name="clientPartner" showIf="isBusinessProject" readonlyIf="project != null" domain="self.isCustomer = true" form-view="partner-form" grid-view="partner-grid" if-module="axelor-business-project"  if="__config__.app.isApp('business-project')" />
			<field name="priceList" showIf="isBusinessProject &amp;&amp; priceList != null" if-module="axelor-business-project" readonly="true"/>
			<field name="contactPartner" showIf="isBusinessProject" readonlyIf="project != null" onSelect="action-attrs-domain-on-contact-partner" form-view="partner-form" grid-view="partner-grid" if-module="axelor-business-project"  if="__config__.app.isApp('business-project')" />
			<field name="assignedTo" title="Person In Charge" onChange="action-attrs-project-add-member" form-view="user-form" grid-view="user-grid"/>
			<field name="saleOrder" showIf="isBusinessProject"  domain="self.clientPartner = :clientPartner" form-view="sale-order-form" grid-view="sale-order-grid" if-module="axelor-business-project"  if="__config__.app.isApp('business-project')" />
			<spacer/>
			<field name="fromDate" />
			<field name="toDate" onChange="action-project-method-set-duration"/>
			<field name="$visibleDuration" colSpan="6" title="Duration" type="decimal" onChange="action-project-method-set-stored-duration,action-attrs-project-compute-leadDelay"/>
			<field name="$visibleTimeSpent" readonly="true" colSpan="6" title="Time Spent" type="decimal" onChange="action-project-method-set-stored-time-spent"/>
			<field name="dueDate" showIf="isProject"/>
			<field name="progress" widget="Progress" onChange="action-attrs-project-compute-leadDelay" showIf="isProject"/>
			<field name="$visibleLeadDelay" colSpan="6" title="Lead/Delay" showIf="isProject" type="decimal" onChange="action-project-method-set-stored-lead-delay, action-method-project-compute-progress"/>
			<field name="imputable" widget="boolean-switch" if-module="axelor-human-resource" if="__config__.app.isApp('employee')"/>
			<field name="projInvTypeSelect" showIf="isBusinessProject"  if-module="axelor-business-project" if="__config__.app.isApp('business-project')" />
			<field name="invoiced" showIf="isBusinessProject &amp;&amp; (projInvTypeSelect == 2 || projInvTypeSelect == 3)" if-module="axelor-business-project" if="__config__.app.isApp('business-project')" />
			<field name="excludePlanning" showIf="isProject"/>
			<field name="totalPlannedHrs" if-module="axelor-human-resource" if="__config__.app.isApp('employee')"/>
		</panel>
		<panel title="Members">
			<field name="membersUserSet" onSelect="action-project-attrs-members-domain" form-view="user-form" grid-view="user-grid" widget="TagSelect" colSpan="12" showTitle="false" canNew="false"/>
		</panel>
		<panel-tabs>
		
			<panel title="Task Tree" showIf="isProject" >
				<button name="addTask" title="+ New" onClick="save,action-project-add-task" colSpan="3"/>
				<panel-dashlet action="action-view-show-project-task-tree" colSpan="12" title="Task Tree" />
			</panel>
			<panel name="invoicing" title="Invoicing" if-module="axelor-business-project" showIf="projInvTypeSelect == 3" if="__config__.app.isApp('business-project')">
				<field name="product" onChange="action-project-record-unit" requiredIf="projInvTypeSelect == 3"/>
  				<field name="price" onChange="action-project-record-compute-exTaxTotal" requiredIf="projInvTypeSelect == 3"/>
  				<field name="qty" onChange="action-project-record-compute-exTaxTotal" requiredIf="projInvTypeSelect == 3"/>
  				<field name="unit" requiredIf="projInvTypeSelect == 3"/>
  				<field name="exTaxTotal" readonly="true"/>
			</panel>
			<panel title="Related elements" showIf="isBusinessProject" if="eval:  __config__.app.isApp('business-project') &amp;&amp; (__config__.app.getApp('business-project').getShowPurchaseOrderLineRelatedToProject() || __config__.app.getApp('business-project').getShowSaleOrderLineRelatedToProject() || __config__.app.getApp('business-project').getShowExpenseLineRelatedToProject() || __config__.app.getApp('business-project').getShowProductionOrderRelatedToProject() &amp;&amp; __config__.app.isApp('production') &amp;&amp; __config__.app.getApp('production').getManageBusinessProduction())">
				<panel-related field="purchaseOrderLineList" form-view="purchase-order-line-form" grid-view="purchase-order-line-invoicing-project-grid" if-module="axelor-business-project" canSelect="true" canNew="false"  canEdit="false" colSpan="12" if="eval: __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowPurchaseOrderLineRelatedToProject()"/>
				<panel-related field="saleOrderLineList" canSelect="true" canNew="false" canEdit="false" colSpan="12" if-module="axelor-business-project" if="eval: __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowSaleOrderLineRelatedToProject()" />
				<panel-related field="expensesLineList" canSelect="true" canNew="false" canEdit="false" colSpan="12" if-module="axelor-business-project" if="eval: __config__.app.isApp('business-project') &amp;&amp;  __config__.app.getApp('business-project').getShowExpenseLineRelatedToProject()" />
				<panel-related field="invoiceLineList" title="Purchase invoice lines" domain="self.operationTypeSelect = 1" canSelect="true" canNew="false" canEdit="false" colSpan="12" if-module="axelor-business-production" if="eval:  __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowPurchaseInvoiceLineRelatedToProject()" />
				<panel-related field="invoiceLineList" title="Sale invoice lines" domain="self.operationTypeSelect = 3" canSelect="true" canNew="false" canEdit="false" colSpan="12" if-module="axelor-business-production" if="eval:  __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowSaleInvoiceLineRelatedToProject()" />
				<panel-related field="productionOrderList" canSelect="true" canNew="false" canEdit="false" colSpan="12" if-module="axelor-business-production" if="eval:  __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowProductionOrderRelatedToProject()" />
			</panel>
			<panel name="otherElementsToInvoice" showIf="isBusinessProject" title="Other elements to invoice" if-module="axelor-business-project" if="__config__.app.isApp('business-project')" >
				<panel-related field="elementsToInvoiceList" colSpan="12"/>
			</panel>
			<panel name="logTimes" title="Log Times"  if-module="axelor-human-resource" if="__config__.app.isApp('timesheet')" >
<!-- 				<field name="unitOnPrinting" if-module="axelor-business-project" if="__config__.app.isApp('business-project')"/> -->
				<field name="excludeTimesheetEditor"/>
				<panel-related field="timesheetLineList" colSpan="12" grid-view="timesheet-line-project-grid" form-view="timesheet-line-project-form"/>
			</panel>
			<panel name="description" title="Description">
				<field name="description" showTitle="false" colSpan="12" widget="html"/>
				<field name="timeSpent" hidden="true"/>
				<field name="leadDelay" hidden="true"/>
			</panel>
			<panel name="configurations" title="Configurations">
				<field name="productSet" if-module="axelor-human-resource"  if="__config__.app.isApp('employee')" grid-view="product-activity-grid" form-view="product-activity-form" domain="self.isActivity = true" colSpan="12" widget="TagSelect"/>
				<field name="categorySet" colSpan="12" widget="TagSelect"/>
				<field name="projectFolderSet" readonly="true" colSpan="12" widget="TagSelect"/>
				<spacer/>
				<field name="childProjectList" hidden="true"/>
				<button name="computeDurationFromChildren" title="Compute duration" showIf="childProjectList.length > 0" colSpan="3" onClick="save,action-method-project-compute-duration-fromchildren,save"/>
				<field name="sequence" hidden="true"/>
				<spacer/>
                <field name="team" title="Team" colSpan="6" canNew="true" onChange="action-project-method-clear-members"/>
				<field name="synchronisable" widget="boolean-switch" colSpan="3" />
				<button name="selectTeam" title="Select a team" onClick="save,action-project-method-select-team" colSpan="3" showIf="team != null"/>
			</panel>
		</panel-tabs>
		<panel>
			<field name="attrs" colSpan="12" />
		</panel>
		<panel-mail>
		  <mail-messages limit="4" />
		  <mail-followers />
	    </panel-mail>
	</form>
	
	
	<form name="folder-project-form" title="Project" model="com.axelor.apps.project.db.Project" onNew="action-project-group-on-new-project"
	onLoad="action-project-method-set-visible-duration,action-project-attrs-duration-title,action-project-method-set-visible-duration-log-times,action-project-attrs-scale-and-precision,save">
		<toolbar>
			<button name="printProject" title="Reporting folder" onClick="save,action-project-method-print-project" if-module="axelor-business-project" if="__config__.app.isApp('business-project')" />
		</toolbar>
	    <panel name="main" >
	    	<field name="statusSelect" widget="NavSelect" colSpan="6"/>
	        <!-- 
	        	<field name="project" onChange="action-project-attrs-hide-invoicing-panel,action-project-record-inv-type-select,action-project-record-bind-customer-project" colSpan="6" requiredIf="!$popup()" title="Project" hideIf="$popup()" domain="self.typeSelect = 'project'" form-view="project-form" grid-view="project-grid"/>
	         -->
		    <field name="name" colSpan="12" />
			<field name="assignedTo" colSpan="12" title="Assigned To" onSelect="action-task-attrs-assigned-to-domain" onChange="action-attrs-project-add-member" form-view="user-form" grid-view="user-grid"/>
			<field name="isProject" if-module="axelor-business-project" if="__config__.app.isApp('business-project')"/>
			<field name="isBusinessProject" if-module="axelor-business-project" if="__config__.app.isApp('business-project')"/>
			<field name="clientPartner" showIf="isBusinessProject" domain="self.isCustomer = true" />
			<field name="fromDate" />
			<field name="toDate" />
			<field name="$visibleDuration" title="Duration" type="decimal" onChange="action-project-method-set-stored-duration,action-attrs-project-compute-leadDelay"/>
			<field name="$visibleTimeSpent" readonly="true" title="Time Spent" type="decimal" onChange="action-project-method-set-stored-time-spent"/>
			<field name="dueDate" />
			<field name="progress" onChange="action-attrs-project-compute-leadDelay"/>
			<field name="$visibleLeadDelay" title="Lead/Delay" type="decimal" onChange="action-project-record-set-stored-lead-delay, action-method-project-compute-progress"/>
			<field name="imputable" if-module="axelor-human-resource" if="__config__.app.isApp('employee')"/>
			<field name="projInvTypeSelect" onChange="action-project-attrs-hide-invoicing-panel" if-module="axelor-business-project" if="__config__.app.isApp('business-project')" />
			<field name="invoiced" showIf="projInvTypeSelect == 2 || projInvTypeSelect == 3" if-module="axelor-business-project" if="__config__.app.isApp('business-project')" />
			<field name="sequence" />
		</panel>
		<panel-tabs>
			<panel name="invoicingPanel" title="Invoicing" if-module="axelor-business-project" hidden="true" if="__config__.app.isApp('business-project')" >
				<field name="product" onChange="action-project-record-unit"/>
  				<field name="price" onChange="action-project-record-compute-exTaxTotal"/>
  				<field name="qty" onChange="action-project-record-compute-exTaxTotal"/>
  				<field name="unit" requiredIf="product != null"/>
  				<field name="exTaxTotal" readonly="true"/>
			</panel>
			<panel title="Related elements" if="eval:  __config__.app.isApp('business-project') &amp;&amp; (__config__.app.getApp('business-project').getShowPurchaseOrderLineRelatedToProject() || __config__.app.getApp('business-project').getShowSaleOrderLineRelatedToProject() || __config__.app.getApp('business-project').getShowExpenseLineRelatedToProject() || __config__.app.getApp('production').getShowProductionOrderRelatedToProject() &amp;&amp; __config__.app.isApp('production') &amp;&amp; __config__.app.getApp('production').getManageBusinessProduction())">
				<panel-related field="purchaseOrderLineList" form-view="purchase-order-line-form" grid-view="purchase-order-line-invoicing-project-grid" if-module="axelor-business-project" canSelect="true" canNew="false"  canEdit="false" colSpan="12" if="eval: __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowPurchaseOrderLineRelatedToProject()"/>
				<panel-related field="saleOrderLineList" canSelect="true" canNew="false" canEdit="false" colSpan="12" if-module="axelor-business-project" if="eval: __config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowSaleOrderLineRelatedToProject()" />
				<panel-related field="expensesLineList" canSelect="true" canNew="false" canEdit="false" colSpan="12" if-module="axelor-business-project" if="eval: __config__.app.isApp('business-project') &amp;&amp;  __config__.app.getApp('business-project').getShowExpenseLineRelatedToProject()" />
				<panel-related field="productionOrderList" canSelect="true" canNew="false" canEdit="false" colSpan="12" if-module="axelor-business-production" if="eval:  __config__.app.isApp('production') &amp;&amp; __config__.app.isApp('business-project')  &amp;&amp; __config__.app.getApp('production').getShowProductionOrderRelatedToProject()  &amp;&amp;  __config__.app.getApp('production').getManageBusinessProduction()" />
			</panel>
			<panel name="logTimes" title="Log Times">
				<field name="unitOnPrinting" if-module="axelor-business-project" if="__config__.app.isApp('business-project')" />
				<panel-related field="timesheetLineList" colSpan="12" grid-view="timesheet-line-project-grid" form-view="timesheet-line-project-form" if-module="axelor-human-resource" if="__config__.app.isApp('timesheet')" />
			</panel>
			<panel name="description" title="Description">
				<field name="description" showTitle="false" colSpan="12" widget="html"/>
				<field name="duration" hidden="true"/>
				<field name="timeSpent" hidden="true"/>
				<field name="leadDelay" hidden="true"/>
				<field name="company" hidden="true" />
			</panel>
			<panel name="activity" title="Activities">
				<panel-related field="productSet" grid-view="product-activity-grid" form-view="product-activity-form" domain="self.isActivity = true" colSpan="12"/>
			</panel>
		</panel-tabs>
		<panel>
			<field name="attrs" colSpan="12" />
		</panel>
	</form>
	
	
	<kanban columnBy="statusSelect" sequenceBy="statusSelect" limit="10"
	 name="project-kanban" title="Projects" model="com.axelor.apps.project.db.Project">
		<field name="fullName"/>
		<field name="description"/>
		<field name="progress"/>
		<field name="dueDate"/>
		<field name="leadDelay"/>
		<field name="statusSelect"/>
		<field name="sequence"/>
		<hilite color="danger" if="dueDate.isAfter(__datetime__) &amp;&amp; statusSelect &lt; 3"/>
		<hilite color="success" if="(dueDate.isBefore(__datetime__) || dueDate.equals(__datetime__)) &amp;&amp; leadDelay &gt;= 0 &amp;&amp; statusSelect &lt; 3"/>
		<hilite color="warning" if="(dueDate.isBefore(__datetime__) || dueDate.equals(__datetime__)) &amp;&amp; leadDelay &lt; 0 &amp;&amp; statusSelect &lt; 3"/>
		<template>
		&lt;h4&gt;{{fullName}}&lt;/h4&gt;
		&lt;div class="card-body"&gt;{{description}}&lt;/div&gt;
		&lt;div class="card-footer"&gt;
		  &lt;i class='fa fa-clock-o'&gt;&lt;/i&gt; &lt;span&gt;{{dueDate|date:'dd/MM/yyyy'}}&lt;/span&gt;
		&lt;/div&gt;
		</template>
	</kanban>
	
	<kanban columnBy="statusSelect" sequenceBy="statusSelect" limit="10"
	 name="task-kanban" title="Tasks" model="com.axelor.apps.project.db.Project">
		<field name="fullName"/>
		<field name="description"/>
		<field name="progress"/>
		<field name="dueDate"/>
		<field name="leadDelay"/>
		<field name="statusSelect"/>
		<field name="sequence"/>
		<hilite color="danger" if="dueDate.isAfter(__datetime__) &amp;&amp; statusSelect &lt; 3"/>
		<hilite color="success" if="(dueDate.isBefore(__datetime__) || dueDate.equals(__datetime__)) &amp;&amp; leadDelay &gt;= 0 &amp;&amp; statusSelect &lt; 3"/>
		<hilite color="warning" if="(dueDate.isBefore(__datetime__) || dueDate.equals(__datetime__)) &amp;&amp; leadDelay &lt; 0 &amp;&amp; statusSelect &lt; 3"/>
		<template>
		&lt;h4&gt;{{fullName}}&lt;/h4&gt;
		&lt;div class="card-body"&gt;{{description}}&lt;/div&gt;
		&lt;div class="card-footer"&gt;
		  &lt;i class='fa fa-clock-o'&gt;&lt;/i&gt; &lt;span&gt;{{dueDate|date:'dd/MM/yyyy'}}&lt;/span&gt;
		&lt;/div&gt;
		</template>
	</kanban>
	
	<calendar name="project-calendar" 
			  model="com.axelor.apps.project.db.Project" 
			  title="Project Calendar"
			  eventStart="fromDate"
			  eventStop="toDate"
			  eventLength="1"
			  colorBy="statusSelect"
			  mode="month"
			  >
			  <field name="fullName"/>
	</calendar>
	
	<action-view name="action-view-show-project-task-tree" title="Project Task Tree" model="com.axelor.team.db.TeamTask">	
		<view type="tree" name="project-task-tree"/>
    	<view type="form" name="team-task-form"/>
    	<domain>self.project.id = :_id AND self.parentTask = null</domain>
     	<context name="_id" expr="eval: id"/>
	</action-view>
	
	<tree name="project-task-tree" title="Tasks">
    	
    	<column name="name" type="string"/>
    	<column name="assignedTo" type="reference"/>
    	<column name="progress" type="decimal"/>
		<column name="editTask" type="button"/>
		
		<node model="com.axelor.team.db.TeamTask" domain="self.project.id = :_id" onClick="action-project-task-view">
			<field name="name" as="name"/>
			<field name="assignedTo" as="assignedTo"/>
			<field name="progress" as="progress"/>
			<button name="editTask" title="Edit" onClick="action-team-task-edit-task"/>
		</node>    	
		
		<node model="com.axelor.team.db.TeamTask" parent="parentTask" draggable="true" onClick="action-project-task-view">
			<field name="name" as="name"/>
			<field name="assignedTo" as="assignedTo"/>
			<field name="progress" as="progress"/>
			<button name="editTask" title="Edit" onClick="action-team-task-edit-task"/>
		</node>
    
	</tree>
	
	<action-group name="action-project-group-on-new-project">
		<action name="action-project-generate-project-from-partner" if="_idPartner != null"/>
		<action name="action-project-defaults"/>
		<action name="action-project-attrs-duration-title"/>
		<action name="action-project-attrs-scale-and-precision"/>
		<action name="action-attrs-project-set-project-type" if="__config__.app.isApp('business-project')" />
		<action name="action-project-record-init-type"/>
	</action-group>
	
	<action-group name="action-project-on-load-group">
		<action name="action-project-method-set-visible-duration" />
		<action name="action-project-attrs-duration-title" />
		<action name="action-project-method-set-visible-duration-log-times" />
		<action name="action-project-attrs-scale-and-precision" />
		<action name="action-attrs-project-set-project-type"  if="__config__.app.isApp('business-project')" />
	</action-group>
	
	<action-method name="action-project-generate-project-from-partner">
		<call class="com.axelor.apps.project.web.ProjectController" method="generateProjectFromPartner"/>
	</action-method>
	
	<action-record name="action-project-record-inv-type-select" model="com.axelor.apps.project.db.Project">
		<field name="projInvTypeSelect" expr="eval: project?.projInvTypeSelect"/>
	</action-record>
	
<!-- 	<action-attrs name="action-project-attrs-filter-project-parent"> -->
<!-- 		<attribute name="domain" for="projectParent" expr="eval: &quot; self.id IN (${projectFolder?.project?.collect{it.id}.join(',')})&quot;"/> -->
<!-- 	</action-attrs> -->
	
	<action-attrs name="action-project-attrs-hide-invoicing-panel">
		<attribute name="hidden" for="invoicingPanel" expr="eval: projInvTypeSelect != 3"/>
	</action-attrs>
	
	<action-attrs name="action-task-attrs-assigned-to-domain">
	    <attribute name="domain" for="assignedTo" expr="eval:&quot;self.id in (${(project?.membersUserSet?.collect{it->it.id}+[0,0]).join(',')}) &quot;"
				   if="(typeSelect == 'task')&amp;&amp;(project?.membersUserSet)&amp;&amp;(!project.membersUserSet.isEmpty())" />
	</action-attrs>
	
	<action-attrs name="action-project-defaults" model="com.axelor.apps.project.db.Project">
		<attribute name="value" for="fromDate" expr="eval: __datetime__"/>
		<attribute name="value" for="company" expr="eval:__user__.activeCompany"/>
		<attribute name="value" for="assignedTo" expr="eval: __user__"/>
		<attribute name="value:add" for="membersUserSet" expr="eval: __user__"/>
		<attribute name="value" for="isProject" expr="eval:_fromProject"/>
		<attribute name="value" for="isBusinessProject" expr="eval:_fromBusinessProject"/>
	</action-attrs>

	<action-attrs name="action-attrs-project-add-member" model="com.axelor.apps.project.db.Project">
		<attribute name="value:add" for="membersUserSet" expr="eval: assignedTo"/>
	</action-attrs>
	
	<action-attrs name="action-attrs-project-set-project-type" model="com.axelor.apps.project.db.Project">
		<attribute name="readonly" for="isProject" expr="eval:_fromProject"/>
		<attribute name="readonly" for="isBusinessProject" expr="eval:_fromBusinessProject"/>
	</action-attrs>

	<action-record name="action-project-record-init-type" model="com.axelor.apps.project.db.Project">
		<field if="_projectTypeName == 'PHASE'" name="projectType" expr="eval: com.axelor.apps.project.db.ProjectType.PHASE"/>
		<field if="_projectTypeName == 'PROJECT'" name="projectType" expr="eval: com.axelor.apps.project.db.ProjectType.PROJECT"/>
	</action-record>

	<action-record name="action-project-record-empty-parent-project" model="com.axelor.apps.project.db.Project">
		<field name="parentProject" expr="eval: null"/>
	</action-record>
	
	<action-view name="action-project-task-view" title="Tasks" model="com.axelor.team.db.TeamTask">
    	<view type="form" name="team-task-form"/>
        <view-param name="popup" value="reload"/>
        <view-param name="show-toolbar" value="false"/>
  		<view-param name="show-confirm" value="false" />
	  	<view-param name="popup-save" value="false"/>
    	<context name="_showRecord" expr="eval: id"/>
    </action-view>
    	
    <action-attrs name="action-project-attrs-duration-title">
	    <attribute name="title" for="timesheetLineList.visibleDuration" expr="eval:__user__.employee?.timeLoggingPreferenceSelect == 'days' ? com.axelor.i18n.I18n.get('Days') : __user__.employee?.timeLoggingPreferenceSelect == 'minutes' ? com.axelor.i18n.I18n.get('Minutes') : com.axelor.i18n.I18n.get('Hours')"/>
		<attribute name="title" for="$visibleDuration" expr="eval:__user__.employee?.timeLoggingPreferenceSelect == 'days' ? com.axelor.i18n.I18n.get('Duration(Days)') : __user__.employee?.timeLoggingPreferenceSelect == 'minutes' ? com.axelor.i18n.I18n.get('Duration(Minutes)') : com.axelor.i18n.I18n.get('Duration(Hours)')"/>
		<attribute name="title" for="$visibleTimeSpent" expr="eval:__user__.employee?.timeLoggingPreferenceSelect == 'days' ? com.axelor.i18n.I18n.get('Time Spent(Days)') : __user__.employee?.timeLoggingPreferenceSelect == 'minutes' ? com.axelor.i18n.I18n.get('Time Spent(Minutes)') : com.axelor.i18n.I18n.get('Time Spent(Hours)')"/>
		<attribute name="title" for="$visibleLeadDelay" expr="eval:__user__.employee?.timeLoggingPreferenceSelect == 'days' ? com.axelor.i18n.I18n.get('Lead/Delay(Days)') : __user__.employee?.timeLoggingPreferenceSelect == 'minutes' ? com.axelor.i18n.I18n.get('Lead/Delay(Minutes)') : com.axelor.i18n.I18n.get('Lead/Delay(Hours)')"/>
	</action-attrs>
	
	<action-view name="action-project-view-show-project" title="Related Projects" model="com.axelor.apps.project.db.Project">
		<view type="grid" name="project-grid" />
		<view type="form" name="project-form" />
		<domain>self.typeSelect = 'project' AND self.project.id = :id</domain>
	</action-view>
	
	<action-view name="action-project-view-show-task" title="Tasks" model="com.axelor.apps.project.db.Project">
		<view type="grid" name="team-task-grid" />
		<view type="form" name="team-task-form" />
		<domain>self.typeSelect = 'task' AND self.project.id = :id</domain>
	</action-view>
	
	<action-view name="action-project-view-create-team" model="com.axelor.team.db.Team" title="Team">
	  <view name="team-grid" type="grid"/>
	  <view name="team-form" type="form"/>
	  <view-param name="popup" value="reload"/>
	  <view-param name="show-toolbar" value="false"/>
	  <view-param name="show-confirm" value="true"/>
	  <view-param name="popup-save" value="true"/>
	  <view-param name="forceEdit" value="true"/>
	  <context name="_showRecord" expr="eval: id"/>
	</action-view>
	
	<action-view name="action-project-open-gantt" title="Gantt" model="com.axelor.team.db.TeamTask">
		<view type="gantt" name="task-gantt" />
		<view type="grid" name="team-task-grid" />
		<view type="form" name="team-task-form" />
		<domain>self.project.id = :_id OR self.project.project.id = :_id</domain>
	</action-view>
	
	<action-view name="action-project-book-resource" title="Book resource" model="com.axelor.apps.project.db.ResourceBooking">
		<view type="form" name="resource-booking-form" />
		<view type="grid" name="resource-booking-grid" />
		<view type="calendar" name="resource-booking-calendar" />
		<context name="_project" expr="eval:__self__"/>
	</action-view>
	
	<action-view name="action-project-add-task" title="Task" model="com.axelor.team.db.TeamTask">
		<view type="form" name="team-task-form" />
		<view type="grid" name="team-task-grid" />
		<context name="_project" expr="eval:__self__"/>
	</action-view>
	
	<action-record name="action-project-record-compute-exTaxTotal" model="com.axelor.apps.project.db.Project">
		<field name="exTaxTotal" expr="eval: price*qty"/>
	</action-record>
	
	<action-record name="action-project-record-bind-customer-project" model="com.axelor.apps.project.db.Project">
		<field name="clientPartner" expr="eval: project?.clientPartner"/>
	</action-record>
	
	<action-record name="action-project-record-bind-customer-parent" model="com.axelor.apps.project.db.Project">
		<field name="clientPartner" expr="eval: _parent?.clientPartner"/>
	</action-record>
	
	<action-record name="action-project-record-unit" model="com.axelor.apps.project.db.Project">
		<field name="unit" expr="eval: product?.unit"/>
		<field name="price" expr="eval: product?.salePrice"/>
		<field name="qty" expr="1"/>
		<field name="exTaxTotal" expr="eval: product?.salePrice"/>
	</action-record>
	
	<action-method name="action-project-method-set-stored-duration" model="com.axelor.apps.project.db.Project" if-module="axelor-human-resource">
		<call class="com.axelor.apps.hr.web.project.ProjectController" method="setStoredDuration"/>
	</action-method>
	
	<action-method name="action-project-method-set-stored-time-spent" model="com.axelor.apps.project.db.Project">
		<call class="com.axelor.apps.hr.web.project.ProjectController" method="setStoredTimeSpent"/>
	</action-method>
	
	<action-method name="action-project-method-set-visible-duration" model="com.axelor.apps.project.db.Project" if-module="axelor-human-resource">
	    <call class="com.axelor.apps.hr.web.project.ProjectController" method="setProjectVisibleDuration"/>
	</action-method>
	
	<action-method name="action-project-method-set-stored-lead-delay" model="com.axelor.apps.project.db.Project">
		<call class="com.axelor.apps.hr.web.project.ProjectController" method="setStoredLeadDelay"/>
	</action-method>
	
	<action-method name="action-project-method-set-visible-duration-log-times" if-module="axelor-human-resource">
		<call class="com.axelor.apps.hr.web.project.ProjectController" method="setVisibleDuration" if="__config__.app.isApp('employee')" />
	</action-method>
	
	<action-method name="action-method-project-compute-progress">
		<call class="com.axelor.apps.businessproject.web.ProjectController" method="computeProgress"/>
	</action-method>
	
	<action-method name="action-method-project-compute-duration-fromchildren">
		<call class="com.axelor.apps.businessproject.web.ProjectController" method="computeDurationFromChildren"/>
	</action-method>
	
  	<action-attrs name="action-project-attrs-scale-and-precision">
		<attribute name="scale" for="price" expr="eval: __config__.app.getNbDecimalDigitForUnitPrice()"/>
	</action-attrs>
	
	<action-attrs name="action-attrs-project-compute-leadDelay" model="com.axelor.apps.project.db.Project">
	    <attribute name="value" for="$visibleLeadDelay" expr="eval: new BigDecimal(visibleTimeSpent).subtract(new BigDecimal(visibleDuration).multiply(progress).divide(100))" if="visibleDuration != ''"/>
	</action-attrs>
	
	<action-attrs name="action-attrs-domain-on-contact-partner">
		<attribute for="contactPartner" if="clientPartner != null &amp;&amp; !clientPartner.contactPartnerSet.empty" name="domain" expr="eval: &quot;self.id IN (${clientPartner.contactPartnerSet?.collect{it.id}.join(',')})&quot;"/>
 		<attribute for="contactPartner" if="clientPartner != null &amp;&amp; clientPartner.contactPartnerSet.empty" name="domain" expr="eval: &quot;self.id IN (0)&quot;"/>
 		<attribute for="contactPartner" if="clientPartner == null" name="domain" expr="eval: &quot;self.isContact = true&quot;"/>
	</action-attrs>
	
	<action-method name="action-project-method-set-duration">
		<call class="com.axelor.apps.project.web.ProjectController" method="setDurationDays"/>
	</action-method>
	
	<action-method name="action-project-method-create-planning">
		<call class="com.axelor.apps.project.web.ProjectController" method="createPlanning"/>
	</action-method>

	<action-method name="action-project-method-generate-quotation">
		<call class="com.axelor.apps.project.web.ProjectController" method="generateQuotation"/>
	</action-method>

	<action-method name="action-project-method-select-team">
		<call class="com.axelor.apps.project.web.ProjectController" method="selectTeam"/>
	</action-method>

	<action-attrs name="action-project-attrs-members-domain">
		<attribute if="team?.members" name="domain" expr="eval: &quot;self.id IN (${team.members.collect{ it.id }.join(&quot;,&quot;)}) &quot;" for="membersUserSet"/>
		<attribute if="!team?.members" name="domain" expr="eval: &quot;self.id = 0 &quot;" for="membersUserSet"/>
	</action-attrs>

	<action-method name="action-project-method-clear-members">
		<call class="com.axelor.apps.project.web.ProjectController" method="clearMembers"/>
	</action-method>

</object-views>
