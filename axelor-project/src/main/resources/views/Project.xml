<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_7.1.xsd">

  <grid name="project-grid" title="Projects" model="com.axelor.apps.project.db.Project"
    orderBy="projectStatus, name">
    <menubar>
      <menu name="projectToolsMenu" title="Tools" icon="fa-wrench" showTitle="true">
        <item name="ganttWithUserItem" title="Gantt with user"
          action="action-project-open-popup-select-users"/>
        <item name="ganttWithProjectItem" title="Gantt with project"
          action="action-project-open-popup-select-projects"/>
      </menu>
    </menubar>
    <field name="name"/>
    <field name="company" form-view="company-form" grid-view="company-grid"
      if="__config__.app.getApp('base')?.getEnableMultiCompany()"/>
    <field name="code"/>
    <field name="parentProject"/>
    <field name="clientPartner"/>
    <field name="assignedTo"/>
    <field name="fromDate"/>
    <field name="toDate"/>
    <field name="imputable" width="90"/>
    <button name="openGanttBtn" title="Gantt" icon="fa-tasks"
      onClick="action-project-open-gantt"/>
    <field name="projectStatus"/>
  </grid>

  <grid name="project-child-grid" title="Projects" model="com.axelor.apps.project.db.Project"
    orderBy="projectStatus, name">
    <field name="name"/>
    <field name="code"/>
  </grid>

  <form name="business-project-form" title="Project" model="com.axelor.apps.project.db.Project"
    onLoad="action-project-on-load-group" onNew="action-project-group-on-new-project"
    onSave="action-project-method-check-resource-availibility">
    <menubar>
      <menu name="taskMenu" title="Tasks" showTitle="true" icon="fa-tasks">
        <item name="myOpenTasks" title="My open tasks"
          action="save,action-project-method-my-open-tasks" showIf="id &amp;&amp; isShowStatus"/>
        <item name="tasksCreatedByMe" title="Tasks created by me"
          action="save,action-project-method-my-tasks" showIf="id &amp;&amp; isShowStatus"/>
        <item name="allOpenTasks" title="All open tasks"
          action="save,action-project-method-all-open-tasks" showIf="id"/>
        <item name="allTasks" title="All tasks" action="save,action-project-method-all-tasks"
          showIf="id"/>
      </menu>
      <menu name="projectToolsMenu" title="Tools" showTitle="true" icon="fa-wrench">
        <item name="ganttItem" title="Gantt" showIf="id &amp;&amp; isShowGantt"
          action="save,action-project-open-gantt"/>
        <item name="bookResourceItem" title="Book resource"
          if=" __config__.app.getApp('project')?.resourceManagement"
          action="save,action-project-book-resource"/>
        <item name="taskEditorItem" action="save,action-project-open-task-editor"
          title="Task editor"/>
        <item name="wiki" title="Wiki" action="save,project.wiki.all" showIf="id"/>
        <item name="topic" title="Topic" action="save,project.topic.all"
          showIf="id &amp;&amp; isShowTopic"/>
        <item name="perStatusKanban" title="Per status kanban"
          action="save,action-project-method-view-per-status-kanban"
          showIf="id &amp;&amp; isShowKanbanPerStatus"/>
        <item name="perStatusCalendar" title="Per status calendar"
          action="save,action-project-view-per-status-calendar"
          showIf="id &amp;&amp; isShowCalendarPerStatus"/>
        <item name="perSectionKanban" title="Per section kanban"
          action="save,action-project-view-per-section-kanban"
          showIf="id &amp;&amp; isShowKanbanPerSection"/>
        <item name="perSectionCalendar" title="Per section calendar"
          action="save,action-project-view-per-section-calendar"
          showIf="id &amp;&amp; isShowCalendarPerSection"/>
        <item name="perUserCalendar" title="Per user calendar"
          action="save,action-project-view-per-user-calendar"
          showIf="id &amp;&amp; isShowCalendarPerUser"/>
      </menu>
    </menubar>
    <panel name="mainPanel">
      <panel name="detailsPanel" colSpan="12">
        <panel name="statusPanel" stacked="true" colSpan="8">
          <field name="projectStatus" showTitle="false" widget="NavSelect" x-order="sequence"/>
        </panel>
        <field name="$viewerProjectTags" showTitle="false" colSpan="4" readonly="true">
          <viewer depends="isBusinessProject,$toInvoiceCounter,id">
							<![CDATA[
								<>
									<Box d="flex" justifyContent="flex-end" gap="4" alignItems="center">
										<Box>
											{isBusinessProject &&
												<Badge style={{ backgroundColor: "#FD6217" }}>
													{_t('To Invoice')} {id && <Badge style={{ backgroundColor: "#FFAA00", fontSize: "12px" }}>{$fmt('$toInvoiceCounter')}</Badge>}
												</Badge>
											}
										</Box>
										{isBusinessProject && <Badge style={{ backgroundColor: "#2185D0" }}>{_t('Business')}</Badge>}
									</Box>
								</>
							]]>
          </viewer>
        </field>
      </panel>

      <panel-include view="incl-information-panel-form"/>
    </panel>
    <panel name="detailsPanel">
      <panel name="generalInfoPanel" colSpan="12">
        <field name="company" form-view="company-form" grid-view="company-grid" colSpan="3"
          canEdit="false" if-module="axelor-business-project"/>
        <field name="clientPartner"
          domain="self.isCustomer = true AND :company member of self.companySet"
          onChange="action-project-method-get-partner-data" requiredIf="isBusinessProject"
          form-view="partner-form" grid-view="partner-grid" colSpan="3"
          if="__config__.app.isApp('business-project')" if-module="axelor-business-project"
          showIf="isBusinessProject"/>
        <field name="currency" colSpan="3" if="__config__.app.isApp('business-project')"
          if-module="axelor-business-project" showIf="isBusinessProject" canEdit="false"/>
        <field name="priceList" colSpan="3" if="__config__.app.isApp('business-project')"
          if-module="axelor-business-project" showIf="isBusinessProject" canEdit="false"/>
        <field name="contactPartner" onSelect="action-attrs-domain-on-contact-partner"
          form-view="partner-form" grid-view="partner-grid" colSpan="6"
          if="__config__.app.isApp('business-project')" if-module="axelor-business-project"
          showIf="isBusinessProject"/>
        <field name="customerAddress" grid-view="address-grid" form-view="address-form"
          if="__config__.app.isApp('business-project')" if-module="axelor-business-project"
          showIf="isBusinessProject"
          domain="self IN (SELECT address FROM PartnerAddress where partner = :clientPartner)"/>
      </panel>
      <field name="description" colSpan="12" widget="html"/>
      <field name="siteSet" colSpan="12" grid-view="site-project-grid" form-view="site-form"
        if="__config__.app.getApp('base')?.enableSiteManagementForProject"
        domain="self.isUsableOnProject = true"/>
    </panel>

    <panel-tabs name="mainPanelTab">
      <panel title="Task Tree" name="taskTreePanel">
        <button name="addTaskBtn" title="New task" colSpan="2" css="btn-custom text-left"
          icon="fa-plus" onClick="save,action-project-add-task"/>
        <button name="addTicketBtn" title="New ticket" colSpan="2" css="btn-custom text-left"
          icon="fa-plus" onClick="save,action-project-add-ticket"
          if-module="axelor-business-support" if="__config__.app.isApp('business-support')"/>
        <button name="allTaskBtn" title="All tasks" colSpan="2" css="btn-custom text-left"
          icon="fa-tasks" onClick="save,action-project-view-show-related-tasks"/>
        <panel-dashlet name="projectTaskTreeDashletPanel" title="Task Tree"
          colSpan="12" action="action-view-show-project-task-tree"/>
        <panel-dashlet name="taskInvoicingDashletPanel" title="Task Invoicing"
          colSpan="12" showIf="isBusinessProject"
          action="action-dashlet-project-show-all-invoicing-task"
          if="__config__.app.isApp('business-project')" canSearch="true"/>
      </panel>
      <panel-include view="incl-member-panel-form"/>
      <panel-include if-module="axelor-human-resource" view="incl-planning-panel-form"
        if="__config__.app.isApp('employee')"/>
      <panel-include view="incl-holdback-panel-form"/>
      <panel-include if-module="axelor-human-resource"
        view="incl-log-times-panel-form" if="__config__.app.isApp('timesheet')"/>

      <panel title="Sales" name="salesPanel" showIf="isBusinessProject"
        if="__config__.app.isApp('business-project')
				&amp;&amp; __config__.app.getApp('business-project').getShowSaleOrderLineRelatedToProject()"
        if-module="axelor-business-project">
        <button name="generateQuotationBtn" title="Generate quotation"
          onClick="action-project-method-generate-quotation" css="btn-custom text-left"/>
        <button name="showSaleOrderLinesBtn" title="Show sale order lines" css="btn-custom"
          icon="fa-line-chart" onClick="action-project-view-show-sale-order-lines"/>
        <panel-dashlet name="saleQuotationPanel"
          action="action-project-dashlet-sale-quotation" colSpan="12" canSearch="true"/>
        <panel-dashlet name="saleOrderPanel"
          action="action-project-dashlet-sale-order" colSpan="12" canSearch="true"/>
        <button name="selectNewSOLinesBtn" title="Select new lines"
          css="btn-custom text-left"
          onClick="save,action-project-attrs-sales-order-line-select-lines"
          hideIf="$popup() || $readonly()" colSpan="3"/>
        <button name="manageSOLinesBtn" title="Manage lines" css="btn-custom text-left"
          onClick="save,action-project-attrs-sales-order-line-manage-lines"
          hideIf="$popup() || $readonly()" colSpan="3"/>
        <field name="$salesOrderLineSet" hidden="true" type="many-to-many" widget="TagSelect"
          title="Sale order lines" colSpan="12" target="com.axelor.apps.sale.db.SaleOrderLine"
          canEdit="false" canNew="false" grid-view="sale-order-line-project-grid"
          form-view="sale-order-line-form"/>
        <button-group name="SOLinesBtnGroup" colSpan="4">
          <button name="addSelectedSOLinesBtn" hidden="true" title="Add selected lines"
            onClick="action-sale-order-line-method-set-project"/>
          <button name="unlinkSelectedSOLinesBtn" hidden="true" title="Unlink selected lines"
            onClick="action-validate-unset-project,action-sale-order-line-method-unset-project"/>
        </button-group>
        <button name="cancelManageSOLinesBtn" colSpan="4" hidden="true" title="Cancel"
          onClick="action-project-attrs-sales-order-line-cancel-manage-lines"/>
        <panel-dashlet name="saleOrderLinePanel"
          action="action-project-view-show-confirmed-sale-order-lines" colSpan="12" canSearch="true"/>
        <panel-dashlet name="customerDeliveriesPanel"
          action="action-project-dashlet-customer-deliveries" colSpan="12"/>
      </panel>
      <panel title="Purchases" name="purchasesPanel" showIf="isBusinessProject"
        if="__config__.app.isApp('business-project')
					&amp;&amp; __config__.app.getApp('business-project').getShowPurchaseOrderLineRelatedToProject()"
        if-module="axelor-business-project">
        <button name="generatePurchaseQuotationBtn" title="Generate quotation"
          onClick="action-project-method-generate-purchase-quotation" css="btn-custom text-left"/>
        <button name="showPurchaseOrderLinesBtn" title="Show purchase order lines"
          css="btn-custom" icon="fa-shopping-cart"
          onClick="action-project-view-show-purchase-order-lines"/>
        <panel-dashlet name="purchaseQuotationPanel"
          action="action-project-project-purchase-quotation" colSpan="12" canSearch="true"/>
        <panel-dashlet name="purchaseOrderPanel"
          action="action-project-dashlet-purchase-order" colSpan="12" canSearch="true"/>
        <button name="selectNewPOLinesBtn" title="Select new lines"
          css="btn-custom text-left"
          onClick="save,action-project-attrs-purchase-order-line-select-lines"
          hideIf="$popup() || $readonly()" colSpan="3"/>
        <button name="managePOLinesBtn" title="Manage lines" css="btn-custom text-left"
          onClick="save,action-project-attrs-purchase-order-line-manage-lines"
          hideIf="$popup() || $readonly()" colSpan="3"/>
        <field name="$purchaseOrderLineSet" hidden="true" type="many-to-many"
          widget="TagSelect" title="Purchase order lines" colSpan="12"
          target="com.axelor.apps.purchase.db.PurchaseOrderLine" canEdit="false" canNew="false"
          grid-view="purchase-order-line-project-grid" form-view="purchase-order-line-form"/>
        <button-group name="POLinesBtnGroup" colSpan="4">
          <button name="addSelectedPOLinesBtn" hidden="true" title="Add selected lines"
            onClick="action-purchase-order-line-method-set-project"/>
          <button name="unlinkSelectedPOLinesBtn" hidden="true" title="Unlink selected lines"
            onClick="action-validate-unset-project,action-purchase-order-line-method-unset-project"/>
        </button-group>
        <button name="cancelManagePOLinesBtn" colSpan="4" hidden="true" title="Cancel"
          onClick="action-project-attrs-purchase-order-line-cancel-manage-lines"/>
        <panel-dashlet name="purchaseOrderLinePanel"
          action="action-project-view-show-confirmed-purchase-order-lines" colSpan="12"
          canSearch="true"/>
        <panel-dashlet name="supplierArrivalsPanel"
          action="action-project-dashlet-supplier-arrivals" colSpan="12"/>
      </panel>
      <panel-include view="incl-resource-booking-panel-form"
        if="__config__.app.getApp('project')?.resourceManagement"/>

      <panel title="Expenses" name="expensesPanel" showIf="isBusinessProject"
        if="__config__.app.isApp('business-project')
				&amp;&amp;  __config__.app.getApp('business-project').getShowExpenseLineRelatedToProject()"
        if-module="axelor-business-project">
        <button name="showExpenseLinesBtn" title="Show expense lines"
          css="btn-custom text-left" icon="fa-credit-card"
          onClick="action-project-view-show-expense-lines"/>
        <panel-dashlet name="expenseWaitingPanel"
          action="action-project-dashlet-expense-waiting" colSpan="12" canSearch="true"/>
        <panel-dashlet name="expensePanel"
          action="action-project-dashlet-expense-validated" colSpan="12" canSearch="true"/>
        <button name="selectNewExpenseLinesBtn" title="Select new lines"
          css="btn-custom text-left" onClick="save,action-project-attrs-expense-line-select-lines"
          hideIf="$popup() || $readonly()" colSpan="3"/>
        <button name="manageExpenseLinesBtn" title="Manage lines" css="btn-custom text-left"
          onClick="save,action-project-attrs-expense-line-manage-lines"
          hideIf="$popup() || $readonly()" colSpan="3"/>
        <field name="$expenseLineSet" hidden="true" type="many-to-many" widget="TagSelect"
          title="Expense lines" colSpan="12" target="com.axelor.apps.hr.db.ExpenseLine"
          canEdit="false" canNew="false" grid-view="expense-line-project-grid"
          form-view="expense-line-form"/>
        <button-group name="expenseLinesBtnGroup" colSpan="4">
          <button name="addSelectedExpenseLinesBtn" hidden="true" title="Add selected lines"
            onClick="action-expense-line-method-set-project"/>
          <button name="unlinkSelectedExpenseLinesBtn" hidden="true"
            title="Unlink selected lines"
            onClick="action-validate-unset-project,action-expense-line-method-unset-project"/>
        </button-group>
        <button name="cancelManageExpenseLinesBtn" colSpan="4" hidden="true" title="Cancel"
          onClick="action-project-attrs-expense-line-cancel-manage-lines"/>
        <panel-dashlet name="expenseLinePanel"
          action="action-project-view-show-validated-expense-lines" colSpan="12" canSearch="true"/>
      </panel>
      <panel title="Production" name="productionPanel" showIf="isBusinessProject"
        if-module="axelor-business-production"
        if="__config__.app.isApp('business-project')
				 &amp;&amp; __config__.app.getApp('business-project').getShowProductionOrderRelatedToProject()">
        <button name="showProductionOrdersBtn" title="Show production orders"
          css="btn-custom text-left" icon="fa-cogs"
          onClick="action-project-view-show-production-orders"/>
        <panel-related colSpan="12" field="productionOrderList" canSelect="true"
          canNew="false" canEdit="false" canSearch="true" name="productionOrderList"/>
      </panel>
      <panel title="Invoicing" name="invoicingPanel" showIf="isBusinessProject"
        if="__config__.app.isApp('business-project')" if-module="axelor-business-project">
        <help colSpan="12"><![CDATA[To be invoiceable, each element (task, timesheet, expenses, etc.) has to be set with the checkbox "To invoice" as True. These boolean buttons below will set newly created element with "To invoice" as True.]]></help>
        <field name="toInvoice" colSpan="3"
          onChange="action-project-attrs-set-invoicing-sequence"/>
        <field name="isInvoicingTimesheet" colSpan="3" showIf="isShowTimeSpent"/>
        <field name="isInvoicingExpenses" colSpan="3"/>
        <field name="isInvoicingPurchases" colSpan="3"/>
        <field name="invoicingSequenceSelect" showIf="toInvoice" requiredIf="toInvoice"
          selection-in="[1,2]" colSpan="6"/>
        <field name="consolidatePhaseWhenInvoicing"
          title="Consolidate sub project when invoicing" colSpan="4"/>
        <spacer name="invoicingSequenceSelectSpacer" colSpan="2"/>
        <button name="showInvoicingProjectsBtn" title="Create invoicing project"
          css="btn-custom" icon="fa-file-text-o"
          onClick="save,action-project-view-show-invoicing-projects"/>
        <field name="invoicingComment" colSpan="12"/>
        <panel-related name="manualElementListPanel" colSpan="12"
          field="manualElementList" form-view="manual-element-form" grid-view="manual-element-grid"/>
        <panel-dashlet name="allinvoicingProjectsPanel"
          action="action-dashlet-project-show-all-invoicing-project" colSpan="12"/>
        <panel-dashlet name="customerInvoicePanel"
          action="action-project-dashlet-customer-invoices" colSpan="12"
          if="__config__.app.getApp('business-project').getShowSaleInvoiceLineRelatedToProject()"
          canSearch="true"/>
        <button name="selectNewCustomerInvoiceLinesBtn" title="Select new lines"
          css="btn-custom text-left"
          onClick="save,action-project-attrs-customer-invoice-line-select-lines"
          hideIf="$popup() || $readonly()" colSpan="3"
          if="__config__.app.getApp('business-project').getShowSaleInvoiceLineRelatedToProject()"/>
        <button name="manageCustomerInvoiceLinesBtn" title="Manage lines"
          css="btn-custom text-left"
          onClick="save,action-project-attrs-customer-invoice-line-manage-lines"
          hideIf="$popup() || $readonly()" colSpan="3"
          if="__config__.app.getApp('business-project').getShowSaleInvoiceLineRelatedToProject()"/>
        <field name="$customerInvoiceLineSet" hidden="true" type="many-to-many"
          widget="TagSelect" title="Customer Invoice lines" colSpan="12"
          target="com.axelor.apps.account.db.InvoiceLine" canEdit="false" canNew="false"
          grid-view="invoice-line-project-grid" form-view="invoice-line-form"/>
        <button-group name="customerInvoiceLinesBtnGroup" colSpan="4">
          <button name="addSelectedCustomerInvoiceLinesBtn" hidden="true"
            title="Add selected lines"
            onClick="action-invoice-line-method-set-customer-invoice-line-project"/>
          <button name="unlinkSelectedCustomerInvoiceLinesBtn" hidden="true"
            title="Unlink selected lines"
            onClick="action-validate-unset-project,action-invoice-line-method-unset-customer-invoice-line-project"/>
        </button-group>
        <button name="cancelManageCustomerInvoiceLinesBtn" colSpan="4" hidden="true"
          title="Cancel" onClick="action-project-attrs-customer-invoice-line-cancel-manage-lines"/>
        <panel-dashlet name="customerInvoiceLinePanel"
          action="action-project-view-show-sale-invoice-lines" colSpan="12"
          if="__config__.app.getApp('business-project').getShowSaleInvoiceLineRelatedToProject()"
          canSearch="true"/>
        <panel-dashlet name="supplierInvoicePanel"
          action="action-project-dashlet-supplier-invoices" colSpan="12"
          if="__config__.app.getApp('business-project').getShowPurchaseInvoiceLineRelatedToProject()"
          canSearch="true"/>
        <button name="selectNewSupplierInvoiceLinesBtn" title="Select new lines"
          css="btn-custom text-left"
          onClick="save,action-project-attrs-supplier-invoice-line-select-lines"
          hideIf="$popup() || $readonly()" colSpan="3"
          if="__config__.app.getApp('business-project').getShowPurchaseInvoiceLineRelatedToProject()"/>
        <button name="manageSupplierInvoiceLinesBtn" title="Manage lines"
          css="btn-custom text-left"
          onClick="save,action-project-attrs-supplier-invoice-line-manage-lines"
          hideIf="$popup() || $readonly()" colSpan="3"
          if="__config__.app.getApp('business-project').getShowPurchaseInvoiceLineRelatedToProject()"/>
        <field name="$supplierInvoiceLineSet" hidden="true" type="many-to-many"
          widget="TagSelect" title="Supplier Invoice lines" colSpan="12"
          target="com.axelor.apps.account.db.InvoiceLine" canEdit="false" canNew="false"
          grid-view="invoice-line-project-grid" form-view="invoice-line-form"/>
        <button-group name="supplierInvoiceLinesBtnGroup" colSpan="4">
          <button name="addSelectedSupplierInvoiceLinesBtn" hidden="true"
            title="Add selected lines"
            onClick="action-invoice-line-method-set-supplier-invoice-line-project"/>
          <button name="unlinkSelectedSupplierInvoiceLinesBtn" hidden="true"
            title="Unlink selected lines"
            onClick="action-validate-unset-project,action-invoice-line-method-unset-supplier-invoice-line-project"/>
        </button-group>
        <button name="cancelManageSupplierInvoiceLinesBtn" colSpan="4" hidden="true"
          title="Cancel" onClick="action-project-attrs-supplier-invoice-line-cancel-manage-lines"/>
        <panel-dashlet name="supplierInvoiceLinePanel"
          action="action-project-view-show-purchase-invoice-lines" colSpan="12"
          if="__config__.app.getApp('business-project').getShowPurchaseInvoiceLineRelatedToProject()"
          canSearch="true"/>
        <panel-dashlet name="advancePaymentInvoicesDashletPanel"
          action="action-project-dashlet-advance-payment-invoices" colSpan="12"
          if="__config__.app.getApp('business-project').getShowPurchaseInvoiceLineRelatedToProject() || __config__.app.getApp('business-project').getShowSaleInvoiceLineRelatedToProject()"
          canSearch="true"/>
      </panel>
      <panel title="Analytic" name="analyticPanel" showIf="isBusinessProject"
        if="__config__.app.isApp('business-project')" if-module="axelor-business-project">
        <panel-dashlet name="analyticDashletPanel"
          action="action-project-dashlet-analytic-move-lines" colSpan="12"/>
      </panel>
      <panel-include view="incl-wiki-panel-form"/>
      <panel title="Roadmap" name="roadmapPanel" if-module="axelor-business-support"
        if="__config__.app.isApp('business-support')">
        <panel-related name="roadmapSetPanel" field="roadmapSet" colSpan="12"
          form-view="project-version-form">
          <field name="title"/>
          <field name="projectStatus"/>
          <field name="testingServerDate"/>
          <field name="productionServerDate"/>
        </panel-related>
      </panel>
      <panel name="announcementPanel" title="Announcement" if-module="axelor-business-support"
        if="__config__.app.isApp('business-support')">
        <panel-related name="announcementListPanel" field="announcementList"
          colSpan="12" form-view="project-announcement-form">
          <field name="title"/>
          <field name="date"/>
          <field name="content"/>
        </panel-related>
      </panel>
      <panel title="Configurations" name="configurationsPanel">
        <field if="__config__.app.isApp('employee')" if-module="axelor-human-resource"
          name="productSet" colSpan="12" widget="TagSelect" canEdit="false"
          domain="self.isActivity = true AND self.dtype = 'Product'"
          form-view="product-activity-form" grid-view="product-activity-grid"/>
        <field name="projectFolderSet" colSpan="12" widget="TagSelect"
          if="__config__.app.isApp('business-project')" if-module="axelor-business-project"/>
        <field name="projectTimeUnit"/>
        <field name="excludeTimesheetEditor" if="__config__.app.isApp('timesheet')"
          if-module="axelor-human-resource"/>
        <field name="childProjectList" hidden="true"/>
        <field name="sequence" hidden="true"/>
        <field name="imputable" colSpan="4" widget="boolean-switch"
          if="__config__.app.isApp('employee') &amp;&amp; __config__.app.isApp('timesheet')"
          if-module="axelor-human-resource"
          onChange="action-project-record-reset-value-is-show-timespent,action-project-record-is-show-timespent-reset-values"/>
        <panel-include view="incl-fields-to-display-panel-form"/>
      </panel>
      <panel title="Contracts" name="contractPanel" showIf="isBusinessProject"
        if="__config__.app.isApp('business-project')" if-module="axelor-business-project">
        <button name="createNewCustomerContract" title="Create new customer contract"
          colSpan="6" onClick="save,action-project-view-create-new-customer-contract"/>
        <button name="createNewSupplierContract" title="Create new supplier contract"
          colSpan="6" onClick="save,action-project-view-create-new-supplier-contract"/>
        <panel-dashlet name="customerContractPanel" title="Customer contracts"
          action="action-project-dashlet-customer-contracts" colSpan="12" canSearch="true"/>
        <panel-dashlet name="supplierContractPanel" title="Supplier contracts"
          action="action-project-dashlet-supplier-contracts" colSpan="12" canSearch="true"/>
        <panel-dashlet name="contractInvoicePanel" title="Invoices"
          action="action-project-dashlet-contract-invoices" colSpan="12"/>
      </panel>
      <panel title="Custom fields" name="customFieldConfigPanel">
        <panel-related field="taskCustomFieldsList" colSpan="12" showIf="id"
          form-view="project-task-meta-json-field-form" grid-view="project-meta-json-field-grid"/>
      </panel>
      <panel title="Activities" name="activityPanel"
        onTabSelect="action-project-activity-dashboard-method-on-new" showIf="id">
        <panel-include view="project-activity-dashboard-form"/>
      </panel>
    </panel-tabs>
    <panel name="attrsPanel">
      <field name="attrs" colSpan="12"/>
    </panel>
    <panel-include view="incl-action-panel-project-form"/>
    <panel name="characteristicsPanel" title="Characteristics" colSpan="12" sidebar="true"
      canCollapse="true">
      <panel name="configPanel" colSpan="12">
        <field if="__config__.app.isApp('business-project')"
          if-module="axelor-business-project" name="isBusinessProject" colSpan="6"
          widget="boolean-switch"/>
        <field name="isShowPhasesElements" colSpan="12" widget="boolean-switch"/>
        <field if="__config__.app.isApp('business-project')"
          if-module="axelor-business-project" name="$toInvoiceCounter" showTitle="false"
          type="integer" hidden="true" colSpan="6"/>
      </panel>
      <panel name="projectPanel" colSpan="12">
        <field name="parentProject" canEdit="false" form-view="business-project-form"
          grid-view="project-grid" onSelect="action-project-attrs-set-parent-project-domain"/>
        <spacer name="childProjectSpacer" colSpan="6"/>
        <field name="childProjectList" readonly="true" colSpan="12"
          form-view="business-project-form" grid-view="project-child-grid"
          showIf="isShowPhasesElements"/>
      </panel>
    </panel>
    <panel name="followUpPanel" colSpan="12" title="Follow-up" sidebar="true"
      canCollapse="true">
      <field name="assignedTo" title="Assigned to" canNew="false" canView="false"
        canEdit="false" onChange="action-attrs-project-add-member" form-view="user-form"
        grid-view="user-grid"/>
    </panel>
    <panel name="datePanel" title="Dates" colSpan="12" sidebar="true" canCollapse="true">
      <field name="fromDate" colSpan="6"/>
      <field name="toDate" colSpan="6"/>
    </panel>
    <panel-mail name="mailPanel">
      <mail-messages limit="4"/>
      <mail-followers/>
    </panel-mail>
  </form>


  <form name="project-select-wizard-form" title="Select Projects"
    model="com.axelor.utils.db.Wizard">
    <panel name="mainPanel">
      <field name="projectSet" title="Projects" type="many-to-many" colSpan="12"
        target="com.axelor.apps.project.db.Project" canNew="false"/>
      <button name="ganttBtn" title="Open gantt"
        onClick="action-wizard-validate-project-select,action-open-project-gantt,close" colSpan="3"/>
    </panel>
  </form>

  <form name="user-select-wizard-form" title="Select Users" model="com.axelor.utils.db.Wizard">
    <panel name="mainPanel">
      <field name="userSet" title="Users" type="many-to-many" colSpan="12"
        target="com.axelor.auth.db.User" canNew="false"
        onSelect="action-project-gantt-user-wizard-user-domain"/>
      <button name="ganttBtn" title="Open gantt"
        onClick="action-wizard-validate-user-select,action-open-user-gantt,close" colSpan="3"/>
    </panel>
  </form>

  <kanban columnBy="projectStatus" sequenceBy="orderByState" limit="10" name="project-kanban"
    title="Projects" model="com.axelor.apps.project.db.Project">
    <field name="fullName"/>
    <field name="description"/>
    <field name="projectStatus"/>
    <field name="sequence"/>
    <template>
		<![CDATA[
	    <>
	    	<strong>{fullName}</strong>
	    	<Box dangerouslySetInnerHTML={{__html : description}}></Box>
	    </>
		]]>
    </template>
  </kanban>

  <kanban columnBy="projectStatus" sequenceBy="projectStatus" limit="10" name="task-kanban"
    title="Tasks" model="com.axelor.apps.project.db.Project">
    <field name="fullName"/>
    <field name="description"/>
    <field name="projectStatus"/>
    <field name="sequence"/>
    <template>
		<![CDATA[
	    <>
	    	<strong>{fullName}</strong>
	    	<Box dangerouslySetInnerHTML={{__html : description}}></Box>
	    </>
		]]>
    </template>
  </kanban>

  <tree name="project-project-task-tree" title="Tasks">

    <column name="name" type="string"/>
    <column name="taskDate" type="date"/>
    <column name="assignedTo" type="reference"/>
    <column name="openTaskBtn" type="button"/>
    <column name="createSubtaskBtn" type="button"/>
    <column name="deleteTaskBtn" type="button"/>

    <node model="com.axelor.apps.project.db.ProjectTask" domain="self.project.id = :_id"
      onClick="action-project-task-view-task" orderBy="taskDate">
      <field name="name" as="name"/>
      <field name="taskDate" as="taskDate"/>
      <field name="assignedTo" as="assignedTo"/>
      <field name="progress" as="progress"/>
      <button name="createSubtaskBtn" icon="fa-plus"
        onClick="save, action-project-view-add-subtask"/>
      <button name="deleteTaskBtn" icon="fa-times"
        onClick="action-project-task-validate-delete-team-task-confirmation, action-project-task-method-delete-project-task"/>
      <button name="openTaskBtn" icon="fa-external-link"
        onClick="action-project-task-open-task"/>
    </node>

    <node model="com.axelor.apps.project.db.ProjectTask" parent="parentTask" draggable="true"
      onClick="action-project-task-view-task" orderBy="taskDate">
      <field name="name" as="name"/>
      <field name="taskDate" as="taskDate"/>
      <field name="assignedTo" as="assignedTo"/>
      <field name="progress" as="progress"/>
      <button name="createSubtaskBtn" icon="fa-plus"
        onClick="save, action-project-view-add-subtask"/>
      <button name="deleteTaskBtn" icon="fa-times"
        onClick="action-project-task-validate-delete-team-task-confirmation, action-project-task-method-delete-project-task"/>
      <button name="openTaskBtn" icon="fa-external-link"
        onClick="action-project-task-open-task"/>
    </node>

  </tree>

  <tree name="project-phase-tree" title="Phases">

    <column name="name" type="string"/>
    <column name="assignedTo" type="reference"/>
    <column name="progress" type="integer"/>
    <column name="openTask" type="button"/>

    <node model="com.axelor.apps.project.db.Project" domain="self.parentProject.id = :id"
      onClick="action-project-view-phase">
      <field name="name" as="name"/>
      <field name="assignedTo" as="assignedTo"/>
      <button name="openTaskBtn" title="Open phase" onClick="action-project-view-phase"/>
    </node>

    <node model="com.axelor.apps.project.db.ProjectTask" parent="project" draggable="true"
      onClick="action-project-task-view-task">
      <field name="name" as="name"/>
      <field name="assignedTo" as="assignedTo"/>
      <field name="progress" as="progress"/>
      <button name="openTaskBtn" title="Open task" onClick="action-project-task-open-task"/>
    </node>
  </tree>

  <calendar name="project-calendar" title="Project Calendar"
    model="com.axelor.apps.project.db.Project" mode="month" colorBy="projectStatus"
    eventStart="fromDate" eventStop="toDate" eventLength="1">
    <field name="fullName"/>
  </calendar>

  <action-group name="action-project-group-on-new-project">
    <action name="action-project-defaults"/>
    <action name="action-project-record-status-new"/>
    <action name="action-project-attrs-on-new-load"/>
    <action name="action-attrs-project-set-project-type"
      if="__config__.app.isApp('business-project')"/>
  </action-group>

  <action-group name="action-project-on-load-group">
    <action name="action-project-attrs-on-new-load"/>
    <action name="action-attrs-project-set-project-type"
      if="__config__.app.isApp('business-project')"/>
    <action name="action-project-method-count-to-invoice"
      if="__config__.app.isApp('business-project')"/>
  </action-group>

  <action-attrs name="action-task-attrs-assigned-to-domain">
    <attribute name="domain" for="assignedTo"
      expr="eval:&quot;self.id in (${(project?.membersUserSet?.collect{it->it.id}+[0,0]).join(',')}) &quot;"
      if="(typeSelect == 'task')&amp;&amp;(project?.membersUserSet)&amp;&amp;(!project.membersUserSet.isEmpty())"/>
  </action-attrs>

  <action-attrs name="action-attrs-project-set-project-type"
    model="com.axelor.apps.project.db.Project">
    <attribute name="readonly" for="isBusinessProject" expr="eval:_fromBusinessProject"/>
  </action-attrs>

  <action-view name="action-project-task-view" title="Tasks"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="form" name="project-task-form"/>
    <view-param name="popup" value="reload"/>
    <view-param name="show-toolbar" value="false"/>
    <view-param name="show-confirm" value="false"/>
    <view-param name="popup-save" value="false"/>
    <context name="_showRecord" expr="eval: id"/>
  </action-view>

  <action-view name="action-project-add-ticket"
    model="com.axelor.apps.project.db.ProjectTask" title="Ticket">
    <view name="project-task-form" type="form"/>
    <view name="project-task-grid" type="grid"/>
    <view-param name="popup" value="reload"/>
    <view-param name="popup-save" value="true"/>
    <view-param name="show-confirm" value="true"/>
    <view-param name="show-toolbar" value="false"/>
    <view-param name="forceTitle" value="true"/>
    <context name="_project" expr="eval:__this__"/>
    <context name="_typeSelect"
      expr="eval: com.axelor.apps.project.db.repo.ProjectTaskRepository.TYPE_TICKET"/>
  </action-view>

  <action-view name="action-project-open-popup-select-users" title="Select Users"
    model="com.axelor.utils.db.Wizard">
    <view type="form" name="user-select-wizard-form"/>
    <view-param name="show-toolbar" value="false"/>
    <view-param name="show-confirm" value="false"/>
    <view-param name="popup-save" value="false"/>
  </action-view>

  <action-view name="action-project-open-popup-select-projects" title="Select Projects"
    model="com.axelor.utils.db.Wizard">
    <view type="form" name="project-select-wizard-form"/>
    <view-param name="show-toolbar" value="false"/>
    <view-param name="show-confirm" value="false"/>
    <view-param name="popup-save" value="false"/>
  </action-view>

  <action-view name="action-open-project-gantt" title="Project Gantt"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="gantt" name="project-task-gantt"/>
    <view type="grid" name="project-task-grid"/>
    <view type="form" name="project-task-form"/>
    <domain>self.project.id IN (:_projectIds) OR self.project.parentProject.id IN (:_projectIds)</domain>
    <context name="_projectIds" expr="eval: projectSet.collect{it.id}"/>
  </action-view>

  <action-view name="action-open-user-gantt" title="User Gantt"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="gantt" name="user-task-gantt"/>
    <view type="grid" name="project-task-grid"/>
    <view type="form" name="project-task-form"/>
    <domain>self.assignedTo.id IN (:_userIds) </domain>
    <context name="_userIds" expr="eval: userSet.collect{it.id}"/>
  </action-view>

  <action-view name="action-project-view-add-subtask"
    model="com.axelor.apps.project.db.ProjectTask" title="Task">
    <view name="project-task-form" type="form"/>
    <view name="project-task-grid" type="grid"/>
    <view-param name="popup" value="reload"/>
    <view-param name="popup-save" value="true"/>
    <view-param name="show-confirm" value="true"/>
    <view-param name="show-toolbar" value="false"/>
    <context name="_project" expr="eval:__this__.project"/>
    <context name="_parentTask" expr="eval:__this__"/>
    <context name="_typeSelect"
      expr="eval: com.axelor.apps.project.db.repo.ProjectTaskRepository.TYPE_TASK"/>
  </action-view>

  <action-record name="action-project-record-bind-customer-project"
    model="com.axelor.apps.project.db.Project">
    <field name="clientPartner" expr="eval: project?.clientPartner"/>
  </action-record>

  <action-record name="action-project-record-bind-customer-parent"
    model="com.axelor.apps.project.db.Project">
    <field name="clientPartner" expr="eval: __parent__?.clientPartner"/>
  </action-record>

  <action-attrs name="action-attrs-domain-on-contact-partner">
    <attribute for="contactPartner"
      if="clientPartner != null &amp;&amp; !clientPartner.contactPartnerSet.empty" name="domain"
      expr="eval: &quot;self.id IN (${clientPartner.contactPartnerSet?.collect{it.id}.join(',')})&quot;"/>
    <attribute for="contactPartner"
      if="clientPartner != null &amp;&amp; clientPartner.contactPartnerSet.empty" name="domain"
      expr="eval: &quot;self.id IN (0)&quot;"/>
    <attribute for="contactPartner" if="clientPartner == null" name="domain"
      expr="eval: &quot;self.isContact = true AND :company member of self.companySet&quot;"/>
  </action-attrs>

  <action-validate name="action-wizard-validate-user-select">
    <error message="Please select user" if="eval: userSet == null || userSet  == 0"/>
  </action-validate>

  <action-validate name="action-wizard-validate-project-select">
    <error message="Please select project" if="eval: projectSet == null || projectSet  == 0"/>
  </action-validate>

  <action-validate name="action-project-task-validate-delete-team-task-confirmation">
    <alert message="Are you sure you want to delete this task ?"/>
  </action-validate>

  <action-attrs name="action-business-support-attrs-project-default">
    <attribute name="hidden" for="project" expr="eval:true"
      if="_parent &amp;&amp; (_parent?._model == 'com.axelor.apps.project.db.Project' || _parent?._model == 'com.axelor.apps.project.db.ProjectTemplate')"/>
  </action-attrs>

  <action-view name="action-project-view-create-new-customer-contract"
    title="Create new customer contract" model="com.axelor.apps.contract.db.Contract">
    <view type="form" name="contract-form"/>
    <context name="_xTargetType" expr="eval:1"/>
    <context name="_project" expr="eval: __self__"/>
    <context name="_clientPartner" expr="eval: __self__.clientPartner"/>
  </action-view>

  <action-view name="action-project-view-create-new-supplier-contract"
    title="Create new supplier contract" model="com.axelor.apps.contract.db.Contract">
    <view type="form" name="contract-form"/>
    <context name="_xTargetType" expr="eval:2"/>
    <context name="_project" expr="eval:__self__"/>
  </action-view>

  <action-view name="action-project-dashlet-customer-contracts"
    title="Customer contracts" model="com.axelor.apps.contract.db.Contract">
    <view type="grid" name="contract-grid"/>
    <view type="form" name="contract-form"/>
    <domain>self.project.id = :id AND self.targetTypeSelect = 1 AND self.statusSelect != 3</domain>
  </action-view>

  <action-view name="action-project-dashlet-supplier-contracts"
    title="Supplier contracts" model="com.axelor.apps.contract.db.Contract">
    <view type="grid" name="contract-grid"/>
    <view type="form" name="contract-form"/>
    <domain>self.project.id = :id AND self.targetTypeSelect = 2 AND self.statusSelect != 3</domain>
  </action-view>

  <action-view name="action-project-dashlet-contract-invoices" title="Invoices"
    model="com.axelor.apps.account.db.Invoice">
    <view type="grid" name="invoice-grid"/>
    <view type="form" name="invoice-form"/>
    <domain>:_id IN self.contractSet.project.id</domain>
  </action-view>

  <action-attrs name="action-project-gantt-user-wizard-user-domain">
    <attribute name="domain"
      expr="eval:&quot;self.id in (${([0]+__repo__(Project).all().fetch().collect{it->it.membersUserSet.id}.flatten()).join(',')})&quot;"
      for="userSet"/>
  </action-attrs>

  <search-filters name="project-topic-filters"
    model="com.axelor.apps.project.db.Topic" title="Topics">
    <filter name="project-topic-filters-my-topics" title="My topics">
      <domain>self.createdBy.id = :userId</domain>
    </filter>
    <filter name="project-topic-filters-new-topics" title="New topics">
      <domain>self.createdOn &gt; date(now())</domain>
    </filter>
  </search-filters>

  <action-method name="action-project-view-show-related-tasks">
    <call class="com.axelor.apps.project.web.ProjectMenuController"
      method="allProjectRelatedTasks"/>
  </action-method>

  <action-record name="action-project-record-is-show-timespent-reset-values"
    model="com.axelor.apps.project.db.Project">
    <field name="isInvoicingTimesheet" expr="eval: false" if="!isShowTimeSpent"/>
  </action-record>

  <action-record name="action-project-record-reset-value-is-show-timespent"
    model="com.axelor.apps.project.db.Project">
    <field name="isShowTimeSpent" expr="eval: false" if="!imputable"/>
  </action-record>

  <action-group name="action-project-group-status-finish">
    <action name="action-project-validate-finish-status"/>
    <action name="action-project-record-status-finish"/>
    <action name="save"/>
  </action-group>

  <action-validate name="action-project-validate-finish-status">
    <error message="Please fill completed project status in App Project configuration."
      if="!__config__.app.getApp('project')?.completedProjectStatus"/>
  </action-validate>

  <search-filters name="project-filters" model="com.axelor.apps.project.db.Project"
    title="Project filters">
    <field name="company" hidden="true"
      if="!__config__.app.getApp('base')?.getEnableMultiCompany()"/>
    <field name="resourceBookingList" hidden="true"
      if="!__config__.app.getApp('project')?.resourceManagement"/>
    <field name="productionOrderList" hidden="true"
      if="!(__config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowProductionOrderRelatedToProject())"/>
    <field name="clientPartner" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="currency" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="priceList" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="contactPartner" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="customerAddress" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="totalPlannedHrs" hidden="true" if="!__config__.app.isApp('employee')"/>
    <field name="toInvoice" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="isInvoicingTimesheet" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="isInvoicingExpenses" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="isInvoicingPurchases" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="invoicingSequenceSelect" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="consolidatePhaseWhenInvoicing" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="invoicingComment" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="manualElementList" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="roadmapSet" hidden="true" if="!__config__.app.isApp('business-support')"/>
    <field name="announcementList" hidden="true"
      if="!__config__.app.isApp('business-support')"/>
    <field name="productSet" hidden="true" if="!__config__.app.isApp('employee')"/>
    <field name="imputable" hidden="true" if="!__config__.app.isApp('employee')"/>
    <field name="isBusinessProject" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
  </search-filters>
</object-views>
