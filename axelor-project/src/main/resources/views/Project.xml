<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_7.2.xsd">

  <grid name="project-grid" title="Projects" model="com.axelor.apps.project.db.Project"
    orderBy="projectStatus, name">
    <toolbar>
      <button name="logTimeBtn" icon="clock-history"
        onClick="action-timesheet-line-method-log-time" if="__config__.app.isApp('timesheet')"/>
    </toolbar>
    <menubar>
      <menu name="projectToolsMenu" title="Tools" icon="fa-wrench" showTitle="true">
        <item name="ganttWithUserItem" title="Gantt with user"
          action="action-project-open-popup-select-users"/>
        <item name="ganttWithProjectItem" title="Gantt with project"
          action="action-project-open-popup-select-projects"/>
      </menu>
    </menubar>
    <field name="name"/>
    <field name="company" form-view="company-form" grid-view="company-grid"
      if="__config__.app.getApp('base')?.getEnableMultiCompany()"/>
    <field name="code"/>
    <field name="parentProject"/>
    <field name="clientPartner"/>
    <field name="assignedTo"/>
    <field name="fromDate"/>
    <field name="toDate"/>
    <field name="projectStatus"/>
    <button name="openGanttBtn" title="Gantt" icon="bar-chart-steps"
      onClick="action-project-open-gantt"/>
    <button name="openTasks" onClick="action-project-view-show-related-tasks"
      icon="list-task"/>
  </grid>

  <grid name="project-child-grid" title="Projects" model="com.axelor.apps.project.db.Project"
    orderBy="projectStatus, name">
    <field name="name"/>
    <field name="code"/>
  </grid>

  <form name="project-form" title="Project" model="com.axelor.apps.project.db.Project"
    onLoad="action-project-on-load-group" onNew="action-project-group-on-new-project"
    onSave="action-project-group-on-save" width="large">
    <menubar>
      <menu name="taskMenu" title="Tasks" showTitle="true" icon="fa-tasks">
        <item name="myOpenTasks" title="My open tasks"
          action="save,action-project-method-my-open-tasks"
          showIf="id &amp;&amp; taskStatusManagementSelect != 1"/>
        <item name="tasksCreatedByMe" title="Tasks created by me"
          action="save,action-project-method-my-tasks"
          showIf="id &amp;&amp; taskStatusManagementSelect != 1"/>
        <item name="allOpenTasks" title="All open tasks"
          action="save,action-project-method-all-open-tasks" showIf="id"/>
        <item name="allTasks" title="All tasks" action="save,action-project-method-all-tasks"
          showIf="id"/>
        <item name="allTasksTree" title="All tasks (tree)"
          action="save, action-view-show-project-task-tree" showIf="id"/>
      </menu>
      <menu name="projectToolsMenu" title="Tools" showTitle="true" icon="fa-wrench">
        <item name="ganttItem" title="Gantt" showIf="id &amp;&amp; isShowGantt"
          action="save,action-project-open-gantt"/>
        <item name="bookResourceItem" title="Book resource"
          if=" __config__.app.getApp('project')?.resourceManagement"
          action="save,action-project-book-resource"/>
        <item name="wiki" title="Wiki" action="save,project.wiki.all" showIf="id"/>
        <item name="topic" title="Topic" action="save,project.topic.all"
          showIf="id &amp;&amp; isShowTopic"/>
        <item name="perStatusKanban" title="Per status kanban"
          action="save,action-project-method-view-per-status-kanban"
          showIf="id &amp;&amp; isShowKanbanPerStatus"/>
        <item name="perStatusCalendar" title="Per status calendar"
          action="save,action-project-view-per-status-calendar"
          showIf="id &amp;&amp; isShowCalendarPerStatus"/>
        <item name="perCategoryKanban" title="Per category kanban"
          action="save,action-project-view-per-category-kanban"
          showIf="id &amp;&amp; isShowKanbanPerCategory"/>
        <item name="perCategoryCalendar" title="Per category calendar"
          action="save,action-project-view-per-category-calendar"
          showIf="id &amp;&amp; isShowCalendarPerCategory"/>
        <item name="perUserCalendar" title="Per user calendar"
          action="save,action-project-view-per-user-calendar"
          showIf="id &amp;&amp; isShowCalendarPerUser"/>
      </menu>
    </menubar>
    <panel name="mainPanel" colSpan="12">
      <panel-include view="incl-information-panel-form"/>
      <spacer colSpan="2"/>
      <panel name="statusChangeBtn" colSpan="4">
        <button name="finishBtn" icon="check-circle" title="Finish"
          showIf="id &amp;&amp; !projectStatus.isCompleted"
          onClick="action-project-group-finish-project"/>
        <button name="cancelBtn" title="Cancel" css="btn-danger"
          hideIf="projectStatus.id == $canceledProjectStatusId || !id" icon="x-circle"
          onClick="action-project-group-status-canceled"/>
        <button name="resetBtn" title="Reset" css="btn-warning"
          showIf="id &amp;&amp; projectStatus.id == $canceledProjectStatusId"
          icon="skip-backward-fill" onClick="action-project-record-status-new,save"/>
        <field name="projectStatus.isCompleted" hidden="true"/>
      </panel>
    </panel>

    <panel-tabs name="mainPanelTab">

      <panel name="overviewPanel" title="Overview"
        onTabSelect="action-project-activity-dashboard-method-on-new,action-project-dashboard-method-on-new">
        <field name="projectStatus" showTitle="false" widget="NavSelect" x-order="sequence"/>
        <field name="company" form-view="company-form" grid-view="company-grid" colSpan="2"/>
        <field name="fromDate" colSpan="2"/>
        <field name="toDate" colSpan="2"/>
        <panel-include view="incl-project-overview-panel-form"/>
      </panel>

      <panel title="Tasks" name="taskPanel">
        <panel-dashlet name="projectTaskDashletPanel" title="Tasks" x-show-bars="true"
          colSpan="12" action="action-project-view-show-project-task" height="200%" canSearch="true"/>
      </panel>

      <panel-include view="incl-wiki-panel-form"/>

      <panel-include view="incl-checklist-panel-form"/>

      <panel title="Log Times" name="logTimesPanel" if-module="axelor-human-resource"
        if="__config__.app.isApp('timesheet')">
        <panel-include view="incl-log-times-panel-form"/>
      </panel>
      <panel-include view="incl-project-roadmap-panel-form"/>

      <panel title="Configurations" name="configurationsPanel">
        <panel-include view="incl-project-config-panel-form"/>
      </panel>
    </panel-tabs>
    <panel name="attrsPanel">
      <field name="attrs" colSpan="12"/>
    </panel>
    <panel-mail name="mailPanel">
      <mail-messages limit="4"/>
      <mail-followers/>
    </panel-mail>
  </form>

  <form name="incl-project-overview-panel-form" title="Project"
    model="com.axelor.apps.project.db.Project">
    <panel colSpan="12">
      <field name="description" colSpan="12" widget="html"/>
    </panel>
    <panel name="dashboardPanel" title="Dashboard" showTitle="false" colSpan="12"
      canCollapse="true" collapseIf="false">
      <panel-include view="project-dashboard-form"/>
    </panel>
    <panel name="sitePanel" title="Sites" canCollapse="true" colSpan="12" collapseIf="true"
      if="__config__.app.getApp('base')?.enableSiteManagementForProject">
      <field name="siteSet" showTitle="false" colSpan="12" grid-view="site-project-grid"
        form-view="site-form"
        domain="(self.typeSelect = 1 AND self.isUsableOnProject = true AND self.company = :company)
          OR (self.typeSelect = 2 AND self.isUsableOnProject = true AND self.company = :company AND self.partner = :clientPartner)"
        canEdit="false"/>
    </panel>
    <panel title="Activities" name="activityPanel" canCollapse="true" collapseIf="true"
      colSpan="12" showIf="id">
      <panel-include view="project-activity-dashboard-form"/>
    </panel>
  </form>

  <form name="incl-information-panel-form" title="Project"
    model="com.axelor.apps.project.db.Project">
    <panel name="informationPanel">
      <field name="fullName" showTitle="false" colSpan="12" css="label-bold bold large">
        <editor x-show-titles="false">
          <panel name="seq" colSpan="3">
            <field name="code" showTitle="false" colSpan="12" readonly="true"
              if="__config__.app.getApp('project')?.generateProjectSequence"
              css="label-bold bold large" x-bind="{{code|unaccent|uppercase}}"/>
            <field name="code" showTitle="false" colSpan="12" required="true"
              if="!__config__.app.getApp('project')?.generateProjectSequence"
              css="label-bold bold large" x-bind="{{code|unaccent|uppercase}}"/>
          </panel>
          <field name="name" showTitle="false" colSpan="6" required="true"
            css="label-bold bold large"/>
        </editor>
      </field>
    </panel>
  </form>

  <form name="incl-project-structure-panel-form" title="Project"
    model="com.axelor.apps.project.db.Project">
    <panel name="structurePanel" title="Project structure" collapseIf="false"
      canCollapse="true" colSpan="12">
      <panel title="Members" name="membersPanel" colSpan="12">
        <field name="extendsMembersFromParent" hidden="true" widget="boolean-switch"/>
        <spacer/>
        <field name="team" title="Team" readonlyIf="synchronize || extendsMembersFromParent"
          colSpan="6" canNew="false" canEdit="false"/>
        <field name="synchronize" readonlyIf="extendsMembersFromParent" colSpan="3"
          widget="boolean-switch"/>
        <button name="importMemberBtn" title="Import all members" showIf="team != null"
          readonlyIf="extendsMembersFromParent" colSpan="3"
          onClick="action-project-method-import-members"/>
        <field name="membersUserSet" colSpan="9" widget="TagSelect" canNew="false"
          form-view="user-form" grid-view="user-grid" canEdit="false"/>
        <field name="assignedTo" title="Assigned to" canNew="false" canView="false"
          canEdit="false" onChange="action-attrs-project-add-member" form-view="user-form"
          grid-view="user-grid" colSpan="3"/>
      </panel>
      <panel name="characteristicsPanel" title="Characteristics" colSpan="12">
        <field name="parentProject" canEdit="false" form-view="project-form"
          grid-view="project-grid" onSelect="action-project-attrs-set-parent-project-domain"/>
        <field name="isShowPhasesElements" widget="boolean-switch"/>
        <field name="childProjectList" readonly="true" colSpan="12" form-view="project-form"
          grid-view="project-child-grid" showIf="isShowPhasesElements"/>
      </panel>
      <panel name="resourceBookingListPanel" title="Resource booking" colSpan="12"
        if="__config__.app.getApp('project')?.resourceManagement">
        <panel-related name="resourceBookingListPanel" field="resourceBookingList"
          form-view="resource-booking-form" grid-view="resource-booking-grid-incl-project"
          height="200%" colSpan="12"/>
      </panel>
    </panel>
  </form>

  <form name="incl-log-times-panel-form" title="Project"
    model="com.axelor.apps.project.db.Project">
    <panel title="Log Times" name="logTimesPanel" showTitle="false" colSpan="12" itemSpan="12">
      <panel-dashlet name="validatedTimesheetsPanel" x-show-bars="true"
        if="__config__.app.getApp('timesheet')?.needValidation" height="200%"
        action="action-project-dashlet-validated-timesheet-lines" title="Validated Timesheet lines"
        colSpan="12" canSearch="true"/>
      <panel-dashlet name="waitingTimesheetLinesPanel" x-show-bars="true"
        if="__config__.app.getApp('timesheet')?.needValidation" height="200%"
        action="action-project-dashlet-project-waiting-timesheet-lines"
        title="Waiting Timesheet lines" colSpan="12" canSearch="true"/>
      <panel-dashlet name="allTimesheetsLinesPanel" x-show-bars="true"
        if="!__config__.app.getApp('timesheet')?.needValidation" height="200%"
        action="action-project-dashlet-project-all-timesheet-lines" title="TimesheetLine.timeSpent"
        colSpan="12" canSearch="true"/>
    </panel>
  </form>

  <form name="incl-wiki-panel-form" title="Project" model="com.axelor.apps.project.db.Project">
    <panel title="Wiki" name="wikiPanel" canCollapse="true" collapseIf="true" colSpan="12">
      <field name="wikiDescription" colSpan="12" widget="html"/>
      <panel-related name="wikiListPanel" field="wikiList" colSpan="12"
        form-view="wiki-form" grid-view="wiki-grid-incl-project" canSearch="true"/>
    </panel>
  </form>

  <form name="incl-project-config-panel-form" title="Project"
    model="com.axelor.apps.project.db.Project">
    <panel-include view="incl-project-structure-panel-form"/>
    <panel title="General configuration" name="generalConfigurationsPanel" colSpan="12"
      canCollapse="true" collapseIf="false">
      <field if="__config__.app.isApp('employee')" if-module="axelor-human-resource"
        name="productSet" widget="TagSelect" canEdit="false"
        domain="self.isActivity = true AND self.dtype = 'Product'" form-view="product-activity-form"
        grid-view="product-activity-grid"/>
      <field name="projectTimeUnit" onSelect="action-project-attrs-set-time-unit-domain"/>
      <field name="numberHoursADay"/>
      <field name="excludeTimesheetEditor" if="__config__.app.isApp('timesheet')"
        if-module="axelor-human-resource"/>
      <field name="manageTimeSpent" widget="inline-checkbox"
        onChange="action-project-record-manage-timespent-reset-values, action-attrs-project-show-log-time-panel"
        if="__config__.app.isApp('timesheet')"/>
      <field name="sprintManagementSelect" widget="RadioSelect"/>
    </panel>
    <panel name="taskConfigurationPanel" title="Task configuration" colSpan="12"
      canCollapse="true" collapseIf="false">
      <field name="taskStatusManagementSelect" widget="RadioSelect"
        readonlyIf="projectTaskList.length &gt; 0" colSpan="12"
        onChange="action-project-record-manage-task-status-set, action-project-record-activate-task-status-by-category"/>
      <field name="projectTaskStatusSet" widget="TagSelect"
        readonlyIf="projectTaskList.length &gt; 0" showIf="taskStatusManagementSelect == 2"
        requiredIf="taskStatusManagementSelect == 2" canEdit="false"
        onChange="action-project-method-manage-completed-task-status"/>
      <field name="completedTaskStatus" grid-view="task-status-grid"
        form-view="task-status-form" showIf="taskStatusManagementSelect == 2"
        requiredIf="taskStatusManagementSelect == 2"
        onSelect="action-project-attrs-set-completed-task-status-domain"/>
      <panel name="taskStatusManagementPanel" colSpan="12"
        showIf="projectTaskList.length &gt; 0 &amp;&amp; taskStatusManagementSelect == 2 &amp;&amp; !$readonly()">
        <field name="$statusToAddSet" type="many-to-many" widget="TagSelect"
          title="Status to add" onSelect="action-project-attrs-status-to-add-domain" colSpan="3"
          target="com.axelor.apps.project.db.TaskStatus" canNew="false"/>
        <button name="addStatusBtn"
          onClick="action-project-attrs-add-task-status,action-project-method-manage-completed-task-status"
          title="Add status" showIf="$statusToAddSet.length &gt; 0" colSpan="3"/>
        <field name="$statusToRemoveSet" type="many-to-many" widget="TagSelect"
          title="Status to remove" onSelect="action-project-attrs-status-to-remove-domain"
          colSpan="3" target="com.axelor.apps.project.db.TaskStatus" canNew="false"/>
        <button name="removeStatusBtn"
          onClick="save, action-project-method-remove-task-status" title="Remove status" colSpan="3"
          showIf="$statusToRemoveSet.length &gt; 0"/>
      </panel>
      <field name="isShowPriority" widget="inline-checkbox"
        onChange="action-project-record-priority-reset-values"/>
      <field name="projectTaskPrioritySet" widget="TagSelect" showIf="isShowPriority"
        requiredIf="isShowPriority" canEdit="false"/>
      <field name="isShowTaskCategory" widget="inline-checkbox"
        onChange="action-project-record-change-show-task-category, action-project-record-manage-task-status-set"
        canEdit="false"/>
      <field name="projectTaskCategorySet" widget="TagSelect" showIf="isShowTaskCategory"
        canEdit="false"
        requiredIf="taskStatusManagementSelect == 4 || enableStatusProgressByCategory"/>
      <field name="isShowProgress" widget="inline-checkbox"/>
      <field name="enableStatusProgressByCategory"
        if="__config__.app.getApp('project')?.selectAutoProgressOnProjectTask"
        showIf="isShowTaskCategory"/>
      <field name="projectTaskLinkTypeSet" colSpan="12" widget="TagSelect" canEdit="false"
        placeholder="All"/>
      <field name="projectTaskList" hidden="true"/>
    </panel>
    <panel title="View configuration" name="viewConfig" colSpan="12" canCollapse="true"
      collapseIf="false">
      <field name="isShowPlanning" colSpan="4" widget="inline-checkbox"
        if="__config__.app.isApp('employee') &amp;&amp; __config__.app.getApp('project')?.enablePlanification"/>
      <field name="isShowFrequency" colSpan="4" widget="inline-checkbox"/>
      <field name="isShowTopic" colSpan="4" widget="inline-checkbox"/>
      <field name="isShowGantt" colSpan="4" widget="inline-checkbox"/>
      <field name="isShowKanbanPerStatus" colSpan="4" widget="inline-checkbox"
        showIf="taskStatusManagementSelect != 1"/>
      <field name="isShowKanbanPerCategory" colSpan="4" widget="inline-checkbox"
        showIf="isShowTaskCategory"/>
      <field name="isShowCalendarPerStatus" colSpan="4" widget="inline-checkbox"/>
      <field name="isShowCalendarPerCategory" colSpan="4" widget="inline-checkbox"
        showIf="isShowTaskCategory"/>
      <field name="isShowCalendarPerUser" colSpan="4" widget="inline-checkbox"/>
    </panel>
    <panel-include view="incl-custom-fields-to-display-panel-form"/>
  </form>

  <form name="project-select-wizard-form" title="Select Projects"
    model="com.axelor.utils.db.Wizard">
    <panel name="mainPanel">
      <field name="projectSet" title="Projects" type="many-to-many" colSpan="12"
        target="com.axelor.apps.project.db.Project" canNew="false" canEdit="false"/>
      <button name="ganttBtn" title="Open gantt"
        onClick="action-wizard-validate-project-select,action-open-project-gantt,close" colSpan="3"/>
    </panel>
  </form>

  <form name="user-select-wizard-form" title="Select Users" model="com.axelor.utils.db.Wizard">
    <panel name="mainPanel">
      <field name="userSet" title="Users" type="many-to-many" colSpan="12"
        target="com.axelor.auth.db.User" canNew="false" canEdit="false"
        onSelect="action-project-gantt-user-wizard-user-domain"/>
      <button name="ganttBtn" title="Open gantt"
        onClick="action-wizard-validate-user-select,action-open-user-gantt,close" colSpan="3"/>
    </panel>
  </form>

  <form name="incl-custom-fields-to-display-panel-form" title="Project"
    model="com.axelor.apps.project.db.Project">
    <panel title="Custom fields" name="customFieldConfigPanel" canCollapse="true"
      collapseIf="false" colSpan="12">
      <field name="customFieldManagementSelect" widget="MultiSelect" placeholder="None"
        onChange="save"/>
      <panel-related field="taskCustomFieldsList" colSpan="12"
        showIf="$contains(customFieldManagementSelect, 'project')"
        form-view="project-task-meta-json-field-form" grid-view="project-meta-json-field-grid"/>
    </panel>
  </form>

  <form name="incl-checklist-panel-form" title="Check list"
    model="com.axelor.apps.project.db.Project">
    <panel name="templatePanel" title="Check list">
      <field name="$projectCheckListTemplate" title="Check list template" type="Many-to-one"
        target="com.axelor.apps.project.db.ProjectCheckListTemplate"
        domain="self.typeSelect = 'project'"/>
      <button name="generateCheckListItems" readonlyIf="!$projectCheckListTemplate"
        title="Generate check list" onClick="action-project-group-generate-checklist-items"/>
      <panel-related name="checkListPanel" colSpan="12" x-tree-limit="1"
        title="Check list" field="projectCheckListItemList" orderBy="sequence" canMove="true"
        onChange="action-check-list-item-method-reset-completed-fields"
        form-view="project-check-list-item-form" grid-view="project-check-list-item-grid"
        widget="tree-grid" x-tree-field="projectCheckListItemList"
        x-tree-field-title="Add a new check list item" editable="true" x-expand-all="true"/>
    </panel>
  </form>

  <form name="incl-project-roadmap-panel-form" title="Project"
    model="com.axelor.apps.project.db.Project">
    <panel title="Roadmap" name="roadmapPanel">
      <panel-related name="roadmapSetPanel" field="roadmapSet" colSpan="12"
        form-view="project-version-form" grid-view="project-version-grid"/>
      <panel name="sprintPanel" title="Sprints" colSpan="12"
        hideIf="sprintManagementSelect == 'none'">
        <panel itemSpan="12">
          <button name="generateBacklogSprintBtn" title="Generate a backlog sprint"
            onClick="action-project-method-generate-backlog-sprint" showIf="!backlogSprint"/>

          <field name="backlogSprint" grid-view="sprint-grid" form-view="sprint-form"
            showIf="backlogSprint" readonly="true"/>
        </panel>
        <button name="generateSprintsBtn" title="Generate sprints"
          showIf="sprintManagementSelect == 'project'"
          onClick="save,action-sprint-generator-project-view-wizard-mass-generate"/>
        <panel-dashlet name="sprintDashletPanel" title="Sprints" x-show-bars="true"
          colSpan="12" action="action-project-method-show-sprint-list" height="200%"
          canSearch="true" editable="true"
          canNew="id &amp;&amp; sprintManagementSelect == 'project'"
          canDelete="sprintManagementSelect == 'project'"/>
        <field name="sprintManagementSelect" hidden="true"/>
      </panel>
      <panel-dashlet action="action-project-method-tasks-per-sprint"
        name="tasksPerSprintPanel" colSpan="12" height="200%"/>
      <field name="sprintManagementSelect" hidden="true"/>
    </panel>
  </form>

  <kanban columnBy="projectStatus" sequenceBy="orderByState" limit="10" name="project-kanban"
    title="Projects" model="com.axelor.apps.project.db.Project"
    onMove="action-business-project-group-project-status-on-change">
    <field name="fullName"/>
    <field name="description"/>
    <field name="projectStatus"/>
    <field name="sequence"/>
    <template>
		<![CDATA[
	    <>
	    	<strong>{fullName}</strong>
	    	<Box dangerouslySetInnerHTML={{__html : description}}></Box>
	    </>
		]]>
    </template>
  </kanban>

  <kanban columnBy="projectStatus" sequenceBy="projectStatus" limit="10" name="task-kanban"
    title="Tasks" model="com.axelor.apps.project.db.Project">
    <field name="fullName"/>
    <field name="description"/>
    <field name="projectStatus"/>
    <field name="sequence"/>
    <template>
		<![CDATA[
	    <>
	    	<strong>{fullName}</strong>
	    	<Box dangerouslySetInnerHTML={{__html : description}}></Box>
	    </>
		]]>
    </template>
  </kanban>

  <tree name="project-project-task-tree" title="Tasks">

    <column name="name" type="string"/>
    <column name="taskDate" type="date"/>
    <column name="assignedTo" type="reference"/>
    <column name="openTaskBtn" type="button"/>

    <node model="com.axelor.apps.project.db.ProjectTask" domain="self.project.id = :_id"
      onClick="action-project-task-view-task" orderBy="taskDate">
      <field name="name" as="name"/>
      <field name="taskDate" as="taskDate"/>
      <field name="assignedTo" as="assignedTo"/>
      <field name="progress" as="progress"/>
      <button name="openTaskBtn" icon="fa-external-link"
        onClick="action-project-task-open-task"/>
    </node>

    <node model="com.axelor.apps.project.db.ProjectTask" parent="parentTask" draggable="true"
      onClick="action-project-task-view-task" orderBy="taskDate">
      <field name="name" as="name"/>
      <field name="taskDate" as="taskDate"/>
      <field name="assignedTo" as="assignedTo"/>
      <field name="progress" as="progress"/>
      <button name="openTaskBtn" icon="fa-external-link"
        onClick="action-project-task-open-task"/>
    </node>
  </tree>

  <tree name="project-phase-tree" title="Phases">

    <column name="name" type="string"/>
    <column name="assignedTo" type="reference"/>
    <column name="progress" type="integer"/>
    <column name="openTask" type="button"/>

    <node model="com.axelor.apps.project.db.Project" domain="self.parentProject.id = :id"
      onClick="action-project-view-phase">
      <field name="name" as="name"/>
      <field name="assignedTo" as="assignedTo"/>
      <button name="openTaskBtn" title="Open phase" onClick="action-project-view-phase"/>
    </node>

    <node model="com.axelor.apps.project.db.ProjectTask" parent="project" draggable="true"
      onClick="action-project-task-view-task">
      <field name="name" as="name"/>
      <field name="assignedTo" as="assignedTo"/>
      <field name="progress" as="progress"/>
      <button name="openTaskBtn" title="Open task" onClick="action-project-task-open-task"/>
    </node>
  </tree>

  <calendar name="project-calendar" title="Project Calendar"
    model="com.axelor.apps.project.db.Project" mode="month" colorBy="projectStatus"
    eventStart="fromDate" eventStop="toDate" eventLength="1">
    <field name="fullName"/>
  </calendar>

  <!-- ACTION GROUP -->

  <action-group name="action-project-on-load-group">
    <action name="action-project-attrs-on-new-load"/>
    <action name="action-project-method-task-status-management-selection-in"/>
    <action name="action-project-activity-dashboard-method-on-new"/>
    <action name="action-project-dashboard-method-on-new"/>
    <action name="action-attrs-project-show-log-time-panel"/>
  </action-group>

  <action-group name="action-project-group-on-new-project">
    <action name="action-project-defaults"/>
    <action name="action-project-record-status-new"/>
    <action name="action-project-attrs-on-new-load"/>
    <action name="action-project-method-task-status-management-selection-in"/>
  </action-group>

  <action-group name="action-project-group-on-save">
    <action name="action-project-method-check-resource-availibility"/>
    <action name="action-project-method-check-sprint-overlap"/>
  </action-group>

  <action-group name="action-project-group-finish-project">
    <action name="action-project-record-status-finish"/>
    <action name="save"/>
  </action-group>

  <action-group name="action-project-group-status-canceled">
    <action name="action-project-validate-canceled-status"/>
    <action name="action-project-record-status-canceled"/>
    <action name="save"/>
  </action-group>

  <action-group name="action-project-group-generate-checklist-items">
    <action name="action-project-validate-checklist-items"/>
    <action name="action-project-method-generate-checklist-items-from-template"/>
  </action-group>

  <!-- ACTION ATTRS -->

  <action-attrs name="action-task-attrs-assigned-to-domain">
    <attribute name="domain" for="assignedTo"
      expr="eval:&quot;self.id in (${(project?.membersUserSet?.collect{it->it.id}+[0,0]).join(',')}) &quot;"
      if="(typeSelect == 'task')&amp;&amp;(project?.membersUserSet)&amp;&amp;(!project.membersUserSet.isEmpty())"/>
  </action-attrs>

  <action-attrs name="action-attrs-project-set-project-type"
    model="com.axelor.apps.project.db.Project">
    <attribute name="readonly" for="isBusinessProject" expr="eval:_fromBusinessProject"/>
  </action-attrs>

  <action-attrs name="action-business-support-attrs-project-default">
    <attribute name="hidden" for="project" expr="eval:true"
      if="_parent &amp;&amp; (_parent?._model == 'com.axelor.apps.project.db.Project' || _parent?._model == 'com.axelor.apps.project.db.ProjectTemplate')"/>
  </action-attrs>

  <action-attrs name="action-project-gantt-user-wizard-user-domain">
    <attribute name="domain"
      expr="eval:&quot;self.id in (${([0]+__repo__(Project).all().fetch().collect{it->it.membersUserSet.id}.flatten()).join(',')})&quot;"
      for="userSet"/>
  </action-attrs>

  <action-attrs name="action-project-attrs-on-new-load">
    <attribute name="selection-in" for="projectStatus"
      expr="eval: __repo__(ProjectStatus).all()?.fetch()?.collect{it.id}?.join(',')"/>
    <attribute name="scale" for="price"
      expr="eval: __config__.app.getNbDecimalDigitForUnitPrice()"/>
  </action-attrs>

  <action-attrs name="action-project-defaults"
    model="com.axelor.apps.project.db.Project">
    <attribute name="value" for="company" expr="eval:__user__.activeCompany"/>
    <attribute name="value" for="fromDate" expr="eval: __datetime__"/>
    <attribute name="value" for="assignedTo" expr="eval: __user__"/>
    <attribute name="value:add" for="membersUserSet" expr="eval: __user__"/>
    <attribute name="value" for="isBusinessProject" expr="eval:_fromBusinessProject"/>
    <attribute name="value" for="parentProject"
      expr="eval:__repo__(Project).find(_parentProjectId)" if="_parentProjectId != null"/>
    <attribute name="value" for="siteSet"
      expr="eval: __config__.app.getApp('base')?.defaultSitesSet"
      if="__config__.app.getApp('base')?.enableSiteManagementForProject"/>
    <attribute name="value" for="numberHoursADay"
      expr="eval: __config__.app.getApp('base')?.dailyWorkHours"/>
    <attribute name="value" for="projectTimeUnit"
      expr="eval: __config__.app.getApp('base')?.unitDays"/>
  </action-attrs>

  <action-attrs name="action-project-attrs-set-completed-task-status-domain">
    <attribute name="domain" for="completedTaskStatus"
      expr="eval: 'self.isCompleted = true AND self.id IN (' + projectTaskStatusSet?.collect{ it.id }?.join(',') + ')'"
      if="projectTaskStatusSet?.collect{it.id}?.size &gt; 0"/>
    <attribute name="domain" for="completedTaskStatus" expr="eval: 'self.id = 0'"
      if="projectTaskStatusSet?.collect{it.id}?.size == 0"/>
  </action-attrs>

  <action-attrs name="action-project-attrs-set-parent-project-domain"
    model="com.axelor.apps.project.db.Project">
    <attribute name="domain" for="parentProject" expr="eval:&quot;self.id != :id&quot;"
      if="id != null"/>
  </action-attrs>

  <action-attrs name="action-attrs-project-add-member"
    model="com.axelor.apps.project.db.Project">
    <attribute name="value:add" for="membersUserSet" expr="eval: assignedTo"/>
  </action-attrs>

  <action-attrs name="action-attrs-project-show-log-time-panel">
    <attribute for="logTimesPanel" name="hidden" expr="eval: !manageTimeSpent"/>
  </action-attrs>


  <action-attrs name="action-project-attrs-set-time-unit-domain">
    <attribute name="domain" for="projectTimeUnit"
      expr="eval: &quot; self.id = ${__config__.app.getApp('base')?.unitDays?.id} OR self.id = ${__config__.app.getApp('base')?.unitHours?.id}&quot;"/>
  </action-attrs>

  <action-attrs name="action-project-attrs-status-to-add-domain">
    <attribute for="$statusToAddSet" name="domain"
      expr="eval: &quot; self.id NOT IN (${(projectTaskStatusSet?.collect{it.id}+[0]).join(',')}) &quot;"/>
  </action-attrs>

  <action-attrs name="action-project-attrs-status-to-remove-domain">
    <attribute for="$statusToRemoveSet" name="domain"
      expr="eval: &quot; self.id IN (${(projectTaskStatusSet?.collect{it.id}+[0]).join(',')}) &quot;"/>
  </action-attrs>

  <action-attrs name="action-project-attrs-add-task-status">
    <attribute for="projectTaskStatusSet" name="value"
      expr="eval: projectTaskStatusSet+statusToAddSet"/>
    <attribute for="$statusToAddSet" name="value" expr="eval: null"/>
  </action-attrs>

  <!-- ACTION RECORD -->

  <action-record name="action-project-record-bind-customer-project"
    model="com.axelor.apps.project.db.Project">
    <field name="clientPartner" expr="eval: project?.clientPartner"/>
  </action-record>

  <action-record name="action-project-record-bind-customer-parent"
    model="com.axelor.apps.project.db.Project">
    <field name="clientPartner" expr="eval: __parent__?.clientPartner"/>
  </action-record>

  <action-record name="action-project-record-manage-timespent-reset-values"
    model="com.axelor.apps.project.db.Project">
    <field name="isInvoicingTimesheet" expr="eval: false" if="!manageTimeSpent"/>
  </action-record>

  <action-record name="action-project-record-status-new"
    model="com.axelor.apps.project.db.Project">
    <field name="projectStatus"
      expr="eval: __repo__(ProjectStatus).all().order('sequence').fetchOne()"/>
    <field name="projectTaskStatusSet"
      expr="eval: __config__.app.getApp('project')?.getDefaultTaskStatusSet()"/>
    <field name="projectTaskPrioritySet"
      expr="eval: __config__.app.getApp('project')?.getDefaultPrioritySet()"/>
    <field name="completedTaskStatus"
      expr="eval: __config__.app.getApp('project')?.completedTaskStatus"/>
  </action-record>

  <action-record name="action-project-record-priority-reset-values"
    model="com.axelor.apps.project.db.Project">
    <field name="projectTaskPrioritySet" expr="eval: null" if="!isShowPriority"/>
  </action-record>

  <action-record name="action-project-record-change-show-task-category"
    model="com.axelor.apps.project.db.Project">
    <field name="projectTaskCategorySet" expr="eval: null" if="!isShowTaskCategory"/>
    <field name="isShowKanbanPerCategory" expr="eval: false" if="!isShowTaskCategory"/>
    <field name="isShowCalendarPerCategory" expr="eval: false" if="!isShowTaskCategory"/>
    <field name="taskStatusManagementSelect" expr="2"
      if="!isShowTaskCategory &amp;&amp; taskStatusManagementSelect == 4"/>
  </action-record>

  <action-record name="action-project-record-status-finish"
    model="com.axelor.apps.project.db.Project">
    <field name="projectStatus"
      expr="eval:__config__.app.getApp('project')?.completedProjectStatus"/>
  </action-record>

  <action-record name="action-project-record-status-canceled"
    model="com.axelor.apps.project.db.Project">
    <field name="projectStatus"
      expr="eval: __config__.app.getApp('project')?.canceledProjectStatus"/>
  </action-record>

  <action-record name="action-project-record-manage-task-status-set"
    model="com.axelor.apps.project.db.Project">
    <field name="projectTaskStatusSet"
      expr="eval: __config__.app.getApp('project')?.getDefaultTaskStatusSet()"
      if="taskStatusManagementSelect == 2"/>
    <field name="completedTaskStatus"
      expr="eval: __config__.app.getApp('project')?.getCompletedTaskStatus()"
      if="taskStatusManagementSelect == 2"/>
    <field name="projectTaskStatusSet,completedTaskStatus" expr="eval: null"
      if="taskStatusManagementSelect == 1 || taskStatusManagementSelect == 4"/>
  </action-record>

  <action-record name="action-project-record-activate-task-status-by-category"
    model="com.axelor.apps.project.db.Project">
    <field name="isShowTaskCategory" expr="eval: true" if="taskStatusManagementSelect == 4"/>
  </action-record>

  <!-- ACTION METHOD -->

  <action-method name="action-project-view-show-related-tasks">
    <call class="com.axelor.apps.project.web.ProjectMenuController"
      method="allProjectRelatedTasks"/>
  </action-method>

  <action-method name="action-project-method-check-resource-availibility">
    <call class="com.axelor.apps.project.web.ProjectController" method="checkIfResourceBooked"/>
  </action-method>

  <action-method name="action-project-method-my-open-tasks">
    <call class="com.axelor.apps.project.web.ProjectController" method="getMyOpenTasks"/>
  </action-method>

  <action-method name="action-project-method-my-tasks">
    <call class="com.axelor.apps.project.web.ProjectController" method="getMyTasks"/>
  </action-method>

  <action-method name="action-project-method-all-open-tasks">
    <call class="com.axelor.apps.project.web.ProjectController" method="getAllOpenTasks"/>
  </action-method>

  <action-method name="action-project-method-all-tasks">
    <call class="com.axelor.apps.project.web.ProjectController" method="getAllTasks"/>
  </action-method>

  <action-method name="action-project-method-view-per-status-kanban">
    <call class="com.axelor.apps.project.web.ProjectController" method="perStatusKanban"/>
  </action-method>

  <action-method name="action-project-method-import-members">
    <call class="com.axelor.apps.project.web.ProjectController" method="importMembers"/>
  </action-method>

  <action-method name="action-project-method-manage-completed-task-status">
    <call class="com.axelor.apps.project.web.ProjectController"
      method="manageCompletedTaskStatus"/>
  </action-method>

  <action-method name="action-project-method-task-status-management-selection-in">
    <call class="com.axelor.apps.project.web.ProjectController"
      method="taskStatusManagementSelectionIn"/>
  </action-method>

  <action-method name="action-project-method-generate-checklist-items-from-template">
    <call class="com.axelor.apps.project.web.ProjectController"
      method="generateCheckListFromTemplate"/>
  </action-method>

  <action-method name="action-project-method-generate-backlog-sprint">
    <call class="com.axelor.apps.project.web.ProjectController" method="generateBacklogSprint"/>
  </action-method>

  <action-method name="action-project-method-remove-task-status">
    <call class="com.axelor.apps.project.web.ProjectController" method="removeTaskStatus"/>
  </action-method>

  <action-method name="action-project-method-tasks-per-sprint">
    <call class="com.axelor.apps.project.web.ProjectMenuController" method="viewTasksPerSprint"/>
  </action-method>

  <action-method name="action-project-method-check-sprint-overlap">
    <call class="com.axelor.apps.project.web.ProjectController" method="checkSprintOverlap"/>
  </action-method>

  <action-method name="action-project-method-show-sprint-list">
    <call class="com.axelor.apps.project.web.ProjectMenuController" method="viewSprints"/>
  </action-method>

  <!-- ACTION VIEW -->

  <action-view name="action-project-open-popup-select-users" title="Select Users"
    model="com.axelor.utils.db.Wizard">
    <view type="form" name="user-select-wizard-form"/>
    <view-param name="show-toolbar" value="false"/>
    <view-param name="show-confirm" value="false"/>
    <view-param name="popup-save" value="false"/>
  </action-view>

  <action-view name="action-project-open-popup-select-projects" title="Select Projects"
    model="com.axelor.utils.db.Wizard">
    <view type="form" name="project-select-wizard-form"/>
    <view-param name="show-toolbar" value="false"/>
    <view-param name="show-confirm" value="false"/>
    <view-param name="popup-save" value="false"/>
  </action-view>

  <action-view name="action-open-project-gantt" title="Project Gantt"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="gantt" name="project-task-gantt"/>
    <view type="grid" name="project-task-grid"/>
    <view type="form" name="project-task-form"/>
    <view-param name="details-view" value="true"/>
    <domain>self.project.id IN (:_projectIds) OR self.project.parentProject.id IN (:_projectIds)</domain>
    <context name="_projectIds" expr="eval: projectSet.collect{it.id}"/>
  </action-view>

  <action-view name="action-open-user-gantt" title="User Gantt"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="gantt" name="user-task-gantt"/>
    <view type="grid" name="project-task-grid"/>
    <view type="form" name="project-task-form"/>
    <view-param name="details-view" value="true"/>
    <domain>self.assignedTo.id IN (:_userIds) </domain>
    <context name="_userIds" expr="eval: userSet.collect{it.id}"/>
  </action-view>

  <action-view name="action-project-view-add-subtask"
    model="com.axelor.apps.project.db.ProjectTask" title="Task">
    <view name="project-task-form" type="form"/>
    <view name="project-task-grid" type="grid"/>
    <view-param name="details-view" value="true"/>
    <view-param name="popup" value="reload"/>
    <view-param name="popup-save" value="true"/>
    <view-param name="show-confirm" value="true"/>
    <view-param name="show-toolbar" value="false"/>
    <context name="_project" expr="eval:__this__.project"/>
    <context name="_parentTask" expr="eval:__this__"/>
    <context name="_typeSelect"
      expr="eval: com.axelor.apps.project.db.repo.ProjectTaskRepository.TYPE_TASK"/>
  </action-view>

  <action-view name="action-project-open-gantt" title="Gantt"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="gantt" name="task-gantt"/>
    <view type="grid" name="project-task-grid"/>
    <view type="form" name="project-task-form"/>
    <view-param name="details-view" value="true"/>
    <domain>self.project.id = :_id OR self.project.parentProject.id = :_id</domain>
    <context name="_project" expr="eval:__this__"/>
  </action-view>

  <action-view name="action-project-book-resource" title="Book resource"
    model="com.axelor.apps.project.db.ResourceBooking">
    <view type="form" name="resource-booking-form"/>
    <view type="grid" name="resource-booking-grid"/>
    <view type="calendar" name="resource-booking-calendar"/>
    <context name="_project" expr="eval:__self__"/>
  </action-view>

  <action-view name="project.wiki.all" title="Wikis (${name})"
    model="com.axelor.apps.project.db.Wiki">
    <view type="grid" name="wiki-grid"/>
    <view type="form" name="wiki-form"/>
    <domain>self.project = :_project</domain>
    <context name="_project" expr="eval: __this__"/>
  </action-view>

  <action-view name="project.topic.all" title="Topics (${name})"
    model="com.axelor.apps.project.db.Topic">
    <view type="grid" name="topic-grid"/>
    <view type="form" name="topic-form"/>
    <view-param name="search-filters" value="project-topic-filters"/>
    <domain>self.project = :_project AND self.isClosed = false</domain>
    <context name="_project" expr="eval: __this__"/>
    <context name="userId" expr="eval: __user__.id"/>
  </action-view>

  <action-view name="action-project-add-task"
    model="com.axelor.apps.project.db.ProjectTask" title="Task">
    <view name="project-task-form" type="form"/>
    <view name="project-task-grid" type="grid"/>
    <view-param name="details-view" value="true"/>
    <view-param name="popup" value="reload"/>
    <view-param name="popup-save" value="true"/>
    <view-param name="show-confirm" value="true"/>
    <view-param name="show-toolbar" value="false"/>
    <context name="_project" expr="eval:__parent__"/>
    <context name="_typeSelect"
      expr="eval: com.axelor.apps.project.db.repo.ProjectTaskRepository.TYPE_TASK"/>
  </action-view>

  <action-view name="action-view-show-project-task-tree" title="Project Task Tree"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="tree" name="project-project-task-tree"/>
    <view type="form" name="project-task-form"/>
    <domain>self.project.id = :_id AND self.parentTask = null</domain>
    <context name="_id" expr="eval: id"/>
  </action-view>

  <action-view name="action-project-view-show-project-task" title="Project Tasks"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="grid" name="project-task-project-grid"/>
    <view type="form" name="project-task-form"/>
    <domain>self.project.id = :_id</domain>
    <context name="_id" expr="eval: id"/>
  </action-view>

  <!-- ACTION VALIDATE -->

  <action-validate name="action-wizard-validate-user-select">
    <error message="Please select user" if="eval: userSet == null || userSet  == 0"/>
  </action-validate>

  <action-validate name="action-wizard-validate-project-select">
    <error message="Please select project" if="eval: projectSet == null || projectSet  == 0"/>
  </action-validate>

  <action-validate name="action-project-task-validate-delete-team-task-confirmation">
    <alert message="Are you sure you want to delete this task ?"/>
  </action-validate>

  <action-validate name="action-project-validate-canceled-status">
    <error message="Please fill canceled project status in App Project configuration."
      if="!__config__.app.getApp('project')?.canceledProjectStatus"/>
  </action-validate>

  <action-validate name="action-project-validate-checklist-items">
    <alert message="Your current check list will be erased, do you want to continue ?"
      if="projectCheckListItemList &amp;&amp; !projectCheckListItemList.isEmpty()"/>
  </action-validate>


  <search-filters name="project-project-filters"
    model="com.axelor.apps.project.db.Project" title="Project filters">
    <field name="company" hidden="true"
      if="!__config__.app.getApp('base')?.getEnableMultiCompany()"/>
    <field name="resourceBookingList" hidden="true"
      if="!__config__.app.getApp('project')?.resourceManagement"/>
    <field name="totalPlannedHrs" hidden="true" if="!__config__.app.isApp('employee')"/>
    <field name="productSet" hidden="true" if="!__config__.app.isApp('employee')"/>
  </search-filters>

  <search-filters name="project-topic-filters"
    model="com.axelor.apps.project.db.Topic" title="Topics">
    <filter name="project-topic-filters-my-topics" title="My topics">
      <domain>self.createdBy.id = :userId</domain>
    </filter>
    <filter name="project-topic-filters-new-topics" title="New topics">
      <domain>self.createdOn &gt; date(now())</domain>
    </filter>
  </search-filters>

  <search-filters name="project-filters" model="com.axelor.apps.project.db.Project"
    title="Project filters">
    <field name="company" hidden="true"
      if="!__config__.app.getApp('base')?.getEnableMultiCompany()"/>
    <field name="resourceBookingList" hidden="true"
      if="!__config__.app.getApp('project')?.resourceManagement"/>
    <field name="productionOrderList" hidden="true"
      if="!(__config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getShowProductionOrderRelatedToProject())"/>
    <field name="clientPartner" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="currency" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="priceList" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="contactPartner" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="customerAddress" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="totalPlannedHrs" hidden="true" if="!__config__.app.isApp('employee')"/>
    <field name="toInvoice" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="isInvoicingTimesheet" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="isInvoicingExpenses" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="isInvoicingPurchases" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="invoicingSequenceSelect" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="consolidatePhaseWhenInvoicing" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="invoicingComment" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="manualElementList" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="roadmapSet" hidden="true" if="!__config__.app.isApp('business-support')"/>
    <field name="announcementList" hidden="true"
      if="!__config__.app.isApp('business-support')"/>
    <field name="productSet" hidden="true" if="!__config__.app.isApp('employee')"/>
    <field name="isBusinessProject" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
  </search-filters>
</object-views>
