<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_7.2.xsd">

  <grid name="project-task-grid" title="Tasks" model="com.axelor.apps.project.db.ProjectTask"
    edit-icon="true" orderBy="-priority.technicalTypeSelect">
    <toolbar>
      <button name="logTimeBtn" icon="clock-history"
        onClick="action-timesheet-line-method-log-time" if="__config__.app.isApp('timesheet')"/>
    </toolbar>
    <hilite if="$get('status.id') == $get('project.completedTaskStatus.id')" color="success"/>
    <hilite if="$moment(taskEndDate).diff(todayDate,'days') &lt; 0" color="danger"/>
    <hilite if="$get('priority.technicalTypeSelect') == 4" color="warning"/>
    <field name="ticketNumber"
      if="__config__.app.getApp('project')?.getIsEnablePerProjectTaskSequence()"/>
    <field name="name"/>
    <field name="project"/>
    <field name="taskDate"/>
    <field name="status"/>
    <field name="priority"/>
    <field name="projectTaskCategory"/>
    <field name="taskEndDate" hidden="true"/>
    <field name="priority.technicalTypeSelect" hidden="true"/>
    <field name="project.completedTaskStatus.id" hidden="true"/>
  </grid>

  <grid name="project-task-project-grid" title="Tasks"
    model="com.axelor.apps.project.db.ProjectTask" edit-icon="true"
    orderBy="-priority.technicalTypeSelect">
    <toolbar>
      <button name="newLineBtn" title="New line" icon="fa-plus"
        onClick="action-project-add-task"/>
      <button name="removeLineBtn" title="Remove lines" icon="fa-trash"
        onClick="action-project-task-validate-delete-team-task-confirmation, action-project-task-method-delete-project-tasks"/>
      <button name="allTaskBtn" title="All tasks" colSpan="2" css="btn-custom text-left"
        icon="fa-tasks" onClick="save,action-project-view-show-related-tasks"/>
    </toolbar>
    <hilite if="$get('priority.technicalTypeSelect') == 1" color="grey"/>
    <hilite if="$get('priority.technicalTypeSelect') == 3" color="warning"/>
    <hilite if="$get('priority.technicalTypeSelect') == 4" color="danger"/>
    <field name="ticketNumber"
      if="__config__.app.getApp('project')?.getIsEnablePerProjectTaskSequence()" width="200"/>
    <field name="name" width="680"/>
    <field name="projectTaskCategory" width="200"/>
    <field name="taskDate" width="100"/>
    <field name="status" width="100"/>
    <field name="priority.technicalTypeSelect" hidden="true"/>
    <button name="createSubtaskBtn" icon="fa-plus"
      onClick="save, action-project-view-add-subtask"/>
    <button name="deleteTaskBtn" icon="fa-times-circle"
      onClick="action-project-task-validate-delete-team-task-confirmation, action-project-task-method-delete-project-task"/>
  </grid>

  <form name="project-task-form" title="Task" model="com.axelor.apps.project.db.ProjectTask"
    onNew="action-project-task-group-onnew" onLoad="action-project-task-group-timer-process"
    width="large">
    <toolbar>
      <button name="grabEventBtn" icon="fa-suitcase" help="Take charge"
        onClick="action-project-task-record-assigned-yourself,save"/>
      <button name="doneBtn" icon="fa-check" onClick="action-project-task-group-click-done"
        showIf="project.taskStatusManagementSelect != 1"/>
    </toolbar>
    <menubar>
      <menu name="projectTaskMenu" title="Tools"
        if="__config__.app.getApp('project')?.resourceManagement">
        <item name="bookResourceItem" title="Book resource"
          action="save,action-project-task-book-resource"
          if="__config__.app.getApp('project')?.resourceManagement"/>
      </menu>
    </menubar>

    <panel showIf="nextProjectTask">
      <field name="doApplyToAllNextTasks" widget="InlineCheckbox" colSpan="12"/>
      <field name="project.isShowPlanning" hidden="true"/>
    </panel>

    <panel name="mainPanel" colSpan="12">
      <panel name="statusPanel" stacked="true" colSpan="6">
        <field name="status" widget="NavSelect" showTitle="false"
          hideIf="project.taskStatusManagementSelect == 1 || (project.taskStatusManagementSelect == 4 &amp;&amp; !projectTaskCategory)"
          x-order="sequence" onChange="action-project-task-method-auto-change-progress"/>
        <field name="typeSelect" hidden="true"/>
        <field name="project.isShowPlanning" hidden="true"/>

      </panel>
      <field name="$provider" hidden="true" type="string"/>
      <panel name="projectDetailsPanel" colSpan="12">
        <panel name="detailsPanel" colSpan="8">
          <field name="fullName" showTitle="false" colSpan="12">
            <viewer depends="name">
              <![CDATA[
							<>
								<h3>
									<span>{name}</span>
								</h3>
							</>
						]]>
            </viewer>
            <editor>
              <field name="name" title="Subject" colSpan="12" css="label-bold bold large"
                required="true"/>
            </editor>
          </field>
        </panel>
      </panel>
    </panel>
    <panel-tabs name="mainPanelTab">
      <panel-include view="incl-overview-project-task-panel-form"/>

      <panel name="timeSpentPanel" title="Time Spent" if-module="axelor-human-resource"
        if="__config__.app.isApp('timesheet')" showIf="project.manageTimeSpent">
        <panel-include view="incl-log-times-projec-task-panel-form"/>
        <field name="project.manageTimeSpent" hidden="true"/>
      </panel>

      <panel name="timeFollowUpPanel" title="Time follow-up">
        <panel-include view="incl-time-follow-task-panel-form"/>
      </panel>

      <panel name="taskPanel" title="Tasks" colSpan="12" showIf="id">
        <panel-dashlet name="taskTreePanel" title="Task Tree" colSpan="12"
          action="action-view-show-task-tree" canSearch="true" height="200%"/>
        <panel-related name="finishToStartSetPanel" field="finishToStartSet"
          colSpan="12">
          <field name="name"/>
        </panel-related>
        <panel-include view="incl-frequency-panel-task-form"/>
      </panel>


      <panel-include view="incl-checklist-task-panel-form"/>

      <panel-include view="incl-links-panel-form"/>
    </panel-tabs>

    <panel-mail name="mailPanel">
      <mail-messages/>
      <mail-followers/>
    </panel-mail>
  </form>


  <form name="incl-overview-project-task-panel-form" title="Overview"
    model="com.axelor.apps.project.db.ProjectTask">
    <panel name="overviewPanel" title="Overview">
      <field name="ticketNumber"
        if="__config__.app.getApp('project')?.isEnablePerProjectTaskSequence"/>
      <field name="project" colSpan="6" onChange="action-project-task-group-project-onchange"
        domain="self.projectStatus.isCompleted = false" required="true" form-view="project-form"
        grid-view="project-grid"/>
      <field name="parentTask" readonlyIf="project == null" colSpan="6"
        form-view="project-task-form" grid-view="project-task-grid"
        onChange="action-project-task-record-get-parent-timeunit"
        onSelect="action-project-task-attrs-project-parent-task-configurations"/>
      <field name="assignedTo" readonlyIf="project == null" colSpan="6" canNew="false"
        canView="false" canEdit="false"
        onSelect="action-project-task-attrs-project-assigned-to-configurations" required="true"
        form-view="user-form" grid-view="user-grid"
        onChange="action-project-task-attrs-hide-time-spent-button"/>
      <field name="site" onSelect="action-project-task-attrs-set-site-domain"
        form-view="site-form" grid-view="site-grid"
        if="__config__.app.getApp('base')?.enableSiteManagementForProject"/>

      <panel name="characteristicsPanel" title="Characteristics" colSpan="12"
        collapseIf="false" canCollapse="true">
        <panel-include view="incl-characteristics-panel-form"/>
        <field name="description" colSpan="12" widget="html"/>
      </panel>
      <panel-include view="incl-customized-field-panel-form"/>
    </panel>
  </form>

  <form name="incl-log-times-projec-task-panel-form" title="Project task"
    model="com.axelor.apps.project.db.ProjectTask">
    <panel title="Log Times" name="logTimesPanel" showTitle="false" colSpan="12" itemSpan="12">
      <panel-dashlet name="validatedTimesheetLinesPanel" x-show-bars="true"
        action="action-project-task-dashlet-validated-timesheet-lines"
        title="Validated Timesheet lines" colSpan="12" canSearch="true"
        if="__config__.app.getApp('timesheet')?.needValidation"/>
      <panel-dashlet name="waitingTimesheetLinesPanel" x-show-bars="true"
        action="action-project-task-dashlet-waiting-timesheet-lines" title="Waiting Timesheet lines"
        colSpan="12" canSearch="true" if="__config__.app.getApp('timesheet')?.needValidation"/>
      <panel-dashlet name="allTimesheetLinesPanel" x-show-bars="true"
        action="action-project-task-dashlet-all-timesheet-lines" title="TimesheetLine.timeSpent"
        colSpan="12" canSearch="true" if="!__config__.app.getApp('timesheet')?.needValidation"/>
      <field name="project.manageTimeSpent" hidden="true"/>
    </panel>
  </form>

  <form name="incl-characteristics-panel-form" title="Characteristics"
    model="com.axelor.apps.project.db.ProjectTask">
    <panel name="mainPanel" colSpan="12">
      <field name="projectTaskCategory" colSpan="4" showIf="project.isShowTaskCategory"
        requiredIf="project.isShowTaskCategory &amp;&amp; project.taskStatusManagementSelect == 4"
        onSelect="action-project-task-attrs-project-task-category-configurations"
        onChange="action-project-task-group-project-category-onchange"/>
      <field name="priority" colSpan="4" showIf="project.isShowPriority"
        onSelect="action-project-task-atts-priority-on-select" requiredIf="project.isShowPriority"
        canView="false"/>
      <field name="taskDate" colSpan="4"
        onChange="action-project-task-attrs-set-task-duration,action-project-task-record-set-date-or-frequency-changed"
        required="true"/>
      <field name="taskEndDate" colSpan="4"
        onChange="action-project-task-attrs-set-task-duration"/>
      <field name="taskDeadline" title="Task deadline" colSpan="4"/>
      <field name="tagSet" widget="TagSelect" x-color-field="color" form-view="tag-form"
        grid-view="tag-simplified-grid" colSpan="4"
        onSelect="action-project-task-method-set-tag-domain"/>
      <field name="progress" onChange="action-project-task-group-progress-onchange"
        showIf="project.isShowProgress" colSpan="4" min="0" max="100" widget="Slider" x-step="1"
        x-scale="0"/>
      <field name="targetVersion" domain=":project member of self.projectSet" colSpan="4"
        form-view="project-version-form" grid-view="project-version-grid"/>
      <field name="activeSprint"
        showIf="project.sprintManagementSelect == 'project' || (project.sprintManagementSelect == 'version' &amp;&amp; targetVersion)"
        onSelect="action-project-task-method-compute-sprint-domain" colSpan="4"
        form-view="sprint-form" grid-view="sprint-grid"/>
      <field name="project.isShowProgress" hidden="true"/>
      <field name="project.isShowStatus" hidden="true"/>
      <field name="project.isShowPriority" hidden="true"/>
      <field name="project.isShowTaskCategory" hidden="true"/>
      <field name="project.taskStatusManagementSelect" hidden="true"/>
      <field name="project.sprintManagementSelect" hidden="true"/>
      <field name="oldActiveSprint" hidden="true"/>
    </panel>
  </form>

  <form name="incl-frequency-panel-task-form" title="Frequency"
    model="com.axelor.apps.project.db.ProjectTask">
    <panel name="frequencyPanel" title="Frequency" showIf="project.isShowFrequency"
      canCollapse="true" collapseIf="false">
      <field name="frequency"
        onChange="action-project-task-record-set-date-or-frequency-changed" domain="1 &lt;&gt; 1"
        canNew="true" grid-view="frequency-grid" form-view="frequency-form"/>
      <field name="nextProjectTask" hidden="true" showIf="nextProjectTask"/>
      <field name="isFirst" hidden="true"/>
      <field name="doUpdateNextTasks" hidden="true"/>
      <field name="hasDateOrFrequencyChanged" hidden="true"/>
      <field name="project.isShowFrequency" hidden="true"/>
    </panel>
  </form>

  <form name="incl-links-panel-form" title="Manage relations"
    model="com.axelor.apps.project.db.ProjectTask">
    <panel name="linkTaskPanel" title="Manage relations">
      <field name="$projectTaskLinkType" title="Project task link type" type="Many-to-one"
        target="com.axelor.apps.project.db.ProjectTaskLinkType" colSpan="3"
        onSelect="action-project-task-method-set-link-type-domain"/>
      <field name="$projectTask" title="Project task to link" type="Many-to-one"
        target="com.axelor.apps.project.db.ProjectTask" colSpan="3"
        onSelect="action-project-task-method-set-task-domain"/>
      <field name="$projectTask.project" colSpan="3" readonly="true" type="Many-to-one"
        target="com.axelor.apps.project.db.Project"/>
      <button name="generateNewLink" readonlyIf="!$projectTaskLinkType || !$projectTask"
        title="Generate a new link" onClick="save, action-project-task-method-generate-new-link"
        colSpan="3"/>
      <panel-related field="projectTaskLinkList" colSpan="12" readonly="true"
        grid-view="project-task-link-grid" form-view="project-task-link-form"/>
    </panel>
  </form>

  <form name="incl-customized-field-panel-form" title="Customized fields"
    model="com.axelor.apps.project.db.ProjectTask">
    <panel name="customizedFieldsPanel" title="Customized fields" collapseIf="true"
      canCollapse="true" colSpan="12">
      <panel name="appJsonPanel" colSpan="12"
        showIf="$contains(project.customFieldManagementSelect, 'app')" title="App customized fields">
        <field name="appJson" colSpan="12"/>
      </panel>
      <panel name="projectJsonPanel" colSpan="12"
        showIf="$contains(project.customFieldManagementSelect, 'project')"
        title="Project customized fields">
        <field name="projectJson" colSpan="12"/>
      </panel>
      <panel name="categoryJsonPanel" colSpan="12"
        showIf="projectTaskCategory &amp;&amp; $contains(project.customFieldManagementSelect, 'category')"
        title="Category customized fields">
        <field name="categoryJson" colSpan="12"/>
      </panel>
      <panel name="otherFieldsPanel" title="Other customized fields" colSpan="12">
        <field name="attrs" colSpan="12"/>
      </panel>
      <field name="project.customFieldManagementSelect" hidden="true"/>
    </panel>
  </form>

  <form name="incl-checklist-task-panel-form" title="Check list"
    model="com.axelor.apps.project.db.ProjectTask">
    <panel name="templatePanel" title="Check list" colSpan="12">
      <field name="$projectCheckListTemplate" title="Check list template" type="Many-to-one"
        target="com.axelor.apps.project.db.ProjectCheckListTemplate"
        domain="self.typeSelect = 'task'"/>
      <button name="generateCheckListItems" readonlyIf="!$projectCheckListTemplate"
        title="Generate check list" onClick="action-project-task-group-generate-checklist-items"/>
      <panel-related name="checkListItemListPanel" colSpan="12" x-tree-limit="1"
        title="Check list" field="projectCheckListItemList" orderBy="sequence" canMove="true"
        onChange="action-check-list-item-method-reset-completed-fields"
        form-view="project-check-list-item-form" grid-view="project-check-list-item-grid"
        widget="tree-grid" x-tree-field="projectCheckListItemList"
        x-tree-field-title="Add a new check list item" editable="true"/>
    </panel>
  </form>

  <form name="incl-time-follow-task-panel-form" title="Time follow up"
    model="com.axelor.apps.project.db.ProjectTask">
    <panel name="timesPanel" colSpan="12">
      <field name="timeUnit" colSpan="4" readonlyIf="saleOrderLine || parentTask"
        onSelect="action-project-task-attrs-set-time-unit-domain"
        onChange="action-project-task-method-update-budgeted-time, save"/>
      <field name="budgetedTime" colSpan="4"/>
      <field name="plannedTime" readonly="true" colSpan="4"/>
      <field name="spentTime" readonly="true" colSpan="4"/>
    </panel>
    <panel name="timerPanel" title="Timer" showIf="id" colSpan="12"
      if-module="axelor-helpdesk" if="__config__.app.isApp('helpdesk')" canCollapse="true"
      collapseIf="false">
      <panel name="actionsPanel" title="Actions">
        <button name="startTimerBtn" title="Start" icon="fa-play" colSpan="12" hidden="true"
          onClick="action-project-task-method-start-timer"/>
        <button name="stopTimerBtn" title="Stop" icon="fa-pause" colSpan="12" hidden="true"
          onClick="action-project-task-method-stop-timer"/>
        <button name="cancelTimerBtn" title="Cancel" icon="fa-times-circle" colSpan="12"
          hidden="true" onClick="action-project-task-method-cancel-timer"/>
      </panel>
      <panel name="durationPanel">
        <field name="$_totalTimerDuration" type="decimal" readonly="true"
          title="Total duration (Hours)" colSpan="12"/>
      </panel>
    </panel>
  </form>

  <gantt name="task-gantt" title="Tasks" model="com.axelor.apps.project.db.ProjectTask"
    taskStart="taskDate" taskEnd="taskEndDate" taskDuration="durationHours" taskParent="parentTask"
    taskSequence="sequence" taskProgress="plannedProgress" x-start-to-start="startToStartSet"
    x-finish-to-start="finishToStartSet" x-finish-to-finish="finishToFinishSet"
    taskUser="assignedTo">
    <field name="name"/>
  </gantt>

  <gantt name="project-task-gantt" title="Project Task"
    model="com.axelor.apps.project.db.ProjectTask" taskStart="taskDate" taskEnd="taskEndDate"
    taskDuration="durationHours" taskParent="parentTask" taskSequence="sequence"
    taskProgress="plannedProgress" x-start-to-start="startToStartSet"
    x-finish-to-start="finishToStartSet" x-finish-to-finish="finishToFinishSet">
    <field name="name"/>
    <field name="project"/>
  </gantt>

  <gantt name="user-task-gantt" title="User Task"
    model="com.axelor.apps.project.db.ProjectTask" taskStart="taskDate" taskEnd="taskEndDate"
    taskDuration="durationHours" taskParent="parentTask" taskSequence="sequence"
    taskProgress="plannedProgress" x-start-to-start="startToStartSet"
    x-finish-to-start="finishToStartSet" x-finish-to-finish="finishToFinishSet">
    <field name="name"/>
    <field name="assignedTo"/>
  </gantt>

  <action-view name="action-view-show-task-tree" title="Task Tree"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="tree" name="task-tree"/>
    <view type="form" name="project-task-form"/>
    <domain>self.id = :_id</domain>
    <context name="_id" expr="eval: id"/>
  </action-view>

  <tree name="task-tree" title="Tasks">

    <column name="name" type="string"/>
    <column name="assignedTo" type="reference"/>
    <column name="progress" type="decimal"/>

    <node model="com.axelor.apps.project.db.ProjectTask" domain="self.id = :_id"
      onClick="action-project-task-view-task">
      <field name="name" as="name"/>
      <field name="assignedTo" as="assignedTo"/>
      <field name="progress" as="progress"/>
    </node>

    <node model="com.axelor.apps.project.db.ProjectTask" parent="parentTask" draggable="true"
      onClick="action-project-task-view-task">
      <field name="name" as="name"/>
      <field name="assignedTo" as="assignedTo"/>
      <field name="progress" as="progress"/>
    </node>

  </tree>

  <kanban name="project-task-kanban" columnBy="status" title="Tasks" limit="30"
    sequenceBy="sequence" model="com.axelor.apps.project.db.ProjectTask">
    <toolbar>
      <button name="logTimeBtn" icon="clock-history"
        onClick="save,action-timesheet-line-method-log-time" if="__config__.app.isApp('timesheet')"/>
    </toolbar>
    <field name="name"/>
    <field name="project"/>
    <field name="assignedTo"/>
    <field name="taskDate"/>
    <field name="taskDeadline"/>
    <field name="priority.name"/>
    <field name="priority.technicalTypeSelect"/>
    <field name="progress"/>
    <field name="project.isShowProgress"/>
    <template>
      <![CDATA[
			<>
				<strong>{name}</strong>
				<Box>{project.fullName}</Box>
				<Box d="flex" justifyContent="space-between">
					<Box>
						<Icon icon="calendar" fontSize="15px"/>
						{!taskDeadline && <span> {_t('Not specified')} </span>}
						{$moment(taskDeadline).isSame($moment().subtract(1, 'days'), 'day') && <span> {_t('Deadline Yesterday')} </span>}
						{$moment(taskDeadline).isSame($moment(), 'day') && <span> {_t('Deadline Today')} </span>}
						{$moment(taskDeadline).isSame($moment().add(1, 'days'), 'day') && <span> {_t('Deadline Tomorrow')} </span>}
						{$moment(taskDeadline).isAfter($moment().add(1, 'days'), 'days') && <span> {_t('Deadline')} {$moment().to($moment(taskDeadline), false)} </span>}
						{$moment(taskDeadline).isBefore($moment().subtract(1, 'days'), 'days') && <span> {_t('Deadline')} {$moment(taskDeadline).from($moment(), false)} </span>}
					</Box>
					<Box>
						{priority.technicalTypeSelect == 1 && <Badge bg="success">{priority.name}</Badge>}
						{priority.technicalTypeSelect == 2 && <Badge bg="info">{priority.name}</Badge>}
						{priority.technicalTypeSelect == 3 && <Badge bg="warning">{priority.name}</Badge>}
						{priority.technicalTypeSelect == 4 && <Badge bg="danger">{priority.name}</Badge>}
					</Box>
				</Box>
				{project.isShowProgress &&
					<Box mt={1}>
						{progress == 0 ? <span>{progress}%</span> : <LinearProgress value={progress} striped animated/>}
					</Box>
				}
			    <Box d="grid" gridTemplateColumns="auto auto" style={{ fontSize: "0.85rem", color: "grey" }} mt={2}>
			        <Box d="flex" g={2}>
			        	<Icon icon="clock" fontSize="15px"/> {taskDate ? <span>{$fmt('taskDate')}</span> : <span>{_t('Not specified')}</span>}
			        </Box>
			        <Box d="flex" justifyContent="flex-end">
			        	{assignedTo && <Image src={$image('assignedTo', 'image')} style={{ width: "1.5rem", height: "1.5rem", borderRadius: "100%" }}></Image>}
			        </Box>
			    </Box>
			</>
		]]>
    </template>
  </kanban>

  <kanban name="task-per-category-kanban" columnBy="projectTaskCategory" title="Tasks"
    limit="30" sequenceBy="sequence" model="com.axelor.apps.project.db.ProjectTask">
    <field name="name"/>
    <field name="project"/>
    <field name="assignedTo"/>
    <field name="taskDate"/>
    <field name="taskDeadline"/>
    <field name="priority.name"/>
    <field name="priority.technicalTypeSelect"/>
    <field name="progress"/>
    <template>
      <![CDATA[
			<>
				<strong>{name}</strong>
				<Box>{project.fullName}</Box>
				<Box d="flex" justifyContent="space-between">
					<Box>
						<Icon icon="calendar" fontSize="15px"/>
						{!taskDeadline && <span> {_t('Not specified')} </span>}
						{$moment(taskDeadline).isSame($moment().subtract(1, 'days'), 'day') && <span> {_t('Deadline Yesterday')} </span>}
						{$moment(taskDeadline).isSame($moment(), 'day') && <span> {_t('Deadline Today')} </span>}
						{$moment(taskDeadline).isSame($moment().add(1, 'days'), 'day') && <span> {_t('Deadline Tomorrow')} </span>}
						{$moment(taskDeadline).isAfter($moment().add(1, 'days'), 'days') && <span> {_t('Deadline')} {$moment().to($moment(taskDeadline), false)} </span>}
						{$moment(taskDeadline).isBefore($moment().subtract(1, 'days'), 'days') && <span> {_t('Deadline')} {$moment(taskDeadline).from($moment(), false)} </span>}
					</Box>
					<Box>
						{priority.technicalTypeSelect == 1 && <Badge bg="success">{priority.name}</Badge>}
						{priority.technicalTypeSelect == 2 && <Badge bg="info">{priority.name}</Badge>}
						{priority.technicalTypeSelect == 3 && <Badge bg="warning">{priority.name}</Badge>}
						{priority.technicalTypeSelect == 4 && <Badge bg="danger">{priority.name}</Badge>}
					</Box>
				</Box>
				<Box mt={1}>
					{progress == 0 ? <span>{progress}%</span> : <LinearProgress value={progress} striped animated/>}
				</Box>
			    <Box d="grid" gridTemplateColumns="auto auto" style={{ fontSize: "0.85rem", color: "grey" }} mt={2}>
			        <Box d="flex" g={2}>
			        	<Icon icon="clock" fontSize="15px"/> {taskDate ? <span>{$fmt('taskDate')}</span> : <span>{_t('Not specified')}</span>}
			        </Box>
			        <Box d="flex" justifyContent="flex-end">
			        	{assignedTo && <Image src={$image('assignedTo', 'image')} style={{ width: "1.5rem", height: "1.5rem", borderRadius: "100%" }}></Image>}
			        </Box>
			    </Box>
			</>
		]]>
    </template>
  </kanban>

  <kanban columnBy="activeSprint" model="com.axelor.apps.project.db.ProjectTask"
    sequenceBy="sequence" title="Tasks per sprint" name="project-task-sprint-kanban"
    draggable="true" limit="10">

    <field name="name"/>
    <field name="assignedTo.name"/>
    <field name="totalPlannedHrs"/>

    <template>
      <![CDATA[
			<>
				<strong>{name}</strong><br /><br />
				<strong>User:</strong> {assignedTo.name}<br />
				<strong>Total planned time:</strong> {totalPlannedHrs}
			</>
		]]>
    </template>

  </kanban>

  <calendar name="project-task-per-status-calendar" title="Task Calendar"
    model="com.axelor.apps.project.db.ProjectTask" eventStart="taskDate" eventStop="taskEndDate"
    eventLength="1" mode="month" colorBy="status">
    <field name="fullName"/>
  </calendar>

  <calendar name="project-task-per-category-calendar" title="Task Calendar"
    model="com.axelor.apps.project.db.ProjectTask" eventStart="taskDate" eventStop="taskEndDate"
    eventLength="1" mode="month" colorBy="projectTaskCategory">
    <field name="fullName"/>
  </calendar>

  <calendar name="project-task-per-user-calendar" title="Task Calendar"
    model="com.axelor.apps.project.db.ProjectTask" eventStart="taskDate" eventStop="taskEndDate"
    eventLength="1" mode="month" colorBy="assignedTo">
    <field name="fullName"/>
  </calendar>

  <action-group name="action-project-task-group-onnew">
    <action name="action-project-task-defaults"/>
    <action name="action-project-task-attrs-set-time-unit-default"/>
    <action name="action-project-task-record-set-default"/>
    <action name="action-project-task-record-project-configurations" if="project != null"/>
    <action name="action-project-task-method-set-status-selection-in"/>
    <action name="action-project-task-attrs-hide-time-spent-button"/>
    <action name="action-project-task-group-reset-datas"/>
  </action-group>

  <action-group name="action-project-task-group-project-onchange">
    <action name="action-project-task-group-reset-datas"/>
    <action name="action-project-task-method-set-status-selection-in"/>
    <action name="action-project-task-record-project-configurations"/>
    <action name="action-project-task-attrs-hide-time-spent-button"/>
  </action-group>

  <action-group name="action-project-task-group-generate-checklist-items">
    <action name="action-project-validate-checklist-items"/>
    <action name="action-project-task-method-generate-checklist-items-from-template"/>
  </action-group>

  <action-group name="action-project-task-group-reset-datas">
    <action name="action-project-task-attrs-reset-version-and-sprint"/>
    <action name="action-project-task-attrs-reset-parent-task"/>
  </action-group>

  <action-method name="action-project-task-method-set-link-type-domain">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="setLinkTypeDomain"/>
  </action-method>

  <action-method name="action-project-task-method-set-task-domain">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="setTaskDomain"/>
  </action-method>

  <action-method name="action-project-task-method-generate-new-link">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="generateNewLink"/>
  </action-method>

  <action-method name="action-project-task-method-change-status">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="changeStatus"/>
  </action-method>

  <action-method name="action-project-task-method-validate-finish-status">
    <call class="com.axelor.apps.project.web.ProjectTaskController"
      method="validateCompletedStatus"/>
  </action-method>

  <action-method name="action-project-task-method-set-status-selection-in">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="manageStatus"/>
  </action-method>

  <action-method name="action-project-task-method-set-tag-domain">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="setTagDomain"/>
  </action-method>

  <action-method name="action-project-task-method-compute-sprint-domain">
    <call class="com.axelor.apps.project.web.ProjectTaskController"
      method="computeSprintDomain"/>
  </action-method>

  <action-method
    name="action-project-task-method-generate-checklist-items-from-template">
    <call class="com.axelor.apps.project.web.ProjectTaskController"
      method="generateCheckListFromTemplate"/>
  </action-method>

  <action-method name="action-project-task-method-update-budgeted-time">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="updateBudgetedTime"/>
  </action-method>

  <action-group name="action-project-task-group-click-done">
    <action name="action-project-task-method-validate-finish-status"/>
    <action name="action-project-task-method-change-status"/>
    <action name="action-project-task-method-auto-change-progress"/>
    <action name="save"/>
  </action-group>

  <action-view name="action-project-task-view-task" title="Tasks"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="form" name="project-task-form"/>
    <view-param name="popup" value="reload"/>
    <view-param name="show-toolbar" value="true"/>
    <view-param name="show-confirm" value="true"/>
    <context name="_showRecord" expr="eval: id"/>
  </action-view>

  <action-view name="action-project-task-open-task" title="Task"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="form" name="project-task-form"/>
    <context name="_showRecord" expr="eval: id"/>
  </action-view>

  <action-view name="action-project-task-edit-task" title="Task"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="form" name="project-task-form"/>
    <view-param name="popup" value="reload"/>
    <view-param name="show-toolbar" value="true"/>
    <view-param name="forceEdit" value="true"/>
    <context name="_showRecord" expr="eval: id"/>
  </action-view>

  <action-view name="action-project-task-view-time-planned"
    title="Planned Time Planning" model="com.axelor.apps.project.db.ProjectPlanningTime">
    <view type="form" name="project-planning-time-form"/>
    <view-param name="popup" value="reload"/>
    <view-param name="show-toolbar" value="false"/>
    <view-param name="forceEdit" value="true"/>
    <view-param name="forceTitle" value="true"/>
    <context name="_timePlannedPopup" expr="eval: true"/>
    <context name="_projectTask" expr="eval:__parent__"
      if="_model == 'com.axelor.apps.project.db.ProjectTask'"/>
    <context name="_timeUnit" expr="eval:__parent__.timeUnit"
      if="_model == 'com.axelor.apps.project.db.ProjectTask'"/>
    <context name="_employee" expr="eval:__parent__.assignedTo.employee"
      if="_model == 'com.axelor.apps.project.db.ProjectTask'"/>
    <context name="_project" expr="eval:__parent__.project"
      if="_model == 'com.axelor.apps.project.db.ProjectTask'"/>
    <context name="_project" expr="eval:__parent__"
      if="_model == 'com.axelor.apps.project.db.Project'"/>
  </action-view>

  <action-record name="action-project-task-record-set-default"
    model="com.axelor.apps.project.db.ProjectTask">
    <field name="isFirst" expr="true"/>
    <field name="typeSelect" expr="eval: _typeSelect"/>
  </action-record>

  <action-record name="action-project-task-record-set-date-or-frequency-changed"
    model="com.axelor.apps.project.db.ProjectTask">
    <field name="hasDateOrFrequencyChanged" expr="true" if="nextProjectTask"/>
  </action-record>

  <action-record name="action-project-task-record-project-configurations"
    model="com.axelor.apps.project.db.ProjectTask">
    <field name="projectTaskCategory" expr="eval: null"/>
    <field name="assignedTo"
      expr="eval:(project?.membersUserSet ? project?.membersUserSet?.collect{it.id}.contains(assignedTo.id) : __repo__(Project).find(project?.id).membersUserSet?.collect{it.id}.contains(assignedTo.id)) ? assignedTo : null"
      if="project != null &amp;&amp; assignedTo != null"/>
    <field name="membersUserSet" expr="eval: null"/>
    <field name="team" expr="eval: project?.team"
      if="project?.synchronize &amp;&amp; project.team != null"/>
    <field name="team" expr="eval: __repo__(Project).find(project?.parentProject?.id)?.team"
      if="(!project?.synchronize || project.team == null) &amp;&amp; project?.extendsMembersFromParent &amp;&amp; __repo__(Project).find(project?.parentProject?.id)?.synchronize"/>
    <field name="priority"
      expr="call: com.axelor.apps.project.service.ProjectTaskService:getPriority(project)"
      if="project?.isShowPriority"/>
    <field name="status"
      expr="call: com.axelor.apps.project.service.ProjectTaskService:getStatus(project, __this__)"
      if="project?.taskStatusManagementSelect != 1"/>
  </action-record>

  <action-record name="action-project-task-defaults"
    model="com.axelor.apps.project.db.ProjectTask">
    <field name="name" expr="eval: _value" if="_value"/>
    <field name="assignedTo" expr="eval:__user__"/>
    <field name="taskDate" expr="#{__config__.date}"/>
    <field name="project" expr="eval:_project"/>
    <field name="project" expr="eval: __user__?.activeProject" if="!_project"/>
    <field name="parentTask" expr="eval:_parentTask"/>
  </action-record>

  <action-group name="action-project-task-group-progress-onchange">
    <action name="action-project-task-update-planned-progress"/>
  </action-group>

  <action-record name="action-project-task-update-planned-progress"
    model="com.axelor.apps.project.db.ProjectTask">
    <field name="plannedProgress" expr="eval: progress"/>
  </action-record>

  <action-attrs name="action-project-task-attrs-project-task-category-configurations"
    model="com.axelor.apps.project.db.ProjectTask">
    <attribute name="domain" for="projectTaskCategory"
      expr="eval: (project?.projectTaskCategorySet !=  null &amp;&amp; project?.projectTaskCategorySet?.size() &gt; 0) ? &quot;self.id IN (${project?.projectTaskCategorySet?.collect{it.id}?.join(',')})&quot; : &quot;self.id IN (null)&quot;"/>
  </action-attrs>

  <action-attrs name="action-project-task-attrs-project-assigned-to-configurations"
    model="com.axelor.apps.project.db.ProjectTask">
    <attribute name="domain"
      expr="eval: (project?.membersUserSet != null &amp;&amp; project?.membersUserSet?.size() &gt; 0) ? &quot;self.id IN(${project?.membersUserSet?.collect{it.id}?.join(',')})&quot; : &quot;self.id IN (null)&quot;"
      for="assignedTo"/>
  </action-attrs>

  <action-attrs name="action-project-task-attrs-parent-task-configurations"
    model="com.axelor.apps.project.db.ProjectTask">
    <attribute name="domain"
      expr="eval: (project?.projectTaskList !=null &amp;&amp; project?.projectTaskList?.size() > 0 ) ? &quot;self.id != ${id} AND self.id IN(${project?.projectTaskList?.collect{it.id}?.join(',')})&quot; : &quot;self.id IN (null)&quot;"
      for="parentTask"/>
  </action-attrs>

  <action-attrs name="action-project-task-attrs-set-task-duration">
    <attribute name="value" for="taskDuration"
      expr="eval:java.time.temporal.ChronoUnit.DAYS.between(taskDate, taskEndDate)*86400"
      if="taskDate != null &amp;&amp; taskEndDate != null"/>
  </action-attrs>

  <action-attrs name="action-project-task-attrs-set-dates">
    <attribute name="value" for="taskEndDate"
      expr="eval:taskDate.plus((taskDuration/86400).longValue(), java.time.temporal.ChronoUnit.DAYS)"
      if="taskDate != null"/>
  </action-attrs>

  <action-attrs name="action-project-task-attrs-set-time-unit-domain">
    <attribute for="timeUnit" name="domain"
      expr="eval: &quot; self.id = ${__config__.app.getApp('base')?.unitDays?.id} OR self.id = ${__config__.app.getApp('base')?.unitHours?.id}&quot;"/>
  </action-attrs>

  <action-attrs name="action-project-task-attrs-reset-version-and-sprint">
    <attribute for="activeSprint" name="value" expr="eval: project?.backlogSprint"/>
  </action-attrs>

  <action-attrs name="action-project-task-attrs-reset-parent-task">
    <attribute for="parentTask" name="value" expr="eval: null"/>
  </action-attrs>

  <!-- get timeUnit value from configuration -->
  <action-attrs name="action-project-task-attrs-set-time-unit-default">
    <attribute for="timeUnit" name="value"
      expr="eval: __config__.app.getApp('base')?.unitDays" if="!parentTask?.timeUnit"/>
    <attribute for="timeUnit" name="value" expr="eval: parentTask?.timeUnit"
      if="parentTask?.timeUnit"/>
  </action-attrs>

  <!-- fill timeUnit from parentTask -->
  <action-record name="action-project-task-record-get-parent-timeunit"
    model="com.axelor.apps.project.db.ProjectTask">
    <field name="timeUnit" expr="eval: parentTask?.timeUnit" if="parentTask"/>
  </action-record>

  <action-view name="action-project-task-book-resource" title="Book resource"
    model="com.axelor.apps.project.db.ResourceBooking">
    <view type="form" name="resource-booking-form"/>
    <view type="grid" name="resource-booking-grid"/>
    <view type="calendar" name="resource-booking-calendar"/>
    <context name="_project" expr="eval:__self__.project"/>
    <context name="_task" expr="eval:__self__"/>
  </action-view>

  <action-record name="action-project-task-record-assigned-yourself"
    model="com.axelor.apps.project.db.ProjectTask">
    <field name="assignedTo" expr="eval: __user__"/>
  </action-record>

  <action-method name="action-project-task-method-manage-timer-buttons">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="manageTimerButtons"/>
  </action-method>

  <action-method name="action-project-task-method-compute-total-timer-duration">
    <call class="com.axelor.apps.project.web.ProjectTaskController"
      method="computeTotalTimerDuration"/>
  </action-method>

  <action-method name="action-project-task-method-defaults-from-parent-task">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="fillSubtask"/>
  </action-method>

  <action-method name="action-project-task-method-auto-change-progress">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="changeProgress"/>
  </action-method>

  <action-method name="action-project-task-method-change-statut-depending-category">
    <call class="com.axelor.apps.project.web.ProjectTaskController"
      method="changeStatusDependingCategory"/>
  </action-method>

  <action-group name="action-project-task-group-project-category-onchange">
    <action name="action-project-task-method-onchange-category"/>
    <action name="action-project-task-method-change-statut-depending-category"/>
    <action name="action-project-task-method-auto-change-progress"/>
  </action-group>

  <action-attrs name="action-project-task-atts-priority-on-select">
    <attribute name="domain"
      expr="eval: (project?.projectTaskPrioritySet !=  null &amp;&amp; project?.projectTaskPrioritySet?.size() &gt; 0) ? &quot;self.id IN (${project?.projectTaskPrioritySet?.collect{it.id}?.join(',')})&quot; : &quot;self.id IN (null)&quot;"
      for="priority"/>
  </action-attrs>

  <action-attrs name="action-project-task-attrs-project-parent-task-configurations"
    model="com.axelor.apps.project.db.ProjectTask">
    <attribute name="domain"
      expr="eval: (project?.projectTaskList !=null &amp;&amp; project?.projectTaskList?.size() > 0 ) ? &quot;self.id != ${id} AND self.id IN(${project?.projectTaskList?.collect{it.id}?.join(',')})&quot; : &quot;self.id IN (null)&quot;"
      for="parentTask"/>
  </action-attrs>

  <action-attrs
    name="action-project-task-attrs-project-members-user-set-configurations"
    model="com.axelor.apps.project.db.ProjectTask">
    <attribute name="domain"
      expr="eval: (project?.membersUserSet != null &amp;&amp; project?.membersUserSet?.size() &gt; 0) ? &quot;self.id IN (${project?.membersUserSet?.collect{it.id}?.join(',')})&quot; : &quot;self.id IN (null)&quot;"
      for="membersUserSet"/>
  </action-attrs>

  <action-group name="action-project-task-group-timer-process">
    <action name="action-project-task-method-set-status-selection-in"/>
    <action name="action-project-task-method-manage-timer-buttons"/>
    <action name="action-project-task-method-compute-total-timer-duration"/>
    <action name="action-project-task-attrs-hide-time-spent-button"/>
  </action-group>

  <action-method name="action-project-task-method-start-timer">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="startTimer"/>
  </action-method>

  <action-method name="action-project-task-method-stop-timer">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="stopTimer"/>
  </action-method>

  <action-method name="action-project-task-method-cancel-timer">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="cancelTimer"/>
  </action-method>

  <action-method name="action-project-task-method-delete-project-task">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="deleteProjectTask"/>
  </action-method>

  <action-method name="action-project-task-method-delete-project-tasks">
    <call class="com.axelor.apps.project.web.ProjectTaskController" method="deleteProjectTasks"/>
  </action-method>

  <action-view name="dashlet.task" title="Tasks"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="grid" name="project-task-grid"/>
    <view type="form" name="project-task-form"/>
  </action-view>

  <action-view name="action-project-view-per-category-kanban" title="Tasks"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="kanban" name="task-per-category-kanban"/>
    <view type="form" name="project-task-form"/>
    <domain>self.typeSelect = :_typeSelect AND self.project.id = :_id</domain>
    <context name="_project" expr="eval:__this__"/>
    <context name="_typeSelect" expr="eval: __repo__(ProjectTask).TYPE_TASK"/>
  </action-view>

  <action-view name="action-project-view-per-status-calendar" title="Task Calendar"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="calendar" name="project-task-per-status-calendar"/>
    <view type="form" name="project-task-form"/>
    <domain>self.typeSelect = :_typeSelect AND self.project.id = :_id</domain>
    <context name="_project" expr="eval:__this__"/>
    <context name="_typeSelect" expr="eval: __repo__(ProjectTask).TYPE_TASK"/>
  </action-view>

  <action-view name="action-project-view-per-category-calendar" title="Task Calendar"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="calendar" name="project-task-per-category-calendar"/>
    <view type="form" name="project-task-form"/>
    <domain>self.typeSelect = :_typeSelect AND self.project.id = :_id</domain>
    <context name="_project" expr="eval:__this__"/>
    <context name="_typeSelect" expr="eval: __repo__(ProjectTask).TYPE_TASK"/>
  </action-view>

  <action-view name="action-project-view-per-user-calendar" title="Task Calendar"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="calendar" name="project-task-per-user-calendar"/>
    <view type="form" name="project-task-form"/>
    <domain>self.typeSelect = :_typeSelect AND self.project.id = :_id</domain>
    <context name="_project" expr="eval:__this__"/>
    <context name="_typeSelect" expr="eval: __repo__(ProjectTask).TYPE_TASK"/>
  </action-view>

  <action-attrs name="action-project-task-attrs-hide-time-spent-button">
    <attribute name="hidden" for="timeSpentBtn"
      expr="!(project?.manageTimeSpent &amp;&amp; assignedTo?.employee == __user__.employee)"/>
  </action-attrs>

  <action-attrs name="action-project-task-attrs-set-site-domain">
    <attribute for="site" name="domain"
      expr="eval: &quot;self.id IN (${project?.siteSet?.collect{it.id}.join(',')})&quot;"/>
  </action-attrs>

  <action-validate name="action-project-task-validate-finish-status">
    <error message="Please fill completed task status in Project configuration."
      if="!project?.completedTaskStatus"/>
  </action-validate>

  <search-filters name="project-task-filters"
    model="com.axelor.apps.project.db.ProjectTask" title="Project task filters">
    <field name="targetVersion" hidden="true" if="!__config__.app.isApp('business-support')"/>
    <field name="team" hidden="true" if="__config__.app.isApp('business-support')"/>
    <field name="customerReferral" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="isPrivate" hidden="true" if="!__config__.app.isApp('business-support')"/>
    <field name="isOrderAccepted" hidden="true" if="!__config__.app.isApp('business-support')"/>
    <field name="isOrderProposed" hidden="true" if="!__config__.app.isApp('business-support')"/>
    <field name="assignment" hidden="true" if="!__config__.app.isApp('business-support')"/>
    <field name="internalDescription" hidden="true"
      if="!__config__.app.isApp('business-support')"/>
    <field name="totalPlannedHrs" hidden="true" if="!__config__.app.isApp('employee')"/>
    <field name="budgetedTime" hidden="true" if="!__config__.app.isApp('employee')"/>
    <field name="plannedProgress" hidden="true" if="!__config__.app.isApp('employee')"/>
    <field name="invoicingType" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="toInvoice" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="isPaid" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="isTaskRefused" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="invoiced" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="project.invoicingSequenceSelect" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="saleOrderLine" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="product" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="quantity" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="invoicingUnit" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="unitPrice" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="currency" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="discountTypeSelect" hidden="true"
      if="!__config__.app.isApp('business-project')"/>
    <field name="discountAmount" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="priceDiscounted" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="exTaxTotal" hidden="true" if="!__config__.app.isApp('business-project')"/>
    <field name="metaFile" hidden="true"
      if="!__config__.app.getApp('project')?.isEnableSignature"/>
  </search-filters>

</object-views>
