<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

    <grid name="configurator-grid" title="Configurators" model="com.axelor.apps.sale.db.Configurator" >
        <field name="configuratorCreator"/>
    </grid>

    <form name="configurator-form" title="Configurator" readonlyIf="productId"
          model="com.axelor.apps.sale.db.Configurator"
          onNew="action-configurator-record-on-new"
          onLoad="action-configurator-update-indicators,save">
        <panel>
            <field name="productId" readonly="true" showTitle="false"
                   showIf="productId" colSpan="12">
                <viewer>
                    <![CDATA[
			 			<h3>
			             <span class="label label-important" x-translate>Product generated</span>
			           </h3>
					]]>
                </viewer>
            </field>
            <field name="configuratorCreator"
                   onSelect="action-configurator-method-creator-domain"/>
            <field name="attributes" colSpan="12"/>
        </panel>
        <panel readonly="true">
            <field name="indicators" colSpan="12"/>
        </panel>
        <panel showIf="configuratorCreator.generateProduct" >
            <button name="generateProduct" title="Generate Product"
                    onClick="save,action-configurator-generate-product"/>
            <field name="configuratorCreator.generateProduct" hidden="true"/>
        </panel>
        <panel title="Configurator BoM" if-module="axelor-production" colSpan="12">
            <field name="configuratorBom" if-module="axelor-production" colSpan="12">
                <editor>
                    <panel title="Label">
                        <field name="defNameAsFormula" colSpan="6"/>
                        <field name="name" colSpan="12" showIf="!defNameAsFormula"/>
                        <field name="nameFormula" colSpan="12" height="120"
                               widget="CodeEditor" x-code-syntax="groovy"
                               showTitle="false" showIf="defNameAsFormula"/>
                    </panel>
                    <field name="useCondition" widget="CodeEditor" height="120" colSpan="12"
                           x-code-syntax="groovy"/>
                    <panel title="Product">
                        <field name="defProductAsFormula" colSpan="6" type="boolean"/>
                        <field name="product" colSpan="12" showIf="!defProductAsFormula"/>
                        <field name="productFormula" colSpan="12" height="120" widget="CodeEditor"
                               x-code-syntax="groovy" showTitle="false" showIf="defProductAsFormula"/>
                    </panel>
                    <panel title="Qty">
                        <field name="defQtyAsFormula" colSpan="6" type="boolean"/>
                        <field name="qty" colSpan="12" showIf="!defQtyAsFormula"/>
                        <field name="qtyFormula" colSpan="12" height="120" widget="CodeEditor"
                               showTitle="false" x-code-syntax="groovy" showIf="defQtyAsFormula"/>
                    </panel>
                    <panel title="Unit">
                        <field name="defUnitAsFormula" colSpan="6" type="boolean"/>
                        <field name="unit" colSpan="12" showIf="!defUnitAsFormula"/>
                        <field name="unitFormula" colSpan="12" height="120" widget="CodeEditor"
                               showTitle="false" x-code-syntax="groovy" showIf="defUnitAsFormula"/>
                    </panel>
                    <panel title="Production process">
                        <field name="defProdProcessAsFormula" readonlyIf="defProdProcessAsConfigurator" colSpan="6" type="boolean"/>
                        <field name="defProdProcessAsConfigurator" readonlyIf="defProdProcessAsFormula" colSpan="6" type="boolean"/>
                        <field name="prodProcess" colSpan="12" showIf="!defProdProcessAsFormula &amp;&amp; !defProdProcessAsConfigurator"/>
                        <field name="prodProcessFormula" colSpan="12" height="120" widget="CodeEditor"
                               showTitle="false" x-code-syntax="groovy" showIf="defProdProcessAsFormula &amp;&amp; !defProdProcessAsConfigurator"/>
                        <field name="configuratorProdProcess" colSpan="12"
                               canNew="true" showIf="defProdProcessAsConfigurator"/>
                    </panel>
                    <field name="configuratorBomList" colSpan="12"/>
                </editor>
            </field>
            <button name="generateBom" title="Generate bom"
                    onClick="save,action-configurator-method-generate-bom"/>
        </panel>
    </form>

    <form name="configurator-wizard-form" title="Configurator" readonlyIf="productId"
          model="com.axelor.apps.sale.db.Configurator"
          onNew="action-configurator-record-on-new"
          onLoad="action-configurator-update-indicators,save">
        <panel>
            <field name="productId" readonly="true" showTitle="false"
                   showIf="productId" colSpan="12">
                <viewer>
                    <![CDATA[
			 			<h3>
			             <span class="label label-important" x-translate>Product generated</span>
			           </h3>
					]]>
                </viewer>
            </field>
            <field name="configuratorCreator" domain="self.isActive = true"/>
            <field name="attributes" colSpan="12"/>
        </panel>
        <panel readonly="true">
            <field name="indicators" colSpan="12"/>
        </panel>
        <panel>
            <button name="validate" title="Validate and generate the line"
                    onClick="save,action-configurator-wizard-method-generate"/>
        </panel>
    </form>

    <action-method name="action-configurator-update-indicators">
        <call class="com.axelor.apps.sale.web.ConfiguratorController" method="updateIndicators"/>
    </action-method>

    <action-method name="action-configurator-generate-product">
        <call class="com.axelor.apps.sale.web.ConfiguratorController" method="generateProduct"/>
    </action-method>

    <action-record name="action-configurator-record-on-new"
                   model="com.axelor.apps.sale.db.Configurator">
        <field name="configuratorCreator" expr="eval: _configuratorCreator"/>
    </action-record>

    <action-method name="action-configurator-method-creator-domain">
        <call class="com.axelor.apps.sale.web.ConfiguratorController"
              method="createDomainForCreator"/>
    </action-method>

    <action-method name="action-configurator-wizard-method-generate">
        <call class="com.axelor.apps.sale.web.ConfiguratorController" method="generateForSaleOrder"/>
    </action-method>

    <action-method name="action-configurator-method-generate-bom">
        <call class="com.axelor.apps.production.web.ConfiguratorController"
              method="generateBillOfMaterial"/>
    </action-method>

</object-views>