<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">
    
    <grid name="configurator-creator-grid" title="ConfiguratorCreators" model="com.axelor.apps.sale.db.ConfiguratorCreator">
	    <toolbar>
	    	<button name="exportCreators" title="Export" onClick="action-configurator-creator-export"/>
	    	<button name="importCreators" title="Import" onClick="action-configurator-creator-view-import"/>
	    </toolbar>
    	<field name="name"/>
		<field name="isActive"/>
    </grid>
    
    <form name="configurator-creator-form" title="ConfiguratorCreator" model="com.axelor.apps.sale.db.ConfiguratorCreator">
    	<panel>
    		<field name="name"/>
    		<panel-related field="attributes" onChange="save,action-configurator-creator-method-update-attributes" colSpan="12" readonlyIf="id == null" form-view="sale-json-field-form" grid-view="sale-json-field-grid"/>
    	</panel>
		<panel sidebar="true" title="Actions">
			<button name="activate" title="Activate" readonlyIf="isActive"
					onClick="action-configurator-creator-record-activate,save"/>
			<button name="test" title="Test this creator"
					onClick="action-configurator-creator-method-test"/>
			<field name="generateProduct" widget="boolean-switch"/>
		</panel>
		<panel-related field="configuratorFormulaList" form-view="configurator-formula-form"
					   grid-view="configurator-formula-grid"/>
		<panel title="Authorizations">
			<field name="authorizedUserSet" form-view="user-form" grid-view="user-grid" canNew="false" canSelect="true" colSpan="12"/>
            <field name="authorizedGroupSet" form-view="group-form" grid-view="group-grid" canNew="false" canSelect="true" colSpan="12"/>
		</panel>
		<panel title="Configurator BoM" if-module="axelor-production" colSpan="12">
            <field name="configuratorBom" if-module="axelor-production" colSpan="12">
                <editor>
                    <field name="company"/>
                    <panel title="Label">
                        <field name="defNameAsFormula" colSpan="6"/>
                        <field name="name" colSpan="12" showIf="!defNameAsFormula"/>
                        <field name="nameFormula" colSpan="12" height="120"
                               widget="CodeEditor" x-code-syntax="groovy"
                               showTitle="false" showIf="defNameAsFormula"/>
                    </panel>
                    <field name="useCondition" widget="CodeEditor" height="120" colSpan="12"
                           x-code-syntax="groovy"/>
                    <panel title="Product">
                        <field name="defProductFromConfigurator" colSpan="6" showIf="!defProductAsFormula"/>
                        <field name="defProductAsFormula" colSpan="6" showIf="!defProductFromConfigurator"/>
                        <field name="product" colSpan="12"
                               showIf="!defProductAsFormula &amp;&amp; !defProductFromConfigurator"
                               form-view="product-view" grid-view="product-grid"/>
                        <field name="productFormula" colSpan="12" height="120" widget="CodeEditor"
                               x-code-syntax="groovy" showTitle="false" showIf="defProductAsFormula"/>
                    </panel>
                    <panel title="Qty">
                        <field name="defQtyAsFormula" colSpan="6" type="boolean"/>
                        <field name="qty" colSpan="12" showIf="!defQtyAsFormula"/>
                        <field name="qtyFormula" colSpan="12" height="120" widget="CodeEditor"
                               showTitle="false" x-code-syntax="groovy" showIf="defQtyAsFormula"/>
                    </panel>
                    <panel title="Unit">
                        <field name="defUnitAsFormula" colSpan="6" type="boolean"/>
                        <field name="unit" colSpan="12" showIf="!defUnitAsFormula"
                        form-view="unit-view" grid-view="unit-grid"/>
                        <field name="unitFormula" colSpan="12" height="120" widget="CodeEditor"
                               showTitle="false" x-code-syntax="groovy" showIf="defUnitAsFormula"/>
                    </panel>
                    <panel title="Production process">
                        <field name="defProdProcessAsFormula" readonlyIf="defProdProcessAsConfigurator" colSpan="6" type="boolean"/>
                        <field name="defProdProcessAsConfigurator" readonlyIf="defProdProcessAsFormula" colSpan="6" type="boolean"/>
                        <field name="prodProcess" form-view="prod-process-form" grid-view="prod-process-form"
                               colSpan="12" showIf="!defProdProcessAsFormula &amp;&amp; !defProdProcessAsConfigurator"/>
                        <field name="prodProcessFormula" colSpan="12" height="120" widget="CodeEditor"
                               showTitle="false" x-code-syntax="groovy" showIf="defProdProcessAsFormula &amp;&amp; !defProdProcessAsConfigurator"/>
                        <field name="configuratorProdProcess" colSpan="12"
                               canNew="true" showIf="defProdProcessAsConfigurator"/>
                    </panel>
                    <field name="configuratorBomList" colSpan="12"/>
                </editor>
            </field>
        </panel>
        <panel>
			<button name="createConfigurator" readonlyIf="!isActive" colSpan="3"
					title="Create configurator" onClick="action-configurator-creator-group-create-configurator"/>
		</panel>
    </form>
    
    <form name="import-configurator-creator-form" title="Import Configurator Creator" model="com.axelor.apps.sale.db.ConfiguratorCreator" >
		<panel>
			<field name="dataFile" type="many-to-one" target="com.axelor.meta.db.MetaFile" widget="binary-link" title="Data file"/>
			<button name="importCretors" title="Import Configurator Creators" onClick="action-configurator-creator-method-import-configurator-creators" showIf="dataFile != null" colSpan="4" />
			<field name="importLog" type="text" colSpan="12" readonly="true" title="Import log"/>
		</panel>	
	</form>

	
	<action-group name="action-configurator-creator-group-create-configurator">
        <action name="save"/>
		<action name="action-configurator-creator-create-configurator"/>
	</action-group>
	
	<action-method name="action-configurator-creator-method-import-configurator-creators">
    	<call class="com.axelor.apps.sale.web.ConfiguratorCreatorController" method="importConfiguratorCreators"/>
    </action-method>
    
    <action-method name="action-configurator-creator-create-configurator">
    	<call class="com.axelor.apps.sale.web.ConfiguratorCreatorController"
			  method="createConfigurator"/>
    </action-method>

	<action-method name="action-configurator-creator-method-test">
		<call class="com.axelor.apps.sale.web.ConfiguratorCreatorController"
			  method="testCreator"/>
	</action-method>

	<action-method name="action-configurator-creator-method-update-attributes">
		<call class="com.axelor.apps.sale.web.ConfiguratorCreatorController"
			  method="updateAttributes"/>
	</action-method>

	<action-record name="action-configurator-creator-record-activate"
				   model="com.axelor.apps.sale.db.ConfiguratorCreator">
		<field name="isActive" expr="eval: true"/>
	</action-record>
	
	<!-- 19 is the index of the ZoneTime part of the ZonedDateTime __datetime__ and there's no need to display it to the user -->
	<action-export name="action-configurator-creator-export" output="${date}${time}" download="true">
  		<export name="ConfiguratorCreatorExport-${__datetime__.toString().substring(0, 19)}.xml" template="data-export/export-configurator-creator.tmpl" engine="groovy"/>
	</action-export>
	
	<action-view name="action-configurator-creator-view-import" model="com.axelor.apps.sale.db.ConfiguratorCreator" title="Import configurator creators">
		<view name="import-configurator-creator-form" type="form"/>
		<view-param name="popup" value="true"/>
		<view-param name="popup-save" value="false"/>
		<view-param name="show-confirm" value="false"/>
		<view-param name="show-toolbar" value="false"/>
	</action-view>

</object-views>