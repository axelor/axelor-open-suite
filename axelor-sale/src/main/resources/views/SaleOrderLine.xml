<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_6.1.xsd">

  <grid name="sale-order-line-grid" title="SO lines"
    model="com.axelor.apps.sale.db.SaleOrderLine" orderBy="sequence">
    <hilite strong="true" color="default" if="typeSelect != 0"/>
    <hilite color="danger" if="deliveryState == 1"/>
    <hilite color="warning" if="deliveryState == 2"/>
    <hilite color="success" if="deliveryState == 3"/>
    <field name="$hasWarning" hidden="true"/>
    <button name="treeIconButton" showIf="hasTree" onClick="refresh" readonlyIf="true"
      icon="fa-solid fa-list"
      if="__config__.app.getApp('sale')?.getActivateMultiLevelSaleOrderLines()"/>
    <button name="errorIconButton" showIf="$hasWarning" onClick="refresh" readonlyIf="true"
      icon="fa-exclamation-triangle"/>
    <field name="sequence" if="__config__.app.getApp('sale')?.isDisplaySaleOrderLineNumber"
      width="51"/>
    <field name="typeSelect" hidden="true"/>
    <field name="deliveryState" hidden="true" if="__config__.app.isApp('supplychain')"/>
    <field name="product.code" width="120"/>
    <field name="productName"/>
    <field name="qty" aggregate="sum" x-scale="2"/>
    <field name="reservedQty"
      if="__config__.app.getApp('supplychain')?.manageStockReservation" aggregate="sum" x-scale="2"/>
    <button name="allocateAll"
      if="__config__.app.getApp('supplychain')?.manageStockReservation" title="Allocate"
      icon="fa-plus-square"
      readonlyIf="$get('saleOrder.statusSelect') != 3 || $get('saleOrder.orderBeingEdited') || $number(reservedQty) == $number(qty) || deliveryState == 3 || $get('product.productTypeSelect') == 'service'"
      onClick="save,action-supplychain-sale-order-line-allocate-all"/>
    <button name="deallocate"
      if="__config__.app.getApp('supplychain')?.manageStockReservation" title="Deallocate"
      icon="fa-minus-square"
      readonlyIf="$get('saleOrder.statusSelect') != 3 || $get('saleOrder.orderBeingEdited') || $number(reservedQty) == 0 || deliveryState == 3"
      onClick="save,action-supplychain-sale-order-line-deallocate-all"/>
    <field name="unit" form-view="unit-form" grid-view="unit-grid"/>
    <field name="priceDiscounted" title="Unit price W.T." x-scale="2"/>
    <field name="inTaxPrice" x-scale="2"/>
    <field name="exTaxTotal" aggregate="sum"/>
    <field name="inTaxTotal" aggregate="sum"/>
    <field name="estimatedShippingDate"/>
    <field name="estimatedDeliveryDate"/>
    <field name="availableStatus" if="__config__.app.isApp('supplychain')">
      <hilite strong="true" color="success" if="availableStatusSelect == 1"/>
      <hilite color="danger" strong="true" if="availableStatusSelect == 2"/>
    </field>
    <field name="saleOrder.statusSelect" hidden="true"/>
    <field name="saleOrder.orderBeingEdited" hidden="true"/>
    <field name="product.productTypeSelect" hidden="true"/>
    <field name="hasTree" hidden="true"/>
  </grid>

  <grid name="sale-order-line-menu-grid" title="SO lines"
    model="com.axelor.apps.sale.db.SaleOrderLine" canNew="false" canDelete="false" canEdit="false">
    <field name="saleOrder"/>
    <field name="saleOrder.company"/>
    <field name="saleOrder.stockLocation" if="__config__.app.isApp('supplychain')"/>
    <field name="saleOrder.clientPartner"/>
    <field name="product.code" width="120"/>
    <field name="productName"/>
    <field name="qty" aggregate="sum" x-scale="2"/>
    <field name="deliveredQty" aggregate="sum" x-scale="2"/>
    <field name="reservedQty"
      if="__config__.app.getApp('supplychain')?.manageStockReservation" aggregate="sum" x-scale="2"/>
    <field name="unit" form-view="unit-form" grid-view="unit-grid"/>
    <field name="priceDiscounted" title="Unit price W.T." x-scale="2"/>
    <field name="exTaxTotal" aggregate="sum"/>
    <field name="estimatedShippingDate"/>
    <field name="estimatedDeliveryDate"/>
    <field name="saleOrder.confirmationDateTime"/>
  </grid>

  <grid name="sale-order-line-invoice-grid" title="SO lines"
    model="com.axelor.apps.sale.db.SaleOrderLine">
    <field name="saleOrder"/>
    <field name="saleOrder.inTaxTotal"/>
    <field name="product.code" width="120"/>
    <field name="productName"/>
    <field name="qty" aggregate="sum"/>
    <field name="unit" form-view="unit-form" grid-view="unit-grid"/>
    <field name="priceDiscounted" title="Unit price W.T." x-scale="2"/>
    <field name="inTaxPrice" x-scale="2"/>
    <field name="exTaxTotal" aggregate="sum"/>
    <field name="inTaxTotal" aggregate="sum"/>
  </grid>

  <form name="sale-order-line-project-form" title="SO line"
    model="com.axelor.apps.sale.db.SaleOrderLine"
    onLoad="action-group-sale-saleorderline-onload,action-sale-order-line-attrs-hidden-fields-for-client"
    readonlyIf="true" canEdit="false">
    <panel name="mainPanel" title="Sale order">
      <field name="saleOrder.saleOrderSeq" title="Reference" colSpan="4"/>
      <field name="saleOrder.creationDate" colSpan="4"/>
      <field name="saleOrder.currency" colSpan="4"/>
    </panel>
    <panel-include view="sale-order-line-form"/>
  </form>

  <form name="sale-order-line-form" title="SO line"
    model="com.axelor.apps.sale.db.SaleOrderLine"
    onLoad="action-group-sale-saleorderline-onload,action-sale-order-line-attrs-hidden-fields-for-client"
    onNew="action-group-sale-saleorderline-onnew" width="large">
    <panel name="productPanel" showIf="typeSelect > 0">
      <field name="productName" colSpan="9" title="Title"/>
      <field name="typeSelect" requiredIf="typeSelect != 0" colSpan="3"
        onChange="action-sale-order-line-method-empty-line"/>
      <field name="isShowTotal" colSpan="3"
        onChange="action-sale-order-line-record-reset-is-hide-unit-amounts"
        if="__config__.app.getApp('sale')?.enablePackManagement" showIf="typeSelect == 3"/>
      <field name="isHideUnitAmounts" colSpan="3"
        if="__config__.app.getApp('sale')?.enablePackManagement"
        showIf="typeSelect == 3 &amp;&amp; isShowTotal"/>
      <panel name="descriptionPanel" showIf="typeSelect == 1" title="Description" colSpan="12">
        <field name="description" showTitle="false" colSpan="12" widget="Html" x-lite="true"/>
      </panel>
    </panel>

    <panel-tabs name="mainPanelTab" hideIf="typeSelect > 0">
      <panel name="informationsPanel" title="Information">
        <!-- The condition $isReadOnly !== false is used to manage the case where isReadOnly is null. -->
        <panel name="productInfoPanel" colSpan="12"
          readonlyIf="$isReadOnly !== false || deliveryState == 2 || deliveryState == 3 || amountInvoiced &gt; 0">
          <panel name="tagPanel" colSpan="12">
            <field name="$partnerLanguage" hidden="true"/>
            <field name="$differentLanguageMessage" readonly="true" hidden="true" colSpan="12"
              showTitle="false">
              <viewer depends="$partnerLanguage">
                <![CDATA[<>{$partnerLanguage && <Badge bg="warning">{_t('The partner\'s language is different from the current language. Description and product name are in :')} {$partnerLanguage}</Badge>}</>]]>
              </viewer>
            </field>
            <field name="$viewerTag" showTitle="false" showIf="product != null"
              readonly="true" colSpan="2">
              <viewer depends="product.isUnrenewed,product.isPrototype"><![CDATA[
	                    <>
	                    	 {product?.isUnrenewed && <Badge bg="danger">{_t('Unrenewed')}</Badge>}
	                    	 {product?.isPrototype && <Badge bg="danger">{_t('Prototype')}</Badge>}
	                    </>
					]]>
              </viewer>
            </field>
            <field name="invoicingState" showTitle="false" showIf="id &amp;&amp; $readonly()"
              colSpan="2" if-module="axelor-supplychain" if="__config__.app.isApp('supplychain')">
              <viewer depends="invoicingState"><![CDATA[
                        <>
                            {invoicingState == 1 && <Badge bg="danger">{_t('Not invoiced')}</Badge>}
                            {invoicingState == 2 && <Badge bg="warning">{_t('Partially invoiced')}</Badge>}
                            {invoicingState == 3 && <Badge bg="success">{_t('Invoiced')}</Badge>}
                        </>
                    ]]>
              </viewer>
            </field>
            <field name="deliveryState" showTitle="false" colSpan="2"
              showIf="deliveryState > 0" if-module="axelor-supplychain"
              if="__config__.app.isApp('supplychain')">
              <viewer><![CDATA[
	                    <>
	                        {deliveryState == 1 && <Badge bg="danger">{_t('Not delivered')}</Badge>}
	                        {deliveryState == 2 && <Badge bg="warning">{_t('Partially delivered')}</Badge>}
	                        {deliveryState == 3 && <Badge bg="success">{_t('Delivered')}</Badge>}
	                    </>
					]]></viewer>
            </field>
            <field name="$availabiltyRequest" showIf="$availabiltyRequest" showTitle="false"
              type="boolean" colSpan="2" if-module="axelor-supplychain"
              if="__config__.app.isApp('supplychain')">
              <viewer>
                <![CDATA[<>{$availabiltyRequest && <Badge bg="success">{_t('Availability request')}</Badge>}</>]]>
              </viewer>
            </field>

            <field name="isQtyRequested" showTitle="false" colSpan="2"
              showIf="isQtyRequested &amp;&amp; product &amp;&amp; product.productTypeSelect != 'service'"
              if-module="axelor-supplychain" if="__config__.app.isApp('supplychain')">
              <viewer>
                <![CDATA[<>{isQtyRequested && <Badge bg="success">{_t('Reservation requested')}</Badge>}</>]]>
              </viewer>
            </field>

          </panel>
          <field name="product" canEdit="false"
            onChange="action-group-sale-saleorderline-product-onchange"
            onSelect="action-sale-order-line-method-domain-product" form-view="product-form"
            grid-view="product-grid" if="!__config__.app.isApp('supplychain')"/>
          <field name="product" canEdit="false"
            onChange="action-group-sale-saleorderline-product-onchange"
            onSelect="action-sale-order-line-method-domain-product" form-view="product-form"
            grid-view="stock-move-line-product-grid" if="__config__.app.isApp('supplychain')"/>
          <field name="enableFreezeFields" colSpan="2"/>
          <field name="typeSelect" colSpan="2"
            onChange="action-sale-order-line-method-empty-line,action-sale-order-attrs-hide-ati"/>
          <field name="productName" colSpan="12"/>
          <field name="oldQty"/>
        </panel>
        <panel name="productDetailPanel" colSpan="12">
          <field name="qty" colSpan="3"
            onChange="action-group-sale-saleorderline-qty-onchange"
            readonlyIf="$availabiltyRequest || ($isReadOnly !== false &amp;&amp; !$get('saleOrder.orderBeingEdited'))"
            validIf="$qtyValid != false"/>
          <field name="unit" colSpan="3"
            readonlyIf="$isReadOnly !== false || deliveryState == 3 || $nonNegotiable"
            onChange="action-group-sale-saleorderline-unit-onchange" requiredIf="typeSelect == 0"
            canEdit="false" form-view="unit-form" grid-view="unit-grid"/>
          <field name="price" colSpan="3"
            readonlyIf="$isReadOnly !== false || deliveryState == 3 || $nonNegotiable"
            onChange="action-sale-order-line-method-onchange-price,action-sale-order-line-method-compute,action-sale-order-line-method-compute-analytic-distribution"
            hidden="true"/>
          <field name="inTaxPrice" colSpan="3"
            readonlyIf="$isReadOnly !== false || deliveryState == 3"
            onChange="action-sale-order-line-method-onchange-intaxprice,action-sale-order-line-method-compute,action-sale-order-line-method-compute-analytic-distribution"
            hidden="true"/>
          <panel name="discountPanel" colSpan="12"
            readonlyIf="$isReadOnly !== false || deliveryState == 3">
            <field name="discountTypeSelect" colSpan="3" readonlyIf="$nonNegotiable"
              onChange="action-sale-order-line-group-discount-type-select-onchange"/>
            <!--This panel purpose is to avoid issues with permission by field -->
            <panel name="discountAmountPanel" colSpan="9" hideIf="discountTypeSelect == 0">
              <field name="discountAmount" colSpan="3" readonlyIf="$nonNegotiable"
                validIf="!$maxDiscount || (discountTypeSelect == 1 &amp;&amp; $number(discountAmount) &lt;= ($number(discountDerogation) || $number($maxDiscount))) || (discountTypeSelect == 2 &amp;&amp; 100*$number(discountAmount)/$number(price) &lt;= ($number(discountDerogation) || $number($maxDiscount)))"
                onChange="action-sale-order-line-group-discount-amount-onchange"/>
              <field name="discountDerogation" colSpan="3"
                onChange="action-sale-order-line-record-fill-discount-amount-from-derogation,action-sale-order-line-group-discount-amount-onchange"/>
            </panel>
            <field name="priceDiscounted" colSpan="3" hidden="true" readonly="true"/>
            <field name="$maxDiscount" colSpan="12" showTitle="false" showIf="$maxDiscount"
              readonly="true">
              <viewer>
                <![CDATA[<><Badge bg="warning">{_t('Max discount')} {$maxDiscount}%</Badge></>]]>
              </viewer>
            </field>
          </panel>
          <label name="multipleQtyNotRespectedLabel" hidden="true" colSpan="12"/>
          <field name="discountsNeedReview" hidden="true"/>
          <field name="$qtyValid" hidden="true" colSpan="12"/>
        </panel>

        <panel name="taxPanel" colSpan="12">
          <field name="taxLine" canEdit="false" colSpan="6"
            readonlyIf="$isReadOnly !== false || deliveryState == 2 || deliveryState == 3 || amountInvoiced &gt; 0"
            onChange="action-group-sale-saleorderline-tax-line-onchange"
            domain="self.endDate = null or self.endDate &gt; :__date__" grid-view="tax-line-grid"
            form-view="tax-line-form"/>
          <field name="exTaxTotal" readonly="true" colSpan="3"/>
          <field name="inTaxTotal" readonly="true" colSpan="3"/>
        </panel>
        <panel name="reservationPanel" colSpan="12" if-module="axelor-supplychain"
          if="__config__.app.isApp('supplychain')">
          <field name="requestedReservedQty" colSpan="6" hidden="true"
            if-module="axelor-supplychain"
            onChange="action-supplychain-attrs-sale-order-line-max-requested-reserved-qty"
            if="__config__.app.getApp('supplychain')?.getManageStockReservation()"/>
          <field name="reservedQty" colSpan="6" readonly="true" hidden="true"
            if-module="axelor-supplychain"
            if="__config__.app.getApp('supplychain')?.getManageStockReservation()"/>
          <field hidden="true" name="isQtyRequested"/>
          <panel name="requestedQtyBtnsPanel" colSpan="12" if-module="axelor-supplychain"
            if="__config__.app.getApp('supplychain')?.getManageStockReservation()">
            <button name="updateRequestedReservedQtyBtn" colSpan="6" hidden="true"
              title="Change requested reserved qty"
              onClick="action-view-sale-order-line-requested-reserved-qty-wizard"/>
          </panel>
          <panel name="reservedQtyBtnsPanel" colSpan="12" if-module="axelor-supplychain"
            if="__config__.app.getApp('supplychain')?.getManageStockReservation()">
            <button name="updateAllocatedQtyBtn" colSpan="6" hidden="true"
              title="Change allocated qty"
              onClick="action-view-sale-order-line-allocated-qty-wizard"/>
          </panel>
          <panel name="requestedReservedQtyBtnqPanel" colSpan="12"
            if-module="axelor-supplychain"
            if="__config__.app.getApp('supplychain')?.getManageStockReservation()">
            <button name="requestQty" title="Request reservation"
              showIf="product &amp;&amp; product.productTypeSelect != 'service' &amp;&amp; !isQtyRequested"
              onClick="save,action-method-sale-order-line-request-qty"/>
          </panel>
          <panel name="cancelReservedQtyBtnqPanel" colSpan="12" if-module="axelor-supplychain"
            if="__config__.app.getApp('supplychain')?.getManageStockReservation()">
            <button name="cancelReservation" title="Cancel reservation"
              showIf="product &amp;&amp; product.productTypeSelect != 'service' &amp;&amp; isQtyRequested"
              onClick="save,action-method-sale-order-line-cancel-reservation"/>
          </panel>
        </panel>
        <field name="$availableStock" colSpan="3" readonly="true"
          showIf="product &amp;&amp; product.productTypeSelect != 'service'" type="decimal"
          title="Available stock" if-module="axelor-supplychain"
          if="__config__.app.getApp('supplychain')?.getManageStockReservation()"/>
        <field name="$allocatedStock" colSpan="3" readonly="true"
          showIf="product &amp;&amp; product.productTypeSelect != 'service'" type="decimal"
          title="Allocated stock" if-module="axelor-supplychain"
          if="__config__.app.getApp('supplychain')?.getManageStockReservation()"/>
        <field name="$totalStock" colSpan="3" readonly="true"
          showIf="product &amp;&amp; product.productTypeSelect != 'service'" type="decimal"
          title="Total stock" if-module="axelor-supplychain"
          if="__config__.app.getApp('supplychain')?.getManageStockReservation()"/>
        <field name="taxEquiv" hidden="true" grid-view="tax-equiv-grid"
          form-view="tax-equiv-form"/>
        <field name="selectedComplementaryProductList"
          grid-view="complementary-product-selected-grid"
          form-view="complementary-product-selected-form" colSpan="12" canView="false"
          canEdit="false" canRemove="false" canNew="false" canSelect="false"
          onChange="action-sale-order-line-record-complementary-products-to-handle" hidden="true"
          showIf="selectedComplementaryProductList != null &amp;&amp; selectedComplementaryProductList.length &gt; 0"/>
        <panel name="descriptionPanel" title="Description" colSpan="12"
          readonlyIf="$isReadOnly !== false">
          <field name="description" showTitle="false" colSpan="12" widget="Html" x-lite="true"/>
        </panel>
        <panel name="lineProductionCommentPanel" title="Line production commentary"
          colSpan="12" readonlyIf="$isReadOnly !== false">
          <field name="lineProductionComment" showTitle="false" colSpan="12" widget="Html"
            x-lite="true"/>
        </panel>
        <field name="$isReadOnly" hidden="true"/>
        <field name="product.productTypeSelect" hidden="true"/>
      </panel>
      <panel name="marginPanel" title="Margin" readonlyIf="$isReadOnly !== false">
        <field name="subTotalCostPrice"
          onChange="action-sale-order-line-method-compute-subMargin"/>
        <field name="subTotalGrossMargin" readonly="true"/>
        <field name="subMarginRate" readonly="true"/>
        <field name="subTotalMarkup" readonly="true"/>
        <field name="$companyCurrency" readonly="true" title="Currency" type="many-to-one"
          target="com.axelor.apps.base.db.Currency"/>
      </panel>
      <panel name="deliveryPanel" title="Delivery">
        <field name="desiredDeliveryDate" readonlyIf="$availabiltyRequest"/>
        <field name="estimatedShippingDate"
          onChange="action-sale-order-line-group-deliv-estimated-date-onchange"
          readonlyIf="$availabiltyRequest"/>
        <field name="estimatedDeliveryDate" readonlyIf="$availabiltyRequest"/>
        <field name="deliveredQty" readonly="true" hidden="true"/>
        <button name="$previewBtn" title="See stock details" icon="fa-cubes" colSpan="4"
          widget="info-button"
          onClick="action-stock-location-line-view-for-a-product-from-saleorderline-view"
          if="__config__.app.isApp('supplychain')"/>
        <field name="pickingOrderInfo" colSpan="12" if-module="axelor-supplychain"
          if="__config__.app.isApp('supplychain')" readonlyIf="$isReadOnly !== false"
          hideIf="product.productTypeSelect == 'service'"/>
        <panel-dashlet name="stockMoveLineOfSOPanel" title="Stock Moves"
          action="action-sale-order-line-view-stock-move-line" colSpan="12"
          if-module="axelor-supplychain" if="__config__.app.isApp('supplychain')"
          readonlyIf="$isReadOnly !== false"/>
      </panel>
      <panel name="invoicingFollowUpPanel" title="Invoicing"
        readonlyIf="$isReadOnly !== false" if-module="axelor-supplychain"
        if="__config__.app.isApp('supplychain')">
        <field name="amountInvoiced"/>
        <panel-dashlet name="invoiceLinesFromSOLinePanel"
          action="action-sale-order-line-view-show-invoice-lines" colSpan="12"/>
      </panel>
      <panel name="projectPanel"
        if="__config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getProjectSaleOrderLines()"
        title="Business Project" readonlyIf="$isReadOnly !== false"
        if-module="axelor-business-project">
        <field name="project" title="Business Project" canEdit="false"
          onSelect="action-sale-order-line-attrs-domain-project"
          onChange="action-sale-order-line-record-progress" form-view="project-form"
          grid-view="project-grid"/>
        <field name="toInvoice" colSpan="3"
          if="__config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getProjectSaleOrderLines()"
          if-module="axelor-business-project"/>
        <panel-dashlet name="projectTaskListPanel" title="Related tasks"
          action="action-sale-order-line-view-project-tasks" colSpan="12"/>
      </panel>
    </panel-tabs>
    <panel name="attrsPanel">
      <field name="attrs" colSpan="12"/>
    </panel>
    <panel name="hiddenPanel" hidden="true">
      <field name="saleOrder.statusSelect"/>
      <field name="saleOrder.orderBeingEdited"/>
      <field name="product.isUnrenewed"/>
      <field name="product.isPrototype"/>
      <field name="saleOrder"/>
    </panel>
    <panel-mail name="mailsPanel">
      <mail-messages/>
    </panel-mail>
  </form>

  <form name="sale-order-line-template-form" title="SO line"
    model="com.axelor.apps.sale.db.SaleOrderLine"
    onLoad="action-group-sale-saleorderline-onload,action-sale-order-line-template-attrs-hidden-fields-for-client"
    onNew="action-group-sale-saleorderline-onnew" width="large">
    <panel name="product1Panel" showIf="typeSelect == 1">
      <field name="productName" colSpan="9" title="Title"/>
      <panel name="typeSelect1Panel" colSpan="3">
        <field name="typeSelect" onChange="action-sale-order-line-method-empty-line"
          colSpan="12"/>
      </panel>
    </panel>
    <panel name="product2Panel" hideIf="typeSelect == 1">
      <field name="product" canEdit="false"
        onChange="action-group-sale-saleorderline-product-onchange"
        onSelect="action-sale-order-line-method-domain-product" form-view="product-form"
        grid-view="product-grid"/>
      <panel name="typeSelect2Panel" colSpan="3">
        <field name="typeSelect" onChange="action-sale-order-line-method-empty-line"
          colSpan="12"/>
      </panel>
      <field name="productName"/>
      <panel name="productDetailsPanel" colSpan="12">
        <field name="qty" onChange="action-group-sale-saleorderline-qty-onchange"/>
        <field name="unit" canEdit="false" requiredIf="typeSelect == 0" form-view="unit-form"
          grid-view="unit-grid"/>
        <field name="price"
          onChange="action-sale-order-line-method-onchange-price,action-sale-order-line-method-compute,action-sale-order-line-method-compute-analytic-distribution"
          colSpan="4" hidden="true"/>
        <field name="inTaxPrice"
          onChange="action-sale-order-line-method-onchange-intaxprice,action-sale-order-line-method-compute,action-sale-order-line-method-compute-analytic-distribution"
          colSpan="4" hidden="true"/>
        <panel name="discountPanel" title="Discount">
          <field name="discountTypeSelect"
            onChange="action-sale-order-line-method-compute,action-sale-order-line-attrs-discountamount-title,action-sale-order-line-method-compute-analytic-distribution"/>
          <field name="discountAmount"
            onChange="action-sale-order-line-method-compute,action-sale-order-line-method-compute-analytic-distribution"
            hideIf="discountTypeSelect == 0"/>
          <field name="priceDiscounted" colSpan="4" hidden="true"/>
        </panel>
      </panel>
      <field name="taxLine" canEdit="false" colSpan="4"
        onChange="action-group-sale-saleorderline-tax-line-onchange"
        domain="self.endDate = null or self.endDate &gt; :__date__" grid-view="tax-line-grid"
        form-view="tax-line-form"/>
      <field name="exTaxTotal" readonly="true"/>
      <field name="inTaxTotal" readonly="true"/>
      <field name="taxEquiv" hidden="true" grid-view="tax-equiv-grid"
        form-view="tax-equiv-form"/>
      <panel name="descriptionPanel" title="Description" colSpan="12">
        <field name="description" showTitle="false" colSpan="12" widget="Html" x-lite="true"/>
      </panel>
      <panel name="lineProductionCommentPanel" title="Line production commentary" colSpan="12"
        if="__config__.app.isApp('production')">
        <field name="lineProductionComment" showTitle="false" colSpan="12" widget="Html"
          x-lite="true" if="__config__.app.isApp('production')"/>
      </panel>
    </panel>
    <panel-tabs hideIf="typeSelect == 1" name="allPanelTab">
      <panel name="marginPanel" title="Margin">
        <field name="subTotalCostPrice"
          onChange="action-sale-order-line-method-compute-subMargin"/>
        <field name="subTotalGrossMargin" readonly="true"/>
        <field name="subMarginRate" readonly="true"/>
        <field name="subTotalMarkup" readonly="true"/>
        <field name="$companyCurrency" readonly="true" title="Currency" type="many-to-one"
          target="com.axelor.apps.base.db.Currency"/>
      </panel>
      <panel name="projectPanel"
        if="__config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getProjectSaleOrderLines()"
        title="Project/Task" if-module="axelor-business-project">
        <field name="project" title="Business Project" canEdit="false"
          onSelect="action-sale-order-line-attrs-domain-project"
          onChange="action-sale-order-line-record-progress" form-view="project-form"
          grid-view="project-grid"/>
        <field name="progress" readonly="true" widget="SelectProgress"/>
      </panel>
    </panel-tabs>
    <panel name="attrsPanel">
      <field name="attrs" colSpan="12"/>
    </panel>
  </form>

  <form name="sale-order-line-menu-form" title="SO line"
    model="com.axelor.apps.sale.db.SaleOrderLine" onLoad="action-group-sale-saleorderline-onload"
    onNew="action-group-sale-saleorderline-onnew" width="large">
    <panel name="mainPanel">
      <field name="saleOrder.clientPartner"/>
      <field name="saleOrder" grid-view="sale-order-grid" form-view="sale-order-form"/>
      <field name="saleOrder.company"/>
      <field name="saleOrder.stockLocation" if="__config__.app.isApp('supplychain')"/>
    </panel>
    <panel-include view="sale-order-line-form"/>
  </form>

  <form name="sale-order-line-invoice-form" title="SO line"
    model="com.axelor.apps.sale.db.SaleOrderLine" onLoad="action-group-sale-saleorderline-onload"
    onNew="action-group-sale-saleorderline-onnew" width="large">
    <panel name="mainPanel">
      <field name="saleOrder" grid-view="sale-order-grid" form-view="sale-order-form"/>
    </panel>
    <panel-include view="sale-order-line-form"/>
  </form>

  <form model="com.axelor.apps.sale.db.SaleOrderLine" title="SO line"
    name="sale-order-line-all-form" width="large" canNew="false" canDelete="false" canEdit="false">
    <panel name="mainPanel">
      <field name="saleOrder.company" colSpan="3"/>
      <spacer name="saleOrderCompanySpacer" colSpan="9"/>
      <field name="saleOrder.clientPartner" grid-view="partner-grid" form-view="partner-form"
        colSpan="3"/>
      <field name="saleOrder.saleOrderSeq" grid-view="sale-order-grid"
        form-view="sale-order-form" colSpan="3"/>
      <field name="saleOrder.creationDate" colSpan="3"/>
      <field name="saleOrder.currency" colSpan="3"/>
    </panel>
    <panel-include view="sale-order-line-form"/>
  </form>

  <!-- ACTION VIEW -->

  <action-view name="action-sale-order-line-view-stock-move-line" title=""
    model="com.axelor.apps.stock.db.StockMoveLine">
    <view type="grid" name="stock-move-line-sale-order-line-grid"/>
    <view type="form" name="stock-move-line-all-form"/>
    <domain>self.saleOrderLine.id = :id</domain>
    <context name="id" expr="eval: id"/>
  </action-view>

  <action-view name="action-sale-order-line-view-project-tasks" title="Related tasks"
    model="com.axelor.apps.project.db.ProjectTask">
    <view type="grid" name="project-task-grid"/>
    <view type="form" name="project-task-form"/>
    <domain>self.saleOrderLine = :id</domain>
  </action-view>

  <search-filters title="Sale order lines filter" name="sale-order-lines-filter"
    model="com.axelor.apps.sale.db.SaleOrderLine">
    <field name="invoicingState" hidden="true" if="!__config__.app.isApp('supplychain')"/>
  </search-filters>

  <action-view name="action-sale-order-line-view-show-invoice-lines"
    title="Invoice Lines" model="com.axelor.apps.account.db.InvoiceLine">
    <view type="grid" name="invoice-line-grid"/>
    <view type="form" name="invoice-line-form"/>
    <domain>self.saleOrderLine.id = :saleOrderLineId</domain>
    <context name="saleOrderLineId" expr="eval: id"/>
  </action-view>

  <!-- ACTION GROUPs -->

  <action-group name="action-group-sale-saleorderline-onnew">
    <action name="action-sale-order-line-record-is-form-readonly"/>
    <action name="action-sale-order-line-record-non-negotiable"/>
    <action name="action-sale-order-line-attrs-hide-qty-warning-label"/>
    <action name="action-sale-order-line-attrs-title-project"/>
    <action name="action-sale-order-line-attrs-show-priceDiscounted"/>
    <action name="action-sale-order-line-attrs-scale-and-precision"/>
    <action name="action-sale-order-line-record-new"/>
    <action name="action-sale-order-line-record-project"/>
    <action name="action-sale-order-line-attrs-hide-bill-of-material"/>
    <action name="action-sale-order-line-attrs-set-company-currency"/>
    <action name="action-sale-order-attrs-hide-ati"/>
    <action name="action-supplychain-sale-order-line-attrs-hide-button"/>
    <action name="action-sale-order-line-attrs-fill-estimated-date"/>
    <action name="action-sale-order-line-attrs-is-requested-qty-readonly"
      if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain')?.getManageStockReservation()"/>
    <action name="action-sale-order-line-record-update-requested-reserved-qty-from-qty"
      if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain')?.getManageStockReservation()"/>
    <action name="action-sale-order-line-attrs-selection-in-type-select"/>
    <action name="action-sale-order-line-attrs-delivered-qty-hidden"/>
    <action name="action-sale-order-line-attrs-display-different-language-message"/>
  </action-group>

  <action-group name="action-group-sale-saleorderline-onload">
    <action name="action-sale-order-line-attrs-show-availabilty-request"
      if="__config__.app.isApp('supplychain')"/>
    <action name="action-sale-order-line-record-is-form-readonly"/>
    <action name="action-sale-order-line-record-non-negotiable"/>
    <action name="action-sale-order-line-attrs-title-project"/>
    <action name="action-sale-order-line-attrs-show-priceDiscounted"/>
    <action name="action-sale-order-line-attrs-scale-and-precision"/>
    <action name="action-sale-order-line-attrs-hide-bill-of-material"/>
    <action name="action-sale-order-line-attrs-reserved-qty-visibility"/>
    <action name="action-method-sale-order-line-available-and-allocated-stock"/>
    <action name="action-sale-order-line-attrs-set-company-currency"/>
    <action name="action-supplychain-sale-order-line-attrs-hide-button"/>
    <action name="action-sale-order-line-method-check-qty"
      if="__config__.app.getApp('sale')?.manageMultipleSaleQuantity"/>
    <action name="action-sale-order-line-attrs-is-requested-qty-readonly"
      if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain')?.getManageStockReservation()"/>
    <action name="action-record-sale-order-line-future-qty"
      if="__config__.app.isApp('supplychain')"/>
    <action name="action-sale-order-attrs-hide-ati"/>
    <action name="action-sale-order-line-method-fill-max-discount"/>
    <action name="action-sale-order-line-attrs-selection-in-type-select"/>
    <action name="action-sale-order-line-attrs-delivered-qty-hidden"/>
    <action name="action-sale-order-line-attrs-display-different-language-message"/>
  </action-group>

  <action-group name="action-group-sale-saleorderline-product-onchange">
    <action name="action-sale-order-line-method-get-product-information"/>
    <action name="action-sale-order-line-method-compute"/>
    <action name="action-sale-order-line-attrs-hide-bill-of-material"/>
    <action name="action-sale-order-line-get-production-information"/>
    <action name="action-sale-order-line-method-supplier-partner-default"
      if="__config__.app.isApp('supplychain')"/>
    <action name="action-sale-order-line-method-check-stock"
      if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain')?.getCheckSaleStocks()"/>
    <action name="action-sale-order-line-method-check-qty"
      if="__config__.app.getApp('sale')?.manageMultipleSaleQuantity"/>
    <action if="__config__.app.isApp('supplychain')"
      name="action-sale-order-line-attrs-show-delivery-panel"/>
    <action name="action-method-sale-order-line-available-and-allocated-stock"/>
    <action name="action-sale-order-attrs-hide-ati"/>
    <action name="action-record-sale-order-line-future-qty"
      if="__config__.app.isApp('supplychain')"/>
    <action name="action-sale-order-line-record-complementary-products-to-handle"/>
    <action name="action-sale-order-line-method-fill-max-discount"/>
    <action name="action-sale-order-line-method-translate-product-description-and-name"/>
  </action-group>

  <action-group name="action-group-sale-saleorderline-qty-onchange">
    <action name="action-sale-order-line-method-compute-pricing-scale"/>
    <action name="action-sale-order-line-method-check-delivered-or-invoiced-order-qty"
      if="__config__.app.isApp('supplychain') &amp;&amp; saleOrder?.statusSelect == 3"/>
    <action name="action-sale-order-line-method-get-discount"/>
    <action name="action-sale-order-line-method-compute"/>
    <action name="action-sale-order-line-method-compute-analytic-distribution"
      if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('account')?.getManageAnalyticAccounting()"/>
    <action name="action-sale-order-line-method-check-stock"
      if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain')?.getCheckSaleStocks()"/>
    <action name="action-sale-order-line-method-check-qty"
      if="__config__.app.getApp('sale')?.manageMultipleSaleQuantity"/>
    <action name="action-sale-order-line-record-update-requested-reserved-qty-from-qty"
      if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain')?.getManageStockReservation()"/>
    <action name="action-sale-order-line-record-complementary-products-to-handle"/>
  </action-group>

  <action-group name="action-group-sale-saleorderline-unit-onchange">
    <action name="action-sale-order-line-method-check-stock"
      if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain')?.getCheckSaleStocks()"/>
  </action-group>

  <action-group name="action-group-sale-saleorderline-tax-line-onchange">
    <action name="action-sale-order-line-method-get-tax-equiv"/>
    <action name="action-sale-order-line-method-convert-tax"/>
    <action name="action-sale-order-line-method-compute"/>
    <action name="action-sale-order-line-method-compute-analytic-distribution"
      if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('account')?.getManageAnalyticAccounting()"/>
  </action-group>

  <action-group name="action-sale-order-line-group-discount-type-select-onchange">
    <action name="action-sale-order-line-method-compute"/>
    <action name="action-sale-order-line-attrs-discountamount-title"/>
    <action name="action-sale-order-line-method-compute-analytic-distribution"/>
    <action name="action-sale-order-line-method-fill-max-discount"/>
  </action-group>

  <action-group name="action-sale-order-line-group-discount-amount-onchange">
    <action name="action-sale-order-line-method-compute"/>
    <action name="action-sale-order-line-method-compute-analytic-distribution"/>
  </action-group>

  <action-group name="action-sale-order-line-group-deliv-estimated-date-onchange">
    <action name="save" if="__id__"/>
    <action name="action-sale-order-line-supplychain-method-update-reservation-date"
      if="__id__"/>
  </action-group>

  <!-- ACTION RECORD -->

  <action-record name="action-sale-order-line-record-is-form-readonly"
    model="com.axelor.apps.sale.db.SaleOrderLine">
    <field name="$isReadOnly"
      expr="eval: saleOrder?.statusSelect == 2 || saleOrder?.statusSelect == 3 &amp;&amp; (!saleOrder?.orderBeingEdited || (exTaxTotal &amp;&amp; exTaxTotal != 0 &amp;&amp; amountInvoiced == exTaxTotal) || availabiltyRequest) || saleOrder?.statusSelect == 4"/>
  </action-record>

  <action-record name="action-sale-order-line-record-non-negotiable"
    model="com.axelor.apps.sale.db.SaleOrderLine">
    <field name="$nonNegotiable" expr="eval: __parent__?.priceList?.nonNegotiable"
      if="__parent__ != null &amp;&amp; __parent__?.priceList != null"/>
  </action-record>

  <action-record name="action-sale-order-line-record-new"
    model="com.axelor.apps.sale.db.SaleOrderLine">
    <field name="qty" expr="eval: 1"/>
  </action-record>

  <action-record name="action-sale-order-line-record-project"
    model="com.axelor.apps.sale.db.SaleOrderLine" if-module="axelor-business-project">
    <field name="project" expr="eval: __parent__?.project"
      if="__config__.app.isApp('business-project')"/>
  </action-record>

  <action-record name="action-sale-order-line-record-reset-is-hide-unit-amounts"
    model="com.axelor.apps.sale.db.SaleOrderLine">
    <field name="isHideUnitAmounts" expr="eval: false"/>
  </action-record>

  <!-- TODO : should be splited per module -->
  <action-record name="action-sale-order-line-get-production-information"
    model="com.axelor.apps.sale.db.SaleOrderLine">
    <field name="billOfMaterial" expr="eval: product?.defaultBillOfMaterial"
      if="__config__.app.isApp('production') &amp;&amp; saleSupplySelect == 3 &amp;&amp; product?.defaultBillOfMaterial != null"/>
    <field name="billOfMaterial" expr="eval: product?.parentProduct?.defaultBillOfMaterial"
      if="__config__.app.isApp('production') &amp;&amp; saleSupplySelect == 3 &amp;&amp; product?.defaultBillOfMaterial == null"/>
    <field name="standardDelay" expr="eval: product?.standardDelay"
      if="__config__.app.isApp('supplychain') &amp;&amp; saleSupplySelect == 2 || saleSupplySelect == 3"/>
    <field name="standardDelay" expr="eval: 0"
      if="__config__.app.isApp('supplychain') &amp;&amp; saleSupplySelect != 2 &amp;&amp; saleSupplySelect != 3"/>
  </action-record>

  <action-record name="action-sale-order-line-record-progress"
    model="com.axelor.apps.sale.db.SaleOrderLine">
    <field name="progress" expr="eval: project?.progress"/>
  </action-record>

  <action-record name="action-sale-order-line-record-complementary-products-to-handle"
    model="com.axelor.apps.sale.db.SaleOrderLine">
    <field name="isComplementaryProductsUnhandledYet" expr="eval: true"
      if="product != null &amp;&amp; product.complementaryProductList != null &amp;&amp; !product.complementaryProductList.isEmpty()"/>
  </action-record>

  <action-record
    name="action-sale-order-line-record-fill-discount-amount-from-derogation"
    model="com.axelor.apps.sale.db.SaleOrderLine">
    <field name="discountAmount"
      expr="eval: discountTypeSelect == __repo__(PriceListLine).AMOUNT_TYPE_FIXED ? discountDerogation * price / 100 : discountDerogation"/>
  </action-record>

  <!-- ACTION METHOD -->

  <action-method name="action-sale-order-line-method-compute-pricing-scale">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController" method="computePricingScale"/>
  </action-method>

  <action-method name="action-sale-order-line-method-compute">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController" method="compute"/>
  </action-method>

  <action-method name="action-sale-order-line-method-compute-subMargin">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController" method="computeSubMargin"/>
  </action-method>

  <action-method name="action-sale-order-line-method-convert-tax">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController" method="convertUnitPrice"/>
  </action-method>

  <action-method name="action-sale-order-line-method-get-product-information">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController"
      method="getProductInformation"/>
  </action-method>

  <action-method name="action-sale-order-line-method-get-discount">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController" method="getDiscount"/>
  </action-method>

  <action-method name="action-sale-order-line-method-supplier-partner-default"
    if-module="axelor-supplychain">
    <call class="com.axelor.apps.supplychain.web.SaleOrderLineController"
      method="supplierPartnerDefault"/>
  </action-method>

  <action-method name="action-sale-order-line-method-check-qty">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController" method="checkQty"/>
  </action-method>

  <action-method name="action-sale-order-line-method-get-tax-equiv">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController" method="getTaxEquiv"/>
  </action-method>

  <action-method name="action-sale-order-line-method-onchange-price">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController" method="updateInTaxPrice"/>
  </action-method>

  <action-method name="action-sale-order-line-method-onchange-intaxprice">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController" method="updatePrice"/>
  </action-method>

  <action-method name="action-sale-order-line-method-fill-max-discount">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController" method="fillMaxDiscount"/>
  </action-method>

  <action-method name="action-sale-order-line-method-domain-product">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController"
      method="computeProductDomain"/>
  </action-method>

  <action-method
    name="action-sale-order-line-method-translate-product-description-and-name">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController"
      method="translateProductDescriptionAndName"/>
  </action-method>

  <action-method name="action-sale-order-line-method-empty-line">
    <call class="com.axelor.apps.sale.web.SaleOrderLineController" method="emptyLine"/>
  </action-method>

  <action-method name="action-sale-order-line-method-compute-analytic-distribution"
    if-module="axelor-supplychain">
    <call class="com.axelor.apps.supplychain.web.SaleOrderLineController"
      method="computeAnalyticDistribution" if="__config__.app.isApp('supplychain')"/>
  </action-method>

  <action-method name="action-sale-order-line-method-check-stock"
    if-module="axelor-supplychain">
    <call class="com.axelor.apps.supplychain.web.SaleOrderLineController" method="checkStocks"/>
  </action-method>

  <!-- ACTION ATTRS -->

  <action-attrs name="action-sale-order-line-attrs-hide-bill-of-material"
    if-module="axelor-production">
    <attribute name="hidden" for="billOfMaterial"
      expr="eval: saleSupplySelect != 3 || product?.productTypeSelect == 'service' "
      if="__config__.app.isApp('production')"/>
    <attribute name="hidden" for="customizeBOMBtn"
      expr="eval: saleSupplySelect != 3 || product?.productTypeSelect == 'service' "
      if="__config__.app.isApp('production')"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-bill-of-material-domain">
    <attribute name="domain" for="billOfMaterial"
      expr="eval: &quot;(self.product.id = ${product?.parentProduct?.id} OR self.product.id = ${product?.id}) AND self.defineSubBillOfMaterial = true &quot;"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-discountamount-title">
    <attribute name="title" for="discountAmount"
      expr="eval: com.axelor.i18n.I18n.get('Discount rate')" if="discountTypeSelect == 1"/>
    <attribute name="title" for="discountAmount"
      expr="eval: com.axelor.i18n.I18n.get('Discount amount')" if="discountTypeSelect == 2"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-scale-and-precision">
    <attribute name="scale" for="price"
      expr="eval: __config__.app.getNbDecimalDigitForUnitPrice()"/>
    <attribute name="scale" for="inTaxPrice"
      expr="eval: __config__.app.getNbDecimalDigitForUnitPrice()"/>
    <attribute name="scale" for="priceDiscounted"
      expr="eval: __config__.app.getNbDecimalDigitForUnitPrice()"/>
    <attribute name="scale" for="discountAmount"
      expr="eval: __config__.app.getNbDecimalDigitForUnitPrice()"/>

    <attribute name="scale" for="oldQty"
      expr="eval: __config__.app.getNbDecimalDigitForQty()"/>
    <attribute name="scale" for="qty"
      expr="eval: __config__.app.getNbDecimalDigitForQty()"/>
    <attribute name="scale" for="requestedReservedQty"
      expr="eval: __config__.app.getNbDecimalDigitForQty()"/>
    <attribute name="scale" for="reservedQty"
      expr="eval: __config__.app.getNbDecimalDigitForQty()"/>
    <attribute name="scale" for="deliveredQty"
      expr="eval: __config__.app.getNbDecimalDigitForQty()"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-set-company-currency">
    <attribute name="value" for="$companyCurrency"
      expr="eval:__parent__?.company?.currency"
      if="__parent__ != null &amp;&amp; __parent__._model == 'com.axelor.apps.sale.db.SaleOrder'"/>
    <attribute name="value" for="$companyCurrency"
      expr="eval:saleOrder?.company?.currency" if="saleOrder != null"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-hidden-fields-for-client">
    <attribute name="hidden" for="toInvoice,allPanelTab,marginPanel"
      if="eval: __user__.group?.isClient" expr="true"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-hide-panel">
    <attribute name="hidden"
      for="stockMoveLineOfSOPanel,projectTaskListPanel,invoicingFollowUpPanel" expr="true"
      if="__parent__?.statusSelect == __repo__(SaleOrder).STATUS_DRAFT_QUOTATION || __parent__?.statusSelect == __repo__(SaleOrder).STATUS_FINALIZED_QUOTATION"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-template-attrs-hidden-fields-for-client">
    <attribute name="hidden" for="allPanelTab" if="eval: __user__.group?.isClient"
      expr="true"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-show-delivery-panel">
    <attribute name="hidden" for="deliveryPanel"
      expr="eval: !__user__.getActiveCompany()?.getSupplyChainConfig()?.getHasOutSmForStorableProduct()"
      if="product?.productTypeSelect == 'storable'"/>
    <attribute name="hidden" for="deliveryPanel"
      expr="eval: !__user__.getActiveCompany()?.getSupplyChainConfig()?.getHasOutSmForNonStorableProduct()"
      if="product?.productTypeSelect == 'service'"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-fill-estimated-date">
    <attribute name="value" expr="eval: __parent__?.estimatedShippingDate"
      for="estimatedShippingDate"
      if="__parent__ != null &amp;&amp; __parent__._model == 'com.axelor.apps.sale.db.SaleOrder' &amp;&amp; deliveryState &lt; 2"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-selection-in-type-select">
    <attribute name="selection-in" for="typeSelect"
      expr="eval: __config__.app.getApp('sale')?.enablePackManagement ? [0,1,2,3] : [0,1]"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-delivered-qty-hidden">
    <attribute for="deliveredQty" name="hidden"
      expr="__parent__.statusSelect == 1 || __parent__.statusSelect == 2" if="__parent__ != null"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-display-different-language-message">
    <attribute for="$differentLanguageMessage" name="hidden"
      expr="eval: __parent__?.clientPartner?.language?.code?.equals(__user__.getLanguage())"
      if="__parent__"/>
    <attribute for="$partnerLanguage" name="value"
      expr="eval: __parent__?.clientPartner?.language?.code?.toUpperCase()" if="__parent__"/>

    <attribute for="$differentLanguageMessage" name="hidden"
      expr="eval: saleOrder?.clientPartner?.language?.code?.equals(__user__.getLanguage())"
      if="saleOrder"/>
    <attribute for="$partnerLanguage" name="value"
      expr="eval: saleOrder?.clientPartner?.language?.code?.toUpperCase()" if="saleOrder"/>
  </action-attrs>

  <action-attrs name="action-sale-order-attrs-hide-ati">
    <attribute name="hidden" for="exTaxTotal" expr="eval: __parent__.inAti"
      if="__parent__?._model == 'com.axelor.apps.sale.db.SaleOrder'"/>
    <attribute name="hidden" for="inTaxTotal" expr="eval: !__parent__.inAti"
      if="__parent__?._model == 'com.axelor.apps.sale.db.SaleOrder'"/>
    <attribute name="hidden" for="price" expr="eval: __parent__.inAti"
      if="__parent__?._model == 'com.axelor.apps.sale.db.SaleOrder'"/>
    <attribute name="hidden" for="inTaxPrice" expr="eval: !__parent__.inAti"
      if="__parent__?._model == 'com.axelor.apps.sale.db.SaleOrder'"/>

    <attribute name="hidden" for="exTaxTotal" expr="eval: saleOrder?.inAti"
      if="saleOrder != null &amp;&amp; __parent__?._model != 'com.axelor.apps.sale.db.SaleOrder'"/>
    <attribute name="hidden" for="inTaxTotal" expr="eval: !saleOrder?.inAti"
      if="saleOrder != null &amp;&amp; __parent__?._model != 'com.axelor.apps.sale.db.SaleOrder'"/>
    <attribute name="hidden" for="price" expr="eval: saleOrder?.inAti"
      if="saleOrder != null &amp;&amp; __parent__?._model != 'com.axelor.apps.sale.db.SaleOrder'"/>
    <attribute name="hidden" for="inTaxPrice" expr="eval: !saleOrder?.inAti"
      if="saleOrder != null &amp;&amp; __parent__?._model != 'com.axelor.apps.sale.db.SaleOrder'"/>
  </action-attrs>

  <action-attrs if-module="axelor-business-project"
    name="action-sale-order-line-attrs-title-project">
    <attribute name="title" for="project"
      expr="eval: __config__.app.getApp('project')?.getProjectLabel()"
      if=" __config__.app.isApp('project') &amp;&amp; !com.google.common.base.Strings.isNullOrEmpty( __config__.app.getApp('project')?.getProjectLabel())"/>
    <attribute name="title" for="projectPanel"
      expr="eval:  __config__.app.getApp('project')?.getProjectLabel()"
      if=" __config__.app.isApp('project') &amp;&amp; !com.google.common.base.Strings.isNullOrEmpty( __config__.app.getApp('project')?.getProjectLabel())"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-show-priceDiscounted">
    <attribute name="hidden" for="priceDiscounted" expr="eval: priceDiscounted == price"
      if="__parent__?._model == 'com.axelor.apps.sale.db.SaleOrder' &amp;&amp; !__parent__?.inAti"/>
    <attribute name="hidden" for="priceDiscounted"
      expr="eval: priceDiscounted == inTaxPrice"
      if="__parent__?._model == 'com.axelor.apps.sale.db.SaleOrder' &amp;&amp; __parent__?.inAti"/>
    <attribute name="hidden" for="priceDiscounted" expr="eval: priceDiscounted == price"
      if="saleOrder != null &amp;&amp; __parent__?._model != 'com.axelor.apps.sale.db.SaleOrder' &amp;&amp; !saleOrder?.inAti"/>
    <attribute name="hidden" for="priceDiscounted"
      expr="eval: priceDiscounted == inTaxPrice"
      if="saleOrder != null &amp;&amp; __parent__?._model != 'com.axelor.apps.sale.db.SaleOrder' &amp;&amp; saleOrder?.inAti"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-hide-qty-warning-label">
    <attribute name="hidden" for="multipleQtyNotRespectedLabel" expr="true"/>
    <attribute name="hidden" for="qtyValid" expr="true"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-show-availabilty-request">
    <attribute name="value" for="$availabiltyRequest"
      expr="eval:  id &amp;&amp; __repo__(StockMoveLine).all().filter('self.saleOrderLine.id = ? AND self.stockMove.availabilityRequest = TRUE AND self.stockMove.statusSelect = 2', __self__?.id).count() > 0"/>
  </action-attrs>

  <action-attrs name="action-sale-order-line-attrs-domain-project">
    <attribute name="domain" for="project"
      expr="eval: &quot; self.clientPartner.id = ${__parent__?.clientPartner?.id} AND self.isBusinessProject = true &quot;"
      if="__parent__?._model == 'com.axelor.apps.sale.db.SaleOrder'"/>
    <attribute name="domain" for="project"
      expr="eval: &quot; self.clientPartner.id = ${saleOrder.clientPartner?.id} AND self.isBusinessProject = true &quot;"
      if="saleOrder != null &amp;&amp; __parent__?._model != 'com.axelor.apps.sale.db.SaleOrder'"/>
  </action-attrs>

</object-views>
